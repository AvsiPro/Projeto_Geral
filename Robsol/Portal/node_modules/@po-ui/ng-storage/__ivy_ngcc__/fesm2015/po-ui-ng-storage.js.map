{"version":3,"file":"po-ui-ng-storage.js","sources":["../../../projects/storage/src/lib/drivers/lokijs/po-loki-driver.ts","../../../projects/storage/src/lib/services/po-storage.service.ts","../../../projects/storage/src/lib/po-storage.module.ts","../../../projects/storage/src/po-ui-ng-storage.ts"],"names":[],"mappings":"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","sourcesContent":["import Loki from 'lokijs';\r\nimport LokiIndexedAdapter from 'lokijs/src/loki-indexed-adapter';\r\n\r\nconst keyField = 'key';\r\n\r\nexport class PoLokiDriver {\r\n  private collection;\r\n  private db: any;\r\n  private driver: any;\r\n\r\n  constructor() {\r\n    const self = this;\r\n    this.driver = {\r\n      _driver: 'lokijs',\r\n      _initStorage: function (options: any) {\r\n        return self.initStorage(options);\r\n      },\r\n      clear: function () {\r\n        return self.clear(this);\r\n      },\r\n      getItem: function (key: any) {\r\n        return self.getItem(this, key);\r\n      },\r\n      iterate: function (iteratorCallback: any) {\r\n        return self.iterate(this, iteratorCallback);\r\n      },\r\n      key: function (n: any) {\r\n        return self.key(this, n);\r\n      },\r\n      keys: function () {\r\n        return self.keys(this);\r\n      },\r\n      length: function () {\r\n        return self.length(this);\r\n      },\r\n      removeItem: function (key: any) {\r\n        return self.removeItem(this, key);\r\n      },\r\n      setItem: function (key: any, value: any) {\r\n        return self.setItem(this, key, value);\r\n      }\r\n    };\r\n  }\r\n\r\n  // Funções de iteração\r\n\r\n  private clear(localforage: any) {\r\n    return new Promise(resolve => {\r\n      localforage.ready().then(() => {\r\n        if (this.hasCollectionAndDataInCollection()) {\r\n          this.clearCollection();\r\n        }\r\n        resolve(null);\r\n      });\r\n    });\r\n  }\r\n\r\n  private getItem(localforage: any, key: any) {\r\n    return new Promise(resolve => {\r\n      localforage.ready().then(() => {\r\n        if (this.hasCollectionAndDataInCollection()) {\r\n          const item = this.getItemInCollectionBy(keyField, key);\r\n          if (item) {\r\n            resolve(item.value);\r\n          }\r\n        }\r\n        resolve(null);\r\n      });\r\n    });\r\n  }\r\n\r\n  private initStorage(options: any) {\r\n    return new Promise(resolve => {\r\n      try {\r\n        this.configureLokiStorage(options, this.databaseInitialize.bind(this, options, resolve));\r\n      } catch {\r\n        throw new Error(`Cannot configure Loki Storage`);\r\n      }\r\n    });\r\n  }\r\n\r\n  private iterate(localforage: any, iteratorCallback: Function) {\r\n    return new Promise(resolve => {\r\n      localforage.ready().then(() => {\r\n        if (this.hasCollectionAndDataInCollection()) {\r\n          this.iterateWithDataItem(iteratorCallback);\r\n        }\r\n        resolve(null);\r\n      });\r\n    });\r\n  }\r\n\r\n  private key(localforage: any, n: string | number) {\r\n    return new Promise(resolve => {\r\n      localforage.ready().then(() => {\r\n        if (this.hasCollection()) {\r\n          const map = this.getLokiMap();\r\n          resolve(map[n]);\r\n        }\r\n        resolve(null);\r\n      });\r\n    });\r\n  }\r\n\r\n  private keys(localforage: any) {\r\n    return new Promise(resolve => {\r\n      localforage.ready().then(() => {\r\n        if (this.hasCollection()) {\r\n          const keys = [];\r\n          const map = this.getLokiMap();\r\n          for (const key of Object.keys(map)) {\r\n            keys.push(map[key]);\r\n          }\r\n          resolve(keys);\r\n        }\r\n        resolve(null);\r\n      });\r\n    });\r\n  }\r\n\r\n  private length(localforage: any) {\r\n    return new Promise(resolve => {\r\n      localforage.ready().then(() => {\r\n        if (this.hasCollection()) {\r\n          resolve(this.getNumberItensInCollection());\r\n        }\r\n        resolve(0);\r\n      });\r\n    });\r\n  }\r\n\r\n  private removeItem(localforage: any, key: any) {\r\n    return new Promise(resolve => {\r\n      localforage.ready().then(() => {\r\n        if (this.hasCollection()) {\r\n          this.findAndRemoveItem(key);\r\n        }\r\n        resolve(null);\r\n      });\r\n    });\r\n  }\r\n\r\n  private setItem(localforage: any, key: any, value: any) {\r\n    return new Promise(resolve => {\r\n      localforage.ready().then(() => {\r\n        if (this.hasCollection()) {\r\n          let item: any;\r\n          if (this.hasDataInCollection()) {\r\n            item = this.getItemInCollectionBy(keyField, key);\r\n          }\r\n          this.insertOrUpdate(item, value, key);\r\n        }\r\n        resolve(value);\r\n      });\r\n    });\r\n  }\r\n\r\n  // Funções de acesso ao storage\r\n\r\n  // eslint-disable-next-line @typescript-eslint/member-ordering\r\n  getDriver() {\r\n    return this.driver;\r\n  }\r\n\r\n  private addCollection(options: any): any {\r\n    return this.db.addCollection(options.storeName, { unique: [keyField] });\r\n  }\r\n\r\n  private clearCollection() {\r\n    this.collection.clear({ removeIndices: false });\r\n  }\r\n\r\n  private configureLokiStorage(options: any, databaseInitialize: any) {\r\n    const idbAdapter = new LokiIndexedAdapter();\r\n    this.db = new Loki(options.name, {\r\n      adapter: idbAdapter,\r\n      autoload: true,\r\n      autoloadCallback: databaseInitialize,\r\n      autosave: true,\r\n      autosaveInterval: 4000\r\n    });\r\n  }\r\n\r\n  private findAndRemoveItem(key: any) {\r\n    this.collection.findAndRemove({ [keyField]: key });\r\n  }\r\n\r\n  private getCollection(options: any): any {\r\n    return this.db.getCollection(options.storeName);\r\n  }\r\n\r\n  private databaseInitialize(options: any, resolve: Function) {\r\n    this.collection = this.getCollection(options);\r\n    if (!this.hasCollection()) {\r\n      this.collection = this.addCollection(options);\r\n    }\r\n    resolve();\r\n  }\r\n\r\n  private getItemInCollectionBy(fieldKey: string, key: any) {\r\n    return this.collection.by(fieldKey, key);\r\n  }\r\n\r\n  private getLokiMap() {\r\n    return this.collection.constraints.unique[keyField].lokiMap;\r\n  }\r\n\r\n  private hasCollection() {\r\n    return this.collection;\r\n  }\r\n\r\n  private hasDataInCollection() {\r\n    return this.collection.data && this.collection.data.length;\r\n  }\r\n\r\n  private hasCollectionAndDataInCollection() {\r\n    return this.hasCollection() && this.hasDataInCollection();\r\n  }\r\n\r\n  private insertOrUpdate(item: any, value: any, key: any) {\r\n    if (item) {\r\n      item.value = value;\r\n      this.collection.update(item);\r\n    } else {\r\n      this.collection.insert({ [keyField]: key, value: value });\r\n    }\r\n  }\r\n\r\n  private iterateWithDataItem(iteratorcallback: Function) {\r\n    this.collection.data.forEach(element => {\r\n      iteratorcallback(element.value, element[keyField], element.$loki);\r\n    });\r\n  }\r\n\r\n  private getNumberItensInCollection(): number {\r\n    return this.collection.count();\r\n  }\r\n}\r\n","import { Inject, Injectable, InjectionToken } from '@angular/core';\r\n\r\nimport * as LocalForage from 'localforage';\r\nimport 'localforage';\r\n\r\nimport IdleQueue from 'custom-idle-queue';\r\n\r\nimport { PoLokiDriver } from '../drivers/lokijs/po-loki-driver';\r\nimport { PoStorageConfig } from './po-storage-config.interface';\r\n\r\nexport const PO_STORAGE_CONFIG_TOKEN = new InjectionToken('PO_STORAGE_CONFIG_TOKEN');\r\n\r\n/**\r\n * @description\r\n *\r\n * O PO Storage é uma biblioteca que fornece um serviço para armazenamento de dados no dispositivo local, sendo semelhante\r\n * ao funcionamento do [IonicStorage](https://ionicframework.com/docs/storage/).\r\n * É possível utilizar os drivers [Websql](https://dev.w3.org/html5/webdatabase/), [Indexeddb](https://www.w3.org/TR/IndexedDB/),\r\n * [LocalStorage](https://html.spec.whatwg.org/multipage/webstorage.html) e também [LokiJS](https://github.com/techfort/LokiJS/wiki).\r\n *\r\n * Para um melhor ganho de performance ao buscar e salvar dados, recomendamos a utilização do `LokiJS`, um *database*\r\n * orientado a documento semelhante ao MongoDB, que além de permitir a persistência dos dados no dispositivo possibilita\r\n * também o armazenamento dos dados em memória. Outra vantagem, é o aumento do limite de armazenamento para\r\n * aproximadamente `300mb`.\r\n *\r\n * A estrutura utilizada para armazenar os dados é a de chave/valor, onde uma chave funciona como um identificador exclusivo.\r\n *\r\n * #### Instalando o PO Storage\r\n *\r\n * Para instalar o `po-storage` em sua aplicação execute o seguinte comando:\r\n *\r\n * ```shell\r\n * ng add @po-ui/ng-storage\r\n * ```\r\n * Será instalado o pacote `@po-ui/ng-storage` e também já importará `PoStorageModule` no módulo principal da sua aplicação, conforme abaixo:\r\n *\r\n * ```typescript\r\n * import { PoStorageModule } from '@po-ui/ng-storage';\r\n *\r\n * @NgModule({\r\n *  declarations: [...],\r\n *  imports: [\r\n *    // Importação do módulo PoStorageModule\r\n *    PoStorageModule.forRoot(),\r\n *  ],\r\n *  bootstrap: [IonicApp],\r\n *  providers: [...]\r\n * })\r\n * export class AppModule {}\r\n * ```\r\n *\r\n * Com a declaração do módulo, é criada uma base de dados no armazenamento local e o serviço `PoStorageService` estará\r\n * pronto para ser utilizada na sua aplicação.\r\n *\r\n * #### Configurando as opções de armazenamento\r\n *\r\n * Na importação do módulo, o método `PoStorageModule.forRoot()` pode receber como parâmetro um objeto do tipo\r\n * [`PoStorageConfig`](documentation/po-storage#po-storage-config),\r\n * que serve para configurar as opções personalizadas do armazenamento, como por exemplo: o tipo de armazenamento\r\n * preferêncial.\r\n *\r\n * Caso não seja passada nenhuma configuração a ordem padrão será: ['websql', 'indexeddb', 'localstorage', 'lokijs'].\r\n *\r\n * Abaixo segue um exemplo de configuração onde o storage preferencial passa a ser o `lokijs`:\r\n *\r\n * ```typescript\r\n * import { PoStorageModule } from '@po-ui/ng-storage';\r\n *\r\n * @NgModule({\r\n *  declarations: [...],\r\n *  imports: [\r\n *    // Importação do módulo PoStorageModule com a configuração personalizada\r\n *    PoStorageModule.forRoot({\r\n *      name: 'mystorage',\r\n *      storeName: '_mystore',\r\n *      driverOrder: ['lokijs', 'websql', 'indexeddb', 'localstorage']\r\n *    }),\r\n *  ],\r\n *  bootstrap: [IonicApp],\r\n *  providers: [...]\r\n * })\r\n * export class AppModule {}\r\n * ```\r\n */\r\n@Injectable()\r\nexport class PoStorageService {\r\n  private driver: string = null;\r\n  private idleQueue = new IdleQueue();\r\n  private storagePromise: Promise<LocalForage>;\r\n  private lokijsDriver: PoLokiDriver;\r\n\r\n  constructor(@Inject(PO_STORAGE_CONFIG_TOKEN) config?: PoStorageConfig) {\r\n    this.lokijsDriver = new PoLokiDriver();\r\n    this.setStoragePromise(config);\r\n  }\r\n\r\n  /**\r\n   * Retorna a configuração padrão para o armazenamento. Caso nenhuma configuração seja inserida,\r\n   * essa configuração será utilizada.\r\n   *\r\n   * @returns {PoStorageConfig} Objeto com a configuração padrão do armazenamento.\r\n   */\r\n  static getDefaultConfig(): PoStorageConfig {\r\n    return {\r\n      name: '_postorage',\r\n      storeName: '_pokv',\r\n      driverOrder: ['websql', 'indexeddb', 'localstorage', 'lokijs']\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Cria uma instância do `PoStorageService` com a configuração de armazenamento passada como parâmetro.\r\n   *\r\n   * @param {PoStorageConfig} storageConfig Configuração para o armazenamento.\r\n   * @returns {PoStorageService} Instância do `PoStorageService`.\r\n   */\r\n  static providePoStorage(storageConfig?: PoStorageConfig): PoStorageService {\r\n    return new PoStorageService(PoStorageService.getConfig(storageConfig));\r\n  }\r\n\r\n  private static getConfig(storageConfig?: PoStorageConfig) {\r\n    return storageConfig || PoStorageService.getDefaultConfig();\r\n  }\r\n\r\n  /**\r\n   * Busca uma lista armazenada pela chave e concatena com a lista passada por parâmetro.\r\n   *\r\n   * Por exemplo:\r\n   *\r\n   * ``` typescript\r\n   * const clients = [ { name: 'Marie', age: 23 }, { name: 'Pether', age: 39 }];\r\n   *\r\n   * this.poStorageService.set('clientKey', clients).then(() => {});\r\n   *\r\n   * ...\r\n   *\r\n   * const newClients = [ { name: 'Lisa', age: 36 }, { name: 'Bruce', age: 18 } ];\r\n   *\r\n   * this.poStorageService.appendArrayToArray('clientKey', newClients).then(() => {\r\n   *   // A lista agora será:\r\n   *   // [ { name: 'Marie', age: 23 }, { name: 'Pether', age: 39 }, { name: 'Lisa', age: 36 }, { name: 'Bruce', age: 18 }];\r\n   * });\r\n   * ```\r\n   *\r\n   * @param {string} key Chave da lista armazenada.\r\n   * @param {Array} value Lista que será concatenada.\r\n   *\r\n   * @returns {Promise<any>} Promessa que é resolvida após as duas listas serem concatenadas e armazenadas localmente.\r\n   */\r\n  async appendArrayToArray(key: string, value: Array<any>): Promise<any> {\r\n    const data = await this.getArrayOfStorage(key);\r\n\r\n    const newData = [...data, ...value];\r\n    return this.set(key, newData);\r\n  }\r\n\r\n  /**\r\n   * Acrescenta um item em uma lista armazenada pela chave.\r\n   *\r\n   * @param {string} key Chave da lista armazenada.\r\n   * @param {Array} value Item que será acrescentado na lista.\r\n   *\r\n   * @returns {Promise<any>} Promessa que é resolvida após o item ser acrescentado na lista armazenada.\r\n   */\r\n  async appendItemToArray(key: string, value: any): Promise<any> {\r\n    const data = await this.getArrayOfStorage(key);\r\n\r\n    data.push(value);\r\n    return this.set(key, data);\r\n  }\r\n\r\n  /**\r\n   * Remove todos os itens da base de dados local configurada na declaração do módulo `PoStorageModule`.\r\n   *\r\n   * > Utilize este método com cautela, para evitar a perda indesejada de dados.\r\n   *\r\n   * @returns {Promise<void>} Promessa que é resolvida após todos os itens da base de dados local serem removidos.\r\n   */\r\n  clear(): Promise<void> {\r\n    return this.storagePromise.then(store => store.clear());\r\n  }\r\n\r\n  /**\r\n   * Verifica se existe um valor dentro de uma determinada chave.\r\n   *\r\n   * @param {string} key Chave que será verificada.\r\n   *\r\n   * @returns {Promise<boolean>} Promessa que é resolvida quando a verificação da existência do valor na chave é concluída.\r\n   */\r\n  exists(key: string): Promise<boolean> {\r\n    return this.get(key).then(data => Promise.resolve(data !== null));\r\n  }\r\n\r\n  /**\r\n   * Itera sobre todas as chaves armazenadas.\r\n   *\r\n   * @param {any} iteratorCallback Função de `callback` que é chamada a cada iteração, com os seguintes parâmetros:\r\n   * valor, chave e número da iteração.\r\n   *\r\n   * Exemplo de utilização:\r\n   *\r\n   * ``` typescript\r\n   * this.poStorageService.forEach((value: any, key: string, iterationNumber: number) => {\r\n   *   // Iteração sobre cada chave armazenada.\r\n   * });\r\n   * ```\r\n   *\r\n   * @returns {Promise<void>} Promessa que é resolvida após a iteração sobre todas as chaves armazenadas.\r\n   */\r\n  forEach(iteratorCallback: (value: any, key: string, iterationNumber: number) => any): Promise<void> {\r\n    return this.storagePromise.then(store => store.iterate(iteratorCallback));\r\n  }\r\n\r\n  /**\r\n   * Retorna o valor armazenado em uma determinada chave.\r\n   *\r\n   * @param {string} key Chave que identifica o item.\r\n   * @param {boolean} lock Define se irá travar a leitura e a escrita da base de dados para não ser acessada de forma paralela.\r\n   * Caso outra leitura/escrita já tenha sido iniciada, este método irá esperar o outro terminar para então começar.\r\n   *\r\n   * Padrão: `false`.\r\n   *\r\n   * > Esta definição só será válida se o outro acesso paralelo a este método também estiver com o parâmetro *lock* ativado.\r\n   * @returns {Promise<any>} Promessa que é resolvida após o item ser buscado.\r\n   */\r\n  async get(key: string, lock: boolean = false): Promise<any> {\r\n    if (lock) {\r\n      await this.requestIdlePromise();\r\n      return await this.idleQueue.wrapCall(async () => {\r\n        await this.getImmutableItem(key);\r\n      });\r\n    }\r\n    return await this.getImmutableItem(key);\r\n  }\r\n\r\n  /**\r\n   * Retorna o nome do *driver* que está sendo usado para armazenar os dados, por exemplo: localStorage.\r\n   *\r\n   * @returns {string | null} Nome do *driver*.\r\n   */\r\n  getDriver(): string {\r\n    return this.driver;\r\n  }\r\n\r\n  /**\r\n   * Retorna o primeiro item de uma lista para uma determinada chave.\r\n   *\r\n   * @param {string} key Chave da lista.\r\n   * @returns {Promise<any>} Promessa que é resolvida após o primeiro item ser encontrado.\r\n   */\r\n  getFirstItem(key: string): Promise<any> {\r\n    return this.get(key).then((data: Array<any>) => Promise.resolve(data ? data[0] : null));\r\n  }\r\n\r\n  /**\r\n   * Remove o primeiro item de uma lista a partir da chave.\r\n   *\r\n   * @param {string} key Chave da lista que será removido o primeiro item.\r\n   * @returns {Promise<any>} Promessa que é resolvida após o primeiro item da lista ser removido.\r\n   */\r\n  getItemAndRemove(key: string): Promise<any> {\r\n    return this.get(key).then((data: Array<any>) => {\r\n      if (data === null) {\r\n        return null;\r\n      }\r\n\r\n      const item = data.shift();\r\n      return this.set(key, data).then(() => Promise.resolve(item));\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Busca o primeiro objeto encontrado dentro de uma lista pelo do valor de um campo.\r\n   *\r\n   * Por exemplo:\r\n   *\r\n   * ``` typescript\r\n   * const clients = [ { name: 'Marie', age: 23 }, { name: 'Pether', age: 39 }];\r\n   *\r\n   * this.poStorageService.set('clientKey', clients).then(() => {});\r\n   *\r\n   * ...\r\n   *\r\n   * this.poStorageService.getItemByField('clientKey', 'name', 'Marie').then(client => {\r\n   *   // Resultado do console.log: { name: 'Marie', age: 23 }\r\n   *   console.log(client);\r\n   * });\r\n   * ```\r\n   *\r\n   * @param {string} key Chave da lista.\r\n   * @param {string} fieldName O campo a ser filtrado.\r\n   * @param {any} fieldValue O valor do campo.\r\n   * @returns {Promise<any>} Promessa que é resolvida com o item que foi encontrado.\r\n   */\r\n  getItemByField(key: string, fieldName: string, fieldValue: any): Promise<any> {\r\n    return this.get(key).then((storageRecords: Array<any>) => {\r\n      let storageRecordsFiltered = storageRecords.find(storageRecord => storageRecord[fieldName] === fieldValue);\r\n      storageRecordsFiltered = storageRecordsFiltered || null;\r\n\r\n      return Promise.resolve(storageRecordsFiltered);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Lista com todas as chaves armazenadas.\r\n   *\r\n   * @returns {Promise<Array<string>>} Promessa que é resolvida com todas as chaves armazenadas.\r\n   */\r\n  keys(): Promise<Array<string>> {\r\n    return this.storagePromise.then(store => store.keys());\r\n  }\r\n\r\n  /**\r\n   * Quantidade de chaves armazenadas.\r\n   *\r\n   * @returns {Promise<number>} Promessa que é resolvida com o número de chaves armazenadas.\r\n   */\r\n  length(): Promise<number> {\r\n    return this.storagePromise.then(store => store.length());\r\n  }\r\n\r\n  /**\r\n   * Utilizado para gerenciar o bloqueio e desbloqueio de recursos no `PoStorageService`.\r\n   * Aguardando a liberação da utilização dos recursos que participam deste comportamento e posteriormente envolve o recurso\r\n   * passado como parâmetro em um comportamento de bloqueio e desbloqueio.\r\n   *\r\n   * Este método se comporta igual a utilização em conjunta dos métodos: `PoStorageService.requestIdlePromise()`,\r\n   * `PoStorageService.lock()` e `PoStorageService.unlook()`.\r\n   *\r\n   * Veja mais no método: [`PoStorage.requestIdlePromise()`](documentation/po-storage#request-idle-promise).\r\n   *\r\n   * @param {Function} limitedResource Função que será envolvida no comportamento de bloqueio e desbloqueio.\r\n   */\r\n  async limitedCallWrap(limitedResource: Function): Promise<any> {\r\n    await this.requestIdlePromise();\r\n    return this.idleQueue.wrapCall(limitedResource);\r\n  }\r\n\r\n  /**\r\n   * Incrementa um valor na fila de bloqueio do `PoStorageService`. Utilizado juntamente com o método `unlock` para poder\r\n   * controlar a execução de uma determinada tarefa com o `PoStorage.requestIdlePromise()`.\r\n   *\r\n   * Veja mais no método: [`PoStorage.requestIdlePromise()`](documentation/po-storage#request-idle-promise).\r\n   */\r\n  lock() {\r\n    this.idleQueue.lock();\r\n  }\r\n\r\n  /**\r\n   * Determina se o processo de inicialização do *driver* assíncrono foi concluído.\r\n   *\r\n   * @returns {Promise<LocalForage>} Promessa que é resolvida quando o processo de inicialização do *driver* assíncrono\r\n   * for concluído.\r\n   */\r\n  ready(): Promise<LocalForage> {\r\n    return this.storagePromise;\r\n  }\r\n\r\n  /**\r\n   * Remove um valor associado a uma chave.\r\n   *\r\n   * @param {key} key Chave do valor que será removido.\r\n   * @returns {Promise<any>} Promessa que é resolvida após o valor ser removido.\r\n   */\r\n  remove(key: string): Promise<any> {\r\n    return this.storagePromise.then(store => store.removeItem(key));\r\n  }\r\n\r\n  /**\r\n   * Remove uma propriedade de um objeto armazenado.\r\n   *\r\n   * @param {string} key Chave do objeto armazenado.\r\n   * @param {string} property Propriedade que será removida.\r\n   *\r\n   * @returns {Promise<any>} Promessa que é resolvida após a propriedade ser removida.\r\n   */\r\n  async removeIndexFromObject(key: string, property: string): Promise<any> {\r\n    const data = await this.getObjectOfStorage(key);\r\n\r\n    delete data[property];\r\n    return this.set(key, data);\r\n  }\r\n\r\n  /**\r\n   * Remove um objeto de uma lista armazenada pelo valor de uma propriedade.\r\n   *\r\n   * Por exemplo:\r\n   *\r\n   * ``` typescript\r\n   * const clients = [ { name: 'Marie', age: 23 }, { name: 'Pether', age: 39 }];\r\n   *\r\n   * this.poStorageService.set('clientKey', clients).then(() => {});\r\n   *\r\n   * ...\r\n   *\r\n   * this.poStorageService.removeItemFromArray('clientKey', 'name', 'Marie').then(() => {\r\n   *   // O objeto { name: 'Marie', age: 23 } foi removido da lista que está na chave 'clientKey'\r\n   * });\r\n   * ```\r\n   *\r\n   * @param {string} key Chave da lista que contém o item que será removido.\r\n   * @param {string} field O campo a ser filtrado no item.\r\n   * @param {string} value O valor do filtro.\r\n   * @returns {Promise<any>} Promessa que é resolvida quando o objeto for removido da lista.\r\n   */\r\n  async removeItemFromArray(key: string, field: string, value: any): Promise<any> {\r\n    let data = await this.getArrayOfStorage(key);\r\n\r\n    data = data.filter(item => item[field] !== value);\r\n    return this.set(key, data);\r\n  }\r\n\r\n  /**\r\n   * <a id=\"request-idle-promise\"></a>\r\n   * Método que verifica se o acesso a base de dados configurada está liberado.\r\n   *\r\n   * Utilizado em conjunto com os métodos `lock()` e `unlock()` entre tarefas que não podem ser executadas de forma\r\n   * paralela, para não causar inconsistências nos dados.\r\n   *\r\n   * Exemplo de utilização:\r\n   *\r\n   * ```\r\n   * // Aguarda a liberação para continuar\r\n   * await this.poStorage.requestIdlePromise();\r\n   *\r\n   * this.poStorage.lock();\r\n   *\r\n   * // Executa uma tarefa que irá ler e/ou escrever na base de dados configurada.\r\n   *\r\n   * this.poStorage.unlock();\r\n   * ```\r\n   *\r\n   * > É importante sempre utilizá-lo antes de executar os métodos `lock()` e `unlock()` para garantir que a tarefa só\r\n   * será executada caso o acesso esteja livre.\r\n   *\r\n   * @returns {Promise<any>} Promessa que é resolvida quando o acesso a base de dados configurada estiver liberado.\r\n   */\r\n  requestIdlePromise(): Promise<any> {\r\n    return this.idleQueue.requestIdlePromise();\r\n  }\r\n\r\n  /**\r\n   * Grava um valor em uma determinada chave.\r\n   *\r\n   * @param {string} key Chave para o valor que será gravado.\r\n   * @param {any} value Valor que será gravado.\r\n   * @param {boolean} lock Define se irá travar a leitura e a escrita da base de dados para não ser acessada de forma paralela.\r\n   * Caso outra leitura/escrita já tenha sido iniciada, este método irá esperar o outro terminar para então começar.\r\n   *\r\n   * Padrão: `false`.\r\n   *\r\n   * > Esta definição só será válida se o outro acesso paralelo a este método também estiver com o parâmetro *lock* ativado.\r\n   * @returns {Promise<any>} Promessa que é resolvida após o valor ter sido gravado.\r\n   */\r\n  async set(key: string, value: any, lock: boolean = false): Promise<any> {\r\n    const store = await this.storagePromise;\r\n    const newValue = typeof value === 'object' ? JSON.parse(JSON.stringify(value)) : value;\r\n\r\n    if (lock) {\r\n      await this.requestIdlePromise();\r\n      return this.idleQueue.wrapCall(() => store.setItem(key, newValue));\r\n    }\r\n\r\n    return store.setItem(key, newValue);\r\n  }\r\n\r\n  /**\r\n   * Atribui um valor a uma propriedade de um objeto armazenado pela chave.\r\n   *\r\n   * Por exemplo:\r\n   *\r\n   * ``` typescript\r\n   * const clients = [ { name: 'Marie', age: 23 }, { name: 'Pether', age: 39 }];\r\n   *\r\n   * this.poStorageService.set('clientKey', clients).then(() => {});\r\n   *\r\n   * ...\r\n   *\r\n   * this.poStorageService.setIndexToObject('clientKey', 'name', 'Clare').then(() => {\r\n   *   // O objeto { name: 'Marie', age: 23 } passa a ser { name: 'Clare', age: 23 }\r\n   * });\r\n   * ```\r\n   *\r\n   * @param {string} key Chave do objeto.\r\n   * @param {string} property Nome da propriedade do objeto.\r\n   * @param {any} value Valor que será gravado na propriedade do objeto.\r\n   */\r\n  async setIndexToObject(key: string, property: string, value: any): Promise<any> {\r\n    const data = await this.getObjectOfStorage(key);\r\n\r\n    data[property] = value;\r\n    return this.set(key, data);\r\n  }\r\n\r\n  /**\r\n   * Decrementa um valor na fila de bloqueio. Utilizado juntamente com o método `lock` para poder\r\n   * controlar a execução de uma determinada tarefa com o `PoStorage.requestIdlePromise()`.\r\n   *\r\n   * Veja mais no método: [`PoStorage.requestIdlePromise()`](documentation/po-storage#request-idle-promise).\r\n   */\r\n  unlock() {\r\n    this.idleQueue.unlock();\r\n  }\r\n\r\n  private async getArrayOfStorage(key: string) {\r\n    const data = await this.get(key);\r\n    return data || [];\r\n  }\r\n\r\n  private async getImmutableItem(key: string) {\r\n    const store = await this.storagePromise;\r\n    const items = await store.getItem(key);\r\n    return items ? JSON.parse(JSON.stringify(items)) : null;\r\n  }\r\n\r\n  private async defineLocalForageDriver(localForageInstance: any, driverOrder) {\r\n    await localForageInstance.defineDriver(this.lokijsDriver.getDriver());\r\n    await this.setDriver(localForageInstance, driverOrder);\r\n    return localForageInstance;\r\n  }\r\n\r\n  private getDriverOrder(driverOrder: Array<string>): Array<string> {\r\n    return driverOrder.map(driver => {\r\n      switch (driver) {\r\n        case 'indexeddb':\r\n          return LocalForage.INDEXEDDB;\r\n        case 'websql':\r\n          return LocalForage.WEBSQL;\r\n        case 'localstorage':\r\n          return LocalForage.LOCALSTORAGE;\r\n        default:\r\n          return driver;\r\n      }\r\n    });\r\n  }\r\n\r\n  private async getObjectOfStorage(key: string) {\r\n    const data = await this.get(key);\r\n    return data || {};\r\n  }\r\n\r\n  private async setDriver(localForageInstance: LocalForage, driverOrder) {\r\n    await localForageInstance.setDriver(this.getDriverOrder(driverOrder));\r\n    this.driver = localForageInstance.driver();\r\n  }\r\n\r\n  private setStoragePromise(config: PoStorageConfig) {\r\n    this.storagePromise = this.getStorageInstance(config);\r\n  }\r\n\r\n  private async getStorageInstance(config: PoStorageConfig) {\r\n    const defaultConfig = PoStorageService.getDefaultConfig();\r\n    const actualConfig = Object.assign(defaultConfig, config || {});\r\n\r\n    const localForageInstance = LocalForage.createInstance(actualConfig);\r\n\r\n    try {\r\n      return await this.defineLocalForageDriver(localForageInstance, actualConfig.driverOrder);\r\n    } catch {\r\n      throw new Error(`Cannot use this drivers: ${actualConfig.driverOrder.join(', ')}.`);\r\n    }\r\n  }\r\n}\r\n","import { ModuleWithProviders, NgModule } from '@angular/core';\r\n\r\nimport { PoStorageConfig } from './services/po-storage-config.interface';\r\nimport { PoStorageService, PO_STORAGE_CONFIG_TOKEN } from './services/po-storage.service';\r\n\r\n/**\r\n * @description\r\n *\r\n * Módulo do componente PoStorage responsável por manipular o storage do browser.\r\n */\r\n\r\n@NgModule()\r\nexport class PoStorageModule {\r\n  static forRoot(storageConfig?: PoStorageConfig): ModuleWithProviders<PoStorageModule> {\r\n    return {\r\n      ngModule: PoStorageModule,\r\n      providers: [\r\n        {\r\n          provide: PO_STORAGE_CONFIG_TOKEN,\r\n          useValue: storageConfig || PoStorageService.getDefaultConfig()\r\n        },\r\n        {\r\n          provide: PoStorageService,\r\n          useFactory: PoStorageService.providePoStorage,\r\n          deps: [PO_STORAGE_CONFIG_TOKEN]\r\n        }\r\n      ]\r\n    };\r\n  }\r\n}\r\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public-api';\n\nexport {PO_STORAGE_CONFIG_TOKEN as ɵa} from './lib/services/po-storage.service';"]}