import { ElementRef, Injectable } from '@angular/core';
/**
 * @docsPrivate
 * @description
 *
 * Serviço responsável por gerenciar as posições de um elemento em relação a um elemento alvo. Ele pode receber as
 * seguintes posições:
 *
 * - `right`: Posiciona o elemento no lado direito do componente alvo.
 * - `right-bottom`: Posiciona o elemento no lado direito inferior do componente alvo.
 * - `right-top`: Posiciona o elemento no lado direito superior do componente alvo.
 * - `bottom`: Posiciona o elemento abaixo do componente alvo.
 * - `bottom-left`: Posiciona o elemento abaixo e à esquerda do componente alvo.
 * - `bottom-right`: Posiciona o elemento abaixo e à direita do componente alvo.
 * - `left`: Posiciona o elemento no lado esquerdo do componente alvo.
 * - `left-top`: Posiciona o elemento no lado esquerdo superior do componente alvo.
 * - `left-bottom`: Posiciona o elemento no lado esquerdo inferior do componente alvo.
 * - `top`: Posiciona o elemento acima do componente alvo.
 * - `top-right`: Posiciona o elemento acima e à direita do componente alvo.
 * - `top-left`: Posiciona o elemento acima e à esquerda do componente alvo.
 *
 * Caso o elemento não caiba na tela na posição indicada ele será rotacionado automaticamente para se adequar,
 * inicialmente no lado definido como padrão e em seguida seguindo o sentido horário.
 */
const poControlPositionSidesDefault = [
    'bottom',
    'bottom-left',
    'bottom-right',
    'left',
    'left-top',
    'left-bottom',
    'top',
    'top-right',
    'top-left',
    'right',
    'right-bottom',
    'right-top'
];
export class PoControlPositionService {
    constructor() {
        this.differenceDiagonalToWidthArrow = 3;
        this.isSetElementWidth = false;
        // offset da seta em relação ao canto do componente
        this.offsetArrow = 12;
    }
    /**
     * @description Ajusta a posição do elemento, caso não couber em tela irá para próxima posição.
     *
     * @param value posição para exibição do elemento
     */
    adjustPosition(value) {
        const position = value || 'bottom';
        this.elementPosition(position);
        this.customPositions && this.customPositions.length
            ? this.adjustCustomPosition(position)
            : this.adjustDefaultPosition(position);
    }
    /**
     * @description Retorna a direção da seta, conforme a posição do elemento.
     */
    getArrowDirection() {
        return this.arrowDirection;
    }
    /**
     * @description Método responsável por definir as propriedades utilizadas para exibir o elemento na posição correta.
     *
     * @param element elemento que será exibido
     * @param elementOffset offSet do elemento
     * @param targetElement elemento de onde deve partir a exibição
     * @param customPositions posições que sobrescreve as posições padrões
     * @param isSetElementWidth indica se deve definir o tamanho do elemento a ser exibido, caso for verdadeiro será igual do targetElement
     * @param isCornerAligned indica se o elemento filho será alinhado nos cantos do elemneto pai.
     */
    setElements(element, elementOffset, targetElement, customPositions, isSetElementWidth = false, isCornerAligned = false) {
        this.element = element instanceof ElementRef ? element.nativeElement : element;
        this.targetElement = targetElement instanceof ElementRef ? targetElement.nativeElement : targetElement;
        this.elementOffset = elementOffset;
        this.customPositions = customPositions;
        this.isSetElementWidth = isSetElementWidth;
        this.isCornerAligned = isCornerAligned;
    }
    adjustCustomPosition(position) {
        const positionLength = this.customPositions.length;
        let sidesCount = 0;
        while (sidesCount++ < positionLength) {
            if (this.overflowAllSides(position)) {
                position = this.nextPosition(position, this.customPositions);
                this.elementPosition(position);
            }
        }
    }
    adjustDefaultPosition(position) {
        const mainPositions = this.getMainPositions();
        const mainPositionLength = mainPositions.length;
        let mainSidesCount = 0;
        while (mainSidesCount++ < mainPositionLength) {
            const mainPosition = this.getMainPosition(position);
            this.elementPosition(position);
            if (this.overflowMain(mainPosition)) {
                position = this.nextPosition(mainPosition, mainPositions);
                continue;
            }
            else if (this.overflowAllSides(position)) {
                this.verifySubPositions(position);
                return;
            }
            return;
        }
    }
    elementPosition(position) {
        this.isCornerAligned ? this.setAlignedElementPosition(position) : this.setElementPosition(position);
    }
    getMainPosition(position) {
        return position.indexOf('-') > -1 ? position.substring(0, position.indexOf('-')) : position;
    }
    getMainPositions() {
        const defaultMainPositions = ['top', 'right', 'bottom', 'left'];
        return this.customPositions && this.customPositions.length
            ? this.getMainPositionsByCustomPositions(this.customPositions)
            : defaultMainPositions;
    }
    getMainPositionsByCustomPositions(customPositions) {
        const mainPositions = [];
        const customPositionsLength = customPositions.length;
        for (let i = 0; i < customPositionsLength; i++) {
            const position = customPositions[i];
            const mainPosition = this.getMainPosition(position);
            if (!mainPositions.includes(mainPosition)) {
                mainPositions.push(mainPosition);
            }
        }
        return mainPositions;
    }
    getOverflows() {
        const sizesAndPositions = this.getSizesAndPositions();
        return {
            right: sizesAndPositions.element.right > sizesAndPositions.window.innerWidth,
            top: sizesAndPositions.element.top <= 0,
            left: sizesAndPositions.element.left <= 0,
            bottom: sizesAndPositions.element.bottom > sizesAndPositions.window.innerHeight
        };
    }
    getSizesAndPositions() {
        return {
            window: {
                scrollY: window.scrollY,
                scrollX: window.scrollX,
                innerWidth: window.innerWidth,
                innerHeight: window.innerHeight
            },
            element: this.element.getBoundingClientRect(),
            target: this.targetElement ? this.targetElement.getBoundingClientRect() : { top: 0, bottom: 0, right: 0, left: 0 }
        };
    }
    nextPosition(position, positions = []) {
        const index = positions.indexOf(position);
        const nextIndex = index + 1;
        if (index > -1 && nextIndex < positions.length) {
            return positions[nextIndex];
        }
        else {
            return positions[0];
        }
    }
    overflowAllSides(position) {
        const overflows = this.getOverflows();
        switch (position) {
            case 'top':
                return overflows.top || overflows.right || overflows.left;
            case 'top-right':
                return overflows.top || overflows.right || overflows.left;
            case 'top-left':
                return overflows.top || overflows.left || overflows.right;
            case 'right':
                return overflows.right || overflows.top || overflows.bottom;
            case 'right-top':
                return overflows.right || overflows.top;
            case 'right-bottom':
                return overflows.right || overflows.bottom;
            case 'bottom':
                return overflows.bottom || overflows.right || overflows.left;
            case 'bottom-right':
                return overflows.bottom || overflows.right || overflows.left;
            case 'bottom-left':
                return overflows.bottom || overflows.left || overflows.right;
            case 'left':
                return overflows.left || overflows.top || overflows.bottom;
            case 'left-top':
                return overflows.left || overflows.top;
            case 'left-bottom':
                return overflows.left || overflows.bottom;
        }
    }
    overflowMain(position) {
        const overflows = this.getOverflows();
        switch (position) {
            case 'top':
                return overflows.top;
            case 'right':
                return overflows.right;
            case 'bottom':
                return overflows.bottom;
            case 'left':
                return overflows.left;
        }
    }
    setAlignedArrowDirection(elementPosition) {
        switch (elementPosition) {
            case 'top-left':
                return 'bottom-left';
            case 'top-right':
                return 'bottom-right';
            case 'bottom-right':
                return 'top-right';
            case 'bottom-left':
                return 'top-left';
        }
    }
    setAlignedBottomPositions(displacement, sizesAndPositions) {
        this.element.style.top = sizesAndPositions.target.bottom + this.elementOffset + 'px';
        this.element.style.left = sizesAndPositions.target.left - displacement + 'px';
    }
    setAlignedElementPosition(position) {
        this.setElementWidth();
        const sizesAndPositions = this.getSizesAndPositions();
        switch (position) {
            case 'bottom-left':
                this.setAlignedBottomPositions(0, sizesAndPositions);
                break;
            case 'bottom-right':
                this.setAlignedBottomPositions(sizesAndPositions.element.width - sizesAndPositions.target.width, sizesAndPositions);
                break;
            case 'top-left':
                this.setAlignedTopPositions(0, sizesAndPositions);
                break;
            case 'top-right':
                this.setAlignedTopPositions(sizesAndPositions.element.width - sizesAndPositions.target.width, sizesAndPositions);
                break;
        }
        this.arrowDirection = this.setAlignedArrowDirection(position);
    }
    setAlignedTopPositions(displacement, sizesAndPositions) {
        this.element.style.top =
            sizesAndPositions.target.top - sizesAndPositions.element.height - this.elementOffset + 'px';
        this.element.style.left = sizesAndPositions.target.left - displacement + 'px';
    }
    setArrowDirection(elementPosition) {
        switch (elementPosition) {
            case 'top':
                return 'bottom';
            case 'top-left':
                return 'bottom-right';
            case 'top-right':
                return 'bottom-left';
            case 'right':
                return 'left';
            case 'right-top':
                return 'left-bottom';
            case 'right-bottom':
                return 'left-top';
            case 'bottom':
                return 'top';
            case 'bottom-right':
                return 'top-left';
            case 'bottom-left':
                return 'top-right';
            case 'left':
                return 'right';
            case 'left-bottom':
                return 'right-top';
            case 'left-top':
                return 'right-bottom';
        }
    }
    setBottomPositions(displacement, sizesAndPositions) {
        this.element.style.top = sizesAndPositions.target.bottom + this.elementOffset + 'px';
        this.element.style.left = sizesAndPositions.target.left + sizesAndPositions.target.width / 2 - displacement + 'px';
    }
    setElementPosition(position) {
        this.setElementWidth();
        const sizesAndPositions = this.getSizesAndPositions();
        switch (position) {
            case 'top':
                this.setTopPositions(sizesAndPositions.element.width / 2, sizesAndPositions);
                break;
            case 'top-left':
                this.setTopPositions(sizesAndPositions.element.width - this.offsetArrow - this.differenceDiagonalToWidthArrow, sizesAndPositions);
                break;
            case 'top-right':
                this.setTopPositions(this.offsetArrow + this.differenceDiagonalToWidthArrow, sizesAndPositions);
                break;
            case 'right':
                this.setRightPositions(sizesAndPositions.element.height / 2, sizesAndPositions);
                break;
            case 'right-top':
                this.setRightPositions(sizesAndPositions.element.height - this.offsetArrow - this.differenceDiagonalToWidthArrow, sizesAndPositions);
                break;
            case 'right-bottom':
                this.setRightPositions(this.offsetArrow, sizesAndPositions);
                break;
            case 'bottom':
                this.setBottomPositions(sizesAndPositions.element.width / 2, sizesAndPositions);
                break;
            case 'bottom-right':
                this.setBottomPositions(this.offsetArrow + this.differenceDiagonalToWidthArrow, sizesAndPositions);
                break;
            case 'bottom-left':
                this.setBottomPositions(sizesAndPositions.element.width - this.offsetArrow - this.differenceDiagonalToWidthArrow, sizesAndPositions);
                break;
            case 'left':
                this.setLeftPositions(sizesAndPositions.element.height / 2, sizesAndPositions);
                break;
            case 'left-bottom':
                this.setLeftPositions(this.offsetArrow, sizesAndPositions);
                break;
            case 'left-top':
                this.setLeftPositions(sizesAndPositions.element.height - this.offsetArrow, sizesAndPositions);
                break;
        }
        this.arrowDirection = this.setArrowDirection(position);
    }
    setElementWidth() {
        if (this.isSetElementWidth && this.targetElement) {
            this.element.style.width = `${this.targetElement.clientWidth}px`;
        }
    }
    setLeftPositions(displacement, sizesAndPositions) {
        this.element.style.top = sizesAndPositions.target.top - displacement + sizesAndPositions.target.height / 2 + 'px';
        this.element.style.left =
            sizesAndPositions.target.left - sizesAndPositions.element.width - this.elementOffset + 'px';
    }
    setRightPositions(displacement, sizesAndPositions) {
        this.element.style.top = sizesAndPositions.target.top - displacement + sizesAndPositions.target.height / 2 + 'px';
        this.element.style.left = sizesAndPositions.target.right + this.elementOffset + 'px';
    }
    setTopPositions(displacement, sizesAndPositions) {
        this.element.style.top =
            sizesAndPositions.target.top - sizesAndPositions.element.height - this.elementOffset + 'px';
        this.element.style.left = sizesAndPositions.target.left + sizesAndPositions.target.width / 2 - displacement + 'px';
    }
    verifySubPositions(position) {
        if (position.indexOf('-') > -1) {
            position = position.substring(0, position.indexOf('-'));
            this.elementPosition(position);
        }
        let align = 0;
        while (align++ < 3) {
            if (this.overflowAllSides(position)) {
                position = this.nextPosition(position, poControlPositionSidesDefault);
                this.elementPosition(position);
            }
            else {
                return null;
            }
        }
    }
}
PoControlPositionService.decorators = [
    { type: Injectable }
];
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG8tY29udHJvbC1wb3NpdGlvbi5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vcHJvamVjdHMvdWkvc3JjL2xpYi9zZXJ2aWNlcy9wby1jb250cm9sLXBvc2l0aW9uL3BvLWNvbnRyb2wtcG9zaXRpb24uc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsVUFBVSxFQUFFLFVBQVUsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUV2RDs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztHQXNCRztBQUVILE1BQU0sNkJBQTZCLEdBQWtCO0lBQ25ELFFBQVE7SUFDUixhQUFhO0lBQ2IsY0FBYztJQUNkLE1BQU07SUFDTixVQUFVO0lBQ1YsYUFBYTtJQUNiLEtBQUs7SUFDTCxXQUFXO0lBQ1gsVUFBVTtJQUNWLE9BQU87SUFDUCxjQUFjO0lBQ2QsV0FBVztDQUNaLENBQUM7QUFHRixNQUFNLE9BQU8sd0JBQXdCO0lBRHJDO1FBSVUsbUNBQThCLEdBQVcsQ0FBQyxDQUFDO1FBSTNDLHNCQUFpQixHQUFZLEtBQUssQ0FBQztRQUMzQyxtREFBbUQ7UUFDM0MsZ0JBQVcsR0FBVyxFQUFFLENBQUM7SUE4WG5DLENBQUM7SUEzWEM7Ozs7T0FJRztJQUNILGNBQWMsQ0FBQyxLQUFhO1FBQzFCLE1BQU0sUUFBUSxHQUFHLEtBQUssSUFBSSxRQUFRLENBQUM7UUFDbkMsSUFBSSxDQUFDLGVBQWUsQ0FBQyxRQUFRLENBQUMsQ0FBQztRQUMvQixJQUFJLENBQUMsZUFBZSxJQUFJLElBQUksQ0FBQyxlQUFlLENBQUMsTUFBTTtZQUNqRCxDQUFDLENBQUMsSUFBSSxDQUFDLG9CQUFvQixDQUFDLFFBQVEsQ0FBQztZQUNyQyxDQUFDLENBQUMsSUFBSSxDQUFDLHFCQUFxQixDQUFDLFFBQVEsQ0FBQyxDQUFDO0lBQzNDLENBQUM7SUFFRDs7T0FFRztJQUNILGlCQUFpQjtRQUNmLE9BQU8sSUFBSSxDQUFDLGNB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LFFBQVEsQ0FBQyxDQUFDO1NBQ2hDO1FBRUQsSUFBSSxLQUFLLEdBQUcsQ0FBQyxDQUFDO1FBQ2QsT0FBTyxLQUFLLEVBQUUsR0FBRyxDQUFDLEVBQUU7WUFDbEIsSUFBSSxJQUFJLENBQUMsZ0JBQWdCLENBQUMsUUFBUSxDQUFDLEVBQUU7Z0JBQ25DLFFBQVEsR0FBRyxJQUFJLENBQUMsWUFBWSxDQUFDLFFBQVEsRUFBRSw2QkFBNkIsQ0FBQyxDQUFDO2dCQUN0RSxJQUFJLENBQUMsZUFBZSxDQUFDLFFBQVEsQ0FBQyxDQUFDO2FBQ2hDO2lCQUFNO2dCQUNMLE9BQU8sSUFBSSxDQUFDO2FBQ2I7U0FDRjtJQUNILENBQUM7OztZQXZZRixVQUFVIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgRWxlbWVudFJlZiwgSW5qZWN0YWJsZSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5cclxuLyoqXHJcbiAqIEBkb2NzUHJpdmF0ZVxyXG4gKiBAZGVzY3JpcHRpb25cclxuICpcclxuICogU2VydmnDp28gcmVzcG9uc8OhdmVsIHBvciBnZXJlbmNpYXIgYXMgcG9zacOnw7VlcyBkZSB1bSBlbGVtZW50byBlbSByZWxhw6fDo28gYSB1bSBlbGVtZW50byBhbHZvLiBFbGUgcG9kZSByZWNlYmVyIGFzXHJcbiAqIHNlZ3VpbnRlcyBwb3Npw6fDtWVzOlxyXG4gKlxyXG4gKiAtIGByaWdodGA6IFBvc2ljaW9uYSBvIGVsZW1lbnRvIG5vIGxhZG8gZGlyZWl0byBkbyBjb21wb25lbnRlIGFsdm8uXHJcbiAqIC0gYHJpZ2h0LWJvdHRvbWA6IFBvc2ljaW9uYSBvIGVsZW1lbnRvIG5vIGxhZG8gZGlyZWl0byBpbmZlcmlvciBkbyBjb21wb25lbnRlIGFsdm8uXHJcbiAqIC0gYHJpZ2h0LXRvcGA6IFBvc2ljaW9uYSBvIGVsZW1lbnRvIG5vIGxhZG8gZGlyZWl0byBzdXBlcmlvciBkbyBjb21wb25lbnRlIGFsdm8uXHJcbiAqIC0gYGJvdHRvbWA6IFBvc2ljaW9uYSBvIGVsZW1lbnRvIGFiYWl4byBkbyBjb21wb25lbnRlIGFsdm8uXHJcbiAqIC0gYGJvdHRvbS1sZWZ0YDogUG9zaWNpb25hIG8gZWxlbWVudG8gYWJhaXhvIGUgw6AgZXNxdWVyZGEgZG8gY29tcG9uZW50ZSBhbHZvLlxyXG4gKiAtIGBib3R0b20tcmlnaHRgOiBQb3NpY2lvbmEgbyBlbGVtZW50byBhYmFpeG8gZSDDoCBkaXJlaXRhIGRvIGNvbXBvbmVudGUgYWx2by5cclxuICogLSBgbGVmdGA6IFBvc2ljaW9uYSBvIGVsZW1lbnRvIG5vIGxhZG8gZXNxdWVyZG8gZG8gY29tcG9uZW50ZSBhbHZvLlxyXG4gKiAtIGBsZWZ0LXRvcGA6IFBvc2ljaW9uYSBvIGVsZW1lbnRvIG5vIGxhZG8gZXNxdWVyZG8gc3VwZXJpb3IgZG8gY29tcG9uZW50ZSBhbHZvLlxyXG4gKiAtIGBsZWZ0LWJvdHRvbWA6IFBvc2ljaW9uYSBvIGVsZW1lbnRvIG5vIGxhZG8gZXNxdWVyZG8gaW5mZXJpb3IgZG8gY29tcG9uZW50ZSBhbHZvLlxyXG4gKiAtIGB0b3BgOiBQb3NpY2lvbmEgbyBlbGVtZW50byBhY2ltYSBkbyBjb21wb25lbnRlIGFsdm8uXHJcbiAqIC0gYHRvcC1yaWdodGA6IFBvc2ljaW9uYSBvIGVsZW1lbnRvIGFjaW1hIGUgw6AgZGlyZWl0YSBkbyBjb21wb25lbnRlIGFsdm8uXHJcbiAqIC0gYHRvcC1sZWZ0YDogUG9zaWNpb25hIG8gZWxlbWVudG8gYWNpbWEgZSDDoCBlc3F1ZXJkYSBkbyBjb21wb25lbnRlIGFsdm8uXHJcbiAqXHJcbiAqIENhc28gbyBlbGVtZW50byBuw6NvIGNhaWJhIG5hIHRlbGEgbmEgcG9zacOnw6NvIGluZGljYWRhIGVsZSBzZXLDoSByb3RhY2lvbmFkbyBhdXRvbWF0aWNhbWVudGUgcGFyYSBzZSBhZGVxdWFyLFxyXG4gKiBpbmljaWFsbWVudGUgbm8gbGFkbyBkZWZpbmlkbyBjb21vIHBhZHLDo28gZSBlbSBzZWd1aWRhIHNlZ3VpbmRvIG8gc2VudGlkbyBob3LDoXJpby5cclxuICovXHJcblxyXG5jb25zdCBwb0NvbnRyb2xQb3NpdGlvblNpZGVzRGVmYXVsdDogQXJyYXk8c3RyaW5nPiA9IFtcclxuICAnYm90dG9tJyxcclxuICAnYm90dG9tLWxlZnQnLFxyXG4gICdib3R0b20tcmlnaHQnLFxyXG4gICdsZWZ0JyxcclxuICAnbGVmdC10b3AnLFxyXG4gICdsZWZ0LWJvdHRvbScsXHJcbiAgJ3RvcCcsXHJcbiAgJ3RvcC1yaWdodCcsXHJcbiAgJ3RvcC1sZWZ0JyxcclxuICAncmlnaHQnLFxyXG4gICdyaWdodC1ib3R0b20nLFxyXG4gICdyaWdodC10b3AnXHJcbl07XHJcblxyXG5ASW5qZWN0YWJsZSgpXHJcbmV4cG9ydCBjbGFzcyBQb0NvbnRyb2xQb3NpdGlvblNlcnZpY2Uge1xyXG4gIHByaXZhdGUgYXJyb3dEaXJlY3Rpb246IHN0cmluZztcclxuICBwcml2YXRlIGN1c3RvbVBvc2l0aW9uczogQXJyYXk8c3RyaW5nPjtcclxuICBwcml2YXRlIGRpZmZlcmVuY2VEaWFnb25hbFRvV2lkdGhBcnJvdzogbnVtYmVyID0gMztcclxuICBwcml2YXRlIGVsZW1lbnQ6IEhUTUxFbGVtZW50O1xyXG4gIHByaXZhdGUgZWxlbWVudE9mZnNldDogbnVtYmVyO1xyXG4gIHByaXZhdGUgaXNDb3JuZXJBbGlnbmVkOiBib29sZWFuO1xyXG4gIHByaXZhdGUgaXNTZXRFbGVtZW50V2lkdGg6IGJvb2xlYW4gPSBmYWxzZTtcclxuICAvLyBvZmZzZXQgZGEgc2V0YSBlbSByZWxhw6fDo28gYW8gY2FudG8gZG8gY29tcG9uZW50ZVxyXG4gIHByaXZhdGUgb2Zmc2V0QXJyb3c6IG51bWJlciA9IDEyO1xyXG4gIHByaXZhdGUgdGFyZ2V0RWxlbWVudDogSFRNTEVsZW1lbnQ7XHJcblxyXG4gIC8qKlxyXG4gICAqIEBkZXNjcmlwdGlvbiBBanVzdGEgYSBwb3Npw6fDo28gZG8gZWxlbWVudG8sIGNhc28gbsOjbyBjb3ViZXIgZW0gdGVsYSBpcsOhIHBhcmEgcHLDs3hpbWEgcG9zacOnw6NvLlxyXG4gICAqXHJcbiAgICogQHBhcmFtIHZhbHVlIHBvc2nDp8OjbyBwYXJhIGV4aWJpw6fDo28gZG8gZWxlbWVudG9cclxuICAgKi9cclxuICBhZGp1c3RQb3NpdGlvbih2YWx1ZTogc3RyaW5nKSB7XHJcbiAgICBjb25zdCBwb3NpdGlvbiA9IHZhbHVlIHx8ICdib3R0b20nO1xyXG4gICAgdGhpcy5lbGVtZW50UG9zaXRpb24ocG9zaXRpb24pO1xyXG4gICAgdGhpcy5jdXN0b21Qb3NpdGlvbnMgJiYgdGhpcy5jdXN0b21Qb3NpdGlvbnMubGVuZ3RoXHJcbiAgICAgID8gdGhpcy5hZGp1c3RDdXN0b21Qb3NpdGlvbihwb3NpdGlvbilcclxuICAgICAgOiB0aGlzLmFkanVzdERlZmF1bHRQb3NpdGlvbihwb3NpdGlvbik7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBAZGVzY3JpcHRpb24gUmV0b3JuYSBhIGRpcmXDp8OjbyBkYSBzZXRhLCBjb25mb3JtZSBhIHBvc2nDp8OjbyBkbyBlbGVtZW50by5cclxuICAgKi9cclxuICBnZXRBcnJvd0RpcmVjdGlvbigpIHtcclxuICAgIHJldHVybiB0aGlzLmFycm93RGlyZWN0aW9uO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQGRlc2NyaXB0aW9uIE3DqXRvZG8gcmVzcG9uc8OhdmVsIHBvciBkZWZpbmlyIGFzIHByb3ByaWVkYWRlcyB1dGlsaXphZGFzIHBhcmEgZXhpYmlyIG8gZWxlbWVudG8gbmEgcG9zacOnw6NvIGNvcnJldGEuXHJcbiAgICpcclxuICAgKiBAcGFyYW0gZWxlbWVudCBlbGVtZW50byBxdWUgc2Vyw6EgZXhpYmlkb1xyXG4gICAqIEBwYXJhbSBlbGVtZW50T2Zmc2V0IG9mZlNldCBkbyBlbGVtZW50b1xyXG4gICAqIEBwYXJhbSB0YXJnZXRFbGVtZW50IGVsZW1lbnRvIGRlIG9uZGUgZGV2ZSBwYXJ0aXIgYSBleGliacOnw6NvXHJcbiAgICogQHBhcmFtIGN1c3RvbVBvc2l0aW9ucyBwb3Npw6fDtWVzIHF1ZSBzb2JyZXNjcmV2ZSBhcyBwb3Npw6fDtWVzIHBhZHLDtWVzXHJcbiAgICogQHBhcmFtIGlzU2V0RWxlbWVudFdpZHRoIGluZGljYSBzZSBkZXZlIGRlZmluaXIgbyB0YW1hbmhvIGRvIGVsZW1lbnRvIGEgc2VyIGV4aWJpZG8sIGNhc28gZm9yIHZlcmRhZGVpcm8gc2Vyw6EgaWd1YWwgZG8gdGFyZ2V0RWxlbWVudFxyXG4gICAqIEBwYXJhbSBpc0Nvcm5lckFsaWduZWQgaW5kaWNhIHNlIG8gZWxlbWVudG8gZmlsaG8gc2Vyw6EgYWxpbmhhZG8gbm9zIGNhbnRvcyBkbyBlbGVtbmV0byBwYWkuXHJcbiAgICovXHJcbiAgc2V0RWxlbWVudHMoXHJcbiAgICBlbGVtZW50OiBFbGVtZW50UmVmIHwgSFRNTEVsZW1lbnQsXHJcbiAgICBlbGVtZW50T2Zmc2V0OiBudW1iZXIsXHJcbiAgICB0YXJnZXRFbGVtZW50OiBFbGVtZW50UmVmIHwgSFRNTEVsZW1lbnQsXHJcbiAgICBjdXN0b21Qb3NpdGlvbnM/OiBBcnJheTxzdHJpbmc+LFxyXG4gICAgaXNTZXRFbGVtZW50V2lkdGg6IGJvb2xlYW4gPSBmYWxzZSxcclxuICAgIGlzQ29ybmVyQWxpZ25lZDogYm9vbGVhbiA9IGZhbHNlXHJcbiAgKSB7XHJcbiAgICB0aGlzLmVsZW1lbnQgPSBlbGVtZW50IGluc3RhbmNlb2YgRWxlbWVudFJlZiA/IGVsZW1lbnQubmF0aXZlRWxlbWVudCA6IGVsZW1lbnQ7XHJcbiAgICB0aGlzLnRhcmdldEVsZW1lbnQgPSB0YXJnZXRFbGVtZW50IGluc3RhbmNlb2YgRWxlbWVudFJlZiA/IHRhcmdldEVsZW1lbnQubmF0aXZlRWxlbWVudCA6IHRhcmdldEVsZW1lbnQ7XHJcblxyXG4gICAgdGhpcy5lbGVtZW50T2Zmc2V0ID0gZWxlbWVudE9mZnNldDtcclxuXHJcbiAgICB0aGlzLmN1c3RvbVBvc2l0aW9ucyA9IGN1c3RvbVBvc2l0aW9ucztcclxuICAgIHRoaXMuaXNTZXRFbGVtZW50V2lkdGggPSBpc1NldEVsZW1lbnRXaWR0aDtcclxuICAgIHRoaXMuaXNDb3JuZXJBbGlnbmVkID0gaXNDb3JuZXJBbGlnbmVkO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBhZGp1c3RDdXN0b21Qb3NpdGlvbihwb3NpdGlvbjogc3RyaW5nKSB7XHJcbiAgICBjb25zdCBwb3NpdGlvbkxlbmd0aCA9IHRoaXMuY3VzdG9tUG9zaXRpb25zLmxlbmd0aDtcclxuXHJcbiAgICBsZXQgc2lkZXNDb3VudCA9IDA7XHJcblxyXG4gICAgd2hpbGUgKHNpZGVzQ291bnQrKyA8IHBvc2l0aW9uTGVuZ3RoKSB7XHJcbiAgICAgIGlmICh0aGlzLm92ZXJmbG93QWxsU2lkZXMocG9zaXRpb24pKSB7XHJcbiAgICAgICAgcG9zaXRpb24gPSB0aGlzLm5leHRQb3NpdGlvbihwb3NpdGlvbiwgdGhpcy5jdXN0b21Qb3NpdGlvbnMpO1xyXG4gICAgICAgIHRoaXMuZWxlbWVudFBvc2l0aW9uKHBvc2l0aW9uKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBhZGp1c3REZWZhdWx0UG9zaXRpb24ocG9zaXRpb246IHN0cmluZykge1xyXG4gICAgY29uc3QgbWFpblBvc2l0aW9ucyA9IHRoaXMuZ2V0TWFpblBvc2l0aW9ucygpO1xyXG4gICAgY29uc3QgbWFpblBvc2l0aW9uTGVuZ3RoID0gbWFpblBvc2l0aW9ucy5sZW5ndGg7XHJcblxyXG4gICAgbGV0IG1haW5TaWRlc0NvdW50ID0gMDtcclxuXHJcbiAgICB3aGlsZSAobWFpblNpZGVzQ291bnQrKyA8IG1haW5Qb3NpdGlvbkxlbmd0aCkge1xyXG4gICAgICBjb25zdCBtYWluUG9zaXRpb24gPSB0aGlzLmdldE1haW5Qb3NpdGlvbihwb3NpdGlvbik7XHJcbiAgICAgIHRoaXMuZWxlbWVudFBvc2l0aW9uKHBvc2l0aW9uKTtcclxuXHJcbiAgICAgIGlmICh0aGlzLm92ZXJmbG93TWFpbihtYWluUG9zaXRpb24pKSB7XHJcbiAgICAgICAgcG9zaXRpb24gPSB0aGlzLm5leHRQb3NpdGlvbihtYWluUG9zaXRpb24sIG1haW5Qb3NpdGlvbnMpO1xyXG4gICAgICAgIGNvbnRpbnVlO1xyXG4gICAgICB9IGVsc2UgaWYgKHRoaXMub3ZlcmZsb3dBbGxTaWRlcyhwb3NpdGlvbikpIHtcclxuICAgICAgICB0aGlzLnZlcmlmeVN1YlBvc2l0aW9ucyhwb3NpdGlvbik7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgICB9XHJcblxyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGVsZW1lbnRQb3NpdGlvbihwb3NpdGlvbjogc3RyaW5nKSB7XHJcbiAgICB0aGlzLmlzQ29ybmVyQWxpZ25lZCA/IHRoaXMuc2V0QWxpZ25lZEVsZW1lbnRQb3NpdGlvbihwb3NpdGlvbikgOiB0aGlzLnNldEVsZW1lbnRQb3NpdGlvbihwb3NpdGlvbik7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGdldE1haW5Qb3NpdGlvbihwb3NpdGlvbjogc3RyaW5nKSB7XHJcbiAgICByZXR1cm4gcG9zaXRpb24uaW5kZXhPZignLScpID4gLTEgPyBwb3NpdGlvbi5zdWJzdHJpbmcoMCwgcG9zaXRpb24uaW5kZXhPZignLScpKSA6IHBvc2l0aW9uO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBnZXRNYWluUG9zaXRpb25zKCkge1xyXG4gICAgY29uc3QgZGVmYXVsdE1haW5Qb3NpdGlvbnMgPSBbJ3RvcCcsICdyaWdodCcsICdib3R0b20nLCAnbGVmdCddO1xyXG5cclxuICAgIHJldHVybiB0aGlzLmN1c3RvbVBvc2l0aW9ucyAmJiB0aGlzLmN1c3RvbVBvc2l0aW9ucy5sZW5ndGhcclxuICAgICAgPyB0aGlzLmdldE1haW5Qb3NpdGlvbnNCeUN1c3RvbVBvc2l0aW9ucyh0aGlzLmN1c3RvbVBvc2l0aW9ucylcclxuICAgICAgOiBkZWZhdWx0TWFpblBvc2l0aW9ucztcclxuICB9XHJcblxyXG4gIHByaXZhdGUgZ2V0TWFpblBvc2l0aW9uc0J5Q3VzdG9tUG9zaXRpb25zKGN1c3RvbVBvc2l0aW9uczogQXJyYXk8c3RyaW5nPikge1xyXG4gICAgY29uc3QgbWFpblBvc2l0aW9ucyA9IFtdO1xyXG4gICAgY29uc3QgY3VzdG9tUG9zaXRpb25zTGVuZ3RoID0gY3VzdG9tUG9zaXRpb25zLmxlbmd0aDtcclxuXHJcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGN1c3RvbVBvc2l0aW9uc0xlbmd0aDsgaSsrKSB7XHJcbiAgICAgIGNvbnN0IHBvc2l0aW9uID0gY3VzdG9tUG9zaXRpb25zW2ldO1xyXG5cclxuICAgICAgY29uc3QgbWFpblBvc2l0aW9uID0gdGhpcy5nZXRNYWluUG9zaXRpb24ocG9zaXRpb24pO1xyXG5cclxuICAgICAgaWYgKCFtYWluUG9zaXRpb25zLmluY2x1ZGVzKG1haW5Qb3NpdGlvbikpIHtcclxuICAgICAgICBtYWluUG9zaXRpb25zLnB1c2gobWFpblBvc2l0aW9uKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBtYWluUG9zaXRpb25zO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBnZXRPdmVyZmxvd3MoKSB7XHJcbiAgICBjb25zdCBzaXplc0FuZFBvc2l0aW9ucyA9IHRoaXMuZ2V0U2l6ZXNBbmRQb3NpdGlvbnMoKTtcclxuXHJcbiAgICByZXR1cm4ge1xyXG4gICAgICByaWdodDogc2l6ZXNBbmRQb3NpdGlvbnMuZWxlbWVudC5yaWdodCA+IHNpemVzQW5kUG9zaXRpb25zLndpbmRvdy5pbm5lcldpZHRoLFxyXG4gICAgICB0b3A6IHNpemVzQW5kUG9zaXRpb25zLmVsZW1lbnQudG9wIDw9IDAsXHJcbiAgICAgIGxlZnQ6IHNpemVzQW5kUG9zaXRpb25zLmVsZW1lbnQubGVmdCA8PSAwLFxyXG4gICAgICBib3R0b206IHNpemVzQW5kUG9zaXRpb25zLmVsZW1lbnQuYm90dG9tID4gc2l6ZXNBbmRQb3NpdGlvbnMud2luZG93LmlubmVySGVpZ2h0XHJcbiAgICB9O1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBnZXRTaXplc0FuZFBvc2l0aW9ucygpIHtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIHdpbmRvdzoge1xyXG4gICAgICAgIHNjcm9sbFk6IHdpbmRvdy5zY3JvbGxZLFxyXG4gICAgICAgIHNjcm9sbFg6IHdpbmRvdy5zY3JvbGxYLFxyXG4gICAgICAgIGlubmVyV2lkdGg6IHdpbmRvdy5pbm5lcldpZHRoLFxyXG4gICAgICAgIGlubmVySGVpZ2h0OiB3aW5kb3cuaW5uZXJIZWlnaHRcclxuICAgICAgfSxcclxuICAgICAgZWxlbWVudDogdGhpcy5lbGVtZW50LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLFxyXG4gICAgICB0YXJnZXQ6IHRoaXMudGFyZ2V0RWxlbWVudCA/IHRoaXMudGFyZ2V0RWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKSA6IHsgdG9wOiAwLCBib3R0b206IDAsIHJpZ2h0OiAwLCBsZWZ0OiAwIH1cclxuICAgIH07XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIG5leHRQb3NpdGlvbihwb3NpdGlvbjogc3RyaW5nLCBwb3NpdGlvbnM6IEFycmF5PHN0cmluZz4gPSBbXSk6IHN0cmluZyB7XHJcbiAgICBjb25zdCBpbmRleCA9IHBvc2l0aW9ucy5pbmRleE9mKHBvc2l0aW9uKTtcclxuICAgIGNvbnN0IG5leHRJbmRleCA9IGluZGV4ICsgMTtcclxuXHJcbiAgICBpZiAoaW5kZXggPiAtMSAmJiBuZXh0SW5kZXggPCBwb3NpdGlvbnMubGVuZ3RoKSB7XHJcbiAgICAgIHJldHVybiBwb3NpdGlvbnNbbmV4dEluZGV4XTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHJldHVybiBwb3NpdGlvbnNbMF07XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIG92ZXJmbG93QWxsU2lkZXMocG9zaXRpb246IHN0cmluZykge1xyXG4gICAgY29uc3Qgb3ZlcmZsb3dzID0gdGhpcy5nZXRPdmVyZmxvd3MoKTtcclxuXHJcbiAgICBzd2l0Y2ggKHBvc2l0aW9uKSB7XHJcbiAgICAgIGNhc2UgJ3RvcCc6XHJcbiAgICAgICAgcmV0dXJuIG92ZXJmbG93cy50b3AgfHwgb3ZlcmZsb3dzLnJpZ2h0IHx8IG92ZXJmbG93cy5sZWZ0O1xyXG4gICAgICBjYXNlICd0b3AtcmlnaHQnOlxyXG4gICAgICAgIHJldHVybiBvdmVyZmxvd3MudG9wIHx8IG92ZXJmbG93cy5yaWdodCB8fCBvdmVyZmxvd3MubGVmdDtcclxuICAgICAgY2FzZSAndG9wLWxlZnQnOlxyXG4gICAgICAgIHJldHVybiBvdmVyZmxvd3MudG9wIHx8IG92ZXJmbG93cy5sZWZ0IHx8IG92ZXJmbG93cy5yaWdodDtcclxuICAgICAgY2FzZSAncmlnaHQnOlxyXG4gICAgICAgIHJldHVybiBvdmVyZmxvd3MucmlnaHQgfHwgb3ZlcmZsb3dzLnRvcCB8fCBvdmVyZmxvd3MuYm90dG9tO1xyXG4gICAgICBjYXNlICdyaWdodC10b3AnOlxyXG4gICAgICAgIHJldHVybiBvdmVyZmxvd3MucmlnaHQgfHwgb3ZlcmZsb3dzLnRvcDtcclxuICAgICAgY2FzZSAncmlnaHQtYm90dG9tJzpcclxuICAgICAgICByZXR1cm4gb3ZlcmZsb3dzLnJpZ2h0IHx8IG92ZXJmbG93cy5ib3R0b207XHJcbiAgICAgIGNhc2UgJ2JvdHRvbSc6XHJcbiAgICAgICAgcmV0dXJuIG92ZXJmbG93cy5ib3R0b20gfHwgb3ZlcmZsb3dzLnJpZ2h0IHx8IG92ZXJmbG93cy5sZWZ0O1xyXG4gICAgICBjYXNlICdib3R0b20tcmlnaHQnOlxyXG4gICAgICAgIHJldHVybiBvdmVyZmxvd3MuYm90dG9tIHx8IG92ZXJmbG93cy5yaWdodCB8fCBvdmVyZmxvd3MubGVmdDtcclxuICAgICAgY2FzZSAnYm90dG9tLWxlZnQnOlxyXG4gICAgICAgIHJldHVybiBvdmVyZmxvd3MuYm90dG9tIHx8IG92ZXJmbG93cy5sZWZ0IHx8IG92ZXJmbG93cy5yaWdodDtcclxuICAgICAgY2FzZSAnbGVmdCc6XHJcbiAgICAgICAgcmV0dXJuIG92ZXJmbG93cy5sZWZ0IHx8IG92ZXJmbG93cy50b3AgfHwgb3ZlcmZsb3dzLmJvdHRvbTtcclxuICAgICAgY2FzZSAnbGVmdC10b3AnOlxyXG4gICAgICAgIHJldHVybiBvdmVyZmxvd3MubGVmdCB8fCBvdmVyZmxvd3MudG9wO1xyXG4gICAgICBjYXNlICdsZWZ0LWJvdHRvbSc6XHJcbiAgICAgICAgcmV0dXJuIG92ZXJmbG93cy5sZWZ0IHx8IG92ZXJmbG93cy5ib3R0b207XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIG92ZXJmbG93TWFpbihwb3NpdGlvbjogc3RyaW5nKSB7XHJcbiAgICBjb25zdCBvdmVyZmxvd3MgPSB0aGlzLmdldE92ZXJmbG93cygpO1xyXG5cclxuICAgIHN3aXRjaCAocG9zaXRpb24pIHtcclxuICAgICAgY2FzZSAndG9wJzpcclxuICAgICAgICByZXR1cm4gb3ZlcmZsb3dzLnRvcDtcclxuICAgICAgY2FzZSAncmlnaHQnOlxyXG4gICAgICAgIHJldHVybiBvdmVyZmxvd3MucmlnaHQ7XHJcbiAgICAgIGNhc2UgJ2JvdHRvbSc6XHJcbiAgICAgICAgcmV0dXJuIG92ZXJmbG93cy5ib3R0b207XHJcbiAgICAgIGNhc2UgJ2xlZnQnOlxyXG4gICAgICAgIHJldHVybiBvdmVyZmxvd3MubGVmdDtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHByaXZhdGUgc2V0QWxpZ25lZEFycm93RGlyZWN0aW9uKGVsZW1lbnRQb3NpdGlvbjogc3RyaW5nKSB7XHJcbiAgICBzd2l0Y2ggKGVsZW1lbnRQb3NpdGlvbikge1xyXG4gICAgICBjYXNlICd0b3AtbGVmdCc6XHJcbiAgICAgICAgcmV0dXJuICdib3R0b20tbGVmdCc7XHJcbiAgICAgIGNhc2UgJ3RvcC1yaWdodCc6XHJcbiAgICAgICAgcmV0dXJuICdib3R0b20tcmlnaHQnO1xyXG4gICAgICBjYXNlICdib3R0b20tcmlnaHQnOlxyXG4gICAgICAgIHJldHVybiAndG9wLXJpZ2h0JztcclxuICAgICAgY2FzZSAnYm90dG9tLWxlZnQnOlxyXG4gICAgICAgIHJldHVybiAndG9wLWxlZnQnO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBzZXRBbGlnbmVkQm90dG9tUG9zaXRpb25zKGRpc3BsYWNlbWVudDogbnVtYmVyLCBzaXplc0FuZFBvc2l0aW9ucykge1xyXG4gICAgdGhpcy5lbGVtZW50LnN0eWxlLnRvcCA9IHNpemVzQW5kUG9zaXRpb25zLnRhcmdldC5ib3R0b20gKyB0aGlzLmVsZW1lbnRPZmZzZXQgKyAncHgnO1xyXG4gICAgdGhpcy5lbGVtZW50LnN0eWxlLmxlZnQgPSBzaXplc0FuZFBvc2l0aW9ucy50YXJnZXQubGVmdCAtIGRpc3BsYWNlbWVudCArICdweCc7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIHNldEFsaWduZWRFbGVtZW50UG9zaXRpb24ocG9zaXRpb246IHN0cmluZykge1xyXG4gICAgdGhpcy5zZXRFbGVtZW50V2lkdGgoKTtcclxuXHJcbiAgICBjb25zdCBzaXplc0FuZFBvc2l0aW9uczogYW55ID0gdGhpcy5nZXRTaXplc0FuZFBvc2l0aW9ucygpO1xyXG5cclxuICAgIHN3aXRjaCAocG9zaXRpb24pIHtcclxuICAgICAgY2FzZSAnYm90dG9tLWxlZnQnOlxyXG4gICAgICAgIHRoaXMuc2V0QWxpZ25lZEJvdHRvbVBvc2l0aW9ucygwLCBzaXplc0FuZFBvc2l0aW9ucyk7XHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICAgIGNhc2UgJ2JvdHRvbS1yaWdodCc6XHJcbiAgICAgICAgdGhpcy5zZXRBbGlnbmVkQm90dG9tUG9zaXRpb25zKFxyXG4gICAgICAgICAgc2l6ZXNBbmRQb3NpdGlvbnMuZWxlbWVudC53aWR0aCAtIHNpemVzQW5kUG9zaXRpb25zLnRhcmdldC53aWR0aCxcclxuICAgICAgICAgIHNpemVzQW5kUG9zaXRpb25zXHJcbiAgICAgICAgKTtcclxuICAgICAgICBicmVhaztcclxuICAgICAgY2FzZSAndG9wLWxlZnQnOlxyXG4gICAgICAgIHRoaXMuc2V0QWxpZ25lZFRvcFBvc2l0aW9ucygwLCBzaXplc0FuZFBvc2l0aW9ucyk7XHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICAgIGNhc2UgJ3RvcC1yaWdodCc6XHJcbiAgICAgICAgdGhpcy5zZXRBbGlnbmVkVG9wUG9zaXRpb25zKFxyXG4gICAgICAgICAgc2l6ZXNBbmRQb3NpdGlvbnMuZWxlbWVudC53aWR0aCAtIHNpemVzQW5kUG9zaXRpb25zLnRhcmdldC53aWR0aCxcclxuICAgICAgICAgIHNpemVzQW5kUG9zaXRpb25zXHJcbiAgICAgICAgKTtcclxuICAgICAgICBicmVhaztcclxuICAgIH1cclxuXHJcbiAgICB0aGlzLmFycm93RGlyZWN0aW9uID0gdGhpcy5zZXRBbGlnbmVkQXJyb3dEaXJlY3Rpb24ocG9zaXRpb24pO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBzZXRBbGlnbmVkVG9wUG9zaXRpb25zKGRpc3BsYWNlbWVudDogbnVtYmVyLCBzaXplc0FuZFBvc2l0aW9ucykge1xyXG4gICAgdGhpcy5lbGVtZW50LnN0eWxlLnRvcCA9XHJcbiAgICAgIHNpemVzQW5kUG9zaXRpb25zLnRhcmdldC50b3AgLSBzaXplc0FuZFBvc2l0aW9ucy5lbGVtZW50LmhlaWdodCAtIHRoaXMuZWxlbWVudE9mZnNldCArICdweCc7XHJcbiAgICB0aGlzLmVsZW1lbnQuc3R5bGUubGVmdCA9IHNpemVzQW5kUG9zaXRpb25zLnRhcmdldC5sZWZ0IC0gZGlzcGxhY2VtZW50ICsgJ3B4JztcclxuICB9XHJcblxyXG4gIHByaXZhdGUgc2V0QXJyb3dEaXJlY3Rpb24oZWxlbWVudFBvc2l0aW9uOiBzdHJpbmcpIHtcclxuICAgIHN3aXRjaCAoZWxlbWVudFBvc2l0aW9uKSB7XHJcbiAgICAgIGNhc2UgJ3RvcCc6XHJcbiAgICAgICAgcmV0dXJuICdib3R0b20nO1xyXG4gICAgICBjYXNlICd0b3AtbGVmdCc6XHJcbiAgICAgICAgcmV0dXJuICdib3R0b20tcmlnaHQnO1xyXG4gICAgICBjYXNlICd0b3AtcmlnaHQnOlxyXG4gICAgICAgIHJldHVybiAnYm90dG9tLWxlZnQnO1xyXG4gICAgICBjYXNlICdyaWdodCc6XHJcbiAgICAgICAgcmV0dXJuICdsZWZ0JztcclxuICAgICAgY2FzZSAncmlnaHQtdG9wJzpcclxuICAgICAgICByZXR1cm4gJ2xlZnQtYm90dG9tJztcclxuICAgICAgY2FzZSAncmlnaHQtYm90dG9tJzpcclxuICAgICAgICByZXR1cm4gJ2xlZnQtdG9wJztcclxuICAgICAgY2FzZSAnYm90dG9tJzpcclxuICAgICAgICByZXR1cm4gJ3RvcCc7XHJcbiAgICAgIGNhc2UgJ2JvdHRvbS1yaWdodCc6XHJcbiAgICAgICAgcmV0dXJuICd0b3AtbGVmdCc7XHJcbiAgICAgIGNhc2UgJ2JvdHRvbS1sZWZ0JzpcclxuICAgICAgICByZXR1cm4gJ3RvcC1yaWdodCc7XHJcbiAgICAgIGNhc2UgJ2xlZnQnOlxyXG4gICAgICAgIHJldHVybiAncmlnaHQnO1xyXG4gICAgICBjYXNlICdsZWZ0LWJvdHRvbSc6XHJcbiAgICAgICAgcmV0dXJuICdyaWdodC10b3AnO1xyXG4gICAgICBjYXNlICdsZWZ0LXRvcCc6XHJcbiAgICAgICAgcmV0dXJuICdyaWdodC1ib3R0b20nO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBzZXRCb3R0b21Qb3NpdGlvbnMoZGlzcGxhY2VtZW50OiBudW1iZXIsIHNpemVzQW5kUG9zaXRpb25zKSB7XHJcbiAgICB0aGlzLmVsZW1lbnQuc3R5bGUudG9wID0gc2l6ZXNBbmRQb3NpdGlvbnMudGFyZ2V0LmJvdHRvbSArIHRoaXMuZWxlbWVudE9mZnNldCArICdweCc7XHJcbiAgICB0aGlzLmVsZW1lbnQuc3R5bGUubGVmdCA9IHNpemVzQW5kUG9zaXRpb25zLnRhcmdldC5sZWZ0ICsgc2l6ZXNBbmRQb3NpdGlvbnMudGFyZ2V0LndpZHRoIC8gMiAtIGRpc3BsYWNlbWVudCArICdweCc7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIHNldEVsZW1lbnRQb3NpdGlvbihwb3NpdGlvbjogc3RyaW5nKSB7XHJcbiAgICB0aGlzLnNldEVsZW1lbnRXaWR0aCgpO1xyXG5cclxuICAgIGNvbnN0IHNpemVzQW5kUG9zaXRpb25zID0gdGhpcy5nZXRTaXplc0FuZFBvc2l0aW9ucygpO1xyXG5cclxuICAgIHN3aXRjaCAocG9zaXRpb24pIHtcclxuICAgICAgY2FzZSAndG9wJzpcclxuICAgICAgICB0aGlzLnNldFRvcFBvc2l0aW9ucyhzaXplc0FuZFBvc2l0aW9ucy5lbGVtZW50LndpZHRoIC8gMiwgc2l6ZXNBbmRQb3NpdGlvbnMpO1xyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgICBjYXNlICd0b3AtbGVmdCc6XHJcbiAgICAgICAgdGhpcy5zZXRUb3BQb3NpdGlvbnMoXHJcbiAgICAgICAgICBzaXplc0FuZFBvc2l0aW9ucy5lbGVtZW50LndpZHRoIC0gdGhpcy5vZmZzZXRBcnJvdyAtIHRoaXMuZGlmZmVyZW5jZURpYWdvbmFsVG9XaWR0aEFycm93LFxyXG4gICAgICAgICAgc2l6ZXNBbmRQb3NpdGlvbnNcclxuICAgICAgICApO1xyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgICBjYXNlICd0b3AtcmlnaHQnOlxyXG4gICAgICAgIHRoaXMuc2V0VG9wUG9zaXRpb25zKHRoaXMub2Zmc2V0QXJyb3cgKyB0aGlzLmRpZmZlcmVuY2VEaWFnb25hbFRvV2lkdGhBcnJvdywgc2l6ZXNBbmRQb3NpdGlvbnMpO1xyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgICBjYXNlICdyaWdodCc6XHJcbiAgICAgICAgdGhpcy5zZXRSaWdodFBvc2l0aW9ucyhzaXplc0FuZFBvc2l0aW9ucy5lbGVtZW50LmhlaWdodCAvIDIsIHNpemVzQW5kUG9zaXRpb25zKTtcclxuICAgICAgICBicmVhaztcclxuICAgICAgY2FzZSAncmlnaHQtdG9wJzpcclxuICAgICAgICB0aGlzLnNldFJpZ2h0UG9zaXRpb25zKFxyXG4gICAgICAgICAgc2l6ZXNBbmRQb3NpdGlvbnMuZWxlbWVudC5oZWlnaHQgLSB0aGlzLm9mZnNldEFycm93IC0gdGhpcy5kaWZmZXJlbmNlRGlhZ29uYWxUb1dpZHRoQXJyb3csXHJcbiAgICAgICAgICBzaXplc0FuZFBvc2l0aW9uc1xyXG4gICAgICAgICk7XHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICAgIGNhc2UgJ3JpZ2h0LWJvdHRvbSc6XHJcbiAgICAgICAgdGhpcy5zZXRSaWdodFBvc2l0aW9ucyh0aGlzLm9mZnNldEFycm93LCBzaXplc0FuZFBvc2l0aW9ucyk7XHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICAgIGNhc2UgJ2JvdHRvbSc6XHJcbiAgICAgICAgdGhpcy5zZXRCb3R0b21Qb3NpdGlvbnMoc2l6ZXNBbmRQb3NpdGlvbnMuZWxlbWVudC53aWR0aCAvIDIsIHNpemVzQW5kUG9zaXRpb25zKTtcclxuICAgICAgICBicmVhaztcclxuICAgICAgY2FzZSAnYm90dG9tLXJpZ2h0JzpcclxuICAgICAgICB0aGlzLnNldEJvdHRvbVBvc2l0aW9ucyh0aGlzLm9mZnNldEFycm93ICsgdGhpcy5kaWZmZXJlbmNlRGlhZ29uYWxUb1dpZHRoQXJyb3csIHNpemVzQW5kUG9zaXRpb25zKTtcclxuICAgICAgICBicmVhaztcclxuICAgICAgY2FzZSAnYm90dG9tLWxlZnQnOlxyXG4gICAgICAgIHRoaXMuc2V0Qm90dG9tUG9zaXRpb25zKFxyXG4gICAgICAgICAgc2l6ZXNBbmRQb3NpdGlvbnMuZWxlbWVudC53aWR0aCAtIHRoaXMub2Zmc2V0QXJyb3cgLSB0aGlzLmRpZmZlcmVuY2VEaWFnb25hbFRvV2lkdGhBcnJvdyxcclxuICAgICAgICAgIHNpemVzQW5kUG9zaXRpb25zXHJcbiAgICAgICAgKTtcclxuICAgICAgICBicmVhaztcclxuICAgICAgY2FzZSAnbGVmdCc6XHJcbiAgICAgICAgdGhpcy5zZXRMZWZ0UG9zaXRpb25zKHNpemVzQW5kUG9zaXRpb25zLmVsZW1lbnQuaGVpZ2h0IC8gMiwgc2l6ZXNBbmRQb3NpdGlvbnMpO1xyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgICBjYXNlICdsZWZ0LWJvdHRvbSc6XHJcbiAgICAgICAgdGhpcy5zZXRMZWZ0UG9zaXRpb25zKHRoaXMub2Zmc2V0QXJyb3csIHNpemVzQW5kUG9zaXRpb25zKTtcclxuICAgICAgICBicmVhaztcclxuICAgICAgY2FzZSAnbGVmdC10b3AnOlxyXG4gICAgICAgIHRoaXMuc2V0TGVmdFBvc2l0aW9ucyhzaXplc0FuZFBvc2l0aW9ucy5lbGVtZW50LmhlaWdodCAtIHRoaXMub2Zmc2V0QXJyb3csIHNpemVzQW5kUG9zaXRpb25zKTtcclxuICAgICAgICBicmVhaztcclxuICAgIH1cclxuXHJcbiAgICB0aGlzLmFycm93RGlyZWN0aW9uID0gdGhpcy5zZXRBcnJvd0RpcmVjdGlvbihwb3NpdGlvbik7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIHNldEVsZW1lbnRXaWR0aCgpIHtcclxuICAgIGlmICh0aGlzLmlzU2V0RWxlbWVudFdpZHRoICYmIHRoaXMudGFyZ2V0RWxlbWVudCkge1xyXG4gICAgICB0aGlzLmVsZW1lbnQuc3R5bGUud2lkdGggPSBgJHt0aGlzLnRhcmdldEVsZW1lbnQuY2xpZW50V2lkdGh9cHhgO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBzZXRMZWZ0UG9zaXRpb25zKGRpc3BsYWNlbWVudDogbnVtYmVyLCBzaXplc0FuZFBvc2l0aW9ucykge1xyXG4gICAgdGhpcy5lbGVtZW50LnN0eWxlLnRvcCA9IHNpemVzQW5kUG9zaXRpb25zLnRhcmdldC50b3AgLSBkaXNwbGFjZW1lbnQgKyBzaXplc0FuZFBvc2l0aW9ucy50YXJnZXQuaGVpZ2h0IC8gMiArICdweCc7XHJcbiAgICB0aGlzLmVsZW1lbnQuc3R5bGUubGVmdCA9XHJcbiAgICAgIHNpemVzQW5kUG9zaXRpb25zLnRhcmdldC5sZWZ0IC0gc2l6ZXNBbmRQb3NpdGlvbnMuZWxlbWVudC53aWR0aCAtIHRoaXMuZWxlbWVudE9mZnNldCArICdweCc7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIHNldFJpZ2h0UG9zaXRpb25zKGRpc3BsYWNlbWVudDogbnVtYmVyLCBzaXplc0FuZFBvc2l0aW9ucykge1xyXG4gICAgdGhpcy5lbGVtZW50LnN0eWxlLnRvcCA9IHNpemVzQW5kUG9zaXRpb25zLnRhcmdldC50b3AgLSBkaXNwbGFjZW1lbnQgKyBzaXplc0FuZFBvc2l0aW9ucy50YXJnZXQuaGVpZ2h0IC8gMiArICdweCc7XHJcbiAgICB0aGlzLmVsZW1lbnQuc3R5bGUubGVmdCA9IHNpemVzQW5kUG9zaXRpb25zLnRhcmdldC5yaWdodCArIHRoaXMuZWxlbWVudE9mZnNldCArICdweCc7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIHNldFRvcFBvc2l0aW9ucyhkaXNwbGFjZW1lbnQ6IG51bWJlciwgc2l6ZXNBbmRQb3NpdGlvbnMpIHtcclxuICAgIHRoaXMuZWxlbWVudC5zdHlsZS50b3AgPVxyXG4gICAgICBzaXplc0FuZFBvc2l0aW9ucy50YXJnZXQudG9wIC0gc2l6ZXNBbmRQb3NpdGlvbnMuZWxlbWVudC5oZWlnaHQgLSB0aGlzLmVsZW1lbnRPZmZzZXQgKyAncHgnO1xyXG4gICAgdGhpcy5lbGVtZW50LnN0eWxlLmxlZnQgPSBzaXplc0FuZFBvc2l0aW9ucy50YXJnZXQubGVmdCArIHNpemVzQW5kUG9zaXRpb25zLnRhcmdldC53aWR0aCAvIDIgLSBkaXNwbGFjZW1lbnQgKyAncHgnO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSB2ZXJpZnlTdWJQb3NpdGlvbnMocG9zaXRpb246IHN0cmluZykge1xyXG4gICAgaWYgKHBvc2l0aW9uLmluZGV4T2YoJy0nKSA+IC0xKSB7XHJcbiAgICAgIHBvc2l0aW9uID0gcG9zaXRpb24uc3Vic3RyaW5nKDAsIHBvc2l0aW9uLmluZGV4T2YoJy0nKSk7XHJcbiAgICAgIHRoaXMuZWxlbWVudFBvc2l0aW9uKHBvc2l0aW9uKTtcclxuICAgIH1cclxuXHJcbiAgICBsZXQgYWxpZ24gPSAwO1xyXG4gICAgd2hpbGUgKGFsaWduKysgPCAzKSB7XHJcbiAgICAgIGlmICh0aGlzLm92ZXJmbG93QWxsU2lkZXMocG9zaXRpb24pKSB7XHJcbiAgICAgICAgcG9zaXRpb24gPSB0aGlzLm5leHRQb3NpdGlvbihwb3NpdGlvbiwgcG9Db250cm9sUG9zaXRpb25TaWRlc0RlZmF1bHQpO1xyXG4gICAgICAgIHRoaXMuZWxlbWVudFBvc2l0aW9uKHBvc2l0aW9uKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxufVxyXG4iXX0=