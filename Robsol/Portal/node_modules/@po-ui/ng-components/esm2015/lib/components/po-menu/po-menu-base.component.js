import { Input, Directive } from '@angular/core';
import { convertToBoolean, convertToInt, isExternalLink, isTypeof, validValue, uuid } from '../../utils/util';
import { PoMenuService } from './services/po-menu.service';
import { PoMenuGlobalService } from './services/po-menu-global.service';
import { PoLanguageService } from '../../services/po-language/po-language.service';
export const poMenuLiteralsDefault = {
    en: { itemNotFound: 'Item not found.', emptyLabelError: 'Attribute PoMenuItem.label can not be empty.' },
    es: { itemNotFound: 'Elemento no encontrado.', emptyLabelError: 'El atributo PoMenuItem.label no puede ser vacío.' },
    pt: { itemNotFound: 'Item não encontrado.', emptyLabelError: 'O atributo PoMenuItem.label não pode ser vazio.' },
    ru: { itemNotFound: 'Предмет не найден.', emptyLabelError: 'Атрибут PoMenuItem.label не может быть пустым.' }
};
/**
 * @description
 *
 * Este é um componente de menu lateral que é utilizado para navegação nas páginas de uma aplicação.
 *
 * O componente po-menu recebe uma lista de objetos do tipo `MenuItem` com as informações dos itens de menu como
 * textos, links para redirecionamento, ações, até 4 níveis de menu e ícones para o primeiro nível de menu.
 */
export class PoMenuBaseComponent {
    constructor(menuGlobalService, menuService, languageService) {
        this.menuGlobalService = menuGlobalService;
        this.menuService = menuService;
        this.languageService = languageService;
        this.literals = Object.assign(Object.assign({}, poMenuLiteralsDefault[this.languageService.getLanguageDefault()]), poMenuLiteralsDefault[this.languageService.getShortLanguage()]);
        this._collapsed = false;
        this._filter = false;
        this._maxLevel = 4;
        this._menus = [];
    }
    /**
     * @optional
     *
     * @description
     *
     * Colapsa (retrai) o menu e caso receba o valor `false` expande o menu.
     *
     * > Utilize esta propriedade para iniciar o menu colapsado.
     *
     * > Ao utilizar os métodos [`colapse`](documentation/po-menu#colapseMethod), [`expand`](documentation/po-menu#expandMethod) e
     * [`toggle`](documentation/po-menu#toggleMethod) o valor desta propriedade não é alterado.
     *
     * **Importante:**
     *
     * > O menu será colapsado/expandido apenas se todos os itens de menu tiverem valor nas propriedades `icon` e `shortLabel`.
     *
     * @default `false`
     */
    set collapsed(collapsed) {
        this._collapsed = convertToBoolean(collapsed);
        this.validateCollapseClass();
    }
    get collapsed() {
        return this._collapsed;
    }
    /** Lista dos itens do menu. Se o valor estiver indefinido ou inválido, será inicializado como um array vazio. */
    set menus(menus) {
        this._menus = Array.isArray(menus) ? menus : [];
        this.menuGlobalService.sendMenus(menus);
        setTimeout(() => {
            const urlRouter = this.checkingRouterChildrenFragments();
            this.checkActiveMenuByUrl(urlRouter);
        });
    }
    get menus() {
        return this._menus;
    }
    get maxLevel() {
        return this._maxLevel;
    }
    /**
     * @optional
     *
     * @description
     *
     * Habilita um campo para pesquisa no menu.
     * A pesquisa é realizada em todos os níveis do menu e busca apenas pelos itens que contém uma ação e/ou link definidos,
     * ou também, pode ser realizada através de um serviço definido na propriedade `p-service`.
     *
     * > O campo de pesquisa é desabilitado se o menu estiver colapsado.
     *
     * @default `false`
     */
    set filter(filter) {
        this._filter = filter === '' ? true : convertToBoolean(filter);
        this.filteredItems = [...this._menus];
    }
    get filter() {
        return this._filter;
    }
    /**
     * @optional
     *
     * @description
     *
     * Nesta propriedade deve ser informada a URL do serviço em que será utilizado para realizar o filtro de itens do
     * menu quando realizar uma busca. Caso haja a necessidade de customização, pode ser informado um
     * serviço implementando a interface `PoMenuFilter`.
     *
     * Caso utilizada uma URL, o serviço deve retornar os dados conforme o
     * [Guia de implementação de APIs](https://po-ui.io/guides/api) do PO UI.
     *
     * Quando utilizada uma URL de serviço, será realizado um *GET* na URL informada, passando o valor digitado
     * no parâmetro `search`, veja exemplo:
     *
     * > O filtro no serviço será realizado caso contenha no mínimo três caracteres no campo de busca, por exemplo `tot`.
     *
     * ```
     * <po-menu p-service="/api/v1/fnd/menu">
     * </po-menu>
     *
     * Requisição: GET /api/v1/fnd/menu?search=contas
     * ```
     *
     * > É necessário que propriedade `p-filter` esteja habilitada.
     */
    set service(value) {
        this._service = value || undefined;
        this.configService(this.service);
    }
    get service() {
        return this._service;
    }
    /**
     * @optional
     *
     * @description
     *
     * Deve ser informado um objeto que deseja-se utilizar na requisição de filtro dos itens de menu.
     *
     * Caso utilizado um serviço customizado, implementando a interface `PoMenuFilter`, o valor desta propriedade
     * será passado como parâmetro, na função `getFilteredData`.
     *
     * Quando utilizada uma URL de serviço, será realizado um *GET* na URL informada, passando os valores informados
     * nesta propriedade em conjunto com o parâmetro `search`, veja exemplo:
     *
     * ```
     * <po-menu p-service="/api/v1/fnd/menu" [p-params]="{ company: 1, user: 297767512 }">
     * </po-menu>
     *
     * Requisição: GET /api/v1/fnd/menu?search=contas&company=1&user=297767512
     * ```
     */
    set params(value) {
        this._params = value && isTypeof(value, 'object') ? value : undefined;
    }
    get params() {
        return this._params;
    }
    /**
     * @optional
     *
     * @description
     *
     * Caminho para a logomarca, que será exibida quando o componente estiver expandido, localizada na parte superior.
     *
     * > **Importante:**
     * - Caso esta propriedade estiver indefinida ou inválida o espaço para logomarca será removido.
     * - Como boa prática, indica-se utilizar imagens com até `24px` de altura e `224px` de largura,
     * caso ultrapassar esses valores a imagem será readequada no espaço disponível.
     */
    set logo(value) {
        this._logo = isTypeof(value, 'string') && value.trim() ? value : undefined;
    }
    get logo() {
        return this._logo;
    }
    /**
     * @optional
     *
     * @description
     *
     * Caminho para a logomarca, que será exibida quando o componente estiver colapsado, localizada na parte superior.
     *
     * > **Importante:**
     * - Caso esta propriedade estiver indefinida ou inválida passa a assumir o valor informado na propriedade `p-logo` e na ausência desta o
     * espaço para logomarca será removido.
     * - Como boa prática, indica-se utilizar imagens com até `48px` de altura e `48px` de largura,
     * caso ultrapassar esses valores a imagem será readequada no espaço disponível.
     * - Caso não informar um valor, esta propriedade passa a assumir o valor informado na propriedade `p-logo`.
     */
    set shortLogo(value) {
        this._shortLogo = isTypeof(value, 'string') && value.trim() ? value : undefined;
    }
    get shortLogo() {
        return this._shortLogo;
    }
    setMenuExtraProperties() {
        this.allowIcons = !!this.menus.length;
        this.allowCollapseMenu = !!this.menus.length;
        this.menus.forEach(menuItem => {
            this._level = 1;
            this.allowIcons = this.allowIcons ? validValue(menuItem.icon) : false;
            this.allowCollapseMenu = this.allowCollapseMenu && this.allowIcons ? validValue(menuItem.shortLabel) : false;
            this.removeBadgeAlert(menuItem);
            this.setMenuItemProperties(menuItem);
            if (menuItem.subItems) {
                this._level++;
                this.processSubItems(menuItem);
            }
        });
    }
    setMenuItemProperties(menuItem) {
        menuItem['id'] = menuItem['id'] || uuid();
        menuItem['level'] = this._level;
        menuItem['type'] = this.setMenuType(menuItem);
    }
    validateMenus(menus) {
        menus.forEach(menu => this.validateMenu(menu));
    }
    setMenuType(menuItem) {
        if (menuItem.subItems && menuItem.subItems.length > 0 && this._level < this.maxLevel) {
            return 'subItems';
        }
        if (!menuItem.link) {
            return 'noLink';
        }
        if (isExternalLink(menuItem.link)) {
            return 'externalLink';
        }
        return 'internalLink';
    }
    configService(service) {
        if (typeof service === 'string' && service.trim()) {
            // service url
            this.menuService.configProperties(service);
            this.filterService = this.menuService;
        }
        else if (typeof service === 'object' && service.getFilteredData) {
            // custom service
            this.filterService = service;
        }
        else {
            this.filterService = undefined;
        }
    }
    processSubItems(menu) {
        menu.subItems.forEach((menuItem, index, menuItems) => {
            const previousItem = menuItems[index - 1];
            if (previousItem && previousItem.subItems) {
                this._level = previousItem['level'];
            }
            if (this._level <= this.maxLevel) {
                this.setMenuItemProperties(menuItem);
                if (menuItem.subItems) {
                    this._level++;
                    this.processSubItems(menuItem);
                }
            }
            if (!menu['badgeAlert']) {
                menu = this.setMenuBadgeAlert(menu, menuItem);
            }
        });
        menu.subItems = Object.assign([], menu.subItems);
    }
    removeBadgeAlert(menuItem) {
        if (menuItem['badgeAlert']) {
            delete menuItem['badgeAlert'];
        }
        if (menuItem.subItems) {
            menuItem.subItems.forEach(subItem => this.removeBadgeAlert(subItem));
        }
    }
    setMenuBadgeAlert(parent, child) {
        const childHasSubItems = child.subItems && child.subItems.length;
        const childHasBadgeAlert = child['badgeAlert'];
        const childHasBadge = child.badge && convertToInt(child.badge.value) >= 0;
        parent['badgeAlert'] = childHasBadgeAlert || (childHasBadge && !childHasSubItems);
        return parent;
    }
    validateMenu(menuItem) {
        if (!menuItem.label || menuItem.label.trim() === '') {
            throw new Error(this.literals.emptyLabelError);
        }
        else if (menuItem.subItems) {
            menuItem.subItems.forEach(subItem => {
                this.validateMenu(subItem);
            });
        }
    }
}
PoMenuBaseComponent.decorators = [
    { type: Directive }
];
PoMenuBaseComponent.ctorParameters = () => [
    { type: PoMenuGlobalService },
    { type: PoMenuService },
    { type: PoLanguageService }
];
PoMenuBaseComponent.propDecorators = {
    collapsed: [{ type: Input, args: ['p-collapsed',] }],
    menus: [{ type: Input, args: ['p-menus',] }],
    filter: [{ type: Input, args: ['p-filter',] }],
    service: [{ type: Input, args: ['p-service',] }],
    params: [{ type: Input, args: ['p-params',] }],
    logo: [{ type: Input, args: ['p-logo',] }],
    shortLogo: [{ type: Input, args: ['p-short-logo',] }]
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG8tbWVudS1iYXNlLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL3VpL3NyYy9saWIvY29tcG9uZW50cy9wby1tZW51L3BvLW1lbnUtYmFzZS5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLEtBQUssRUFBRSxTQUFTLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFFakQsT0FBTyxFQUVMLGdCQUFnQixFQUNoQixZQUFZLEVBQ1osY0FBYyxFQUNkLFFBQVEsRUFDUixVQUFVLEVBQ1YsSUFBSSxFQUNMLE1BQU0sa0JBQWtCLENBQUM7QUFJMUIsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLDRCQUE0QixDQUFDO0FBQzNELE9BQU8sRUFBRSxtQkFBbUIsRUFBRSxNQUFNLG1DQUFtQyxDQUFDO0FBQ3hFLE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxNQUFNLGdEQUFnRCxDQUFDO0FBR25GLE1BQU0sQ0FBQyxNQUFNLHFCQUFxQixHQUFHO0lBQ25DLEVBQUUsRUFBRSxFQUFFLFlBQVksRUFBRSxpQkFBaUIsRUFBRSxlQUFlLEVBQUUsOENBQThDLEVBQUU7SUFDeEcsRUFBRSxFQUFFLEVBQUUsWUFBWSxFQUFFLHlCQUF5QixFQUFFLGVBQWUsRUFBRSxrREFBa0QsRUFBRTtJQUNwSCxFQUFFLEVBQUUsRUFBRSxZQUFZLEVBQUUsc0JBQXNCLEVBQUUsZUFBZSxFQUFFLGlEQUFpRCxFQUFFO0lBQ2hILEVBQUUsRUFBRSxFQUFFLFlBQVksRUFBRSxvQkFBb0IsRUFBRSxlQUFlLEVBQUUsZ0RBQWdELEVBQUU7Q0FDOUcsQ0FBQztBQUVGOzs7Ozs7O0dBT0c7QUFFSCxNQUFNLE9BQWdCLG1CQUFtQjtJQXNNdkMsWUFDUyxpQkFBc0MsRUFDdEMsV0FBMEIsRUFDMUIsZUFBa0M7UUFGbEMsc0JBQWlCLEdBQWpCLGlCQUFpQixDQUFxQjtRQUN0QyxnQkFBVyxHQUFYLFdB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QUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxFQUFFO2dCQUNsQyxJQUFJLENBQUMsWUFBWSxDQUFDLE9BQU8sQ0FBQyxDQUFDO1lBQzdCLENBQUMsQ0FBQyxDQUFDO1NBQ0o7SUFDSCxDQUFDOzs7WUF2VEYsU0FBUzs7O1lBbkJELG1CQUFtQjtZQURuQixhQUFhO1lBRWIsaUJBQWlCOzs7d0JBMkR2QixLQUFLLFNBQUMsYUFBYTtvQkFXbkIsS0FBSyxTQUFDLFNBQVM7cUJBZ0NmLEtBQUssU0FBQyxVQUFVO3NCQW1DaEIsS0FBSyxTQUFDLFdBQVc7cUJBOEJqQixLQUFLLFNBQUMsVUFBVTttQkFvQmhCLEtBQUssU0FBQyxRQUFRO3dCQXNCZCxLQUFLLFNBQUMsY0FBYyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IElucHV0LCBEaXJlY3RpdmUgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuXHJcbmltcG9ydCB7XHJcbiAgYnJvd3Nlckxhbmd1YWdlLFxyXG4gIGNvbnZlcnRUb0Jvb2xlYW4sXHJcbiAgY29udmVydFRvSW50LFxyXG4gIGlzRXh0ZXJuYWxMaW5rLFxyXG4gIGlzVHlwZW9mLFxyXG4gIHZhbGlkVmFsdWUsXHJcbiAgdXVpZFxyXG59IGZyb20gJy4uLy4uL3V0aWxzL3V0aWwnO1xyXG5cclxuaW1wb3J0IHsgUG9NZW51RmlsdGVyIH0gZnJvbSAnLi9wby1tZW51LWZpbHRlci9wby1tZW51LWZpbHRlci5pbnRlcmZhY2UnO1xyXG5pbXBvcnQgeyBQb01lbnVJdGVtIH0gZnJvbSAnLi9wby1tZW51LWl0ZW0uaW50ZXJmYWNlJztcclxuaW1wb3J0IHsgUG9NZW51U2VydmljZSB9IGZyb20gJy4vc2VydmljZXMvcG8tbWVudS5zZXJ2aWNlJztcclxuaW1wb3J0IHsgUG9NZW51R2xvYmFsU2VydmljZSB9IGZyb20gJy4vc2VydmljZXMvcG8tbWVudS1nbG9iYWwuc2VydmljZSc7XHJcbmltcG9ydCB7IFBvTGFuZ3VhZ2VTZXJ2aWNlIH0gZnJvbSAnLi4vLi4vc2VydmljZXMvcG8tbGFuZ3VhZ2UvcG8tbGFuZ3VhZ2Uuc2VydmljZSc7XHJcbmltcG9ydCB7IHBvTG9jYWxlRGVmYXVsdCB9IGZyb20gJy4uLy4uL3NlcnZpY2VzL3BvLWxhbmd1YWdlL3BvLWxhbmd1YWdlLmNvbnN0YW50JztcclxuXHJcbmV4cG9ydCBjb25zdCBwb01lbnVMaXRlcmFsc0RlZmF1bHQgPSB7XHJcbiAgZW46IHsgaXRlbU5vdEZvdW5kOiAnSXRlbSBub3QgZm91bmQuJywgZW1wdHlMYWJlbEVycm9yOiAnQXR0cmlidXRlIFBvTWVudUl0ZW0ubGFiZWwgY2FuIG5vdCBiZSBlbXB0eS4nIH0sXHJcbiAgZXM6IHsgaXRlbU5vdEZvdW5kOiAnRWxlbWVudG8gbm8gZW5jb250cmFkby4nLCBlbXB0eUxhYmVsRXJyb3I6ICdFbCBhdHJpYnV0byBQb01lbnVJdGVtLmxhYmVsIG5vIHB1ZWRlIHNlciB2YWPDrW8uJyB9LFxyXG4gIHB0OiB7IGl0ZW1Ob3RGb3VuZDogJ0l0ZW0gbsOjbyBlbmNvbnRyYWRvLicsIGVtcHR5TGFiZWxFcnJvcjogJ08gYXRyaWJ1dG8gUG9NZW51SXRlbS5sYWJlbCBuw6NvIHBvZGUgc2VyIHZhemlvLicgfSxcclxuICBydTogeyBpdGVtTm90Rm91bmQ6ICfQn9GA0LXQtNC80LXRgiDQvdC1INC90LDQudC00LXQvS4nLCBlbXB0eUxhYmVsRXJyb3I6ICfQkNGC0YDQuNCx0YPRgiBQb01lbnVJdGVtLmxhYmVsINC90LUg0LzQvtC20LXRgiDQsdGL0YLRjCDQv9GD0YHRgtGL0LwuJyB9XHJcbn07XHJcblxyXG4vKipcclxuICogQGRlc2NyaXB0aW9uXHJcbiAqXHJcbiAqIEVzdGUgw6kgdW0gY29tcG9uZW50ZSBkZSBtZW51IGxhdGVyYWwgcXVlIMOpIHV0aWxpemFkbyBwYXJhIG5hdmVnYcOnw6NvIG5hcyBww6FnaW5hcyBkZSB1bWEgYXBsaWNhw6fDo28uXHJcbiAqXHJcbiAqIE8gY29tcG9uZW50ZSBwby1tZW51IHJlY2ViZSB1bWEgbGlzdGEgZGUgb2JqZXRvcyBkbyB0aXBvIGBNZW51SXRlbWAgY29tIGFzIGluZm9ybWHDp8O1ZXMgZG9zIGl0ZW5zIGRlIG1lbnUgY29tb1xyXG4gKiB0ZXh0b3MsIGxpbmtzIHBhcmEgcmVkaXJlY2lvbmFtZW50bywgYcOnw7VlcywgYXTDqSA0IG7DrXZlaXMgZGUgbWVudSBlIMOtY29uZXMgcGFyYSBvIHByaW1laXJvIG7DrXZlbCBkZSBtZW51LlxyXG4gKi9cclxuQERpcmVjdGl2ZSgpXHJcbmV4cG9ydCBhYnN0cmFjdCBjbGFzcyBQb01lbnVCYXNlQ29tcG9uZW50IHtcclxuICBhbGxvd0ljb25zOiBib29sZWFuO1xyXG4gIGFsbG93Q29sbGFwc2VNZW51OiBib29sZWFuO1xyXG5cclxuICBmaWx0ZXJlZEl0ZW1zO1xyXG4gIGZpbHRlclNlcnZpY2U6IFBvTWVudUZpbHRlcjtcclxuXHJcbiAgcmVhZG9ubHkgbGl0ZXJhbHMgPSB7XHJcbiAgICAuLi5wb01lbnVMaXRlcmFsc0RlZmF1bHRbdGhpcy5sYW5ndWFnZVNlcnZpY2UuZ2V0TGFuZ3VhZ2VEZWZhdWx0KCldLFxyXG4gICAgLi4ucG9NZW51TGl0ZXJhbHNEZWZhdWx0W3RoaXMubGFuZ3VhZ2VTZXJ2aWNlLmdldFNob3J0TGFuZ3VhZ2UoKV1cclxuICB9O1xyXG5cclxuICBwcml2YXRlIF9jb2xsYXBzZWQgPSBmYWxzZTtcclxuICBwcml2YXRlIF9maWx0ZXIgPSBmYWxzZTtcclxuICBwcml2YXRlIF9sZXZlbDtcclxuICBwcml2YXRlIF9sb2dvOiBzdHJpbmc7XHJcbiAgcHJpdmF0ZSBfbWF4TGV2ZWwgPSA0O1xyXG4gIHByaXZhdGUgX21lbnVzID0gW107XHJcbiAgcHJpdmF0ZSBfcGFyYW1zOiBhbnk7XHJcbiAgcHJpdmF0ZSBfc2VydmljZTogc3RyaW5nIHwgUG9NZW51RmlsdGVyO1xyXG4gIHByaXZhdGUgX3Nob3J0TG9nbzogc3RyaW5nO1xyXG5cclxuICAvKipcclxuICAgKiBAb3B0aW9uYWxcclxuICAgKlxyXG4gICAqIEBkZXNjcmlwdGlvblxyXG4gICAqXHJcbiAgICogQ29sYXBzYSAocmV0cmFpKSBvIG1lbnUgZSBjYXNvIHJlY2ViYSBvIHZhbG9yIGBmYWxzZWAgZXhwYW5kZSBvIG1lbnUuXHJcbiAgICpcclxuICAgKiA+IFV0aWxpemUgZXN0YSBwcm9wcmllZGFkZSBwYXJhIGluaWNpYXIgbyBtZW51IGNvbGFwc2Fkby5cclxuICAgKlxyXG4gICAqID4gQW8gdXRpbGl6YXIgb3MgbcOpdG9kb3MgW2Bjb2xhcHNlYF0oZG9jdW1lbnRhdGlvbi9wby1tZW51I2NvbGFwc2VNZXRob2QpLCBbYGV4cGFuZGBdKGRvY3VtZW50YXRpb24vcG8tbWVudSNleHBhbmRNZXRob2QpIGVcclxuICAgKiBbYHRvZ2dsZWBdKGRvY3VtZW50YXRpb24vcG8tbWVudSN0b2dnbGVNZXRob2QpIG8gdmFsb3IgZGVzdGEgcHJvcHJpZWRhZGUgbsOjbyDDqSBhbHRlcmFkby5cclxuICAgKlxyXG4gICAqICoqSW1wb3J0YW50ZToqKlxyXG4gICAqXHJcbiAgICogPiBPIG1lbnUgc2Vyw6EgY29sYXBzYWRvL2V4cGFuZGlkbyBhcGVuYXMgc2UgdG9kb3Mgb3MgaXRlbnMgZGUgbWVudSB0aXZlcmVtIHZhbG9yIG5hcyBwcm9wcmllZGFkZXMgYGljb25gIGUgYHNob3J0TGFiZWxgLlxyXG4gICAqXHJcbiAgICogQGRlZmF1bHQgYGZhbHNlYFxyXG4gICAqL1xyXG4gIEBJbnB1dCgncC1jb2xsYXBzZWQnKSBzZXQgY29sbGFwc2VkKGNvbGxhcHNlZDogYm9vbGVhbikge1xyXG4gICAgdGhpcy5fY29sbGFwc2VkID0gY29udmVydFRvQm9vbGVhbihjb2xsYXBzZWQpO1xyXG5cclxuICAgIHRoaXMudmFsaWRhdGVDb2xsYXBzZUNsYXNzKCk7XHJcbiAgfVxyXG5cclxuICBnZXQgY29sbGFwc2VkKCkge1xyXG4gICAgcmV0dXJuIHRoaXMuX2NvbGxhcHNlZDtcclxuICB9XHJcblxyXG4gIC8qKiBMaXN0YSBkb3MgaXRlbnMgZG8gbWVudS4gU2UgbyB2YWxvciBlc3RpdmVyIGluZGVmaW5pZG8gb3UgaW52w6FsaWRvLCBzZXLDoSBpbmljaWFsaXphZG8gY29tbyB1bSBhcnJheSB2YXppby4gKi9cclxuICBASW5wdXQoJ3AtbWVudXMnKSBzZXQgbWVudXMobWVudXM6IEFycmF5PFBvTWVudUl0ZW0+KSB7XHJcbiAgICB0aGlzLl9tZW51cyA9IEFycmF5LmlzQXJyYXkobWVudXMpID8gbWVudXMgOiBbXTtcclxuXHJcbiAgICB0aGlzLm1lbnVHbG9iYWxTZXJ2aWNlLnNlbmRNZW51cyhtZW51cyk7XHJcblxyXG4gICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgIGNvbnN0IHVybFJvdXRlciA9IHRoaXMuY2hlY2tpbmdSb3V0ZXJDaGlsZHJlbkZyYWdtZW50cygpO1xyXG4gICAgICB0aGlzLmNoZWNrQWN0aXZlTWVudUJ5VXJsKHVybFJvdXRlcik7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIGdldCBtZW51cygpIHtcclxuICAgIHJldHVybiB0aGlzLl9tZW51cztcclxuICB9XHJcblxyXG4gIGdldCBtYXhMZXZlbCgpIHtcclxuICAgIHJldHVybiB0aGlzLl9tYXhMZXZlbDtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEBvcHRpb25hbFxyXG4gICAqXHJcbiAgICogQGRlc2NyaXB0aW9uXHJcbiAgICpcclxuICAgKiBIYWJpbGl0YSB1bSBjYW1wbyBwYXJhIHBlc3F1aXNhIG5vIG1lbnUuXHJcbiAgICogQSBwZXNxdWlzYSDDqSByZWFsaXphZGEgZW0gdG9kb3Mgb3MgbsOtdmVpcyBkbyBtZW51IGUgYnVzY2EgYXBlbmFzIHBlbG9zIGl0ZW5zIHF1ZSBjb250w6ltIHVtYSBhw6fDo28gZS9vdSBsaW5rIGRlZmluaWRvcyxcclxuICAgKiBvdSB0YW1iw6ltLCBwb2RlIHNlciByZWFsaXphZGEgYXRyYXbDqXMgZGUgdW0gc2VydmnDp28gZGVmaW5pZG8gbmEgcHJvcHJpZWRhZGUgYHAtc2VydmljZWAuXHJcbiAgICpcclxuICAgKiA+IE8gY2FtcG8gZGUgcGVzcXVpc2Egw6kgZGVzYWJpbGl0YWRvIHNlIG8gbWVudSBlc3RpdmVyIGNvbGFwc2Fkby5cclxuICAgKlxyXG4gICAqIEBkZWZhdWx0IGBmYWxzZWBcclxuICAgKi9cclxuICBASW5wdXQoJ3AtZmlsdGVyJykgc2V0IGZpbHRlcihmaWx0ZXI6IGJvb2xlYW4pIHtcclxuICAgIHRoaXMuX2ZpbHRlciA9IDxhbnk+ZmlsdGVyID09PSAnJyA/IHRydWUgOiBjb252ZXJ0VG9Cb29sZWFuKGZpbHRlcik7XHJcbiAgICB0aGlzLmZpbHRlcmVkSXRlbXMgPSBbLi4udGhpcy5fbWVudXNdO1xyXG4gIH1cclxuXHJcbiAgZ2V0IGZpbHRlcigpIHtcclxuICAgIHJldHVybiB0aGlzLl9maWx0ZXI7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBAb3B0aW9uYWxcclxuICAgKlxyXG4gICAqIEBkZXNjcmlwdGlvblxyXG4gICAqXHJcbiAgICogTmVzdGEgcHJvcHJpZWRhZGUgZGV2ZSBzZXIgaW5mb3JtYWRhIGEgVVJMIGRvIHNlcnZpw6dvIGVtIHF1ZSBzZXLDoSB1dGlsaXphZG8gcGFyYSByZWFsaXphciBvIGZpbHRybyBkZSBpdGVucyBkb1xyXG4gICAqIG1lbnUgcXVhbmRvIHJlYWxpemFyIHVtYSBidXNjYS4gQ2FzbyBoYWphIGEgbmVjZXNzaWRhZGUgZGUgY3VzdG9taXphw6fDo28sIHBvZGUgc2VyIGluZm9ybWFkbyB1bVxyXG4gICAqIHNlcnZpw6dvIGltcGxlbWVudGFuZG8gYSBpbnRlcmZhY2UgYFBvTWVudUZpbHRlcmAuXHJcbiAgICpcclxuICAgKiBDYXNvIHV0aWxpemFkYSB1bWEgVVJMLCBvIHNlcnZpw6dvIGRldmUgcmV0b3JuYXIgb3MgZGFkb3MgY29uZm9ybWUgb1xyXG4gICAqIFtHdWlhIGRlIGltcGxlbWVudGHDp8OjbyBkZSBBUElzXShodHRwczovL3BvLXVpLmlvL2d1aWRlcy9hcGkpIGRvIFBPIFVJLlxyXG4gICAqXHJcbiAgICogUXVhbmRvIHV0aWxpemFkYSB1bWEgVVJMIGRlIHNlcnZpw6dvLCBzZXLDoSByZWFsaXphZG8gdW0gKkdFVCogbmEgVVJMIGluZm9ybWFkYSwgcGFzc2FuZG8gbyB2YWxvciBkaWdpdGFkb1xyXG4gICAqIG5vIHBhcsOibWV0cm8gYHNlYXJjaGAsIHZlamEgZXhlbXBsbzpcclxuICAgKlxyXG4gICAqID4gTyBmaWx0cm8gbm8gc2VydmnDp28gc2Vyw6EgcmVhbGl6YWRvIGNhc28gY29udGVuaGEgbm8gbcOtbmltbyB0csOqcyBjYXJhY3RlcmVzIG5vIGNhbXBvIGRlIGJ1c2NhLCBwb3IgZXhlbXBsbyBgdG90YC5cclxuICAgKlxyXG4gICAqIGBgYFxyXG4gICAqIDxwby1tZW51IHAtc2VydmljZT1cIi9hcGkvdjEvZm5kL21lbnVcIj5cclxuICAgKiA8L3BvLW1lbnU+XHJcbiAgICpcclxuICAgKiBSZXF1aXNpw6fDo286IEdFVCAvYXBpL3YxL2ZuZC9tZW51P3NlYXJjaD1jb250YXNcclxuICAgKiBgYGBcclxuICAgKlxyXG4gICAqID4gw4kgbmVjZXNzw6FyaW8gcXVlIHByb3ByaWVkYWRlIGBwLWZpbHRlcmAgZXN0ZWphIGhhYmlsaXRhZGEuXHJcbiAgICovXHJcbiAgQElucHV0KCdwLXNlcnZpY2UnKSBzZXQgc2VydmljZSh2YWx1ZTogc3RyaW5nIHwgUG9NZW51RmlsdGVyKSB7XHJcbiAgICB0aGlzLl9zZXJ2aWNlID0gdmFsdWUgfHwgdW5kZWZpbmVkO1xyXG5cclxuICAgIHRoaXMuY29uZmlnU2VydmljZSh0aGlzLnNlcnZpY2UpO1xyXG4gIH1cclxuXHJcbiAgZ2V0IHNlcnZpY2UoKSB7XHJcbiAgICByZXR1cm4gdGhpcy5fc2VydmljZTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEBvcHRpb25hbFxyXG4gICAqXHJcbiAgICogQGRlc2NyaXB0aW9uXHJcbiAgICpcclxuICAgKiBEZXZlIHNlciBpbmZvcm1hZG8gdW0gb2JqZXRvIHF1ZSBkZXNlamEtc2UgdXRpbGl6YXIgbmEgcmVxdWlzacOnw6NvIGRlIGZpbHRybyBkb3MgaXRlbnMgZGUgbWVudS5cclxuICAgKlxyXG4gICAqIENhc28gdXRpbGl6YWRvIHVtIHNlcnZpw6dvIGN1c3RvbWl6YWRvLCBpbXBsZW1lbnRhbmRvIGEgaW50ZXJmYWNlIGBQb01lbnVGaWx0ZXJgLCBvIHZhbG9yIGRlc3RhIHByb3ByaWVkYWRlXHJcbiAgICogc2Vyw6EgcGFzc2FkbyBjb21vIHBhcsOibWV0cm8sIG5hIGZ1bsOnw6NvIGBnZXRGaWx0ZXJlZERhdGFgLlxyXG4gICAqXHJcbiAgICogUXVhbmRvIHV0aWxpemFkYSB1bWEgVVJMIGRlIHNlcnZpw6dvLCBzZXLDoSByZWFsaXphZG8gdW0gKkdFVCogbmEgVVJMIGluZm9ybWFkYSwgcGFzc2FuZG8gb3MgdmFsb3JlcyBpbmZvcm1hZG9zXHJcbiAgICogbmVzdGEgcHJvcHJpZWRhZGUgZW0gY29uanVudG8gY29tIG8gcGFyw6JtZXRybyBgc2VhcmNoYCwgdmVqYSBleGVtcGxvOlxyXG4gICAqXHJcbiAgICogYGBgXHJcbiAgICogPHBvLW1lbnUgcC1zZXJ2aWNlPVwiL2FwaS92MS9mbmQvbWVudVwiIFtwLXBhcmFtc109XCJ7IGNvbXBhbnk6IDEsIHVzZXI6IDI5Nzc2NzUxMiB9XCI+XHJcbiAgICogPC9wby1tZW51PlxyXG4gICAqXHJcbiAgICogUmVxdWlzacOnw6NvOiBHRVQgL2FwaS92MS9mbmQvbWVudT9zZWFyY2g9Y29udGFzJmNvbXBhbnk9MSZ1c2VyPTI5Nzc2NzUxMlxyXG4gICAqIGBgYFxyXG4gICAqL1xyXG4gIEBJbnB1dCgncC1wYXJhbXMnKSBzZXQgcGFyYW1zKHZhbHVlOiBhbnkpIHtcclxuICAgIHRoaXMuX3BhcmFtcyA9IHZhbHVlICYmIGlzVHlwZW9mKHZhbHVlLCAnb2JqZWN0JykgPyB2YWx1ZSA6IHVuZGVmaW5lZDtcclxuICB9XHJcblxyXG4gIGdldCBwYXJhbXMoKSB7XHJcbiAgICByZXR1cm4gdGhpcy5fcGFyYW1zO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQG9wdGlvbmFsXHJcbiAgICpcclxuICAgKiBAZGVzY3JpcHRpb25cclxuICAgKlxyXG4gICAqIENhbWluaG8gcGFyYSBhIGxvZ29tYXJjYSwgcXVlIHNlcsOhIGV4aWJpZGEgcXVhbmRvIG8gY29tcG9uZW50ZSBlc3RpdmVyIGV4cGFuZGlkbywgbG9jYWxpemFkYSBuYSBwYXJ0ZSBzdXBlcmlvci5cclxuICAgKlxyXG4gICAqID4gKipJbXBvcnRhbnRlOioqXHJcbiAgICogLSBDYXNvIGVzdGEgcHJvcHJpZWRhZGUgZXN0aXZlciBpbmRlZmluaWRhIG91IGludsOhbGlkYSBvIGVzcGHDp28gcGFyYSBsb2dvbWFyY2Egc2Vyw6EgcmVtb3ZpZG8uXHJcbiAgICogLSBDb21vIGJvYSBwcsOhdGljYSwgaW5kaWNhLXNlIHV0aWxpemFyIGltYWdlbnMgY29tIGF0w6kgYDI0cHhgIGRlIGFsdHVyYSBlIGAyMjRweGAgZGUgbGFyZ3VyYSxcclxuICAgKiBjYXNvIHVsdHJhcGFzc2FyIGVzc2VzIHZhbG9yZXMgYSBpbWFnZW0gc2Vyw6EgcmVhZGVxdWFkYSBubyBlc3Bhw6dvIGRpc3BvbsOtdmVsLlxyXG4gICAqL1xyXG4gIEBJbnB1dCgncC1sb2dvJykgc2V0IGxvZ28odmFsdWU6IGFueSkge1xyXG4gICAgdGhpcy5fbG9nbyA9IGlzVHlwZW9mKHZhbHVlLCAnc3RyaW5nJykgJiYgdmFsdWUudHJpbSgpID8gdmFsdWUgOiB1bmRlZmluZWQ7XHJcbiAgfVxyXG5cclxuICBnZXQgbG9nbygpIHtcclxuICAgIHJldHVybiB0aGlzLl9sb2dvO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQG9wdGlvbmFsXHJcbiAgICpcclxuICAgKiBAZGVzY3JpcHRpb25cclxuICAgKlxyXG4gICAqIENhbWluaG8gcGFyYSBhIGxvZ29tYXJjYSwgcXVlIHNlcsOhIGV4aWJpZGEgcXVhbmRvIG8gY29tcG9uZW50ZSBlc3RpdmVyIGNvbGFwc2FkbywgbG9jYWxpemFkYSBuYSBwYXJ0ZSBzdXBlcmlvci5cclxuICAgKlxyXG4gICAqID4gKipJbXBvcnRhbnRlOioqXHJcbiAgICogLSBDYXNvIGVzdGEgcHJvcHJpZWRhZGUgZXN0aXZlciBpbmRlZmluaWRhIG91IGludsOhbGlkYSBwYXNzYSBhIGFzc3VtaXIgbyB2YWxvciBpbmZvcm1hZG8gbmEgcHJvcHJpZWRhZGUgYHAtbG9nb2AgZSBuYSBhdXPDqm5jaWEgZGVzdGEgb1xyXG4gICAqIGVzcGHDp28gcGFyYSBsb2dvbWFyY2Egc2Vyw6EgcmVtb3ZpZG8uXHJcbiAgICogLSBDb21vIGJvYSBwcsOhdGljYSwgaW5kaWNhLXNlIHV0aWxpemFyIGltYWdlbnMgY29tIGF0w6kgYDQ4cHhgIGRlIGFsdHVyYSBlIGA0OHB4YCBkZSBsYXJndXJhLFxyXG4gICAqIGNhc28gdWx0cmFwYXNzYXIgZXNzZXMgdmFsb3JlcyBhIGltYWdlbSBzZXLDoSByZWFkZXF1YWRhIG5vIGVzcGHDp28gZGlzcG9uw612ZWwuXHJcbiAgICogLSBDYXNvIG7Do28gaW5mb3JtYXIgdW0gdmFsb3IsIGVzdGEgcHJvcHJpZWRhZGUgcGFzc2EgYSBhc3N1bWlyIG8gdmFsb3IgaW5mb3JtYWRvIG5hIHByb3ByaWVkYWRlIGBwLWxvZ29gLlxyXG4gICAqL1xyXG4gIEBJbnB1dCgncC1zaG9ydC1sb2dvJykgc2V0IHNob3J0TG9nbyh2YWx1ZTogYW55KSB7XHJcbiAgICB0aGlzLl9zaG9ydExvZ28gPSBpc1R5cGVvZih2YWx1ZSwgJ3N0cmluZycpICYmIHZhbHVlLnRyaW0oKSA/IHZhbHVlIDogdW5kZWZpbmVkO1xyXG4gIH1cclxuXHJcbiAgZ2V0IHNob3J0TG9nbygpIHtcclxuICAgIHJldHVybiB0aGlzLl9zaG9ydExvZ287XHJcbiAgfVxyXG5cclxuICBjb25zdHJ1Y3RvcihcclxuICAgIHB1YmxpYyBtZW51R2xvYmFsU2VydmljZTogUG9NZW51R2xvYmFsU2VydmljZSxcclxuICAgIHB1YmxpYyBtZW51U2VydmljZTogUG9NZW51U2VydmljZSxcclxuICAgIHB1YmxpYyBsYW5ndWFnZVNlcnZpY2U6IFBvTGFuZ3VhZ2VTZXJ2aWNlXHJcbiAgKSB7fVxyXG5cclxuICBwcm90ZWN0ZWQgc2V0TWVudUV4dHJhUHJvcGVydGllcygpIHtcclxuICAgIHRoaXMuYWxsb3dJY29ucyA9ICEhdGhpcy5tZW51cy5sZW5ndGg7XHJcbiAgICB0aGlzLmFsbG93Q29sbGFwc2VNZW51ID0gISF0aGlzLm1lbnVzLmxlbmd0aDtcclxuXHJcbiAgICB0aGlzLm1lbnVzLmZvckVhY2gobWVudUl0ZW0gPT4ge1xyXG4gICAgICB0aGlzLl9sZXZlbCA9IDE7XHJcbiAgICAgIHRoaXMuYWxsb3dJY29ucyA9IHRoaXMuYWxsb3dJY29ucyA/IHZhbGlkVmFsdWUobWVudUl0ZW0uaWNvbikgOiBmYWxzZTtcclxuICAgICAgdGhpcy5hbGxvd0NvbGxhcHNlTWVudSA9IHRoaXMuYWxsb3dDb2xsYXBzZU1lbnUgJiYgdGhpcy5hbGxvd0ljb25zID8gdmFsaWRWYWx1ZShtZW51SXRlbS5zaG9ydExhYmVsKSA6IGZhbHNlO1xyXG4gICAgICB0aGlzLnJlbW92ZUJhZGdlQWxlcnQobWVudUl0ZW0pO1xyXG4gICAgICB0aGlzLnNldE1lbnVJdGVtUHJvcGVydGllcyhtZW51SXRlbSk7XHJcblxyXG4gICAgICBpZiAobWVudUl0ZW0uc3ViSXRlbXMpIHtcclxuICAgICAgICB0aGlzLl9sZXZlbCsrO1xyXG4gICAgICAgIHRoaXMucHJvY2Vzc1N1Ykl0ZW1zKG1lbnVJdGVtKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBwcm90ZWN0ZWQgc2V0TWVudUl0ZW1Qcm9wZXJ0aWVzKG1lbnVJdGVtOiBQb01lbnVJdGVtKTogdm9pZCB7XHJcbiAgICBtZW51SXRlbVsnaWQnXSA9IG1lbnVJdGVtWydpZCddIHx8IHV1aWQoKTtcclxuICAgIG1lbnVJdGVtWydsZXZlbCddID0gdGhpcy5fbGV2ZWw7XHJcbiAgICBtZW51SXRlbVsndHlwZSddID0gdGhpcy5zZXRNZW51VHlwZShtZW51SXRlbSk7XHJcbiAgfVxyXG5cclxuICBwcm90ZWN0ZWQgdmFsaWRhdGVNZW51cyhtZW51cyk6IHZvaWQge1xyXG4gICAgbWVudXMuZm9yRWFjaChtZW51ID0+IHRoaXMudmFsaWRhdGVNZW51KG1lbnUpKTtcclxuICB9XHJcblxyXG4gIHByb3RlY3RlZCBzZXRNZW51VHlwZShtZW51SXRlbTogUG9NZW51SXRlbSk6IHN0cmluZyB7XHJcbiAgICBpZiAobWVudUl0ZW0uc3ViSXRlbXMgJiYgbWVudUl0ZW0uc3ViSXRlbXMubGVuZ3RoID4gMCAmJiB0aGlzLl9sZXZlbCA8IHRoaXMubWF4TGV2ZWwpIHtcclxuICAgICAgcmV0dXJuICdzdWJJdGVtcyc7XHJcbiAgICB9XHJcbiAgICBpZiAoIW1lbnVJdGVtLmxpbmspIHtcclxuICAgICAgcmV0dXJuICdub0xpbmsnO1xyXG4gICAgfVxyXG4gICAgaWYgKGlzRXh0ZXJuYWxMaW5rKG1lbnVJdGVtLmxpbmspKSB7XHJcbiAgICAgIHJldHVybiAnZXh0ZXJuYWxMaW5rJztcclxuICAgIH1cclxuICAgIHJldHVybiAnaW50ZXJuYWxMaW5rJztcclxuICB9XHJcblxyXG4gIHByaXZhdGUgY29uZmlnU2VydmljZShzZXJ2aWNlOiBzdHJpbmcgfCBQb01lbnVGaWx0ZXIpIHtcclxuICAgIGlmICh0eXBlb2Ygc2VydmljZSA9PT0gJ3N0cmluZycgJiYgc2VydmljZS50cmltKCkpIHtcclxuICAgICAgLy8gc2VydmljZSB1cmxcclxuICAgICAgdGhpcy5tZW51U2VydmljZS5jb25maWdQcm9wZXJ0aWVzKHNlcnZpY2UpO1xyXG4gICAgICB0aGlzLmZpbHRlclNlcnZpY2UgPSB0aGlzLm1lbnVTZXJ2aWNlO1xyXG4gICAgfSBlbHNlIGlmICh0eXBlb2Ygc2VydmljZSA9PT0gJ29iamVjdCcgJiYgc2VydmljZS5nZXRGaWx0ZXJlZERhdGEpIHtcclxuICAgICAgLy8gY3VzdG9tIHNlcnZpY2VcclxuICAgICAgdGhpcy5maWx0ZXJTZXJ2aWNlID0gc2VydmljZTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHRoaXMuZmlsdGVyU2VydmljZSA9IHVuZGVmaW5lZDtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHByaXZhdGUgcHJvY2Vzc1N1Ykl0ZW1zKG1lbnUpIHtcclxuICAgIG1lbnUuc3ViSXRlbXMuZm9yRWFjaCgobWVudUl0ZW0sIGluZGV4LCBtZW51SXRlbXMpID0+IHtcclxuICAgICAgY29uc3QgcHJldmlvdXNJdGVtID0gbWVudUl0ZW1zW2luZGV4IC0gMV07XHJcbiAgICAgIGlmIChwcmV2aW91c0l0ZW0gJiYgcHJldmlvdXNJdGVtLnN1Ykl0ZW1zKSB7XHJcbiAgICAgICAgdGhpcy5fbGV2ZWwgPSBwcmV2aW91c0l0ZW1bJ2xldmVsJ107XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGlmICh0aGlzLl9sZXZlbCA8PSB0aGlzLm1heExldmVsKSB7XHJcbiAgICAgICAgdGhpcy5zZXRNZW51SXRlbVByb3BlcnRpZXMobWVudUl0ZW0pO1xyXG5cclxuICAgICAgICBpZiAobWVudUl0ZW0uc3ViSXRlbXMpIHtcclxuICAgICAgICAgIHRoaXMuX2xldmVsKys7XHJcbiAgICAgICAgICB0aGlzLnByb2Nlc3NTdWJJdGVtcyhtZW51SXRlbSk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcblxyXG4gICAgICBpZiAoIW1lbnVbJ2JhZGdlQWxlcnQnXSkge1xyXG4gICAgICAgIG1lbnUgPSB0aGlzLnNldE1lbnVCYWRnZUFsZXJ0KG1lbnUsIG1lbnVJdGVtKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcblxyXG4gICAgbWVudS5zdWJJdGVtcyA9IE9iamVjdC5hc3NpZ24oW10sIG1lbnUuc3ViSXRlbXMpO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSByZW1vdmVCYWRnZUFsZXJ0KG1lbnVJdGVtOiBQb01lbnVJdGVtKTogdm9pZCB7XHJcbiAgICBpZiAobWVudUl0ZW1bJ2JhZGdlQWxlcnQnXSkge1xyXG4gICAgICBkZWxldGUgbWVudUl0ZW1bJ2JhZGdlQWxlcnQnXTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAobWVudUl0ZW0uc3ViSXRlbXMpIHtcclxuICAgICAgbWVudUl0ZW0uc3ViSXRlbXMuZm9yRWFjaChzdWJJdGVtID0+IHRoaXMucmVtb3ZlQmFkZ2VBbGVydChzdWJJdGVtKSk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIHNldE1lbnVCYWRnZUFsZXJ0KHBhcmVudDogUG9NZW51SXRlbSwgY2hpbGQ6IFBvTWVudUl0ZW0pOiBQb01lbnVJdGVtIHtcclxuICAgIGNvbnN0IGNoaWxkSGFzU3ViSXRlbXMgPSBjaGlsZC5zdWJJdGVtcyAmJiBjaGlsZC5zdWJJdGVtcy5sZW5ndGg7XHJcbiAgICBjb25zdCBjaGlsZEhhc0JhZGdlQWxlcnQgPSBjaGlsZFsnYmFkZ2VBbGVydCddO1xyXG4gICAgY29uc3QgY2hpbGRIYXNCYWRnZSA9IGNoaWxkLmJhZGdlICYmIGNvbnZlcnRUb0ludChjaGlsZC5iYWRnZS52YWx1ZSkgPj0gMDtcclxuXHJcbiAgICBwYXJlbnRbJ2JhZGdlQWxlcnQnXSA9IGNoaWxkSGFzQmFkZ2VBbGVydCB8fCAoY2hpbGRIYXNCYWRnZSAmJiAhY2hpbGRIYXNTdWJJdGVtcyk7XHJcblxyXG4gICAgcmV0dXJuIHBhcmVudDtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgdmFsaWRhdGVNZW51KG1lbnVJdGVtOiBQb01lbnVJdGVtKTogdm9pZCB7XHJcbiAgICBpZiAoIW1lbnVJdGVtLmxhYmVsIHx8IG1lbnVJdGVtLmxhYmVsLnRyaW0oKSA9PT0gJycpIHtcclxuICAgICAgdGhyb3cgbmV3IEVycm9yKHRoaXMubGl0ZXJhbHMuZW1wdHlMYWJlbEVycm9yKTtcclxuICAgIH0gZWxzZSBpZiAobWVudUl0ZW0uc3ViSXRlbXMpIHtcclxuICAgICAgbWVudUl0ZW0uc3ViSXRlbXMuZm9yRWFjaChzdWJJdGVtID0+IHtcclxuICAgICAgICB0aGlzLnZhbGlkYXRlTWVudShzdWJJdGVtKTtcclxuICAgICAgfSk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwcm90ZWN0ZWQgYWJzdHJhY3QgY2hlY2tBY3RpdmVNZW51QnlVcmwodXJsUm91dGVyKTtcclxuICBwcm90ZWN0ZWQgYWJzdHJhY3QgY2hlY2tpbmdSb3V0ZXJDaGlsZHJlbkZyYWdtZW50cygpO1xyXG4gIHByb3RlY3RlZCBhYnN0cmFjdCB2YWxpZGF0ZUNvbGxhcHNlQ2xhc3MoKTtcclxufVxyXG4iXX0=