/* eslint-disable */
import { __rest } from "tslib";
import { Directive, ElementRef, NgZone, Renderer2 } from '@angular/core';
import { Subject } from 'rxjs';
import { convertNumberToDecimal } from '../../../../utils/util';
import { poChartAngleStepInterval, poChartCompleteCircle, poChartDonutSerieWidth, poChartGaugeSerieWidth, poChartStartAngle } from './po-chart-circular.constant';
import { PoDefaultColorsTextBlack } from '../../../../services/po-color/po-colors.constant';
import { PoChartDynamicTypeComponent } from '../po-chart-dynamic-type.component';
import { PoChartType } from '../../enums/po-chart-type.enum';
const poChartBlackColor = '#000000';
const poChartWhiteColor = '#ffffff';
export class PoChartCircular extends PoChartDynamicTypeComponent {
    constructor(el, ngZone, renderer) {
        super();
        this.el = el;
        this.ngZone = ngZone;
        this.renderer = renderer;
        this.chartItemStartAngle = poChartStartAngle;
        this.windowResizeEmitter = new Subject();
        this.chartItemsEndAngleList = [];
        this.svgPathElementsList = [];
        this.svgTextElementsList = [];
    }
    ngOnDestroy() {
        this.removeWindowResizeListener();
        this.removeWindowScrollListener();
        this.animationRunning = false;
    }
    ngOnInit() {
        this.chartInitSetup();
        this.setEventListeners();
    }
    removeTooltip() {
        if (this.tooltipElement) {
            this.renderer.addClass(this.tooltipElement, 'po-invisible');
        }
    }
    drawPath(path, chartItemStartAngle, chartItemEndAngle) {
        const sinAlpha = Math.sin(chartItemStartAngle);
        const cosAlpha = Math.cos(chartItemStartAngle);
        const sinBeta = Math.sin(chartItemEndAngle);
        const cosBeta = Math.cos(chartItemEndAngle);
        const startX = this.centerX + cosAlpha * this.centerX;
        const startY = this.centerX + sinAlpha * this.centerX;
        const endX = this.centerX + cosBeta * this.centerX;
        const endY = this.centerX + sinBeta * this.centerX;
        const startInnerX = this.centerX + cosAlpha * this.innerRadius;
        const startInnerY = this.centerX + sinAlpha * this.innerRadius;
        const endInnerX = this.centerX + cosBeta * this.innerRadius;
        const endInnerY = this.centerX + sinBeta * this.innerRadius;
        const halfGaugeCoordinates = [
            'M',
            startX,
            startY,
            'A',
            this.centerX,
            this.centerX,
            0,
            '0,1',
            endX,
            endY,
            'A',
            1,
            1,
            0,
            '0,1',
            endInnerX,
            endInnerY,
            'A',
            this.innerRadius,
            this.innerRadius,
            0,
            '0,0',
            startInnerX,
            startInnerY,
            'A',
            1,
            1,
            0,
            '0,1',
            startX,
            startY,
            'Z'
        ].join(' ');
        return path.setAttribute('d', halfGaugeCoordinates);
    }
    getSeriesWithValue(series) {
        const newSeries = [];
        series.forEach((serie, index) => {
            var _a;
            const value = (_a = serie.data) !== null && _a !== void 0 ? _a : serie.value;
            if (value > 0) {
                newSeries.push(Object.assign(Object.assign({}, serie), { color: this.colors[index] }));
            }
        });
        return newSeries;
    }
    animationSetup() {
        this.chartItemEndAngle = this.chartItemsEndAngleList[0];
        this.animationRunning = true;
        this.drawPathInit();
    }
    appendGaugeBackgroundPathElement(svgPathsWrapper) {
        const svgPath = this.renderer.createElement('svg:path', 'svg');
        this.renderer.setAttribute(svgPath, 'class', 'po-chart-gauge-base-path');
        svgPathsWrapper.appendChild(svgPath);
        this.renderer.appendChild(this.svgElement, svgPathsWrapper);
    }
    calculateAngleRadians() {
        this.series.forEach((serie, index) => {
            var _a;
            const data = (_a = serie.data) !== null && _a !== void 0 ? _a : serie.value;
            this.chartItemsEndAngleList[index] = this.calculateEndAngle(data, this.totalValue);
        });
    }
    calculateCurrentEndAngle(angleCurrentPosition) {
        const isSerieDrawCompleted = this.chartItemStartAngle + angleCurrentPosition > this.chartItemStartAngle + this.chartItemEndAngle;
        if (isSerieDrawCompleted) {
            return this.chartItemStartAngle + this.chartItemEndAngle - poChartCompleteCircle;
        }
        else {
            return this.chartItemStartAngle + angleCurrentPosition;
        }
    }
    calculateEndAngle(value, totalValue) {
        const endAngle = (value / totalValue) * (Math.PI * 2);
        return this.isChartGaugeType ? endAngle / 2 : endAngle;
    }
    calculateSVGDimensions() {
        this.calculateSVGContainerDimensions(this.chartWrapper, this.chartHeader, this.chartLegend);
        this.innerRadius = this.setInnerRadius(this.type);
    }
    changeTooltipPosition(event) {
        if (this.tooltipElement && this.tooltipElement.classList.contains('po-invisible')) {
            this.showTooltip();
        }
        const tooltipPositions = this.setTooltipPositions(event);
        this.renderer.setStyle(this.tooltipElement, 'left', `${tooltipPositions.left}px`);
        this.renderer.setStyle(this.tooltipElement, 'top', `${tooltipPositions.top}px`);
    }
    chartInitSetup() {
        this.calculateSVGDimensions();
        this.calculateTotalValue();
        this.calculateAngleRadians();
        this.createSVGElements();
        this.animationSetup();
    }
    checkingIfScrollsWithPoPage() {
        const poPageContent = document.getElementsByClassName('po-page-content');
        return poPageContent.length ? poPageContent[0] : window;
    }
    createPath(serie, svgPathsWrapper) {
        const svgPath = this.renderer.createElement('svg:path', 'svg');
        this.renderer.setAttribute(svgPath, 'class', 'po-path-item');
        this.renderer.setAttribute(svgPath, 'fill', serie.color);
        this.setElementAttributes(svgPath, serie);
        svgPathsWrapper.appendChild(svgPath);
        this.renderer.appendChild(this.svgElement, svgPathsWrapper);
        this.svgPathElementsList.push(svgPath);
    }
    createPaths() {
        const svgPathsWrapper = this.renderer.createElement('svg:g', 'svg');
        if (this.isChartGaugeType) {
            this.appendGaugeBackgroundPathElement(svgPathsWrapper);
            // Tratamento para evitar que o path desenhe os arcos referentes ao border radius do path.
            if (this.isSerieValueEqualZero()) {
                return;
            }
        }
        this.series.forEach(serie => this.createPath(serie, svgPathsWrapper));
    }
    createText(serie) {
        const data = serie.value;
        const svgG = this.renderer.createElement('svg:g', 'svg');
        const svgText = this.renderer.createElement('svg:text', 'svg');
        const fontSize = this.getFontSize();
        const textColor = this.getTextColor(serie.color);
        svgText.textContent = this.getPercentValue(data, this.totalValue) + '%';
        this.renderer.setAttribute(svgText, 'class', 'po-path-item');
        this.renderer.setAttribute(svgText, 'fill', textColor);
        this.renderer.setAttribute(svgText, 'font-size', fontSize);
        this.renderer.setAttribute(svgText, 'fill-opacity', '0');
        this.setElementAttributes(svgText, serie);
        this.renderer.appendChild(svgG, svgText);
        this.renderer.appendChild(this.svgElement, svgG);
        this.svgTextElementsList.push(svgText);
    }
    createTexts() {
        if (this.type === PoChartType.Donut) {
            this.series.forEach(serie => this.createText(serie));
        }
    }
    createSVGElements() {
        const viewBoxHeight = this.isChartGaugeType
            ? this.centerX + this.centerX * poChartGaugeSerieWidth
            : this.chartWrapper;
        const preserveAspectRatio = this.isChartGaugeType ? 'xMidYMax' : 'xMidYMin';
        this.svgElement = this.renderer.createElement('svg:svg', 'svg');
        this.renderer.setAttribute(this.svgElement, 'viewBox', `0 0 ${this.chartWrapper} ${viewBoxHeight}`);
        this.renderer.setAttribute(this.svgElement, 'preserveAspectRatio', `${preserveAspectRatio} meet`);
        this.renderer.setAttribute(this.svgElement, 'class', 'po-chart-svg-element');
        this.renderer.setAttribute(this.svgElement, 'width', `${this.centerX}`);
        this.renderer.setAttribute(this.svgElement, 'height', `${this.svgHeight}`);
        this.svgContainer.nativeElement.appendChild(this.svgElement);
        this.createPaths();
        this.createTexts();
    }
    drawPathInit() {
        if (!this.animationRunning) {
            return;
        }
        else {
            this.ngZone.runOutsideAngular(() => this.drawSeries());
        }
    }
    drawSeries(currentSerieIndex = 0, angleCurrentPosition = 0) {
        const isFinishedDrawingCurrentSeries = angleCurrentPosition > this.chartItemEndAngle;
        const isFinishedDrawingAllSeries = currentSerieIndex === this.svgPathElementsList.length;
        if (isFinishedDrawingAllSeries) {
            return;
        }
        if (isFinishedDrawingCurrentSeries) {
            this.chartItemStartAngle = this.chartItemStartAngle + this.chartItemEndAngle;
            currentSerieIndex++;
            this.chartItemEndAngle = this.chartItemsEndAngleList[currentSerieIndex];
            angleCurrentPosition = 0;
        }
        else {
            angleCurrentPosition += poChartAngleStepInterval;
            this.drawPath(this.svgPathElementsList[currentSerieIndex], this.chartItemStartAngle, this.calculateCurrentEndAngle(angleCurrentPosition));
            this.setTextProperties(this.svgTextElementsList[currentSerieIndex], this.chartItemStartAngle, this.calculateCurrentEndAngle(angleCurrentPosition));
        }
        window.requestAnimationFrame(this.drawSeries.bind(this, currentSerieIndex, angleCurrentPosition));
    }
    emitEventOnEnter(event) {
        this.onSerieHover.next(event);
    }
    getFontSize() {
        const fontSizePorcent = 0.04;
        const fontSize = fontSizePorcent * this.chartWrapper;
        return `${fontSize.toFixed(0)}px`;
    }
    getPercentValue(value, totalValue) {
        const percentValue = (value / totalValue) * 100;
        const floatPercentValue = convertNumberToDecimal(percentValue, 2);
        return String(floatPercentValue).replace('.', ',');
    }
    getTextColor(color) {
        if (PoDefaultColorsTextBlack.includes(color)) {
            return poChartBlackColor;
        }
        return poChartWhiteColor;
    }
    getTooltipValue(value) {
        if (this.type === PoChartType.Pie) {
            return value.toString();
        }
        return this.getPercentValue(value, this.totalValue) + '%';
    }
    isSerieValueEqualZero() {
        return this.series.length && this.series[0].value === 0;
    }
    onMouseClick() {
        let serieOnClick;
        const _a = this.series[0], { color } = _a, serie = __rest(_a, ["color"]);
        serieOnClick = serie;
        this.onSerieClick.next(serieOnClick);
    }
    onMouseEnter(event) {
        let serieOnEnter;
        const _a = this.series[0], { color } = _a, serie = __rest(_a, ["color"]);
        this.chartElementDescription = event.target.getAttributeNS(null, 'data-tooltip-category');
        serieOnEnter = serie;
        this.emitEventOnEnter(serieOnEnter);
    }
    onWindowResize() {
        this.calculateSVGDimensions();
        this.renderer.setAttribute(this.svgElement, 'width', `${this.centerX}`);
        this.renderer.setAttribute(this.svgElement, 'height', `${this.svgHeight}`);
        this.windowResizeEmitter.next();
    }
    removeWindowResizeListener() {
        if (this.windowResizeListener) {
            this.windowResizeListener();
        }
    }
    removeWindowScrollListener() {
        if (this.windowScrollListener) {
            this.windowScrollListener();
        }
    }
    setEventListeners() {
        let chartSeries = this.el.nativeElement.querySelectorAll('.po-path-item');
        chartSeries = Array.from(chartSeries);
        chartSeries.forEach(serie => {
            this.renderer.listen(serie, 'click', this.onMouseClick.bind(this));
            this.renderer.listen(serie, 'mouseenter', this.onMouseEnter.bind(this));
            if (!this.isChartGaugeType) {
                this.renderer.listen(serie, 'mousemove', this.changeTooltipPosition.bind(this));
                this.renderer.listen(serie, 'mouseleave', this.removeTooltip.bind(this));
            }
        });
        this.windowResizeListener = this.renderer.listen(window, 'resize', this.onWindowResize.bind(this));
        this.windowScrollListener = this.renderer.listen(this.checkingIfScrollsWithPoPage(), 'scroll', this.removeTooltip.bind(this));
    }
    setInnerRadius(type) {
        let serieWidth;
        switch (type) {
            case PoChartType.Donut: {
                serieWidth = poChartDonutSerieWidth;
                break;
            }
            case PoChartType.Gauge: {
                serieWidth = poChartGaugeSerieWidth;
                break;
            }
            case PoChartType.Pie: {
                return 0;
            }
        }
        return this.centerX - this.centerX * serieWidth;
    }
    setTextProperties(text, startAngle, endAngle) {
        // necessário text.getClientRects().length para contornar erro de console causado no Firefox
        if (this.type === PoChartType.Donut && text.getClientRects().length) {
            // utilizado para recuperar o angulo do meio, entre o inicio e fim para centralizar o texto
            const centerAngle = (startAngle + endAngle) / 2;
            const textBox = text.getBBox();
            const halfTextWidth = textBox.width / 2;
            const halfTextHeight = textBox.height / 2;
            // radius interno (circulo branco) + a metade da diferença entre tamanho do centro e radius interno
            const radius = this.innerRadius + (this.centerX - this.innerRadius) / 2;
            const xCoordinate = radius * Math.cos(centerAngle) + this.centerX - halfTextWidth;
            const yCoordinate = radius * Math.sin(centerAngle) + this.centerX + halfTextHeight / 2;
            text.setAttribute('x', xCoordinate);
            text.setAttribute('y', yCoordinate);
            text.setAttribute('fill-opacity', '1');
        }
    }
    setTooltipPositions(event) {
        const displacement = 8;
        return {
            left: event.clientX - this.tooltipElement.offsetWidth / 2,
            top: event.clientY - this.tooltipElement.offsetHeight - displacement
        };
    }
    setElementAttributes(svgElement, serie) {
        var _a, _b;
        const { tooltip } = serie;
        const data = (_a = serie.data) !== null && _a !== void 0 ? _a : serie.value;
        const label = (_b = serie.label) !== null && _b !== void 0 ? _b : (serie.description || serie.category);
        this.renderer.setAttribute(svgElement, 'data-tooltip-value', `${data}`);
        if (this.isChartGaugeType) {
            this.renderer.setAttribute(svgElement, 'data-tooltip-description', label);
        }
        else {
            const tooltipValue = this.getTooltipValue(data);
            this.renderer.setAttribute(svgElement, 'data-tooltip-category', label);
            this.renderer.setAttribute(svgElement, 'data-tooltip-text', tooltip || `${label}: ${tooltipValue}`);
        }
    }
    showTooltip() {
        this.renderer.removeClass(this.tooltipElement, 'po-invisible');
    }
}
PoChartCircular.decorators = [
    { type: Directive }
];
PoChartCircular.ctorParameters = () => [
    { type: ElementRef },
    { type: NgZone },
    { type: Renderer2 }
];
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG8tY2hhcnQtY2lyY3VsYXIuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy91aS9zcmMvbGliL2NvbXBvbmVudHMvcG8tY2hhcnQvcG8tY2hhcnQtdHlwZXMvcG8tY2hhcnQtY2lyY3VsYXIvcG8tY2hhcnQtY2lyY3VsYXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsb0JBQW9COztBQUVwQixPQUFPLEVBQUUsU0FBUyxFQUFFLFVBQVUsRUFBRSxNQUFNLEVBQXFCLFNBQVMsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUM1RixPQUFPLEVBQUUsT0FBTyxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBRS9CLE9BQU8sRUFBRSxzQkFBc0IsRUFBRSxNQUFNLHdCQUF3QixDQUFDO0FBRWhFLE9BQU8sRUFDTCx3QkFBd0IsRUFDeEIscUJBQXFCLEVBQ3JCLHNCQUFzQixFQUN0QixzQkFBc0IsRUFDdEIsaUJBQWlCLEVBQ2xCLE1BQU0sOEJBQThCLENBQUM7QUFDdEMsT0FBTyxFQUFFLHdCQUF3QixFQUFFLE1BQU0sa0RBQWtELENBQUM7QUFFNUYsT0FBTyxFQUFFLDJCQUEyQixFQUFFLE1BQU0sb0NBQW9DLENBQUM7QUFFakYsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLGdDQUFnQyxDQUFDO0FBRTdELE1BQU0saUJBQWlCLEdBQUcsU0FBUyxDQUFDO0FBQ3BDLE1BQU0saUJBQWlCLEdBQUcsU0FBUyxDQUFDO0FBR3BDLE1BQU0sT0FBTyxlQUFnQixTQUFRLDJCQUEyQjtJQVU5RCxZQUFzQixFQUFjLEVBQVUsTUFBYyxFQUFVLFFBQW1CO1FBQ3ZGLEtBQUssRUFBRSxDQUFDO1FBRFksT0FBRSxHQUFGLEVBQUUsQ0FBWTtRQUFVLFdBQU0sR0FBTixNQUFNLENBQVE7UUFBVSxhQUFRLEdBQVIsUUFBUSxDQUFXO1FBVHpGLHdCQUFtQixHQUFHLGlCQUFpQixDQUFDO1FBQ3hDLHdCQUFtQixHQUFpQixJ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Q0FBQztJQUVPLG9CQUFvQixDQUFDLFVBQVUsRUFBRSxLQUFLOztRQUM1QyxNQUFNLEVBQUUsT0FBTyxFQUFFLEdBQUcsS0FBSyxDQUFDO1FBQzFCLE1BQU0sSUFBSSxHQUFHLE1BQUEsS0FBSyxDQUFDLElBQUksbUNBQUksS0FBSyxDQUFDLEtBQUssQ0FBQztRQUN2QyxNQUFNLEtBQUssR0FBRyxNQUFBLEtBQUssQ0FBQyxLQUFLLG1DQUFJLENBQUMsS0FBSyxDQUFDLFdBQVcsSUFBSSxLQUFLLENBQUMsUUFBUSxDQUFDLENBQUM7UUFFbkUsSUFBSSxDQUFDLFFBQVEsQ0FBQyxZQUFZLENBQUMsVUFBVSxFQUFFLG9CQUFvQixFQUFFLEdBQUcsSUFBSSxFQUFFLENBQUMsQ0FBQztRQUV4RSxJQUFJLElBQUksQ0FBQyxnQkFBZ0IsRUFBRTtZQUN6QixJQUFJLENBQUMsUUFBUSxDQUFDLFlBQVksQ0FBQyxVQUFVLEVBQUUsMEJBQTBCLEVBQUUsS0FBSyxDQUFDLENBQUM7U0FDM0U7YUFBTTtZQUNMLE1BQU0sWUFBWSxHQUFHLElBQUksQ0FBQyxlQUFlLENBQUMsSUFBSSxDQUFDLENBQUM7WUFFaEQsSUFBSSxDQUFDLFFBQVEsQ0FBQyxZQUFZLENBQUMsVUFBVSxFQUFFLHVCQUF1QixFQUFFLEtBQUssQ0FBQyxDQUFDO1lBQ3ZFLElBQUksQ0FBQyxRQUFRLENBQUMsWUFBWSxDQUFDLFVBQVUsRUFBRSxtQkFBbUIsRUFBRSxPQUFPLElBQUksR0FBRyxLQUFLLEtBQUssWUFBWSxFQUFFLENBQUMsQ0FBQztTQUNyRztJQUNILENBQUM7SUFFTyxXQUFXO1FBQ2pCLElBQUksQ0FBQyxRQUFRLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxjQUFjLEVBQUUsY0FBYyxDQUFDLENBQUM7SUFDakUsQ0FBQzs7O1lBMWNGLFNBQVM7OztZQXJCVSxVQUFVO1lBQUUsTUFBTTtZQUFxQixTQUFTIiwic291cmNlc0NvbnRlbnQiOlsiLyogZXNsaW50LWRpc2FibGUgKi9cclxuXHJcbmltcG9ydCB7IERpcmVjdGl2ZSwgRWxlbWVudFJlZiwgTmdab25lLCBPbkRlc3Ryb3ksIE9uSW5pdCwgUmVuZGVyZXIyIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IFN1YmplY3QgfSBmcm9tICdyeGpzJztcclxuXHJcbmltcG9ydCB7IGNvbnZlcnROdW1iZXJUb0RlY2ltYWwgfSBmcm9tICcuLi8uLi8uLi8uLi91dGlscy91dGlsJztcclxuXHJcbmltcG9ydCB7XHJcbiAgcG9DaGFydEFuZ2xlU3RlcEludGVydmFsLFxyXG4gIHBvQ2hhcnRDb21wbGV0ZUNpcmNsZSxcclxuICBwb0NoYXJ0RG9udXRTZXJpZVdpZHRoLFxyXG4gIHBvQ2hhcnRHYXVnZVNlcmllV2lkdGgsXHJcbiAgcG9DaGFydFN0YXJ0QW5nbGVcclxufSBmcm9tICcuL3BvLWNoYXJ0LWNpcmN1bGFyLmNvbnN0YW50JztcclxuaW1wb3J0IHsgUG9EZWZhdWx0Q29sb3JzVGV4dEJsYWNrIH0gZnJvbSAnLi4vLi4vLi4vLi4vc2VydmljZXMvcG8tY29sb3IvcG8tY29sb3JzLmNvbnN0YW50JztcclxuXHJcbmltcG9ydCB7IFBvQ2hhcnREeW5hbWljVHlwZUNvbXBvbmVudCB9IGZyb20gJy4uL3BvLWNoYXJ0LWR5bmFtaWMtdHlwZS5jb21wb25lbnQnO1xyXG5pbXBvcnQgeyBQb0NoYXJ0R2F1Z2VTZXJpZSB9IGZyb20gJy4uL3BvLWNoYXJ0LWdhdWdlL3BvLWNoYXJ0LWdhdWdlLXNlcmllcy5pbnRlcmZhY2UnO1xyXG5pbXBvcnQgeyBQb0NoYXJ0VHlwZSB9IGZyb20gJy4uLy4uL2VudW1zL3BvLWNoYXJ0LXR5cGUuZW51bSc7XHJcblxyXG5jb25zdCBwb0NoYXJ0QmxhY2tDb2xvciA9ICcjMDAwMDAwJztcclxuY29uc3QgcG9DaGFydFdoaXRlQ29sb3IgPSAnI2ZmZmZmZic7XHJcblxyXG5ARGlyZWN0aXZlKClcclxuZXhwb3J0IGNsYXNzIFBvQ2hhcnRDaXJjdWxhciBleHRlbmRzIFBvQ2hhcnREeW5hbWljVHlwZUNvbXBvbmVudCBpbXBsZW1lbnRzIE9uRGVzdHJveSwgT25Jbml0IHtcclxuICBjaGFydEl0ZW1TdGFydEFuZ2xlID0gcG9DaGFydFN0YXJ0QW5nbGU7XHJcbiAgd2luZG93UmVzaXplRW1pdHRlcjogU3ViamVjdDxhbnk+ID0gbmV3IFN1YmplY3QoKTtcclxuXHJcbiAgcHJpdmF0ZSBhbmltYXRpb25SdW5uaW5nOiBib29sZWFuO1xyXG4gIHByaXZhdGUgY2hhcnRJdGVtRW5kQW5nbGU6IG51bWJlcjtcclxuICBwcml2YXRlIGNoYXJ0SXRlbXNFbmRBbmdsZUxpc3Q6IEFycmF5PG51bWJlcj4gPSBbXTtcclxuICBwcml2YXRlIHN2Z1BhdGhFbGVtZW50c0xpc3Q6IEFycmF5PHN0cmluZz4gPSBbXTtcclxuICBwcml2YXRlIHN2Z1RleHRFbGVtZW50c0xpc3Q6IEFycmF5PHN0cmluZz4gPSBbXTtcclxuXHJcbiAgY29uc3RydWN0b3IocHJvdGVjdGVkIGVsOiBFbGVtZW50UmVmLCBwcml2YXRlIG5nWm9uZTogTmdab25lLCBwcml2YXRlIHJlbmRlcmVyOiBSZW5kZXJlcjIpIHtcclxuICAgIHN1cGVyKCk7XHJcbiAgfVxyXG5cclxuICBuZ09uRGVzdHJveSgpIHtcclxuICAgIHRoaXMucmVtb3ZlV2luZG93UmVzaXplTGlzdGVuZXIoKTtcclxuICAgIHRoaXMucmVtb3ZlV2luZG93U2Nyb2xsTGlzdGVuZXIoKTtcclxuICAgIHRoaXMuYW5pbWF0aW9uUnVubmluZyA9IGZhbHNlO1xyXG4gIH1cclxuXHJcbiAgbmdPbkluaXQoKSB7XHJcbiAgICB0aGlzLmNoYXJ0SW5pdFNldHVwKCk7XHJcbiAgICB0aGlzLnNldEV2ZW50TGlzdGVuZXJzKCk7XHJcbiAgfVxyXG5cclxuICByZW1vdmVUb29sdGlwKCkge1xyXG4gICAgaWYgKHRoaXMudG9vbHRpcEVsZW1lbnQpIHtcclxuICAgICAgdGhpcy5yZW5kZXJlci5hZGRDbGFzcyh0aGlzLnRvb2x0aXBFbGVtZW50LCAncG8taW52aXNpYmxlJyk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwcm90ZWN0ZWQgZHJhd1BhdGgocGF0aCwgY2hhcnRJdGVtU3RhcnRBbmdsZSwgY2hhcnRJdGVtRW5kQW5nbGUpIHtcclxuICAgIGNvbnN0IHNpbkFscGhhID0gTWF0aC5zaW4oY2hhcnRJdGVtU3RhcnRBbmdsZSk7XHJcbiAgICBjb25zdCBjb3NBbHBoYSA9IE1hdGguY29zKGNoYXJ0SXRlbVN0YXJ0QW5nbGUpO1xyXG5cclxuICAgIGNvbnN0IHNpbkJldGEgPSBNYXRoLnNpbihjaGFydEl0ZW1FbmRBbmdsZSk7XHJcbiAgICBjb25zdCBjb3NCZXRhID0gTWF0aC5jb3MoY2hhcnRJdGVtRW5kQW5nbGUpO1xyXG5cclxuICAgIGNvbnN0IHN0YXJ0WCA9IHRoaXMuY2VudGVyWCArIGNvc0FscGhhICogdGhpcy5jZW50ZXJYO1xyXG4gICAgY29uc3Qgc3RhcnRZID0gdGhpcy5jZW50ZXJYICsgc2luQWxwaGEgKiB0aGlzLmNlbnRlclg7XHJcblxyXG4gICAgY29uc3QgZW5kWCA9IHRoaXMuY2VudGVyWCArIGNvc0JldGEgKiB0aGlzLmNlbnRlclg7XHJcbiAgICBjb25zdCBlbmRZID0gdGhpcy5jZW50ZXJYICsgc2luQmV0YSAqIHRoaXMuY2VudGVyWDtcclxuXHJcbiAgICBjb25zdCBzdGFydElubmVyWCA9IHRoaXMuY2VudGVyWCArIGNvc0FscGhhICogdGhpcy5pbm5lclJhZGl1cztcclxuICAgIGNvbnN0IHN0YXJ0SW5uZXJZID0gdGhpcy5jZW50ZXJYICsgc2luQWxwaGEgKiB0aGlzLmlubmVyUmFkaXVzO1xyXG5cclxuICAgIGNvbnN0IGVuZElubmVyWCA9IHRoaXMuY2VudGVyWCArIGNvc0JldGEgKiB0aGlzLmlubmVyUmFkaXVzO1xyXG4gICAgY29uc3QgZW5kSW5uZXJZID0gdGhpcy5jZW50ZXJYICsgc2luQmV0YSAqIHRoaXMuaW5uZXJSYWRpdXM7XHJcblxyXG4gICAgY29uc3QgaGFsZkdhdWdlQ29vcmRpbmF0ZXMgPSBbXHJcbiAgICAgICdNJyxcclxuICAgICAgc3RhcnRYLFxyXG4gICAgICBzdGFydFksXHJcbiAgICAgICdBJyxcclxuICAgICAgdGhpcy5jZW50ZXJYLFxyXG4gICAgICB0aGlzLmNlbnRlclgsXHJcbiAgICAgIDAsXHJcbiAgICAgICcwLDEnLFxyXG4gICAgICBlbmRYLFxyXG4gICAgICBlbmRZLFxyXG4gICAgICAnQScsXHJcbiAgICAgIDEsXHJcbiAgICAgIDEsXHJcbiAgICAgIDAsXHJcbiAgICAgICcwLDEnLFxyXG4gICAgICBlbmRJbm5lclgsXHJcbiAgICAgIGVuZElubmVyWSxcclxuICAgICAgJ0EnLFxyXG4gICAgICB0aGlzLmlubmVyUmFkaXVzLFxyXG4gICAgICB0aGlzLmlubmVyUmFkaXVzLFxyXG4gICAgICAwLFxyXG4gICAgICAnMCwwJyxcclxuICAgICAgc3RhcnRJbm5lclgsXHJcbiAgICAgIHN0YXJ0SW5uZXJZLFxyXG4gICAgICAnQScsXHJcbiAgICAgIDEsXHJcbiAgICAgIDEsXHJcbiAgICAgIDAsXHJcbiAgICAgICcwLDEnLFxyXG4gICAgICBzdGFydFgsXHJcbiAgICAgIHN0YXJ0WSxcclxuICAgICAgJ1onXHJcbiAgICBdLmpvaW4oJyAnKTtcclxuXHJcbiAgICByZXR1cm4gcGF0aC5zZXRBdHRyaWJ1dGUoJ2QnLCBoYWxmR2F1Z2VDb29yZGluYXRlcyk7XHJcbiAgfVxyXG5cclxuICBwcm90ZWN0ZWQgZ2V0U2VyaWVzV2l0aFZhbHVlKHNlcmllczogQXJyYXk8UG9DaGFydEdhdWdlU2VyaWU+KSB7XHJcbiAgICBjb25zdCBuZXdTZXJpZXMgPSBbXTtcclxuXHJcbiAgICBzZXJpZXMuZm9yRWFjaCgoc2VyaWU6IGFueSwgaW5kZXgpID0+IHtcclxuICAgICAgY29uc3QgdmFsdWUgPSBzZXJpZS5kYXRhID8/IHNlcmllLnZhbHVlO1xyXG4gICAgICBpZiAodmFsdWUgPiAwKSB7XHJcbiAgICAgICAgbmV3U2VyaWVzLnB1c2goeyAuLi5zZXJpZSwgY29sb3I6IHRoaXMuY29sb3JzW2luZGV4XSB9KTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcblxyXG4gICAgcmV0dXJuIG5ld1NlcmllcztcclxuICB9XHJcblxyXG4gIHByaXZhdGUgYW5pbWF0aW9uU2V0dXAoKSB7XHJcbiAgICB0aGlzLmNoYXJ0SXRlbUVuZEFuZ2xlID0gdGhpcy5jaGFydEl0ZW1zRW5kQW5nbGVMaXN0WzBdO1xyXG4gICAgdGhpcy5hbmltYXRpb25SdW5uaW5nID0gdHJ1ZTtcclxuICAgIHRoaXMuZHJhd1BhdGhJbml0KCk7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGFwcGVuZEdhdWdlQmFja2dyb3VuZFBhdGhFbGVtZW50KHN2Z1BhdGhzV3JhcHBlcjogYW55KSB7XHJcbiAgICBjb25zdCBzdmdQYXRoID0gdGhpcy5yZW5kZXJlci5jcmVhdGVFbGVtZW50KCdzdmc6cGF0aCcsICdzdmcnKTtcclxuICAgIHRoaXMucmVuZGVyZXIuc2V0QXR0cmlidXRlKHN2Z1BhdGgsICdjbGFzcycsICdwby1jaGFydC1nYXVnZS1iYXNlLXBhdGgnKTtcclxuICAgIHN2Z1BhdGhzV3JhcHBlci5hcHBlbmRDaGlsZChzdmdQYXRoKTtcclxuICAgIHRoaXMucmVuZGVyZXIuYXBwZW5kQ2hpbGQodGhpcy5zdmdFbGVtZW50LCBzdmdQYXRoc1dyYXBwZXIpO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBjYWxjdWxhdGVBbmdsZVJhZGlhbnMoKSB7XHJcbiAgICB0aGlzLnNlcmllcy5mb3JFYWNoKChzZXJpZSwgaW5kZXgpID0+IHtcclxuICAgICAgY29uc3QgZGF0YSA9IHNlcmllLmRhdGEgPz8gc2VyaWUudmFsdWU7XHJcbiAgICAgIHRoaXMuY2hhcnRJdGVtc0VuZEFuZ2xlTGlzdFtpbmRleF0gPSB0aGlzLmNhbGN1bGF0ZUVuZEFuZ2xlKGRhdGEsIHRoaXMudG90YWxWYWx1ZSk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgY2FsY3VsYXRlQ3VycmVudEVuZEFuZ2xlKGFuZ2xlQ3VycmVudFBvc2l0aW9uOiBudW1iZXIpIHtcclxuICAgIGNvbnN0IGlzU2VyaWVEcmF3Q29tcGxldGVkID1cclxuICAgICAgdGhpcy5jaGFydEl0ZW1TdGFydEFuZ2xlICsgYW5nbGVDdXJyZW50UG9zaXRpb24gPiB0aGlzLmNoYXJ0SXRlbVN0YXJ0QW5nbGUgKyB0aGlzLmNoYXJ0SXRlbUVuZEFuZ2xlO1xyXG5cclxuICAgIGlmIChpc1NlcmllRHJhd0NvbXBsZXRlZCkge1xyXG4gICAgICByZXR1cm4gdGhpcy5jaGFydEl0ZW1TdGFydEFuZ2xlICsgdGhpcy5jaGFydEl0ZW1FbmRBbmdsZSAtIHBvQ2hhcnRDb21wbGV0ZUNpcmNsZTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHJldHVybiB0aGlzLmNoYXJ0SXRlbVN0YXJ0QW5nbGUgKyBhbmdsZUN1cnJlbnRQb3NpdGlvbjtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHByaXZhdGUgY2FsY3VsYXRlRW5kQW5nbGUodmFsdWU6IG51bWJlciwgdG90YWxWYWx1ZTogbnVtYmVyKTogbnVtYmVyIHtcclxuICAgIGNvbnN0IGVuZEFuZ2xlID0gKHZhbHVlIC8gdG90YWxWYWx1ZSkgKiAoTWF0aC5QSSAqIDIpO1xyXG5cclxuICAgIHJldHVybiB0aGlzLmlzQ2hhcnRHYXVnZVR5cGUgPyBlbmRBbmdsZSAvIDIgOiBlbmRBbmdsZTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgY2FsY3VsYXRlU1ZHRGltZW5zaW9ucygpIHtcclxuICAgIHRoaXMuY2FsY3VsYXRlU1ZHQ29udGFpbmVyRGltZW5zaW9ucyh0aGlzLmNoYXJ0V3JhcHBlciwgdGhpcy5jaGFydEhlYWRlciwgdGhpcy5jaGFydExlZ2VuZCk7XHJcblxyXG4gICAgdGhpcy5pbm5lclJhZGl1cyA9IHRoaXMuc2V0SW5uZXJSYWRpdXModGhpcy50eXBlKTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgY2hhbmdlVG9vbHRpcFBvc2l0aW9uKGV2ZW50OiBNb3VzZUV2ZW50KSB7XHJcbiAgICBpZiAodGhpcy50b29sdGlwRWxlbWVudCAmJiB0aGlzLnRvb2x0aXBFbGVtZW50LmNsYXNzTGlzdC5jb250YWlucygncG8taW52aXNpYmxlJykpIHtcclxuICAgICAgdGhpcy5zaG93VG9vbHRpcCgpO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IHRvb2x0aXBQb3NpdGlvbnMgPSB0aGlzLnNldFRvb2x0aXBQb3NpdGlvbnMoZXZlbnQpO1xyXG4gICAgdGhpcy5yZW5kZXJlci5zZXRTdHlsZSh0aGlzLnRvb2x0aXBFbGVtZW50LCAnbGVmdCcsIGAke3Rvb2x0aXBQb3NpdGlvbnMubGVmdH1weGApO1xyXG4gICAgdGhpcy5yZW5kZXJlci5zZXRTdHlsZSh0aGlzLnRvb2x0aXBFbGVtZW50LCAndG9wJywgYCR7dG9vbHRpcFBvc2l0aW9ucy50b3B9cHhgKTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgY2hhcnRJbml0U2V0dXAoKSB7XHJcbiAgICB0aGlzLmNhbGN1bGF0ZVNWR0RpbWVuc2lvbnMoKTtcclxuICAgIHRoaXMuY2FsY3VsYXRlVG90YWxWYWx1ZSgpO1xyXG4gICAgdGhpcy5jYWxjdWxhdGVBbmdsZVJhZGlhbnMoKTtcclxuICAgIHRoaXMuY3JlYXRlU1ZHRWxlbWVudHMoKTtcclxuICAgIHRoaXMuYW5pbWF0aW9uU2V0dXAoKTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgY2hlY2tpbmdJZlNjcm9sbHNXaXRoUG9QYWdlKCkge1xyXG4gICAgY29uc3QgcG9QYWdlQ29udGVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoJ3BvLXBhZ2UtY29udGVudCcpO1xyXG5cclxuICAgIHJldHVybiBwb1BhZ2VDb250ZW50Lmxlbmd0aCA/IHBvUGFnZUNvbnRlbnRbMF0gOiB3aW5kb3c7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGNyZWF0ZVBhdGgoc2VyaWU6IFBvQ2hhcnRHYXVnZVNlcmllLCBzdmdQYXRoc1dyYXBwZXI6IGFueSkge1xyXG4gICAgY29uc3Qgc3ZnUGF0aCA9IHRoaXMucmVuZGVyZXIuY3JlYXRlRWxlbWVudCgnc3ZnOnBhdGgnLCAnc3ZnJyk7XHJcblxyXG4gICAgdGhpcy5yZW5kZXJlci5zZXRBdHRyaWJ1dGUoc3ZnUGF0aCwgJ2NsYXNzJywgJ3BvLXBhdGgtaXRlbScpO1xyXG4gICAgdGhpcy5yZW5kZXJlci5zZXRBdHRyaWJ1dGUoc3ZnUGF0aCwgJ2ZpbGwnLCBzZXJpZS5jb2xvcik7XHJcblxyXG4gICAgdGhpcy5zZXRFbGVtZW50QXR0cmlidXRlcyhzdmdQYXRoLCBzZXJpZSk7XHJcblxyXG4gICAgc3ZnUGF0aHNXcmFwcGVyLmFwcGVuZENoaWxkKHN2Z1BhdGgpO1xyXG5cclxuICAgIHRoaXMucmVuZGVyZXIuYXBwZW5kQ2hpbGQodGhpcy5zdmdFbGVtZW50LCBzdmdQYXRoc1dyYXBwZXIpO1xyXG5cclxuICAgIHRoaXMuc3ZnUGF0aEVsZW1lbnRzTGlzdC5wdXNoKHN2Z1BhdGgpO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBjcmVhdGVQYXRocygpIHtcclxuICAgIGNvbnN0IHN2Z1BhdGhzV3JhcHBlciA9IHRoaXMucmVuZGVyZXIuY3JlYXRlRWxlbWVudCgnc3ZnOmcnLCAnc3ZnJyk7XHJcblxyXG4gICAgaWYgKHRoaXMuaXNDaGFydEdhdWdlVHlwZSkge1xyXG4gICAgICB0aGlzLmFwcGVuZEdhdWdlQmFja2dyb3VuZFBhdGhFbGVtZW50KHN2Z1BhdGhzV3JhcHBlcik7XHJcbiAgICAgIC8vIFRyYXRhbWVudG8gcGFyYSBldml0YXIgcXVlIG8gcGF0aCBkZXNlbmhlIG9zIGFyY29zIHJlZmVyZW50ZXMgYW8gYm9yZGVyIHJhZGl1cyBkbyBwYXRoLlxyXG4gICAgICBpZiAodGhpcy5pc1NlcmllVmFsdWVFcXVhbFplcm8oKSkge1xyXG4gICAgICAgIHJldHVybjtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHRoaXMuc2VyaWVzLmZvckVhY2goc2VyaWUgPT4gdGhpcy5jcmVhdGVQYXRoKHNlcmllLCBzdmdQYXRoc1dyYXBwZXIpKTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgY3JlYXRlVGV4dChzZXJpZTogUG9DaGFydEdhdWdlU2VyaWUpIHtcclxuICAgIGNvbnN0IGRhdGEgPSBzZXJpZS52YWx1ZTtcclxuXHJcbiAgICBjb25zdCBzdmdHID0gdGhpcy5yZW5kZXJlci5jcmVhdGVFbGVtZW50KCdzdmc6ZycsICdzdmcnKTtcclxuICAgIGNvbnN0IHN2Z1RleHQgPSB0aGlzLnJlbmRlcmVyLmNyZWF0ZUVsZW1lbnQoJ3N2Zzp0ZXh0JywgJ3N2ZycpO1xyXG5cclxuICAgIGNvbnN0IGZvbnRTaXplID0gdGhpcy5nZXRGb250U2l6ZSgpO1xyXG4gICAgY29uc3QgdGV4dENvbG9yID0gdGhpcy5nZXRUZXh0Q29sb3Ioc2VyaWUuY29sb3IpO1xyXG5cclxuICAgIHN2Z1RleHQudGV4dENvbnRlbnQgPSB0aGlzLmdldFBlcmNlbnRWYWx1ZShkYXRhLCB0aGlzLnRvdGFsVmFsdWUpICsgJyUnO1xyXG5cclxuICAgIHRoaXMucmVuZGVyZXIuc2V0QXR0cmlidXRlKHN2Z1RleHQsICdjbGFzcycsICdwby1wYXRoLWl0ZW0nKTtcclxuICAgIHRoaXMucmVuZGVyZXIuc2V0QXR0cmlidXRlKHN2Z1RleHQsICdmaWxsJywgdGV4dENvbG9yKTtcclxuICAgIHRoaXMucmVuZGVyZXIuc2V0QXR0cmlidXRlKHN2Z1RleHQsICdmb250LXNpemUnLCBmb250U2l6ZSk7XHJcbiAgICB0aGlzLnJlbmRlcmVyLnNldEF0dHJpYnV0ZShzdmdUZXh0LCAnZmlsbC1vcGFjaXR5JywgJzAnKTtcclxuXHJcbiAgICB0aGlzLnNldEVsZW1lbnRBdHRyaWJ1dGVzKHN2Z1RleHQsIHNlcmllKTtcclxuXHJcbiAgICB0aGlzLnJlbmRlcmVyLmFwcGVuZENoaWxkKHN2Z0csIHN2Z1RleHQpO1xyXG5cclxuICAgIHRoaXMucmVuZGVyZXIuYXBwZW5kQ2hpbGQodGhpcy5zdmdFbGVtZW50LCBzdmdHKTtcclxuICAgIHRoaXMuc3ZnVGV4dEVsZW1lbnRzTGlzdC5wdXNoKHN2Z1RleHQpO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBjcmVhdGVUZXh0cygpIHtcclxuICAgIGlmICh0aGlzLnR5cGUgPT09IFBvQ2hhcnRUeXBlLkRvbnV0KSB7XHJcbiAgICAgIHRoaXMuc2VyaWVzLmZvckVhY2goc2VyaWUgPT4gdGhpcy5jcmVhdGVUZXh0KHNlcmllKSk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGNyZWF0ZVNWR0VsZW1lbnRzKCkge1xyXG4gICAgY29uc3Qgdmlld0JveEhlaWdodCA9IHRoaXMuaXNDaGFydEdhdWdlVHlwZVxyXG4gICAgICA/IHRoaXMuY2VudGVyWCArIHRoaXMuY2VudGVyWCAqIHBvQ2hhcnRHYXVnZVNlcmllV2lkdGhcclxuICAgICAgOiB0aGlzLmNoYXJ0V3JhcHBlcjtcclxuICAgIGNvbnN0IHByZXNlcnZlQXNwZWN0UmF0aW8gPSB0aGlzLmlzQ2hhcnRHYXVnZVR5cGUgPyAneE1pZFlNYXgnIDogJ3hNaWRZTWluJztcclxuXHJcbiAgICB0aGlzLnN2Z0VsZW1lbnQgPSB0aGlzLnJlbmRlcmVyLmNyZWF0ZUVsZW1lbnQoJ3N2ZzpzdmcnLCAnc3ZnJyk7XHJcblxyXG4gICAgdGhpcy5yZW5kZXJlci5zZXRBdHRyaWJ1dGUodGhpcy5zdmdFbGVtZW50LCAndmlld0JveCcsIGAwIDAgJHt0aGlzLmNoYXJ0V3JhcHBlcn0gJHt2aWV3Qm94SGVpZ2h0fWApO1xyXG4gICAgdGhpcy5yZW5kZXJlci5zZXRBdHRyaWJ1dGUodGhpcy5zdmdFbGVtZW50LCAncHJlc2VydmVBc3BlY3RSYXRpbycsIGAke3ByZXNlcnZlQXNwZWN0UmF0aW99IG1lZXRgKTtcclxuICAgIHRoaXMucmVuZGVyZXIuc2V0QXR0cmlidXRlKHRoaXMuc3ZnRWxlbWVudCwgJ2NsYXNzJywgJ3BvLWNoYXJ0LXN2Zy1lbGVtZW50Jyk7XHJcbiAgICB0aGlzLnJlbmRlcmVyLnNldEF0dHJpYnV0ZSh0aGlzLnN2Z0VsZW1lbnQsICd3aWR0aCcsIGAke3RoaXMuY2VudGVyWH1gKTtcclxuICAgIHRoaXMucmVuZGVyZXIuc2V0QXR0cmlidXRlKHRoaXMuc3ZnRWxlbWVudCwgJ2hlaWdodCcsIGAke3RoaXMuc3ZnSGVpZ2h0fWApO1xyXG5cclxuICAgIHRoaXMuc3ZnQ29udGFpbmVyLm5hdGl2ZUVsZW1lbnQuYXBwZW5kQ2hpbGQodGhpcy5zdmdFbGVtZW50KTtcclxuXHJcbiAgICB0aGlzLmNyZWF0ZVBhdGhzKCk7XHJcbiAgICB0aGlzLmNyZWF0ZVRleHRzKCk7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGRyYXdQYXRoSW5pdCgpIHtcclxuICAgIGlmICghdGhpcy5hbmltYXRpb25SdW5uaW5nKSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHRoaXMubmdab25lLnJ1bk91dHNpZGVBbmd1bGFyKCgpID0+IHRoaXMuZHJhd1NlcmllcygpKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHByaXZhdGUgZHJhd1NlcmllcyhjdXJyZW50U2VyaWVJbmRleDogbnVtYmVyID0gMCwgYW5nbGVDdXJyZW50UG9zaXRpb246IG51bWJlciA9IDApIHtcclxuICAgIGNvbnN0IGlzRmluaXNoZWREcmF3aW5nQ3VycmVudFNlcmllcyA9IGFuZ2xlQ3VycmVudFBvc2l0aW9uID4gdGhpcy5jaGFydEl0ZW1FbmRBbmdsZTtcclxuICAgIGNvbnN0IGlzRmluaXNoZWREcmF3aW5nQWxsU2VyaWVzID0gY3VycmVudFNlcmllSW5kZXggPT09IHRoaXMuc3ZnUGF0aEVsZW1lbnRzTGlzdC5sZW5ndGg7XHJcblxyXG4gICAgaWYgKGlzRmluaXNoZWREcmF3aW5nQWxsU2VyaWVzKSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuXHJcbiAgICBpZiAoaXNGaW5pc2hlZERyYXdpbmdDdXJyZW50U2VyaWVzKSB7XHJcbiAgICAgIHRoaXMuY2hhcnRJdGVtU3RhcnRBbmdsZSA9IHRoaXMuY2hhcnRJdGVtU3RhcnRBbmdsZSArIHRoaXMuY2hhcnRJdGVtRW5kQW5nbGU7XHJcbiAgICAgIGN1cnJlbnRTZXJpZUluZGV4Kys7XHJcbiAgICAgIHRoaXMuY2hhcnRJdGVtRW5kQW5nbGUgPSB0aGlzLmNoYXJ0SXRlbXNFbmRBbmdsZUxpc3RbY3VycmVudFNlcmllSW5kZXhdO1xyXG4gICAgICBhbmdsZUN1cnJlbnRQb3NpdGlvbiA9IDA7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBhbmdsZUN1cnJlbnRQb3NpdGlvbiArPSBwb0NoYXJ0QW5nbGVTdGVwSW50ZXJ2YWw7XHJcblxyXG4gICAgICB0aGlzLmRyYXdQYXRoKFxyXG4gICAgICAgIHRoaXMuc3ZnUGF0aEVsZW1lbnRzTGlzdFtjdXJyZW50U2VyaWVJbmRleF0sXHJcbiAgICAgICAgdGhpcy5jaGFydEl0ZW1TdGFydEFuZ2xlLFxyXG4gICAgICAgIHRoaXMuY2FsY3VsYXRlQ3VycmVudEVuZEFuZ2xlKGFuZ2xlQ3VycmVudFBvc2l0aW9uKVxyXG4gICAgICApO1xyXG5cclxuICAgICAgdGhpcy5zZXRUZXh0UHJvcGVydGllcyhcclxuICAgICAgICB0aGlzLnN2Z1RleHRFbGVtZW50c0xpc3RbY3VycmVudFNlcmllSW5kZXhdLFxyXG4gICAgICAgIHRoaXMuY2hhcnRJdGVtU3RhcnRBbmdsZSxcclxuICAgICAgICB0aGlzLmNhbGN1bGF0ZUN1cnJlbnRFbmRBbmdsZShhbmdsZUN1cnJlbnRQb3NpdGlvbilcclxuICAgICAgKTtcclxuICAgIH1cclxuXHJcbiAgICB3aW5kb3cucmVxdWVzdEFuaW1hdGlvbkZyYW1lKHRoaXMuZHJhd1Nlcmllcy5iaW5kKHRoaXMsIGN1cnJlbnRTZXJpZUluZGV4LCBhbmdsZUN1cnJlbnRQb3NpdGlvbikpO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBlbWl0RXZlbnRPbkVudGVyKGV2ZW50OiBQb0NoYXJ0R2F1Z2VTZXJpZSkge1xyXG4gICAgdGhpcy5vblNlcmllSG92ZXIubmV4dChldmVudCk7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGdldEZvbnRTaXplKCkge1xyXG4gICAgY29uc3QgZm9udFNpemVQb3JjZW50ID0gMC4wNDtcclxuXHJcbiAgICBjb25zdCBmb250U2l6ZSA9IGZvbnRTaXplUG9yY2VudCAqIHRoaXMuY2hhcnRXcmFwcGVyO1xyXG5cclxuICAgIHJldHVybiBgJHtmb250U2l6ZS50b0ZpeGVkKDApfXB4YDtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgZ2V0UGVyY2VudFZhbHVlKHZhbHVlOiBudW1iZXIsIHRvdGFsVmFsdWU6IG51bWJlcikge1xyXG4gICAgY29uc3QgcGVyY2VudFZhbHVlID0gKHZhbHVlIC8gdG90YWxWYWx1ZSkgKiAxMDA7XHJcblxyXG4gICAgY29uc3QgZmxvYXRQZXJjZW50VmFsdWUgPSBjb252ZXJ0TnVtYmVyVG9EZWNpbWFsKHBlcmNlbnRWYWx1ZSwgMik7XHJcblxyXG4gICAgcmV0dXJuIFN0cmluZyhmbG9hdFBlcmNlbnRWYWx1ZSkucmVwbGFjZSgnLicsICcsJyk7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGdldFRleHRDb2xvcihjb2xvcjogc3RyaW5nKSB7XHJcbiAgICBpZiAoUG9EZWZhdWx0Q29sb3JzVGV4dEJsYWNrLmluY2x1ZGVzKGNvbG9yKSkge1xyXG4gICAgICByZXR1cm4gcG9DaGFydEJsYWNrQ29sb3I7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHBvQ2hhcnRXaGl0ZUNvbG9yO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBnZXRUb29sdGlwVmFsdWUodmFsdWU6IG51bWJlcikge1xyXG4gICAgaWYgKHRoaXMudHlwZSA9PT0gUG9DaGFydFR5cGUuUGllKSB7XHJcbiAgICAgIHJldHVybiB2YWx1ZS50b1N0cmluZygpO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiB0aGlzLmdldFBlcmNlbnRWYWx1ZSh2YWx1ZSwgdGhpcy50b3RhbFZhbHVlKSArICclJztcclxuICB9XHJcblxyXG4gIHByaXZhdGUgaXNTZXJpZVZhbHVlRXF1YWxaZXJvKCk6IGJvb2xlYW4ge1xyXG4gICAgcmV0dXJuIHRoaXMuc2VyaWVzLmxlbmd0aCAmJiB0aGlzLnNlcmllc1swXS52YWx1ZSA9PT0gMDtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgb25Nb3VzZUNsaWNrKCkge1xyXG4gICAgbGV0IHNlcmllT25DbGljazogUG9DaGFydEdhdWdlU2VyaWU7XHJcblxyXG4gICAgY29uc3QgeyBjb2xvciwgLi4uc2VyaWUgfSA9IHRoaXMuc2VyaWVzWzBdO1xyXG4gICAgc2VyaWVPbkNsaWNrID0gc2VyaWU7XHJcblxyXG4gICAgdGhpcy5vblNlcmllQ2xpY2submV4dChzZXJpZU9uQ2xpY2spO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBvbk1vdXNlRW50ZXIoZXZlbnQpIHtcclxuICAgIGxldCBzZXJpZU9uRW50ZXI6IFBvQ2hhcnRHYXVnZVNlcmllO1xyXG5cclxuICAgIGNvbnN0IHsgY29sb3IsIC4uLnNlcmllIH0gPSB0aGlzLnNlcmllc1swXTtcclxuXHJcbiAgICB0aGlzLmNoYXJ0RWxlbWVudERlc2NyaXB0aW9uID0gZXZlbnQudGFyZ2V0LmdldEF0dHJpYnV0ZU5TKG51bGwsICdkYXRhLXRvb2x0aXAtY2F0ZWdvcnknKTtcclxuICAgIHNlcmllT25FbnRlciA9IHNlcmllO1xyXG5cclxuICAgIHRoaXMuZW1pdEV2ZW50T25FbnRlcihzZXJpZU9uRW50ZXIpO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBvbldpbmRvd1Jlc2l6ZSgpIHtcclxuICAgIHRoaXMuY2FsY3VsYXRlU1ZHRGltZW5zaW9ucygpO1xyXG4gICAgdGhpcy5yZW5kZXJlci5zZXRBdHRyaWJ1dGUodGhpcy5zdmdFbGVtZW50LCAnd2lkdGgnLCBgJHt0aGlzLmNlbnRlclh9YCk7XHJcbiAgICB0aGlzLnJlbmRlcmVyLnNldEF0dHJpYnV0ZSh0aGlzLnN2Z0VsZW1lbnQsICdoZWlnaHQnLCBgJHt0aGlzLnN2Z0hlaWdodH1gKTtcclxuICAgIHRoaXMud2luZG93UmVzaXplRW1pdHRlci5uZXh0KCk7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIHJlbW92ZVdpbmRvd1Jlc2l6ZUxpc3RlbmVyKCkge1xyXG4gICAgaWYgKHRoaXMud2luZG93UmVzaXplTGlzdGVuZXIpIHtcclxuICAgICAgdGhpcy53aW5kb3dSZXNpemVMaXN0ZW5lcigpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSByZW1vdmVXaW5kb3dTY3JvbGxMaXN0ZW5lcigpIHtcclxuICAgIGlmICh0aGlzLndpbmRvd1Njcm9sbExpc3RlbmVyKSB7XHJcbiAgICAgIHRoaXMud2luZG93U2Nyb2xsTGlzdGVuZXIoKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHByaXZhdGUgc2V0RXZlbnRMaXN0ZW5lcnMoKSB7XHJcbiAgICBsZXQgY2hhcnRTZXJpZXM6IEFycmF5PHN0cmluZz4gPSB0aGlzLmVsLm5hdGl2ZUVsZW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLnBvLXBhdGgtaXRlbScpO1xyXG4gICAgY2hhcnRTZXJpZXMgPSBBcnJheS5mcm9tKGNoYXJ0U2VyaWVzKTtcclxuICAgIGNoYXJ0U2VyaWVzLmZvckVhY2goc2VyaWUgPT4ge1xyXG4gICAgICB0aGlzLnJlbmRlcmVyLmxpc3RlbihzZXJpZSwgJ2NsaWNrJywgdGhpcy5vbk1vdXNlQ2xpY2suYmluZCh0aGlzKSk7XHJcbiAgICAgIHRoaXMucmVuZGVyZXIubGlzdGVuKHNlcmllLCAnbW91c2VlbnRlcicsIHRoaXMub25Nb3VzZUVudGVyLmJpbmQodGhpcykpO1xyXG5cclxuICAgICAgaWYgKCF0aGlzLmlzQ2hhcnRHYXVnZVR5cGUpIHtcclxuICAgICAgICB0aGlzLnJlbmRlcmVyLmxpc3RlbihzZXJpZSwgJ21vdXNlbW92ZScsIHRoaXMuY2hhbmdlVG9vbHRpcFBvc2l0aW9uLmJpbmQodGhpcykpO1xyXG4gICAgICAgIHRoaXMucmVuZGVyZXIubGlzdGVuKHNlcmllLCAnbW91c2VsZWF2ZScsIHRoaXMucmVtb3ZlVG9vbHRpcC5iaW5kKHRoaXMpKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcblxyXG4gICAgdGhpcy53aW5kb3dSZXNpemVMaXN0ZW5lciA9IHRoaXMucmVuZGVyZXIubGlzdGVuKHdpbmRvdywgJ3Jlc2l6ZScsIHRoaXMub25XaW5kb3dSZXNpemUuYmluZCh0aGlzKSk7XHJcbiAgICB0aGlzLndpbmRvd1Njcm9sbExpc3RlbmVyID0gdGhpcy5yZW5kZXJlci5saXN0ZW4oXHJcbiAgICAgIHRoaXMuY2hlY2tpbmdJZlNjcm9sbHNXaXRoUG9QYWdlKCksXHJcbiAgICAgICdzY3JvbGwnLFxyXG4gICAgICB0aGlzLnJlbW92ZVRvb2x0aXAuYmluZCh0aGlzKVxyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgc2V0SW5uZXJSYWRpdXModHlwZTogUG9DaGFydFR5cGUpIHtcclxuICAgIGxldCBzZXJpZVdpZHRoO1xyXG5cclxuICAgIHN3aXRjaCAodHlwZSkge1xyXG4gICAgICBjYXNlIFBvQ2hhcnRUeXBlLkRvbnV0OiB7XHJcbiAgICAgICAgc2VyaWVXaWR0aCA9IHBvQ2hhcnREb251dFNlcmllV2lkdGg7XHJcblxyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgICB9XHJcbiAgICAgIGNhc2UgUG9DaGFydFR5cGUuR2F1Z2U6IHtcclxuICAgICAgICBzZXJpZVdpZHRoID0gcG9DaGFydEdhdWdlU2VyaWVXaWR0aDtcclxuICAgICAgICBicmVhaztcclxuICAgICAgfVxyXG4gICAgICBjYXNlIFBvQ2hhcnRUeXBlLlBpZToge1xyXG4gICAgICAgIHJldHVybiAwO1xyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHRoaXMuY2VudGVyWCAtIHRoaXMuY2VudGVyWCAqIHNlcmllV2lkdGg7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIHNldFRleHRQcm9wZXJ0aWVzKHRleHQsIHN0YXJ0QW5nbGU6IG51bWJlciwgZW5kQW5nbGU6IG51bWJlcikge1xyXG4gICAgLy8gbmVjZXNzw6FyaW8gdGV4dC5nZXRDbGllbnRSZWN0cygpLmxlbmd0aCBwYXJhIGNvbnRvcm5hciBlcnJvIGRlIGNvbnNvbGUgY2F1c2FkbyBubyBGaXJlZm94XHJcbiAgICBpZiAodGhpcy50eXBlID09PSBQb0NoYXJ0VHlwZS5Eb251dCAmJiB0ZXh0LmdldENsaWVudFJlY3RzKCkubGVuZ3RoKSB7XHJcbiAgICAgIC8vIHV0aWxpemFkbyBwYXJhIHJlY3VwZXJhciBvIGFuZ3VsbyBkbyBtZWlvLCBlbnRyZSBvIGluaWNpbyBlIGZpbSBwYXJhIGNlbnRyYWxpemFyIG8gdGV4dG9cclxuICAgICAgY29uc3QgY2VudGVyQW5nbGUgPSAoc3RhcnRBbmdsZSArIGVuZEFuZ2xlKSAvIDI7XHJcbiAgICAgIGNvbnN0IHRleHRCb3ggPSB0ZXh0LmdldEJCb3goKTtcclxuXHJcbiAgICAgIGNvbnN0IGhhbGZUZXh0V2lkdGggPSB0ZXh0Qm94LndpZHRoIC8gMjtcclxuICAgICAgY29uc3QgaGFsZlRleHRIZWlnaHQgPSB0ZXh0Qm94LmhlaWdodCAvIDI7XHJcblxyXG4gICAgICAvLyByYWRpdXMgaW50ZXJubyAoY2lyY3VsbyBicmFuY28pICsgYSBtZXRhZGUgZGEgZGlmZXJlbsOnYSBlbnRyZSB0YW1hbmhvIGRvIGNlbnRybyBlIHJhZGl1cyBpbnRlcm5vXHJcbiAgICAgIGNvbnN0IHJhZGl1cyA9IHRoaXMuaW5uZXJSYWRpdXMgKyAodGhpcy5jZW50ZXJYIC0gdGhpcy5pbm5lclJhZGl1cykgLyAyO1xyXG5cclxuICAgICAgY29uc3QgeENvb3JkaW5hdGUgPSByYWRpdXMgKiBNYXRoLmNvcyhjZW50ZXJBbmdsZSkgKyB0aGlzLmNlbnRlclggLSBoYWxmVGV4dFdpZHRoO1xyXG4gICAgICBjb25zdCB5Q29vcmRpbmF0ZSA9IHJhZGl1cyAqIE1hdGguc2luKGNlbnRlckFuZ2xlKSArIHRoaXMuY2VudGVyWCArIGhhbGZUZXh0SGVpZ2h0IC8gMjtcclxuICAgICAgdGV4dC5zZXRBdHRyaWJ1dGUoJ3gnLCB4Q29vcmRpbmF0ZSk7XHJcbiAgICAgIHRleHQuc2V0QXR0cmlidXRlKCd5JywgeUNvb3JkaW5hdGUpO1xyXG4gICAgICB0ZXh0LnNldEF0dHJpYnV0ZSgnZmlsbC1vcGFjaXR5JywgJzEnKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHByaXZhdGUgc2V0VG9vbHRpcFBvc2l0aW9ucyhldmVudDogTW91c2VFdmVudCkge1xyXG4gICAgY29uc3QgZGlzcGxhY2VtZW50OiBudW1iZXIgPSA4O1xyXG5cclxuICAgIHJldHVybiB7XHJcbiAgICAgIGxlZnQ6IGV2ZW50LmNsaWVudFggLSB0aGlzLnRvb2x0aXBFbGVtZW50Lm9mZnNldFdpZHRoIC8gMixcclxuICAgICAgdG9wOiBldmVudC5jbGllbnRZIC0gdGhpcy50b29sdGlwRWxlbWVudC5vZmZzZXRIZWlnaHQgLSBkaXNwbGFjZW1lbnRcclxuICAgIH07XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIHNldEVsZW1lbnRBdHRyaWJ1dGVzKHN2Z0VsZW1lbnQsIHNlcmllKSB7XHJcbiAgICBjb25zdCB7IHRvb2x0aXAgfSA9IHNlcmllO1xyXG4gICAgY29uc3QgZGF0YSA9IHNlcmllLmRhdGEgPz8gc2VyaWUudmFsdWU7XHJcbiAgICBjb25zdCBsYWJlbCA9IHNlcmllLmxhYmVsID8/IChzZXJpZS5kZXNjcmlwdGlvbiB8fCBzZXJpZS5jYXRlZ29yeSk7XHJcblxyXG4gICAgdGhpcy5yZW5kZXJlci5zZXRBdHRyaWJ1dGUoc3ZnRWxlbWVudCwgJ2RhdGEtdG9vbHRpcC12YWx1ZScsIGAke2RhdGF9YCk7XHJcblxyXG4gICAgaWYgKHRoaXMuaXNDaGFydEdhdWdlVHlwZSkge1xyXG4gICAgICB0aGlzLnJlbmRlcmVyLnNldEF0dHJpYnV0ZShzdmdFbGVtZW50LCAnZGF0YS10b29sdGlwLWRlc2NyaXB0aW9uJywgbGFiZWwpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgY29uc3QgdG9vbHRpcFZhbHVlID0gdGhpcy5nZXRUb29sdGlwVmFsdWUoZGF0YSk7XHJcblxyXG4gICAgICB0aGlzLnJlbmRlcmVyLnNldEF0dHJpYnV0ZShzdmdFbGVtZW50LCAnZGF0YS10b29sdGlwLWNhdGVnb3J5JywgbGFiZWwpO1xyXG4gICAgICB0aGlzLnJlbmRlcmVyLnNldEF0dHJpYnV0ZShzdmdFbGVtZW50LCAnZGF0YS10b29sdGlwLXRleHQnLCB0b29sdGlwIHx8IGAke2xhYmVsfTogJHt0b29sdGlwVmFsdWV9YCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIHNob3dUb29sdGlwKCkge1xyXG4gICAgdGhpcy5yZW5kZXJlci5yZW1vdmVDbGFzcyh0aGlzLnRvb2x0aXBFbGVtZW50LCAncG8taW52aXNpYmxlJyk7XHJcbiAgfVxyXG59XHJcbiJdfQ==