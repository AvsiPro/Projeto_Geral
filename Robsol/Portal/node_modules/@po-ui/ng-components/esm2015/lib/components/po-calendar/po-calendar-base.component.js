import { EventEmitter, Input, Output, Directive } from '@angular/core';
import { PoDateService } from '../../services/po-date';
import { PoLanguageService } from '../../services/po-language/po-language.service';
import { poLocales } from '../../services/po-language/po-language.constant';
import { PoCalendarMode } from './po-calendar-mode.enum';
/**
 * @description
 *
 * O `po-calendar` é um componente para seleção de datas. Ele permite uma fácil navegação clicando nas setas
 * de direcionamento e nos *labels* do ano ou mês.
 *
 * Este componente pode receber os seguintes formatos de data:
 *
 * - **Data e hora combinados (E8601DZw): yyyy-mm-ddThh:mm:ss+|-hh:mm**
 * ```
 * this.date = '2017-11-28T00:00:00-02:00';
 * ```
 *
 * - **Data (E8601DAw.): yyyy-mm-dd**
 * ```
 * this.date = '2017-11-28';
 * ```
 *
 * - **JavaScript Date Object:**
 * ```
 * this.date = new Date(2017, 10, 28);
 * ```
 *
 * > Independentemente do formato utilizado, o componente trata o valor do *model* internamente com o
 * formato **Data (E8601DAw.): yyyy-mm-dd**.
 *
 * Importante:
 *
 * - Caso seja definida uma data fora do range da data mínima e data máxima via *ngModel* o componente mostrará
 * a data desabilitada porém o *model* não será alterado.
 * - Caso seja definida uma data inválida a mesma não será atribuída ao calendário porém o *model* manterá a data inválida.
 */
export class PoCalendarBaseComponent {
    constructor(poDate, languageService) {
        this.poDate = poDate;
        this.languageService = languageService;
        /** Evento disparado ao selecionar um dia do calendário. */
        this.change = new EventEmitter();
        this.onTouched = null;
        this.propagateChange = null;
        this.today = new Date();
        this._locale = this.languageService.getShortLanguage();
        this.shortLanguage = languageService.getShortLanguage();
    }
    /**
     * @optional
     *
     * @description
     *
     * Idioma do calendário.
     *
     * > O locale padrão sera recuperado com base no [`PoI18nService`](/documentation/po-i18n) ou *browser*.
     */
    set locale(locale) {
        this._locale = poLocales.includes(locale) ? locale : this.shortLanguage;
    }
    get locale() {
        return this._locale;
    }
    /**
     * @optional
     *
     * @description
     *
     * Define a data máxima possível de ser selecionada.
     *
     * Pode receber os seguintes formatos de data:
     *
     * - **Data e hora combinados (E8601DZw): yyyy-mm-ddThh:mm:ss+|-hh:mm**
     * ```
     * this.date = '2017-11-28T00:00:00-02:00';
     * ```
     *
     * - **Data (E8601DAw.): yyyy-mm-dd**
     * ```
     * this.date = '2017-11-28';
     * ```
     *
     * - **JavaScript Date Object:**
     * ```
     * this.date = new Date(2017, 10, 28);
     * ```
     */
    set maxDate(maxDate) {
        this._maxDate = this.poDate.getDateForDateRange(maxDate, false);
    }
    get maxDate() {
        return this._maxDate;
    }
    /**
     * @optional
     *
     * @description
     *
     * Define a data mínima possível de ser selecionada.
     *
     * Pode receber os seguintes formatos de data:
     *
     * - **Data e hora combinados (E8601DZw): yyyy-mm-ddThh:mm:ss+|-hh:mm**
     * ```
     * this.date = '2017-11-28T00:00:00-02:00';
     * ```
     *
     * - **Data (E8601DAw.): yyyy-mm-dd**
     * ```
     * this.date = '2017-11-28';
     * ```
     *
     * - **JavaScript Date Object:**
     * ```
     * this.date = new Date(2017, 10, 28);
     * ```
     */
    set minDate(minDate) {
        this._minDate = this.poDate.getDateForDateRange(minDate, true);
    }
    get minDate() {
        return this._minDate;
    }
    /**
     * Propriedade que permite informar o modo de exibição do calendar.
     *
     * Implementa o enum `PoCalendarMode`.
     */
    set mode(value) {
        this._mode = value;
        this.setActivateDate();
    }
    get mode() {
        return this._mode;
    }
    get isRange() {
        return this.mode === PoCalendarMode.Range;
    }
    setActivateDate(date) {
        const activateDate = date ? date : this.verifyActivateDate();
        if (this.isRange) {
            const checkedStart = typeof activateDate === 'string' ? this.poDate.convertIsoToDate(activateDate) : new Date(activateDate);
            const checkedEnd = new Date(new Date(checkedStart).setMonth(checkedStart.getMonth() + 1));
            this.activateDate = { start: checkedStart, end: checkedEnd };
        }
        else {
            this.activateDate = new Date(activateDate);
        }
    }
    verifyActivateDate() {
        let today = this.today;
        if (this.minDate && this.minDate > this.today) {
            today = this.minDate;
        }
        else if (this.maxDate && this.maxDate < this.today) {
            today = this.maxDate;
        }
        return today;
    }
}
PoCalendarBaseComponent.decorators = [
    { type: Directive }
];
PoCalendarBaseComponent.ctorParameters = () => [
    { type: PoDateService },
    { type: PoLanguageService }
];
PoCalendarBaseComponent.propDecorators = {
    change: [{ type: Output, args: ['p-change',] }],
    locale: [{ type: Input, args: ['p-locale',] }],
    maxDate: [{ type: Input, args: ['p-max-date',] }],
    minDate: [{ type: Input, args: ['p-min-date',] }],
    mode: [{ type: Input, args: ['p-mode',] }]
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG8tY2FsZW5kYXItYmFzZS5jb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy91aS9zcmMvbGliL2NvbXBvbmVudHMvcG8tY2FsZW5kYXIvcG8tY2FsZW5kYXItYmFzZS5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLFlBQVksRUFBRSxLQUFLLEVBQUUsTUFBTSxFQUFFLFNBQVMsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUV2RSxPQUFPLEVBQUUsYUFBYSxFQUFFLE1BQU0sd0JBQXdCLENBQUM7QUFDdkQsT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0sZ0RBQWdELENBQUM7QUFDbkYsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLGlEQUFpRCxDQUFDO0FBRTVFLE9BQU8sRUFBRSxjQUFjLEVBQUUsTUFBTSx5QkFBeUIsQ0FBQztBQUV6RDs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztHQStCRztBQUVILE1BQU0sT0FBTyx1QkFBdUI7SUFrSGxDLFlBQW1CLE1BQXFCLEVBQVUsZUFBa0M7UUFBakUsV0FBTSxHQUFOLE1BQU0sQ0FBZTtRQUFVLG9CQUFlLEdBQWYsZUFBZSxDQUFtQjtRQWpIcEYsMkRBQTJEO1FBQ3ZDLFdBQU0sR0FBRyxJQUFJLFlBQVksRUFBMkIsQ0FBQztRQUsvRCxjQUFTLEdBQVEsSUFBSSxDQUFDO1FBQ3RCLG9CQUFlLEdBQVEsSUFBSSxDQUFDO1FBQzVCLFVBQUssR0FBUyxJQUFJLElBQUksRUFBRSxDQUFDO1FBRzNCLFlBQU8sR0FBVyxJQUFJLENBQUMsZUFBZSxDQUFDLGdCQUFnQixFQUFFLENBQUM7UUF1R2hFLElBQUksQ0FBQyxhQUFhLEdBQUcsZUFBZSxDQUFDLGdCQUFnQixFQUFFLENBQUM7SUFDMUQsQ0FBQztJQW5HRDs7Ozs7Ozs7T0FRRztJQUNILElBQXVCLE1BQU0sQ0FBQyxNQUFjO1FBQzFDLElBQUks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S0FBSyxTQUFDLFlBQVk7c0JBK0JsQixLQUFLLFNBQUMsWUFBWTttQkFZbEIsS0FBSyxTQUFDLFFBQVEiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBFdmVudEVtaXR0ZXIsIElucHV0LCBPdXRwdXQsIERpcmVjdGl2ZSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5cclxuaW1wb3J0IHsgUG9EYXRlU2VydmljZSB9IGZyb20gJy4uLy4uL3NlcnZpY2VzL3BvLWRhdGUnO1xyXG5pbXBvcnQgeyBQb0xhbmd1YWdlU2VydmljZSB9IGZyb20gJy4uLy4uL3NlcnZpY2VzL3BvLWxhbmd1YWdlL3BvLWxhbmd1YWdlLnNlcnZpY2UnO1xyXG5pbXBvcnQgeyBwb0xvY2FsZXMgfSBmcm9tICcuLi8uLi9zZXJ2aWNlcy9wby1sYW5ndWFnZS9wby1sYW5ndWFnZS5jb25zdGFudCc7XHJcblxyXG5pbXBvcnQgeyBQb0NhbGVuZGFyTW9kZSB9IGZyb20gJy4vcG8tY2FsZW5kYXItbW9kZS5lbnVtJztcclxuXHJcbi8qKlxyXG4gKiBAZGVzY3JpcHRpb25cclxuICpcclxuICogTyBgcG8tY2FsZW5kYXJgIMOpIHVtIGNvbXBvbmVudGUgcGFyYSBzZWxlw6fDo28gZGUgZGF0YXMuIEVsZSBwZXJtaXRlIHVtYSBmw6FjaWwgbmF2ZWdhw6fDo28gY2xpY2FuZG8gbmFzIHNldGFzXHJcbiAqIGRlIGRpcmVjaW9uYW1lbnRvIGUgbm9zICpsYWJlbHMqIGRvIGFubyBvdSBtw6pzLlxyXG4gKlxyXG4gKiBFc3RlIGNvbXBvbmVudGUgcG9kZSByZWNlYmVyIG9zIHNlZ3VpbnRlcyBmb3JtYXRvcyBkZSBkYXRhOlxyXG4gKlxyXG4gKiAtICoqRGF0YSBlIGhvcmEgY29tYmluYWRvcyAoRTg2MDFEWncpOiB5eXl5LW1tLWRkVGhoOm1tOnNzK3wtaGg6bW0qKlxyXG4gKiBgYGBcclxuICogdGhpcy5kYXRlID0gJzIwMTctMTEtMjhUMDA6MDA6MDAtMDI6MDAnO1xyXG4gKiBgYGBcclxuICpcclxuICogLSAqKkRhdGEgKEU4NjAxREF3Lik6IHl5eXktbW0tZGQqKlxyXG4gKiBgYGBcclxuICogdGhpcy5kYXRlID0gJzIwMTctMTEtMjgnO1xyXG4gKiBgYGBcclxuICpcclxuICogLSAqKkphdmFTY3JpcHQgRGF0ZSBPYmplY3Q6KipcclxuICogYGBgXHJcbiAqIHRoaXMuZGF0ZSA9IG5ldyBEYXRlKDIwMTcsIDEwLCAyOCk7XHJcbiAqIGBgYFxyXG4gKlxyXG4gKiA+IEluZGVwZW5kZW50ZW1lbnRlIGRvIGZvcm1hdG8gdXRpbGl6YWRvLCBvIGNvbXBvbmVudGUgdHJhdGEgbyB2YWxvciBkbyAqbW9kZWwqIGludGVybmFtZW50ZSBjb20gb1xyXG4gKiBmb3JtYXRvICoqRGF0YSAoRTg2MDFEQXcuKTogeXl5eS1tbS1kZCoqLlxyXG4gKlxyXG4gKiBJbXBvcnRhbnRlOlxyXG4gKlxyXG4gKiAtIENhc28gc2VqYSBkZWZpbmlkYSB1bWEgZGF0YSBmb3JhIGRvIHJhbmdlIGRhIGRhdGEgbcOtbmltYSBlIGRhdGEgbcOheGltYSB2aWEgKm5nTW9kZWwqIG8gY29tcG9uZW50ZSBtb3N0cmFyw6FcclxuICogYSBkYXRhIGRlc2FiaWxpdGFkYSBwb3LDqW0gbyAqbW9kZWwqIG7Do28gc2Vyw6EgYWx0ZXJhZG8uXHJcbiAqIC0gQ2FzbyBzZWphIGRlZmluaWRhIHVtYSBkYXRhIGludsOhbGlkYSBhIG1lc21hIG7Do28gc2Vyw6EgYXRyaWJ1w61kYSBhbyBjYWxlbmTDoXJpbyBwb3LDqW0gbyAqbW9kZWwqIG1hbnRlcsOhIGEgZGF0YSBpbnbDoWxpZGEuXHJcbiAqL1xyXG5ARGlyZWN0aXZlKClcclxuZXhwb3J0IGNsYXNzIFBvQ2FsZW5kYXJCYXNlQ29tcG9uZW50IHtcclxuICAvKiogRXZlbnRvIGRpc3BhcmFkbyBhbyBzZWxlY2lvbmFyIHVtIGRpYSBkbyBjYWxlbmTDoXJpby4gKi9cclxuICBAT3V0cHV0KCdwLWNoYW5nZScpIGNoYW5nZSA9IG5ldyBFdmVudEVtaXR0ZXI8c3RyaW5nIHwgeyBzdGFydDsgZW5kIH0+KCk7XHJcblxyXG4gIGFjdGl2YXRlRGF0ZTtcclxuICB2YWx1ZTtcclxuXHJcbiAgcHJvdGVjdGVkIG9uVG91Y2hlZDogYW55ID0gbnVsbDtcclxuICBwcm90ZWN0ZWQgcHJvcGFnYXRlQ2hhbmdlOiBhbnkgPSBudWxsO1xyXG4gIHByb3RlY3RlZCB0b2RheTogRGF0ZSA9IG5ldyBEYXRlKCk7XHJcblxyXG4gIHByaXZhdGUgc2hvcnRMYW5ndWFnZTogc3RyaW5nO1xyXG4gIHByaXZhdGUgX2xvY2FsZTogc3RyaW5nID0gdGhpcy5sYW5ndWFnZVNlcnZpY2UuZ2V0U2hvcnRMYW5ndWFnZSgpO1xyXG4gIHByaXZhdGUgX21heERhdGU6IERhdGU7XHJcbiAgcHJpdmF0ZSBfbWluRGF0ZTogRGF0ZTtcclxuICBwcml2YXRlIF9tb2RlOiBQb0NhbGVuZGFyTW9kZTtcclxuXHJcbiAgLyoqXHJcbiAgICogQG9wdGlvbmFsXHJcbiAgICpcclxuICAgKiBAZGVzY3JpcHRpb25cclxuICAgKlxyXG4gICAqIElkaW9tYSBkbyBjYWxlbmTDoXJpby5cclxuICAgKlxyXG4gICAqID4gTyBsb2NhbGUgcGFkcsOjbyBzZXJhIHJlY3VwZXJhZG8gY29tIGJhc2Ugbm8gW2BQb0kxOG5TZXJ2aWNlYF0oL2RvY3VtZW50YXRpb24vcG8taTE4bikgb3UgKmJyb3dzZXIqLlxyXG4gICAqL1xyXG4gIEBJbnB1dCgncC1sb2NhbGUnKSBzZXQgbG9jYWxlKGxvY2FsZTogc3RyaW5nKSB7XHJcbiAgICB0aGlzLl9sb2NhbGUgPSBwb0xvY2FsZXMuaW5jbHVkZXMobG9jYWxlKSA/IGxvY2FsZSA6IHRoaXMuc2hvcnRMYW5ndWFnZTtcclxuICB9XHJcbiAgZ2V0IGxvY2FsZSgpIHtcclxuICAgIHJldHVybiB0aGlzLl9sb2NhbGU7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBAb3B0aW9uYWxcclxuICAgKlxyXG4gICAqIEBkZXNjcmlwdGlvblxyXG4gICAqXHJcbiAgICogRGVmaW5lIGEgZGF0YSBtw6F4aW1hIHBvc3PDrXZlbCBkZSBzZXIgc2VsZWNpb25hZGEuXHJcbiAgICpcclxuICAgKiBQb2RlIHJlY2ViZXIgb3Mgc2VndWludGVzIGZvcm1hdG9zIGRlIGRhdGE6XHJcbiAgICpcclxuICAgKiAtICoqRGF0YSBlIGhvcmEgY29tYmluYWRvcyAoRTg2MDFEWncpOiB5eXl5LW1tLWRkVGhoOm1tOnNzK3wtaGg6bW0qKlxyXG4gICAqIGBgYFxyXG4gICAqIHRoaXMuZGF0ZSA9ICcyMDE3LTExLTI4VDAwOjAwOjAwLTAyOjAwJztcclxuICAgKiBgYGBcclxuICAgKlxyXG4gICAqIC0gKipEYXRhIChFODYwMURBdy4pOiB5eXl5LW1tLWRkKipcclxuICAgKiBgYGBcclxuICAgKiB0aGlzLmRhdGUgPSAnMjAxNy0xMS0yOCc7XHJcbiAgICogYGBgXHJcbiAgICpcclxuICAgKiAtICoqSmF2YVNjcmlwdCBEYXRlIE9iamVjdDoqKlxyXG4gICAqIGBgYFxyXG4gICAqIHRoaXMuZGF0ZSA9IG5ldyBEYXRlKDIwMTcsIDEwLCAyOCk7XHJcbiAgICogYGBgXHJcbiAgICovXHJcbiAgQElucHV0KCdwLW1heC1kYXRlJykgc2V0IG1heERhdGUobWF4RGF0ZTogYW55KSB7XHJcbiAgICB0aGlzLl9tYXhEYXRlID0gdGhpcy5wb0RhdGUuZ2V0RGF0ZUZvckRhdGVSYW5nZShtYXhEYXRlLCBmYWxzZSk7XHJcbiAgfVxyXG4gIGdldCBtYXhEYXRlKCkge1xyXG4gICAgcmV0dXJuIHRoaXMuX21heERhdGU7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBAb3B0aW9uYWxcclxuICAgKlxyXG4gICAqIEBkZXNjcmlwdGlvblxyXG4gICAqXHJcbiAgICogRGVmaW5lIGEgZGF0YSBtw61uaW1hIHBvc3PDrXZlbCBkZSBzZXIgc2VsZWNpb25hZGEuXHJcbiAgICpcclxuICAgKiBQb2RlIHJlY2ViZXIgb3Mgc2VndWludGVzIGZvcm1hdG9zIGRlIGRhdGE6XHJcbiAgICpcclxuICAgKiAtICoqRGF0YSBlIGhvcmEgY29tYmluYWRvcyAoRTg2MDFEWncpOiB5eXl5LW1tLWRkVGhoOm1tOnNzK3wtaGg6bW0qKlxyXG4gICAqIGBgYFxyXG4gICAqIHRoaXMuZGF0ZSA9ICcyMDE3LTExLTI4VDAwOjAwOjAwLTAyOjAwJztcclxuICAgKiBgYGBcclxuICAgKlxyXG4gICAqIC0gKipEYXRhIChFODYwMURBdy4pOiB5eXl5LW1tLWRkKipcclxuICAgKiBgYGBcclxuICAgKiB0aGlzLmRhdGUgPSAnMjAxNy0xMS0yOCc7XHJcbiAgICogYGBgXHJcbiAgICpcclxuICAgKiAtICoqSmF2YVNjcmlwdCBEYXRlIE9iamVjdDoqKlxyXG4gICAqIGBgYFxyXG4gICAqIHRoaXMuZGF0ZSA9IG5ldyBEYXRlKDIwMTcsIDEwLCAyOCk7XHJcbiAgICogYGBgXHJcbiAgICovXHJcbiAgQElucHV0KCdwLW1pbi1kYXRlJykgc2V0IG1pbkRhdGUobWluRGF0ZTogYW55KSB7XHJcbiAgICB0aGlzLl9taW5EYXRlID0gdGhpcy5wb0RhdGUuZ2V0RGF0ZUZvckRhdGVSYW5nZShtaW5EYXRlLCB0cnVlKTtcclxuICB9XHJcbiAgZ2V0IG1pbkRhdGUoKSB7XHJcbiAgICByZXR1cm4gdGhpcy5fbWluRGF0ZTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFByb3ByaWVkYWRlIHF1ZSBwZXJtaXRlIGluZm9ybWFyIG8gbW9kbyBkZSBleGliacOnw6NvIGRvIGNhbGVuZGFyLlxyXG4gICAqXHJcbiAgICogSW1wbGVtZW50YSBvIGVudW0gYFBvQ2FsZW5kYXJNb2RlYC5cclxuICAgKi9cclxuICBASW5wdXQoJ3AtbW9kZScpIHNldCBtb2RlKHZhbHVlOiBQb0NhbGVuZGFyTW9kZSkge1xyXG4gICAgdGhpcy5fbW9kZSA9IHZhbHVlO1xyXG5cclxuICAgIHRoaXMuc2V0QWN0aXZhdGVEYXRlKCk7XHJcbiAgfVxyXG5cclxuICBnZXQgbW9kZSgpIHtcclxuICAgIHJldHVybiB0aGlzLl9tb2RlO1xyXG4gIH1cclxuXHJcbiAgZ2V0IGlzUmFuZ2UoKSB7XHJcbiAgICByZXR1cm4gdGhpcy5tb2RlID09PSBQb0NhbGVuZGFyTW9kZS5SYW5nZTtcclxuICB9XHJcblxyXG4gIGNvbnN0cnVjdG9yKHB1YmxpYyBwb0RhdGU6IFBvRGF0ZVNlcnZpY2UsIHByaXZhdGUgbGFuZ3VhZ2VTZXJ2aWNlOiBQb0xhbmd1YWdlU2VydmljZSkge1xyXG4gICAgdGhpcy5zaG9ydExhbmd1YWdlID0gbGFuZ3VhZ2VTZXJ2aWNlLmdldFNob3J0TGFuZ3VhZ2UoKTtcclxuICB9XHJcblxyXG4gIHByb3RlY3RlZCBzZXRBY3RpdmF0ZURhdGUoZGF0ZT86IERhdGUgfCBzdHJpbmcpIHtcclxuICAgIGNvbnN0IGFjdGl2YXRlRGF0ZSA9IGRhdGUgPyBkYXRlIDogdGhpcy52ZXJpZnlBY3RpdmF0ZURhdGUoKTtcclxuXHJcbiAgICBpZiAodGhpcy5pc1JhbmdlKSB7XHJcbiAgICAgIGNvbnN0IGNoZWNrZWRTdGFydCA9XHJcbiAgICAgICAgdHlwZW9mIGFjdGl2YXRlRGF0ZSA9PT0gJ3N0cmluZycgPyB0aGlzLnBvRGF0ZS5jb252ZXJ0SXNvVG9EYXRlKGFjdGl2YXRlRGF0ZSkgOiBuZXcgRGF0ZShhY3RpdmF0ZURhdGUpO1xyXG4gICAgICBjb25zdCBjaGVja2VkRW5kID0gbmV3IERhdGUobmV3IERhdGUoY2hlY2tlZFN0YXJ0KS5zZXRNb250aChjaGVja2VkU3RhcnQuZ2V0TW9udGgoKSArIDEpKTtcclxuICAgICAgdGhpcy5hY3RpdmF0ZURhdGUgPSB7IHN0YXJ0OiBjaGVja2VkU3RhcnQsIGVuZDogY2hlY2tlZEVuZCB9O1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdGhpcy5hY3RpdmF0ZURhdGUgPSBuZXcgRGF0ZShhY3RpdmF0ZURhdGUpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSB2ZXJpZnlBY3RpdmF0ZURhdGUoKTogRGF0ZSB7XHJcbiAgICBsZXQgdG9kYXkgPSB0aGlzLnRvZGF5O1xyXG4gICAgaWYgKHRoaXMubWluRGF0ZSAmJiB0aGlzLm1pbkRhdGUgPiB0aGlzLnRvZGF5KSB7XHJcbiAgICAgIHRvZGF5ID0gdGhpcy5taW5EYXRlO1xyXG4gICAgfSBlbHNlIGlmICh0aGlzLm1heERhdGUgJiYgdGhpcy5tYXhEYXRlIDwgdGhpcy50b2RheSkge1xyXG4gICAgICB0b2RheSA9IHRoaXMubWF4RGF0ZTtcclxuICAgIH1cclxuICAgIHJldHVybiB0b2RheTtcclxuICB9XHJcbn1cclxuIl19