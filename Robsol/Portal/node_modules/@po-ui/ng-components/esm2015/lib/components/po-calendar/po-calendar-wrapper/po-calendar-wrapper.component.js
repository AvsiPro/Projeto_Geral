import { ChangeDetectionStrategy, Component, Input, Output, EventEmitter } from '@angular/core';
import { Subject } from 'rxjs';
import { debounceTime } from 'rxjs/operators';
import { PoCalendarLangService } from '../services/po-calendar.lang.service';
import { PoCalendarService } from '../services/po-calendar.service';
import { PoDateService } from '../../../services/po-date/po-date.service';
export class PoCalendarWrapperComponent {
    constructor(poCalendarService, poCalendarLangService, poDate) {
        this.poCalendarService = poCalendarService;
        this.poCalendarLangService = poCalendarLangService;
        this.poDate = poDate;
        this.mode = 'day';
        this.responsive = false;
        this.range = false;
        this.activateDate = new Date();
        this.headerChange = new EventEmitter();
        this.selectDate = new EventEmitter();
        this.hoverDate = new Subject().pipe(debounceTime(100));
        this.displayMonths = Array();
        this.displayWeekDays = Array();
        this.today = new Date();
    }
    set locale(value) {
        this._locale = value;
        this.initializeLanguage();
    }
    get locale() {
        return this._locale;
    }
    get monthLabel() {
        return this.poCalendarLangService.getMonthLabel();
    }
    get yearLabel() {
        return this.poCalendarLangService.getYearLabel();
    }
    get isDayVisible() {
        return this.mode === 'day';
    }
    get isMonthVisible() {
        return this.mode === 'month';
    }
    get isYearVisible() {
        return this.mode === 'year';
    }
    get isStartPart() {
        return this.partType === 'start';
    }
    get isEndPart() {
        return this.partType === 'end';
    }
    ngOnInit() {
        this.init();
    }
    ngOnChanges(changes) {
        const { activateDate } = changes;
        if (activateDate) {
            this.updateDate(activateDate.currentValue);
        }
    }
    getBackgroundColor(displayValue, propertyValue) {
        return displayValue === propertyValue ? 'po-calendar-box-background-selected' : 'po-calendar-box-background';
    }
    getDayBackgroundColor(date) {
        return this.getDayColor(date, 'background');
    }
    getDayForegroundColor(date) {
        return this.getDayColor(date, 'foreground');
    }
    getForegroundColor(displayValue, propertyValue) {
        return displayValue === propertyValue ? 'po-calendar-box-foreground-selected' : 'po-calendar-box-foreground';
    }
    isTodayUnavailable() {
        return this.minDate > this.today || this.maxDate < this.today;
    }
    onNextMonth() {
        this.displayMonthNumber < 11
            ? this.updateDisplay(this.displayYear, this.displayMonthNumber + 1)
            : this.updateDisplay(this.displayYear + 1, 0);
        this.headerChange.emit({ month: this.displayMonthNumber, year: this.displayYear });
    }
    onPreviousMonth() {
        if (this.displayMonthNumber > 0) {
            this.updateDisplay(this.displayYear, this.displayMonthNumber - 1);
        }
        else {
            this.updateDisplay(this.displayYear - 1, 11);
        }
        this.headerChange.emit({ month: this.displayMonthNumber, year: this.displayYear });
    }
    onMouseEnter(day) {
        this.hoverDate.next(day);
    }
    onMouseLeave() {
        this.hoverDate.next(null);
    }
    // Ao selecionar uma data
    onSelectDate(date) {
        this.selectDate.emit(date);
    }
    // Ao selecionar um mês
    onSelectMonth(year, month) {
        this.selectDisplayMode('day');
        this.updateDisplay(year, month);
        this.headerChange.emit({ month, year });
    }
    // Ao selecionar um ano
    onSelectYear(year, month) {
        // Se veio da tela de seleção de mês
        this.selectDisplayMode(this.lastDisplay === 'month' ? 'month' : 'day');
        this.currentYear = year;
        this.updateDisplay(year, month);
        this.headerChange.emit({ month, year });
    }
    selectDisplayMode(mode) {
        this.lastDisplay = this.mode;
        this.mode = mode;
    }
    updateYear(value) {
        this.updateDisplay(this.displayYear + value, this.displayMonthNumber);
    }
    addAllYearsInDecade(year) {
        let i;
        for (i = year; i < year + 10; i++) {
            this.displayDecade.push(i);
        }
    }
    equalsDate(date1, date2) {
        try {
            return (date1.getFullYear() === date2.getFullYear() &&
                date1.getMonth() === date2.getMonth() &&
                date1.getDate() === date2.getDate());
        }
        catch (error) {
            return false;
        }
    }
    // Obtém um array de todos os anos desta década
    getDecadeArray(year) {
        this.displayDecade = Array();
        if (year % 10 !== 0) {
            while (year % 10 !== 0) {
                year--;
            }
        }
        this.updateDecade(year);
    }
    getColorForDate(date, local) {
        return this.poDate.validateDateRange(date, this.minDate, this.maxDate)
            ? `po-calendar-box-${local}-selected`
            : `po-calendar-box-${local}-selected-disabled`;
    }
    getColorForDefaultDate(date, local) {
        return this.poDate.validateDateRange(date, this.minDate, this.maxDate)
            ? `po-calendar-box-${local}`
            : `po-calendar-box-${local}-disabled`;
    }
    getColorForToday(date, local) {
        return this.poDate.validateDateRange(date, this.minDate, this.maxDate)
            ? `po-calendar-box-${local}-today`
            : `po-calendar-box-${local}-today-disabled`;
    }
    getColorForDateRange(date, local) {
        return this.poDate.validateDateRange(date, this.minDate, this.maxDate)
            ? `po-calendar-box-${local}-in-range`
            : `po-calendar-box-${local}-in-range-disabled`;
    }
    getDayColor(date, local) {
        var _a, _b;
        const start = (_a = this.selectedValue) === null || _a === void 0 ? void 0 : _a.start;
        const end = (_b = this.selectedValue) === null || _b === void 0 ? void 0 : _b.end;
        if (this.range && (this.equalsDate(date, start) || this.equalsDate(date, end))) {
            return this.getColorForDate(date, local);
        }
        else if (this.range && start && end && date > start && date < end) {
            return this.getColorForDateRange(date, local);
        }
        else if (this.range && start && !end && date > start && date < this.hoverValue) {
            return `po-calendar-box-${local}-hover`;
        }
        else if (!this.range && this.equalsDate(date, this.value)) {
            return this.getColorForDate(date, local);
        }
        else if (this.equalsDate(date, this.today)) {
            return this.getColorForToday(date, local);
        }
        else {
            return this.getColorForDefaultDate(date, local);
        }
    }
    init() {
        this.updateDate(this.activateDate);
        this.initializeLanguage();
        this.selectDisplayMode('day');
    }
    initializeLanguage() {
        this.poCalendarLangService.setLanguage(this.locale);
        this.displayWeekDays = this.poCalendarLangService.getWeekDaysArray();
        this.displayMonths = this.poCalendarLangService.getMonthsArray();
        this.displayMonth = this.displayMonths[this.displayMonthNumber];
        this.displayToday = this.poCalendarLangService.getTodayLabel();
    }
    updateDate(value = new Date()) {
        const date = new Date(value);
        this.currentMonthNumber = date.getMonth();
        this.currentYear = date.getFullYear();
        this.updateDisplay(this.currentYear, this.currentMonthNumber);
    }
    updateDecade(year) {
        this.addAllYearsInDecade(year);
        this.displayStartDecade = year;
        this.displayFinalDecade = year + 9;
    }
    updateDisplay(year, month) {
        const calendarArray = this.poCalendarService.monthDays(year, month);
        this.displayDays = [].concat.apply([], calendarArray);
        this.displayMonthNumber = month;
        this.displayMonth = this.displayMonths[month];
        this.displayYear = year;
        this.getDecadeArray(year);
    }
}
PoCalendarWrapperComponent.decorators = [
    { type: Component, args: [{
                selector: 'po-calendar-wrapper',
                template: "<div class=\"po-calendar-wrapper\">\r\n  <ng-container *ngIf=\"isDayVisible\">\r\n    <po-calendar-header\r\n      [p-hide-previous]=\"isEndPart\"\r\n      [p-hide-next]=\"isStartPart && !responsive\"\r\n      (p-previous)=\"onPreviousMonth()\"\r\n      (p-next)=\"onNextMonth()\"\r\n    >\r\n      <span class=\"po-clickable po-mr-1\" (click)=\"selectDisplayMode('month')\">{{ displayMonth }}</span>\r\n      <span class=\"po-clickable\" (click)=\"selectDisplayMode('year')\">{{ displayYear }}</span>\r\n    </po-calendar-header>\r\n\r\n    <div class=\"po-calendar-content\">\r\n      <div class=\"po-calendar-labels\">\r\n        <div class=\"po-calendar-label\" *ngFor=\"let weekDay of displayWeekDays\">\r\n          {{ weekDay }}\r\n        </div>\r\n      </div>\r\n\r\n      <div class=\"po-calendar-content-list-day\">\r\n        <div\r\n          *ngFor=\"let day of displayDays\"\r\n          class=\"po-calendar-day\"\r\n          [ngClass]=\"getDayBackgroundColor(day)\"\r\n          (click)=\"onSelectDate(day)\"\r\n          (mouseenter)=\"onMouseEnter(day)\"\r\n          (mouseleave)=\"onMouseLeave()\"\r\n          attr-calendar\r\n        >\r\n          <span *ngIf=\"day !== 0\" [ngClass]=\"getDayForegroundColor(day)\">\r\n            {{ day.getDate() }}\r\n          </span>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </ng-container>\r\n\r\n  <ng-container *ngIf=\"isMonthVisible\">\r\n    <po-calendar-header (p-previous)=\"updateYear(-1)\" (p-next)=\"updateYear(1)\">\r\n      <span class=\"po-clickable\" (click)=\"selectDisplayMode('year')\">\r\n        {{ displayYear }}\r\n      </span>\r\n    </po-calendar-header>\r\n\r\n    <div class=\"po-calendar-content\">\r\n      <div class=\"po-calendar-labels\">\r\n        <div class=\"po-calendar-label\">\r\n          {{ monthLabel }}\r\n        </div>\r\n      </div>\r\n      <div class=\"po-calendar-content-list-month\">\r\n        <div\r\n          *ngFor=\"let month of displayMonths; let i = index\"\r\n          class=\"po-calendar-month\"\r\n          [ngClass]=\"getBackgroundColor(i, displayMonthNumber)\"\r\n          (click)=\"onSelectMonth(displayYear, i)\"\r\n          attr-calendar\r\n        >\r\n          <span [ngClass]=\"getForegroundColor(i, displayMonthNumber)\">\r\n            {{ month }}\r\n          </span>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </ng-container>\r\n\r\n  <ng-container *ngIf=\"isYearVisible\">\r\n    <po-calendar-header (p-previous)=\"updateYear(-10)\" (p-next)=\"updateYear(10)\">\r\n      {{ displayStartDecade }} - {{ displayFinalDecade }}\r\n    </po-calendar-header>\r\n\r\n    <div class=\"po-calendar-content\">\r\n      <div class=\"po-calendar-labels\">\r\n        <div class=\"po-calendar-label\">\r\n          {{ yearLabel }}\r\n        </div>\r\n      </div>\r\n\r\n      <div class=\"po-calendar-content-list-year\">\r\n        <div\r\n          *ngFor=\"let year of displayDecade; let i = index\"\r\n          class=\"po-calendar-year\"\r\n          [ngClass]=\"getBackgroundColor(year, currentYear)\"\r\n          (click)=\"onSelectYear(year, displayMonthNumber)\"\r\n          attr-calendar\r\n        >\r\n          <span [ngClass]=\"getForegroundColor(year, currentYear)\">\r\n            {{ year }}\r\n          </span>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </ng-container>\r\n\r\n  <ng-container *ngIf=\"!range\">\r\n    <div class=\"po-calendar-footer\">\r\n      <div class=\"po-calendar-footer-today\">\r\n        <button class=\"po-calendar-footer-today-button\" (click)=\"onSelectDate(today)\" [disabled]=\"isTodayUnavailable()\">\r\n          {{ displayToday }}\r\n        </button>\r\n      </div>\r\n    </div>\r\n  </ng-container>\r\n</div>\r\n",
                providers: [PoCalendarService],
                changeDetection: ChangeDetectionStrategy.OnPush
            },] }
];
PoCalendarWrapperComponent.ctorParameters = () => [
    { type: PoCalendarService },
    { type: PoCalendarLangService },
    { type: PoDateService }
];
PoCalendarWrapperComponent.propDecorators = {
    value: [{ type: Input, args: ['p-value',] }],
    mode: [{ type: Input, args: ['p-mode',] }],
    responsive: [{ type: Input, args: ['p-responsive',] }],
    partType: [{ type: Input, args: ['p-part-type',] }],
    range: [{ type: Input, args: ['p-range',] }],
    activateDate: [{ type: Input, args: ['p-activate-date',] }],
    selectedValue: [{ type: Input, args: ['p-selected-value',] }],
    minDate: [{ type: Input, args: ['p-min-date',] }],
    maxDate: [{ type: Input, args: ['p-max-date',] }],
    hoverValue: [{ type: Input, args: ['p-hover-value',] }],
    headerChange: [{ type: Output, args: ['p-header-change',] }],
    selectDate: [{ type: Output, args: ['p-select-date',] }],
    hoverDate: [{ type: Output, args: ['p-hover-date',] }],
    locale: [{ type: Input, args: ['p-locale',] }]
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG8tY2FsZW5kYXItd3JhcHBlci5jb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy91aS9zcmMvbGliL2NvbXBvbmVudHMvcG8tY2FsZW5kYXIvcG8tY2FsZW5kYXItd3JhcHBlci9wby1jYWxlbmRhci13cmFwcGVyLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsdUJBQXVCLEVBQUUsU0FBUyxFQUFFLEtBQUssRUFBcUIsTUFBTSxFQUFFLFlBQVksRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUVuSCxPQUFPLEVBQUUsT0FBTyxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBQy9CLE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUU5QyxPQUFPLEVBQUUscUJBQXFCLEVBQUUsTUFBTSxzQ0FBc0MsQ0FBQztBQUM3RSxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSxpQ0FBaUMsQ0FBQztBQUNwRSxPQUFPLEVBQUUsYUFBYSxFQUFFLE1BQU0sMkNBQTJDLENBQUM7QUFRMUUsTUFBTSxPQUFPLDBCQUEwQjtJQW1GckMsWUFDVSxpQkFBb0MsRUFDcEMscUJBQTRDLEVBQzVDLE1BQXFCO1FBRnJCLHNCQUFpQixHQUFqQixpQkFBaUIsQ0FBbUI7UUFDcEMsMEJBQXFCLEdBQXJCLHFCQUFxQixDQUF1QjtRQUM1QyxXQUFNLEdBQU4sTUFBTSxDQUFlO1FBbkZkLFNBQUksR0FBNkIsS0FBSyxDQUFDO1FBRWpDLGVBQVUsR0FBWSxLQUFLLENBQUM7UUFJakMsVUFBSyxHQUFZLEtBQUssQ0FBQztRQUVmLGlCQUFZLEdBQUcsSUFBSSxJQUFJLEVBQUUsQ0FBQztRQVV6QixpQkFBWSxHQUFHLElBQUksWUFBWSxFQUFPLENBQUM7UUFFekMsZUFBVSxHQUFHLElBQUksWUFBWSxFQUFPLENBQUM7UUFFdEMsY0FBUyxHQUFHLElBQUksT0FBTyxFQUFR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QVJRLGlCQUFpQjtZQURqQixxQkFBcUI7WUFFckIsYUFBYTs7O29CQVNuQixLQUFLLFNBQUMsU0FBUzttQkFFZixLQUFLLFNBQUMsUUFBUTt5QkFFZCxLQUFLLFNBQUMsY0FBYzt1QkFFcEIsS0FBSyxTQUFDLGFBQWE7b0JBRW5CLEtBQUssU0FBQyxTQUFTOzJCQUVmLEtBQUssU0FBQyxpQkFBaUI7NEJBRXZCLEtBQUssU0FBQyxrQkFBa0I7c0JBRXhCLEtBQUssU0FBQyxZQUFZO3NCQUVsQixLQUFLLFNBQUMsWUFBWTt5QkFFbEIsS0FBSyxTQUFDLGVBQWU7MkJBRXJCLE1BQU0sU0FBQyxpQkFBaUI7eUJBRXhCLE1BQU0sU0FBQyxlQUFlO3dCQUV0QixNQUFNLFNBQUMsY0FBYztxQkFxQnJCLEtBQUssU0FBQyxVQUFVIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3ksIENvbXBvbmVudCwgSW5wdXQsIE9uQ2hhbmdlcywgT25Jbml0LCBPdXRwdXQsIEV2ZW50RW1pdHRlciB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5cclxuaW1wb3J0IHsgU3ViamVjdCB9IGZyb20gJ3J4anMnO1xyXG5pbXBvcnQgeyBkZWJvdW5jZVRpbWUgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XHJcblxyXG5pbXBvcnQgeyBQb0NhbGVuZGFyTGFuZ1NlcnZpY2UgfSBmcm9tICcuLi9zZXJ2aWNlcy9wby1jYWxlbmRhci5sYW5nLnNlcnZpY2UnO1xyXG5pbXBvcnQgeyBQb0NhbGVuZGFyU2VydmljZSB9IGZyb20gJy4uL3NlcnZpY2VzL3BvLWNhbGVuZGFyLnNlcnZpY2UnO1xyXG5pbXBvcnQgeyBQb0RhdGVTZXJ2aWNlIH0gZnJvbSAnLi4vLi4vLi4vc2VydmljZXMvcG8tZGF0ZS9wby1kYXRlLnNlcnZpY2UnO1xyXG5cclxuQENvbXBvbmVudCh7XHJcbiAgc2VsZWN0b3I6ICdwby1jYWxlbmRhci13cmFwcGVyJyxcclxuICB0ZW1wbGF0ZVVybDogJy4vcG8tY2FsZW5kYXItd3JhcHBlci5jb21wb25lbnQuaHRtbCcsXHJcbiAgcHJvdmlkZXJzOiBbUG9DYWxlbmRhclNlcnZpY2VdLFxyXG4gIGNoYW5nZURldGVjdGlvbjogQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3kuT25QdXNoXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBQb0NhbGVuZGFyV3JhcHBlckNvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCwgT25DaGFuZ2VzIHtcclxuICBASW5wdXQoJ3AtdmFsdWUnKSB2YWx1ZTtcclxuXHJcbiAgQElucHV0KCdwLW1vZGUnKSBtb2RlOiAnZGF5JyB8ICdtb250aCcgfCAneWVhcicgPSAnZGF5JztcclxuXHJcbiAgQElucHV0KCdwLXJlc3BvbnNpdmUnKSByZXNwb25zaXZlOiBib29sZWFuID0gZmFsc2U7XHJcblxyXG4gIEBJbnB1dCgncC1wYXJ0LXR5cGUnKSBwYXJ0VHlwZTogJ3N0YXJ0JyB8ICdlbmQnO1xyXG5cclxuICBASW5wdXQoJ3AtcmFuZ2UnKSByYW5nZTogYm9vbGVhbiA9IGZhbHNlO1xyXG5cclxuICBASW5wdXQoJ3AtYWN0aXZhdGUtZGF0ZScpIGFjdGl2YXRlRGF0ZSA9IG5ldyBEYXRlKCk7XHJcblxyXG4gIEBJbnB1dCgncC1zZWxlY3RlZC12YWx1ZScpIHNlbGVjdGVkVmFsdWU7XHJcblxyXG4gIEBJbnB1dCgncC1taW4tZGF0ZScpIG1pbkRhdGU7XHJcblxyXG4gIEBJbnB1dCgncC1tYXgtZGF0ZScpIG1heERhdGU7XHJcblxyXG4gIEBJbnB1dCgncC1ob3Zlci12YWx1ZScpIGhvdmVyVmFsdWU6IERhdGU7XHJcblxyXG4gIEBPdXRwdXQoJ3AtaGVhZGVyLWNoYW5nZScpIGhlYWRlckNoYW5nZSA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xyXG5cclxuICBAT3V0cHV0KCdwLXNlbGVjdC1kYXRlJykgc2VsZWN0RGF0ZSA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xyXG5cclxuICBAT3V0cHV0KCdwLWhvdmVyLWRhdGUnKSBob3ZlckRhdGUgPSBuZXcgU3ViamVjdDxEYXRlPigpLnBpcGUoZGVib3VuY2VUaW1lKDEwMCkpO1xyXG5cclxuICBjdXJyZW50WWVhcjogbnVtYmVyO1xyXG4gIGRpc3BsYXlEYXlzOiBBcnJheTxudW1iZXI+O1xyXG4gIGRpc3BsYXlEZWNhZGU6IEFycmF5PG51bWJlcj47XHJcbiAgZGlzcGxheUZpbmFsRGVjYWRlOiBudW1iZXI7XHJcbiAgZGlzcGxheU1vbnRoOiBhbnk7XHJcbiAgZGlzcGxheU1vbnRoTnVtYmVyOiBudW1iZXI7XHJcbiAgZGlzcGxheU1vbnRoczogQXJyYXk8YW55PiA9IEFycmF5KCk7XHJcbiAgZGlzcGxheVN0YXJ0RGVjYWRlOiBudW1iZXI7XHJcbiAgZGlzcGxheVdlZWtEYXlzOiBBcnJheTxhbnk+ID0gQXJyYXkoKTtcclxuICBkaXNwbGF5WWVhcjogbnVtYmVyO1xyXG4gIGRpc3BsYXlUb2RheTogc3RyaW5nO1xyXG4gIHRvZGF5OiBEYXRlID0gbmV3IERhdGUoKTtcclxuXHJcbiAgcHJvdGVjdGVkIGN1cnJlbnRNb250aE51bWJlcjogbnVtYmVyO1xyXG4gIHByb3RlY3RlZCBkYXRlOiBEYXRlO1xyXG4gIHByb3RlY3RlZCBsYXN0RGlzcGxheTogc3RyaW5nO1xyXG5cclxuICBwcml2YXRlIF9sb2NhbGU6IHN0cmluZztcclxuXHJcbiAgQElucHV0KCdwLWxvY2FsZScpIHNldCBsb2NhbGUodmFsdWU6IHN0cmluZykge1xyXG4gICAgdGhpcy5fbG9jYWxlID0gdmFsdWU7XHJcbiAgICB0aGlzLmluaXRpYWxpemVMYW5ndWFnZSgpO1xyXG4gIH1cclxuXHJcbiAgZ2V0IGxvY2FsZSgpIHtcclxuICAgIHJldHVybiB0aGlzLl9sb2NhbGU7XHJcbiAgfVxyXG5cclxuICBnZXQgbW9udGhMYWJlbCgpIHtcclxuICAgIHJldHVybiB0aGlzLnBvQ2FsZW5kYXJMYW5nU2VydmljZS5nZXRNb250aExhYmVsKCk7XHJcbiAgfVxyXG5cclxuICBnZXQgeWVhckxhYmVsKCkge1xyXG4gICAgcmV0dXJuIHRoaXMucG9DYWxlbmRhckxhbmdTZXJ2aWNlLmdldFllYXJMYWJlbCgpO1xyXG4gIH1cclxuXHJcbiAgZ2V0IGlzRGF5VmlzaWJsZSgpIHtcclxuICAgIHJldHVybiB0aGlzLm1vZGUgPT09ICdkYXknO1xyXG4gIH1cclxuXHJcbiAgZ2V0IGlzTW9udGhWaXNpYmxlKCkge1xyXG4gICAgcmV0dXJuIHRoaXMubW9kZSA9PT0gJ21vbnRoJztcclxuICB9XHJcblxyXG4gIGdldCBpc1llYXJWaXNpYmxlKCkge1xyXG4gICAgcmV0dXJuIHRoaXMubW9kZSA9PT0gJ3llYXInO1xyXG4gIH1cclxuXHJcbiAgZ2V0IGlzU3RhcnRQYXJ0KCkge1xyXG4gICAgcmV0dXJuIHRoaXMucGFydFR5cGUgPT09ICdzdGFydCc7XHJcbiAgfVxyXG5cclxuICBnZXQgaXNFbmRQYXJ0KCkge1xyXG4gICAgcmV0dXJuIHRoaXMucGFydFR5cGUgPT09ICdlbmQnO1xyXG4gIH1cclxuXHJcbiAgY29uc3RydWN0b3IoXHJcbiAgICBwcml2YXRlIHBvQ2FsZW5kYXJTZXJ2aWNlOiBQb0NhbGVuZGFyU2VydmljZSxcclxuICAgIHByaXZhdGUgcG9DYWxlbmRhckxhbmdTZXJ2aWNlOiBQb0NhbGVuZGFyTGFuZ1NlcnZpY2UsXHJcbiAgICBwcml2YXRlIHBvRGF0ZTogUG9EYXRlU2VydmljZVxyXG4gICkge31cclxuXHJcbiAgbmdPbkluaXQoKSB7XHJcbiAgICB0aGlzLmluaXQoKTtcclxuICB9XHJcblxyXG4gIG5nT25DaGFuZ2VzKGNoYW5nZXMpIHtcclxuICAgIGNvbnN0IHsgYWN0aXZhdGVEYXRlIH0gPSBjaGFuZ2VzO1xyXG5cclxuICAgIGlmIChhY3RpdmF0ZURhdGUpIHtcclxuICAgICAgdGhpcy51cGRhdGVEYXRlKGFjdGl2YXRlRGF0ZS5jdXJyZW50VmFsdWUpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgZ2V0QmFja2dyb3VuZENvbG9yKGRpc3BsYXlWYWx1ZTogbnVtYmVyLCBwcm9wZXJ0eVZhbHVlOiBudW1iZXIpIHtcclxuICAgIHJldHVybiBkaXNwbGF5VmFsdWUgPT09IHByb3BlcnR5VmFsdWUgPyAncG8tY2FsZW5kYXItYm94LWJhY2tncm91bmQtc2VsZWN0ZWQnIDogJ3BvLWNhbGVuZGFyLWJveC1iYWNrZ3JvdW5kJztcclxuICB9XHJcblxyXG4gIGdldERheUJhY2tncm91bmRDb2xvcihkYXRlOiBEYXRlKSB7XHJcbiAgICByZXR1cm4gdGhpcy5nZXREYXlDb2xvcihkYXRlLCAnYmFja2dyb3VuZCcpO1xyXG4gIH1cclxuXHJcbiAgZ2V0RGF5Rm9yZWdyb3VuZENvbG9yKGRhdGU6IERhdGUpIHtcclxuICAgIHJldHVybiB0aGlzLmdldERheUNvbG9yKGRhdGUsICdmb3JlZ3JvdW5kJyk7XHJcbiAgfVxyXG5cclxuICBnZXRGb3JlZ3JvdW5kQ29sb3IoZGlzcGxheVZhbHVlOiBudW1iZXIsIHByb3BlcnR5VmFsdWU6IG51bWJlcikge1xyXG4gICAgcmV0dXJuIGRpc3BsYXlWYWx1ZSA9PT0gcHJvcGVydHlWYWx1ZSA/ICdwby1jYWxlbmRhci1ib3gtZm9yZWdyb3VuZC1zZWxlY3RlZCcgOiAncG8tY2FsZW5kYXItYm94LWZvcmVncm91bmQnO1xyXG4gIH1cclxuXHJcbiAgaXNUb2RheVVuYXZhaWxhYmxlKCkge1xyXG4gICAgcmV0dXJuIHRoaXMubWluRGF0ZSA+IHRoaXMudG9kYXkgfHwgdGhpcy5tYXhEYXRlIDwgdGhpcy50b2RheTtcclxuICB9XHJcblxyXG4gIG9uTmV4dE1vbnRoKCkge1xyXG4gICAgdGhpcy5kaXNwbGF5TW9udGhOdW1iZXIgPCAxMVxyXG4gICAgICA/IHRoaXMudXBkYXRlRGlzcGxheSh0aGlzLmRpc3BsYXlZZWFyLCB0aGlzLmRpc3BsYXlNb250aE51bWJlciArIDEpXHJcbiAgICAgIDogdGhpcy51cGRhdGVEaXNwbGF5KHRoaXMuZGlzcGxheVllYXIgKyAxLCAwKTtcclxuXHJcbiAgICB0aGlzLmhlYWRlckNoYW5nZS5lbWl0KHsgbW9udGg6IHRoaXMuZGlzcGxheU1vbnRoTnVtYmVyLCB5ZWFyOiB0aGlzLmRpc3BsYXlZZWFyIH0pO1xyXG4gIH1cclxuXHJcbiAgb25QcmV2aW91c01vbnRoKCkge1xyXG4gICAgaWYgKHRoaXMuZGlzcGxheU1vbnRoTnVtYmVyID4gMCkge1xyXG4gICAgICB0aGlzLnVwZGF0ZURpc3BsYXkodGhpcy5kaXNwbGF5WWVhciwgdGhpcy5kaXNwbGF5TW9udGhOdW1iZXIgLSAxKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHRoaXMudXBkYXRlRGlzcGxheSh0aGlzLmRpc3BsYXlZZWFyIC0gMSwgMTEpO1xyXG4gICAgfVxyXG5cclxuICAgIHRoaXMuaGVhZGVyQ2hhbmdlLmVtaXQoeyBtb250aDogdGhpcy5kaXNwbGF5TW9udGhOdW1iZXIsIHllYXI6IHRoaXMuZGlzcGxheVllYXIgfSk7XHJcbiAgfVxyXG5cclxuICBvbk1vdXNlRW50ZXIoZGF5KSB7XHJcbiAgICAoPFN1YmplY3Q8RGF0ZT4+dGhpcy5ob3ZlckRhdGUpLm5leHQoZGF5KTtcclxuICB9XHJcblxyXG4gIG9uTW91c2VMZWF2ZSgpIHtcclxuICAgICg8U3ViamVjdDxEYXRlPj50aGlzLmhvdmVyRGF0ZSkubmV4dChudWxsKTtcclxuICB9XHJcblxyXG4gIC8vIEFvIHNlbGVjaW9uYXIgdW1hIGRhdGFcclxuICBvblNlbGVjdERhdGUoZGF0ZTogRGF0ZSkge1xyXG4gICAgdGhpcy5zZWxlY3REYXRlLmVtaXQoZGF0ZSk7XHJcbiAgfVxyXG5cclxuICAvLyBBbyBzZWxlY2lvbmFyIHVtIG3DqnNcclxuICBvblNlbGVjdE1vbnRoKHllYXI6IG51bWJlciwgbW9udGg6IG51bWJlcikge1xyXG4gICAgdGhpcy5zZWxlY3REaXNwbGF5TW9kZSgnZGF5Jyk7XHJcbiAgICB0aGlzLnVwZGF0ZURpc3BsYXkoeWVhciwgbW9udGgpO1xyXG5cclxuICAgIHRoaXMuaGVhZGVyQ2hhbmdlLmVtaXQoeyBtb250aCwgeWVhciB9KTtcclxuICB9XHJcblxyXG4gIC8vIEFvIHNlbGVjaW9uYXIgdW0gYW5vXHJcbiAgb25TZWxlY3RZZWFyKHllYXI6IG51bWJlciwgbW9udGg6IG51bWJlcikge1xyXG4gICAgLy8gU2UgdmVpbyBkYSB0ZWxhIGRlIHNlbGXDp8OjbyBkZSBtw6pzXHJcbiAgICB0aGlzLnNlbGVjdERpc3BsYXlNb2RlKHRoaXMubGFzdERpc3BsYXkgPT09ICdtb250aCcgPyAnbW9udGgnIDogJ2RheScpO1xyXG5cclxuICAgIHRoaXMuY3VycmVudFllYXIgPSB5ZWFyO1xyXG4gICAgdGhpcy51cGRhdGVEaXNwbGF5KHllYXIsIG1vbnRoKTtcclxuXHJcbiAgICB0aGlzLmhlYWRlckNoYW5nZS5lbWl0KHsgbW9udGgsIHllYXIgfSk7XHJcbiAgfVxyXG5cclxuICBzZWxlY3REaXNwbGF5TW9kZShtb2RlOiAnbW9udGgnIHwgJ2RheScgfCAneWVhcicpIHtcclxuICAgIHRoaXMubGFzdERpc3BsYXkgPSB0aGlzLm1vZGU7XHJcbiAgICB0aGlzLm1vZGUgPSBtb2RlO1xyXG4gIH1cclxuXHJcbiAgdXBkYXRlWWVhcih2YWx1ZTogbnVtYmVyKSB7XHJcbiAgICB0aGlzLnVwZGF0ZURpc3BsYXkodGhpcy5kaXNwbGF5WWVhciArIHZhbHVlLCB0aGlzLmRpc3BsYXlNb250aE51bWJlcik7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGFkZEFsbFllYXJzSW5EZWNhZGUoeWVhcjogbnVtYmVyKSB7XHJcbiAgICBsZXQgaTtcclxuICAgIGZvciAoaSA9IHllYXI7IGkgPCB5ZWFyICsgMTA7IGkrKykge1xyXG4gICAgICB0aGlzLmRpc3BsYXlEZWNhZGUucHVzaChpKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHByaXZhdGUgZXF1YWxzRGF0ZShkYXRlMTogRGF0ZSwgZGF0ZTI6IERhdGUpOiBib29sZWFuIHtcclxuICAgIHRyeSB7XHJcbiAgICAgIHJldHVybiAoXHJcbiAgICAgICAgZGF0ZTEuZ2V0RnVsbFllYXIoKSA9PT0gZGF0ZTIuZ2V0RnVsbFllYXIoKSAmJlxyXG4gICAgICAgIGRhdGUxLmdldE1vbnRoKCkgPT09IGRhdGUyLmdldE1vbnRoKCkgJiZcclxuICAgICAgICBkYXRlMS5nZXREYXRlKCkgPT09IGRhdGUyLmdldERhdGUoKVxyXG4gICAgICApO1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLy8gT2J0w6ltIHVtIGFycmF5IGRlIHRvZG9zIG9zIGFub3MgZGVzdGEgZMOpY2FkYVxyXG4gIHByaXZhdGUgZ2V0RGVjYWRlQXJyYXkoeWVhcikge1xyXG4gICAgdGhpcy5kaXNwbGF5RGVjYWRlID0gQXJyYXkoKTtcclxuXHJcbiAgICBpZiAoeWVhciAlIDEwICE9PSAwKSB7XHJcbiAgICAgIHdoaWxlICh5ZWFyICUgMTAgIT09IDApIHtcclxuICAgICAgICB5ZWFyLS07XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIHRoaXMudXBkYXRlRGVjYWRlKHllYXIpO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBnZXRDb2xvckZvckRhdGUoZGF0ZTogRGF0ZSwgbG9jYWw6IHN0cmluZykge1xyXG4gICAgcmV0dXJuIHRoaXMucG9EYXRlLnZhbGlkYXRlRGF0ZVJhbmdlKGRhdGUsIHRoaXMubWluRGF0ZSwgdGhpcy5tYXhEYXRlKVxyXG4gICAgICA/IGBwby1jYWxlbmRhci1ib3gtJHtsb2NhbH0tc2VsZWN0ZWRgXHJcbiAgICAgIDogYHBvLWNhbGVuZGFyLWJveC0ke2xvY2FsfS1zZWxlY3RlZC1kaXNhYmxlZGA7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGdldENvbG9yRm9yRGVmYXVsdERhdGUoZGF0ZTogRGF0ZSwgbG9jYWw6IHN0cmluZykge1xyXG4gICAgcmV0dXJuIHRoaXMucG9EYXRlLnZhbGlkYXRlRGF0ZVJhbmdlKGRhdGUsIHRoaXMubWluRGF0ZSwgdGhpcy5tYXhEYXRlKVxyXG4gICAgICA/IGBwby1jYWxlbmRhci1ib3gtJHtsb2NhbH1gXHJcbiAgICAgIDogYHBvLWNhbGVuZGFyLWJveC0ke2xvY2FsfS1kaXNhYmxlZGA7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGdldENvbG9yRm9yVG9kYXkoZGF0ZTogRGF0ZSwgbG9jYWw6IHN0cmluZykge1xyXG4gICAgcmV0dXJuIHRoaXMucG9EYXRlLnZhbGlkYXRlRGF0ZVJhbmdlKGRhdGUsIHRoaXMubWluRGF0ZSwgdGhpcy5tYXhEYXRlKVxyXG4gICAgICA/IGBwby1jYWxlbmRhci1ib3gtJHtsb2NhbH0tdG9kYXlgXHJcbiAgICAgIDogYHBvLWNhbGVuZGFyLWJveC0ke2xvY2FsfS10b2RheS1kaXNhYmxlZGA7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGdldENvbG9yRm9yRGF0ZVJhbmdlKGRhdGU6IERhdGUsIGxvY2FsOiBzdHJpbmcpIHtcclxuICAgIHJldHVybiB0aGlzLnBvRGF0ZS52YWxpZGF0ZURhdGVSYW5nZShkYXRlLCB0aGlzLm1pbkRhdGUsIHRoaXMubWF4RGF0ZSlcclxuICAgICAgPyBgcG8tY2FsZW5kYXItYm94LSR7bG9jYWx9LWluLXJhbmdlYFxyXG4gICAgICA6IGBwby1jYWxlbmRhci1ib3gtJHtsb2NhbH0taW4tcmFuZ2UtZGlzYWJsZWRgO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBnZXREYXlDb2xvcihkYXRlOiBEYXRlLCBsb2NhbDogc3RyaW5nKSB7XHJcbiAgICBjb25zdCBzdGFydCA9IHRoaXMuc2VsZWN0ZWRWYWx1ZT8uc3RhcnQ7XHJcbiAgICBjb25zdCBlbmQgPSB0aGlzLnNlbGVjdGVkVmFsdWU/LmVuZDtcclxuXHJcbiAgICBpZiAodGhpcy5yYW5nZSAmJiAodGhpcy5lcXVhbHNEYXRlKGRhdGUsIHN0YXJ0KSB8fCB0aGlzLmVxdWFsc0RhdGUoZGF0ZSwgZW5kKSkpIHtcclxuICAgICAgcmV0dXJuIHRoaXMuZ2V0Q29sb3JGb3JEYXRlKGRhdGUsIGxvY2FsKTtcclxuICAgIH0gZWxzZSBpZiAodGhpcy5yYW5nZSAmJiBzdGFydCAmJiBlbmQgJiYgZGF0ZSA+IHN0YXJ0ICYmIGRhdGUgPCBlbmQpIHtcclxuICAgICAgcmV0dXJuIHRoaXMuZ2V0Q29sb3JGb3JEYXRlUmFuZ2UoZGF0ZSwgbG9jYWwpO1xyXG4gICAgfSBlbHNlIGlmICh0aGlzLnJhbmdlICYmIHN0YXJ0ICYmICFlbmQgJiYgZGF0ZSA+IHN0YXJ0ICYmIGRhdGUgPCB0aGlzLmhvdmVyVmFsdWUpIHtcclxuICAgICAgcmV0dXJuIGBwby1jYWxlbmRhci1ib3gtJHtsb2NhbH0taG92ZXJgO1xyXG4gICAgfSBlbHNlIGlmICghdGhpcy5yYW5nZSAmJiB0aGlzLmVxdWFsc0RhdGUoZGF0ZSwgdGhpcy52YWx1ZSkpIHtcclxuICAgICAgcmV0dXJuIHRoaXMuZ2V0Q29sb3JGb3JEYXRlKGRhdGUsIGxvY2FsKTtcclxuICAgIH0gZWxzZSBpZiAodGhpcy5lcXVhbHNEYXRlKGRhdGUsIHRoaXMudG9kYXkpKSB7XHJcbiAgICAgIHJldHVybiB0aGlzLmdldENvbG9yRm9yVG9kYXkoZGF0ZSwgbG9jYWwpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgcmV0dXJuIHRoaXMuZ2V0Q29sb3JGb3JEZWZhdWx0RGF0ZShkYXRlLCBsb2NhbCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGluaXQoKSB7XHJcbiAgICB0aGlzLnVwZGF0ZURhdGUodGhpcy5hY3RpdmF0ZURhdGUpO1xyXG4gICAgdGhpcy5pbml0aWFsaXplTGFuZ3VhZ2UoKTtcclxuICAgIHRoaXMuc2VsZWN0RGlzcGxheU1vZGUoJ2RheScpO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBpbml0aWFsaXplTGFuZ3VhZ2UoKSB7XHJcbiAgICB0aGlzLnBvQ2FsZW5kYXJMYW5nU2VydmljZS5zZXRMYW5ndWFnZSh0aGlzLmxvY2FsZSk7XHJcbiAgICB0aGlzLmRpc3BsYXlXZWVrRGF5cyA9IHRoaXMucG9DYWxlbmRhckxhbmdTZXJ2aWNlLmdldFdlZWtEYXlzQXJyYXkoKTtcclxuICAgIHRoaXMuZGlzcGxheU1vbnRocyA9IHRoaXMucG9DYWxlbmRhckxhbmdTZXJ2aWNlLmdldE1vbnRoc0FycmF5KCk7XHJcbiAgICB0aGlzLmRpc3BsYXlNb250aCA9IHRoaXMuZGlzcGxheU1vbnRoc1t0aGlzLmRpc3BsYXlNb250aE51bWJlcl07XHJcbiAgICB0aGlzLmRpc3BsYXlUb2RheSA9IHRoaXMucG9DYWxlbmRhckxhbmdTZXJ2aWNlLmdldFRvZGF5TGFiZWwoKTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgdXBkYXRlRGF0ZSh2YWx1ZTogRGF0ZSA9IG5ldyBEYXRlKCkpIHtcclxuICAgIGNvbnN0IGRhdGUgPSBuZXcgRGF0ZSh2YWx1ZSk7XHJcblxyXG4gICAgdGhpcy5jdXJyZW50TW9udGhOdW1iZXIgPSBkYXRlLmdldE1vbnRoKCk7XHJcbiAgICB0aGlzLmN1cnJlbnRZZWFyID0gZGF0ZS5nZXRGdWxsWWVhcigpO1xyXG4gICAgdGhpcy51cGRhdGVEaXNwbGF5KHRoaXMuY3VycmVudFllYXIsIHRoaXMuY3VycmVudE1vbnRoTnVtYmVyKTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgdXBkYXRlRGVjYWRlKHllYXI6IG51bWJlcikge1xyXG4gICAgdGhpcy5hZGRBbGxZZWFyc0luRGVjYWRlKHllYXIpO1xyXG4gICAgdGhpcy5kaXNwbGF5U3RhcnREZWNhZGUgPSB5ZWFyO1xyXG4gICAgdGhpcy5kaXNwbGF5RmluYWxEZWNhZGUgPSB5ZWFyICsgOTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgdXBkYXRlRGlzcGxheSh5ZWFyOiBudW1iZXIsIG1vbnRoOiBudW1iZXIpIHtcclxuICAgIGNvbnN0IGNhbGVuZGFyQXJyYXkgPSB0aGlzLnBvQ2FsZW5kYXJTZXJ2aWNlLm1vbnRoRGF5cyh5ZWFyLCBtb250aCk7XHJcbiAgICB0aGlzLmRpc3BsYXlEYXlzID0gW10uY29uY2F0LmFwcGx5KFtdLCBjYWxlbmRhckFycmF5KTtcclxuICAgIHRoaXMuZGlzcGxheU1vbnRoTnVtYmVyID0gbW9udGg7XHJcbiAgICB0aGlzLmRpc3BsYXlNb250aCA9IHRoaXMuZGlzcGxheU1vbnRoc1ttb250aF07XHJcbiAgICB0aGlzLmRpc3BsYXlZZWFyID0geWVhcjtcclxuICAgIHRoaXMuZ2V0RGVjYWRlQXJyYXkoeWVhcik7XHJcbiAgfVxyXG59XHJcbiJdfQ==