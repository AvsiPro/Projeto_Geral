import { Component, EventEmitter, Input, Output, ViewChild } from '@angular/core';
import { PoChartType } from '../enums/po-chart-type.enum';
import { PoChartMathsService } from '../services/po-chart-maths.service';
export class PoChartContainerComponent {
    constructor(mathsService) {
        this.mathsService = mathsService;
        this.serieClick = new EventEmitter();
        this.serieHover = new EventEmitter();
        this._series = [];
    }
    set options(value) {
        if (value instanceof Object && !(value instanceof Array)) {
            this._options = value;
            this.verifyAxisOptions(this._options);
        }
    }
    get options() {
        return this._options;
    }
    set series(data) {
        this._series = data;
        this.setAlignByTheCorners(this._series);
        this.setSeriesByType(this._series);
        this.setRange(this._series, this.options);
    }
    get series() {
        return this._series;
    }
    get isTypeCircular() {
        return this.type === PoChartType.Pie || this.type === PoChartType.Donut;
    }
    ngOnChanges(changes) {
        if (changes.type || changes.containerSize) {
            this.setViewBox();
            this.setSvgSpace();
        }
    }
    getCategoriesCoordinates(value) {
        this.categoriesCoordinates = value;
    }
    onSerieClick(event) {
        this.serieClick.emit(event);
    }
    onSerieHover(event) {
        this.serieHover.emit(event);
    }
    getRange(series, options = {}) {
        var _a, _b, _c;
        const domain = this.mathsService.calculateMinAndMaxValues(series);
        const minValue = !((_a = options.axis) === null || _a === void 0 ? void 0 : _a.minRange) && domain.minValue > 0
            ? 0
            : ((_b = options.axis) === null || _b === void 0 ? void 0 : _b.minRange) < domain.minValue
                ? options.axis.minRange
                : domain.minValue;
        const maxValue = ((_c = options.axis) === null || _c === void 0 ? void 0 : _c.maxRange) > domain.maxValue ? options.axis.maxRange : domain.maxValue;
        const updatedDomainValues = { minValue, maxValue };
        return Object.assign(Object.assign({}, domain), updatedDomainValues);
    }
    setSvgSpace() {
        var _a;
        // Representa um ponto 2D dentro do viewport do SVG. Ele é a representação do cursor do mouse para comparação de coordenadas com cada dado de série.
        const svgPoint = this.svgELement.nativeElement.createSVGPoint();
        // Retorna um DOMMatrix representando as matrizes 2D e 3D transformadas a partir das coordenadas do elemento, em relação ao document, para coordenadas relativas ao viewport do SVG.
        // É utilizado nos gráficos do tipo área para que seja possível equiparar as coordenadas do evento com cada dado de série, para assim ativar o ponto de dado equivalente.
        const svgDomMatrix = (_a = this.svgELement.nativeElement.getScreenCTM()) === null || _a === void 0 ? void 0 : _a.inverse();
        this.svgSpace = { svgPoint, svgDomMatrix };
    }
    setAlignByTheCorners(series) {
        this.alignByTheCorners = series.every(serie => serie.type === PoChartType.Area || serie.type === PoChartType.Bar);
    }
    setRange(series, options = {}) {
        if (!this.isTypeCircular) {
            this.range = this.getRange(series, options);
        }
    }
    setSeriesByType(series) {
        this.seriesByType = {
            [PoChartType.Area]: series.filter(serie => serie.type === PoChartType.Area),
            [PoChartType.Column]: series.filter(serie => serie.type === PoChartType.Column),
            [PoChartType.Bar]: series.filter(serie => serie.type === PoChartType.Bar),
            [PoChartType.Line]: series.filter(serie => serie.type === PoChartType.Line),
            [PoChartType.Donut]: series.filter(serie => serie.type === PoChartType.Donut),
            [PoChartType.Pie]: series.filter(serie => serie.type === PoChartType.Pie)
        };
    }
    setViewBox() {
        const { svgWidth, svgHeight } = this.containerSize;
        const viewBoxWidth = this.isTypeCircular ? svgHeight : svgWidth;
        // Tratamento necessário para que não corte o vetor nas extremidades
        const offsetXY = 1;
        this.viewBox = `${offsetXY} -${offsetXY} ${viewBoxWidth} ${this.containerSize.svgHeight}`;
    }
    verifyAxisOptions(options) {
        if (!this.isTypeCircular && options.hasOwnProperty('axis')) {
            this.range = this.getRange(this.series, this.options);
            this.axisOptions = Object.assign(Object.assign({}, this.axisOptions), options.axis);
        }
    }
}
PoChartContainerComponent.decorators = [
    { type: Component, args: [{
                selector: 'po-chart-container',
                template: "<svg:svg\r\n  #svgELement\r\n  class=\"po-chart-svg-element\"\r\n  preserveAspectRatio=\"xMidYMin meet\"\r\n  [attr.viewBox]=\"viewBox\"\r\n  [attr.width]=\"containerSize.svgWidth\"\r\n  [attr.height]=\"containerSize.svgHeight\"\r\n>\r\n  <!-- axis -->\r\n  <svg:g\r\n    *ngIf=\"!isTypeCircular\"\r\n    po-chart-axis\r\n    [p-align-by-the-corners]=\"alignByTheCorners\"\r\n    [p-range]=\"range\"\r\n    [p-type]=\"type\"\r\n    [p-series]=\"series\"\r\n    [p-container-size]=\"containerSize\"\r\n    [p-options]=\"axisOptions\"\r\n    [p-categories]=\"categories\"\r\n    (p-categories-coordinates)=\"getCategoriesCoordinates($event)\"\r\n  ></svg:g>\r\n\r\n  <!-- chart area -->\r\n  <svg:g\r\n    *ngIf=\"(type === 'area' || type === 'line' || type === 'column') && seriesByType['area'].length\"\r\n    po-chart-area\r\n    [p-align-by-the-corners]=\"alignByTheCorners\"\r\n    [p-svg-space]=\"svgSpace\"\r\n    [p-categories]=\"categories\"\r\n    [p-categories-coordinates]=\"categoriesCoordinates\"\r\n    [p-range]=\"range\"\r\n    [p-series]=\"seriesByType['area']\"\r\n    [p-container-size]=\"containerSize\"\r\n    (p-bar-hover)=\"onSerieHover($event)\"\r\n    (p-bar-click)=\"onSerieClick($event)\"\r\n  ></svg:g>\r\n\r\n  <!-- chart column -->\r\n  <svg:g\r\n    *ngIf=\"(type === 'area' || type === 'line' || type === 'column') && seriesByType['column'].length\"\r\n    po-chart-column\r\n    [p-categories]=\"categories\"\r\n    [p-range]=\"range\"\r\n    [p-series]=\"seriesByType['column']\"\r\n    [p-container-size]=\"containerSize\"\r\n    (p-bar-hover)=\"onSerieHover($event)\"\r\n    (p-bar-click)=\"onSerieClick($event)\"\r\n  ></svg:g>\r\n\r\n  <!-- chart line -->\r\n  <svg:g\r\n    *ngIf=\"(type === 'area' || type === 'line' || type === 'column') && seriesByType['line'].length\"\r\n    po-chart-line\r\n    [p-categories]=\"categories\"\r\n    [p-range]=\"range\"\r\n    [p-series]=\"seriesByType['line']\"\r\n    [p-container-size]=\"containerSize\"\r\n    (p-point-hover)=\"onSerieHover($event)\"\r\n    (p-point-click)=\"onSerieClick($event)\"\r\n  ></svg:g>\r\n\r\n  <!-- chart bar -->\r\n  <svg:g\r\n    *ngIf=\"type === 'bar'\"\r\n    po-chart-bar\r\n    [p-categories]=\"categories\"\r\n    [p-range]=\"range\"\r\n    [p-series]=\"seriesByType['bar']\"\r\n    [p-container-size]=\"containerSize\"\r\n    (p-bar-hover)=\"onSerieHover($event)\"\r\n    (p-bar-click)=\"onSerieClick($event)\"\r\n  ></svg:g>\r\n\r\n  <svg:g\r\n    *ngIf=\"type === 'pie'\"\r\n    po-chart-pie\r\n    [p-series]=\"seriesByType['pie']\"\r\n    [p-container-size]=\"containerSize\"\r\n    (p-circular-hover)=\"onSerieHover($event)\"\r\n    (p-circular-click)=\"onSerieClick($event)\"\r\n  ></svg:g>\r\n\r\n  <svg:g\r\n    *ngIf=\"type === 'donut'\"\r\n    po-chart-donut\r\n    [p-options]=\"options\"\r\n    [p-series]=\"seriesByType['donut']\"\r\n    [p-container-size]=\"containerSize\"\r\n    (p-circular-hover)=\"onSerieHover($event)\"\r\n    (p-circular-click)=\"onSerieClick($event)\"\r\n  ></svg:g>\r\n</svg:svg>\r\n"
            },] }
];
PoChartContainerComponent.ctorParameters = () => [
    { type: PoChartMathsService }
];
PoChartContainerComponent.propDecorators = {
    categories: [{ type: Input, args: ['p-categories',] }],
    type: [{ type: Input, args: ['p-type',] }],
    containerSize: [{ type: Input, args: ['p-container-size',] }],
    serieClick: [{ type: Output, args: ['p-serie-click',] }],
    serieHover: [{ type: Output, args: ['p-serie-hover',] }],
    svgELement: [{ type: ViewChild, args: ['svgELement', { static: true },] }],
    options: [{ type: Input, args: ['p-options',] }],
    series: [{ type: Input, args: ['p-series',] }]
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG8tY2hhcnQtY29udGFpbmVyLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL3VpL3NyYy9saWIvY29tcG9uZW50cy9wby1jaGFydC9wby1jaGFydC1jb250YWluZXIvcG8tY2hhcnQtY29udGFpbmVyLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFjLFlBQVksRUFBRSxLQUFLLEVBQWEsTUFBTSxFQUFpQixTQUFTLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFFeEgsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLDZCQUE2QixDQUFDO0FBSTFELE9BQU8sRUFBRSxtQkFBbUIsRUFBRSxNQUFNLG9DQUFvQyxDQUFDO0FBUXpFLE1BQU0sT0FBTyx5QkFBeUI7SUFtRHBDLFlBQW9CLFlBQWlDO1FBQWpDLGlCQUFZLEdBQVosWUFBWSxDQUFxQjtRQTVDNUIsZUFBVSxHQUFHLElBQUksWUFBWSxFQUFPLENBQUM7UUFFckMsZUFBVSxHQUFHLElBQUksWUFBWSxFQUFPLENBQUM7UUFhdEQsWUFBTyxHQUF3QixFQUFFLENBQUM7SUE2QmMsQ0FBQztJQTNCekQsSUFBd0IsT0FBTyxDQUFDLEtBQXFCO1FBQ25ELElBQUksS0FBSyxZQUFZLE1BQU0sSUFBSSxDQUFDLENBQUMsS0FBSyxZQUFZLEtBQUssQ0FBQyxFQUFFO1lBQ3hELElBQUksQ0FBQyxRQUFRLEdBQUcsS0FBSyxDQUFDO1lBRXRCLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUM7U0FDdkM7SUFDSCxDQUFDO0lBRUQsSUFBSSxPQUFPO1FBQ1QsT0FBTyxJQUFJLENBQUMsUUFBUSxDQUFDO0lBQ3ZCLENBQUM7SUFFRCxJQUF1QixNQUFNLENBQUMsSUFBeUI7UUFDckQsSUFBSSxDQUFDLE9BQU8sR0FBRyxJQUFJLENBQUM7UUFDcEIsSUFBSSxD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LCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIEVsZW1lbnRSZWYsIEV2ZW50RW1pdHRlciwgSW5wdXQsIE9uQ2hhbmdlcywgT3V0cHV0LCBTaW1wbGVDaGFuZ2VzLCBWaWV3Q2hpbGQgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuXHJcbmltcG9ydCB7IFBvQ2hhcnRUeXBlIH0gZnJvbSAnLi4vZW51bXMvcG8tY2hhcnQtdHlwZS5lbnVtJztcclxuaW1wb3J0IHsgUG9DaGFydENvbnRhaW5lclNpemUgfSBmcm9tICcuLi9pbnRlcmZhY2VzL3BvLWNoYXJ0LWNvbnRhaW5lci1zaXplLmludGVyZmFjZSc7XHJcbmltcG9ydCB7IFBvQ2hhcnRPcHRpb25zIH0gZnJvbSAnLi4vaW50ZXJmYWNlcy9wby1jaGFydC1vcHRpb25zLmludGVyZmFjZSc7XHJcbmltcG9ydCB7IFBvQ2hhcnRBeGlzT3B0aW9ucyB9IGZyb20gJy4uL2ludGVyZmFjZXMvcG8tY2hhcnQtYXhpcy1vcHRpb25zLmludGVyZmFjZSc7XHJcbmltcG9ydCB7IFBvQ2hhcnRNYXRoc1NlcnZpY2UgfSBmcm9tICcuLi9zZXJ2aWNlcy9wby1jaGFydC1tYXRocy5zZXJ2aWNlJztcclxuaW1wb3J0IHsgUG9DaGFydE1pbk1heFZhbHVlcyB9IGZyb20gJy4uL2ludGVyZmFjZXMvcG8tY2hhcnQtbWluLW1heC12YWx1ZXMuaW50ZXJmYWNlJztcclxuaW1wb3J0IHsgUG9DaGFydFNlcmllIH0gZnJvbSAnLi4vaW50ZXJmYWNlcy9wby1jaGFydC1zZXJpZS5pbnRlcmZhY2UnO1xyXG5cclxuQENvbXBvbmVudCh7XHJcbiAgc2VsZWN0b3I6ICdwby1jaGFydC1jb250YWluZXInLFxyXG4gIHRlbXBsYXRlVXJsOiAnLi9wby1jaGFydC1jb250YWluZXIuY29tcG9uZW50Lmh0bWwnXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBQb0NoYXJ0Q29udGFpbmVyQ29tcG9uZW50IGltcGxlbWVudHMgT25DaGFuZ2VzIHtcclxuICBASW5wdXQoJ3AtY2F0ZWdvcmllcycpIGNhdGVnb3JpZXM6IEFycmF5PHN0cmluZz47XHJcblxyXG4gIEBJbnB1dCgncC10eXBlJykgdHlwZTogUG9DaGFydFR5cGU7XHJcblxyXG4gIEBJbnB1dCgncC1jb250YWluZXItc2l6ZScpIGNvbnRhaW5lclNpemU6IFBvQ2hhcnRDb250YWluZXJTaXplO1xyXG5cclxuICBAT3V0cHV0KCdwLXNlcmllLWNsaWNrJykgc2VyaWVDbGljayA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xyXG5cclxuICBAT3V0cHV0KCdwLXNlcmllLWhvdmVyJykgc2VyaWVIb3ZlciA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xyXG5cclxuICBAVmlld0NoaWxkKCdzdmdFTGVtZW50JywgeyBzdGF0aWM6IHRydWUgfSkgc3ZnRUxlbWVudDogRWxlbWVudFJlZjtcclxuXHJcbiAgYWxpZ25CeVRoZUNvcm5lcnM6IGJvb2xlYW47XHJcbiAgYXhpc09wdGlvbnM6IFBvQ2hhcnRBeGlzT3B0aW9ucztcclxuICBjYXRlZ29yaWVzQ29vcmRpbmF0ZXM6IEFycmF5PG51bWJlcj47XHJcbiAgcmFuZ2U6IFBvQ2hhcnRNaW5NYXhWYWx1ZXM7XHJcbiAgc2VyaWVzQnlUeXBlO1xyXG4gIHN2Z1NwYWNlO1xyXG4gIHZpZXdCb3g6IHN0cmluZztcclxuXHJcbiAgcHJpdmF0ZSBfb3B0aW9uczogUG9DaGFydE9wdGlvbnM7XHJcbiAgcHJpdmF0ZSBfc2VyaWVzOiBBcnJheTxQb0NoYXJ0U2VyaWU+ID0gW107XHJcblxyXG4gIEBJbnB1dCgncC1vcHRpb25zJykgc2V0IG9wdGlvbnModmFsdWU6IFBvQ2hhcnRPcHRpb25zKSB7XHJcbiAgICBpZiAodmFsdWUgaW5zdGFuY2VvZiBPYmplY3QgJiYgISh2YWx1ZSBpbnN0YW5jZW9mIEFycmF5KSkge1xyXG4gICAgICB0aGlzLl9vcHRpb25zID0gdmFsdWU7XHJcblxyXG4gICAgICB0aGlzLnZlcmlmeUF4aXNPcHRpb25zKHRoaXMuX29wdGlvbnMpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgZ2V0IG9wdGlvbnMoKSB7XHJcbiAgICByZXR1cm4gdGhpcy5fb3B0aW9ucztcclxuICB9XHJcblxyXG4gIEBJbnB1dCgncC1zZXJpZXMnKSBzZXQgc2VyaWVzKGRhdGE6IEFycmF5PFBvQ2hhcnRTZXJpZT4pIHtcclxuICAgIHRoaXMuX3NlcmllcyA9IGRhdGE7XHJcbiAgICB0aGlzLnNldEFsaWduQnlUaGVDb3JuZXJzKHRoaXMuX3Nlcmllcyk7XHJcbiAgICB0aGlzLnNldFNlcmllc0J5VHlwZSh0aGlzLl9zZXJpZXMpO1xyXG4gICAgdGhpcy5zZXRSYW5nZSh0aGlzLl9zZXJpZXMsIHRoaXMub3B0aW9ucyk7XHJcbiAgfVxyXG5cclxuICBnZXQgc2VyaWVzKCkge1xyXG4gICAgcmV0dXJuIHRoaXMuX3NlcmllcztcclxuICB9XHJcblxyXG4gIGdldCBpc1R5cGVDaXJjdWxhcigpIHtcclxuICAgIHJldHVybiB0aGlzLnR5cGUgPT09IFBvQ2hhcnRUeXBlLlBpZSB8fCB0aGlzLnR5cGUgPT09IFBvQ2hhcnRUeXBlLkRvbnV0O1xyXG4gIH1cclxuXHJcbiAgY29uc3RydWN0b3IocHJpdmF0ZSBtYXRoc1NlcnZpY2U6IFBvQ2hhcnRNYXRoc1NlcnZpY2UpIHt9XHJcblxyXG4gIG5nT25DaGFuZ2VzKGNoYW5nZXM6IFNpbXBsZUNoYW5nZXMpOiB2b2lkIHtcclxuICAgIGlmIChjaGFuZ2VzLnR5cGUgfHwgY2hhbmdlcy5jb250YWluZXJTaXplKSB7XHJcbiAgICAgIHRoaXMuc2V0Vmlld0JveCgpO1xyXG4gICAgICB0aGlzLnNldFN2Z1NwYWNlKCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBnZXRDYXRlZ29yaWVzQ29vcmRpbmF0ZXModmFsdWU6IEFycmF5PG51bWJlcj4pOiB2b2lkIHtcclxuICAgIHRoaXMuY2F0ZWdvcmllc0Nvb3JkaW5hdGVzID0gdmFsdWU7XHJcbiAgfVxyXG5cclxuICBvblNlcmllQ2xpY2soZXZlbnQ6IGFueSkge1xyXG4gICAgdGhpcy5zZXJpZUNsaWNrLmVtaXQoZXZlbnQpO1xyXG4gIH1cclxuXHJcbiAgb25TZXJpZUhvdmVyKGV2ZW50OiBhbnkpIHtcclxuICAgIHRoaXMuc2VyaWVIb3Zlci5lbWl0KGV2ZW50KTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgZ2V0UmFuZ2Uoc2VyaWVzOiBBcnJheTxQb0NoYXJ0U2VyaWU+LCBvcHRpb25zOiBQb0NoYXJ0T3B0aW9ucyA9IHt9KTogUG9DaGFydE1pbk1heFZhbHVlcyB7XHJcbiAgICBjb25zdCBkb21haW4gPSB0aGlzLm1hdGhzU2VydmljZS5jYWxjdWxhdGVNaW5BbmRNYXhWYWx1ZXMoc2VyaWVzKTtcclxuICAgIGNvbnN0IG1pblZhbHVlID1cclxuICAgICAgIW9wdGlvbnMuYXhpcz8ubWluUmFuZ2UgJiYgZG9tYWluLm1pblZhbHVlID4gMFxyXG4gICAgICAgID8gMFxyXG4gICAgICAgIDogb3B0aW9ucy5heGlzPy5taW5SYW5nZSA8IGRvbWFpbi5taW5WYWx1ZVxyXG4gICAgICAgID8gb3B0aW9ucy5heGlzLm1pblJhbmdlXHJcbiAgICAgICAgOiBkb21haW4ubWluVmFsdWU7XHJcbiAgICBjb25zdCBtYXhWYWx1ZSA9IG9wdGlvbnMuYXhpcz8ubWF4UmFuZ2UgPiBkb21haW4ubWF4VmFsdWUgPyBvcHRpb25zLmF4aXMubWF4UmFuZ2UgOiBkb21haW4ubWF4VmFsdWU7XHJcbiAgICBjb25zdCB1cGRhdGVkRG9tYWluVmFsdWVzID0geyBtaW5WYWx1ZSwgbWF4VmFsdWUgfTtcclxuXHJcbiAgICByZXR1cm4geyAuLi5kb21haW4sIC4uLnVwZGF0ZWREb21haW5WYWx1ZXMgfTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgc2V0U3ZnU3BhY2UoKSB7XHJcbiAgICAvLyBSZXByZXNlbnRhIHVtIHBvbnRvIDJEIGRlbnRybyBkbyB2aWV3cG9ydCBkbyBTVkcuIEVsZSDDqSBhIHJlcHJlc2VudGHDp8OjbyBkbyBjdXJzb3IgZG8gbW91c2UgcGFyYSBjb21wYXJhw6fDo28gZGUgY29vcmRlbmFkYXMgY29tIGNhZGEgZGFkbyBkZSBzw6lyaWUuXHJcbiAgICBjb25zdCBzdmdQb2ludCA9IHRoaXMuc3ZnRUxlbWVudC5uYXRpdmVFbGVtZW50LmNyZWF0ZVNWR1BvaW50KCk7XHJcbiAgICAvLyBSZXRvcm5hIHVtIERPTU1hdHJpeCByZXByZXNlbnRhbmRvIGFzIG1hdHJpemVzIDJEIGUgM0QgdHJhbnNmb3JtYWRhcyBhIHBhcnRpciBkYXMgY29vcmRlbmFkYXMgZG8gZWxlbWVudG8sIGVtIHJlbGHDp8OjbyBhbyBkb2N1bWVudCwgcGFyYSBjb29yZGVuYWRhcyByZWxhdGl2YXMgYW8gdmlld3BvcnQgZG8gU1ZHLlxyXG4gICAgLy8gw4kgdXRpbGl6YWRvIG5vcyBncsOhZmljb3MgZG8gdGlwbyDDoXJlYSBwYXJhIHF1ZSBzZWphIHBvc3PDrXZlbCBlcXVpcGFyYXIgYXMgY29vcmRlbmFkYXMgZG8gZXZlbnRvIGNvbSBjYWRhIGRhZG8gZGUgc8OpcmllLCBwYXJhIGFzc2ltIGF0aXZhciBvIHBvbnRvIGRlIGRhZG8gZXF1aXZhbGVudGUuXHJcbiAgICBjb25zdCBzdmdEb21NYXRyaXggPSB0aGlzLnN2Z0VMZW1lbnQubmF0aXZlRWxlbWVudC5nZXRTY3JlZW5DVE0oKT8uaW52ZXJzZSgpO1xyXG5cclxuICAgIHRoaXMuc3ZnU3BhY2UgPSB7IHN2Z1BvaW50LCBzdmdEb21NYXRyaXggfTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgc2V0QWxpZ25CeVRoZUNvcm5lcnMoc2VyaWVzOiBBcnJheTxQb0NoYXJ0U2VyaWU+KTogdm9pZCB7XHJcbiAgICB0aGlzLmFsaWduQnlUaGVDb3JuZXJzID0gc2VyaWVzLmV2ZXJ5KHNlcmllID0+IHNlcmllLnR5cGUgPT09IFBvQ2hhcnRUeXBlLkFyZWEgfHwgc2VyaWUudHlwZSA9PT0gUG9DaGFydFR5cGUuQmFyKTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgc2V0UmFuZ2Uoc2VyaWVzOiBBcnJheTxQb0NoYXJ0U2VyaWU+LCBvcHRpb25zOiBQb0NoYXJ0T3B0aW9ucyA9IHt9KSB7XHJcbiAgICBpZiAoIXRoaXMuaXNUeXBlQ2lyY3VsYXIpIHtcclxuICAgICAgdGhpcy5yYW5nZSA9IHRoaXMuZ2V0UmFuZ2Uoc2VyaWVzLCBvcHRpb25zKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHByaXZhdGUgc2V0U2VyaWVzQnlUeXBlKHNlcmllczogQXJyYXk8UG9DaGFydFNlcmllPikge1xyXG4gICAgdGhpcy5zZXJpZXNCeVR5cGUgPSB7XHJcbiAgICAgIFtQb0NoYXJ0VHlwZS5BcmVhXTogc2VyaWVzLmZpbHRlcihzZXJpZSA9PiBzZXJpZS50eXBlID09PSBQb0NoYXJ0VHlwZS5BcmVhKSxcclxuICAgICAgW1BvQ2hhcnRUeXBlLkNvbHVtbl06IHNlcmllcy5maWx0ZXIoc2VyaWUgPT4gc2VyaWUudHlwZSA9PT0gUG9DaGFydFR5cGUuQ29sdW1uKSxcclxuICAgICAgW1BvQ2hhcnRUeXBlLkJhcl06IHNlcmllcy5maWx0ZXIoc2VyaWUgPT4gc2VyaWUudHlwZSA9PT0gUG9DaGFydFR5cGUuQmFyKSxcclxuICAgICAgW1BvQ2hhcnRUeXBlLkxpbmVdOiBzZXJpZXMuZmlsdGVyKHNlcmllID0+IHNlcmllLnR5cGUgPT09IFBvQ2hhcnRUeXBlLkxpbmUpLFxyXG4gICAgICBbUG9DaGFydFR5cGUuRG9udXRdOiBzZXJpZXMuZmlsdGVyKHNlcmllID0+IHNlcmllLnR5cGUgPT09IFBvQ2hhcnRUeXBlLkRvbnV0KSxcclxuICAgICAgW1BvQ2hhcnRUeXBlLlBpZV06IHNlcmllcy5maWx0ZXIoc2VyaWUgPT4gc2VyaWUudHlwZSA9PT0gUG9DaGFydFR5cGUuUGllKVxyXG4gICAgfTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgc2V0Vmlld0JveCgpIHtcclxuICAgIGNvbnN0IHsgc3ZnV2lkdGgsIHN2Z0hlaWdodCB9ID0gdGhpcy5jb250YWluZXJTaXplO1xyXG4gICAgY29uc3Qgdmlld0JveFdpZHRoID0gdGhpcy5pc1R5cGVDaXJjdWxhciA/IHN2Z0hlaWdodCA6IHN2Z1dpZHRoO1xyXG4gICAgLy8gVHJhdGFtZW50byBuZWNlc3PDoXJpbyBwYXJhIHF1ZSBuw6NvIGNvcnRlIG8gdmV0b3IgbmFzIGV4dHJlbWlkYWRlc1xyXG4gICAgY29uc3Qgb2Zmc2V0WFkgPSAxO1xyXG5cclxuICAgIHRoaXMudmlld0JveCA9IGAke29mZnNldFhZfSAtJHtvZmZzZXRYWX0gJHt2aWV3Qm94V2lkdGh9ICR7dGhpcy5jb250YWluZXJTaXplLnN2Z0hlaWdodH1gO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSB2ZXJpZnlBeGlzT3B0aW9ucyhvcHRpb25zOiBQb0NoYXJ0T3B0aW9ucyk6IHZvaWQge1xyXG4gICAgaWYgKCF0aGlzLmlzVHlwZUNpcmN1bGFyICYmIG9wdGlvbnMuaGFzT3duUHJvcGVydHkoJ2F4aXMnKSkge1xyXG4gICAgICB0aGlzLnJhbmdlID0gdGhpcy5nZXRSYW5nZSh0aGlzLnNlcmllcywgdGhpcy5vcHRpb25zKTtcclxuICAgICAgdGhpcy5heGlzT3B0aW9ucyA9IHtcclxuICAgICAgICAuLi50aGlzLmF4aXNPcHRpb25zLFxyXG4gICAgICAgIC4uLm9wdGlvbnMuYXhpc1xyXG4gICAgICB9O1xyXG4gICAgfVxyXG4gIH1cclxufVxyXG4iXX0=