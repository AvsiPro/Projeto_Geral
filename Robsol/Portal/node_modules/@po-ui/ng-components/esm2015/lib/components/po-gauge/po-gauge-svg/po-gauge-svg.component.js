import { Component, Input } from '@angular/core';
import { PoGaugePointerEnd, PoGaugeThickness, poGaugeTotalValueDefault } from '../po-gauge-default-values.constant';
import { PoDefaultColors } from '../../../services/po-color/po-colors.constant';
export const poGaugeStartAngle = -Math.PI;
export class PoGaugeSvgComponent {
    constructor() {
        this.addSvgElement = false;
    }
    get hasRanges() {
        return this.ranges.length > 0;
    }
    ngOnChanges(changes) {
        if ((this.container && changes.value) || (this.container && changes.ranges) || this.container) {
            this.setCoordinates(this.value, this.ranges, this.container);
        }
    }
    setCoordinates(value, ranges, container) {
        const { height } = container;
        // Adiciona elemento svg somente após calcular a altura do container pois o svg tem altura default de 150px.
        this.addSvgElement = true;
        this.setViewBox(height);
        this.setBaseCoordinates(height);
        if (!ranges.length) {
            this.setSingleRangeCoordinates(height, value);
            return;
        }
        this.setRangesCoordinates(height, value, ranges);
    }
    setBaseCoordinates(height) {
        const endAngleRadian = 0;
        const coordinates = this.calculateCoordinates(height, poGaugeStartAngle, endAngleRadian);
        this.baseCoordinates = { coordinates };
    }
    setRangesCoordinates(height, value = 0, ranges) {
        const { minRange, maxRange } = this.calculateMinAndMaxValues(ranges);
        const minValue = value < minRange ? value : minRange;
        const maxValue = value > maxRange ? value : maxRange;
        this.setPointerCoordinates(height, value, maxValue, minValue);
        // `.reverse()` no término da iteração para tratar a sobreposicão correta das bordas arredondadas dos ranges.
        const rangesCoordinates = ranges
            .map((range) => {
            var _a, _b;
            const from = (_a = range.from) !== null && _a !== void 0 ? _a : 0;
            const to = (_b = range.to) !== null && _b !== void 0 ? _b : maxRange;
            const startAngleRadian = poGaugeStartAngle + this.calculateAngleRadius(from, maxValue, minValue);
            const endAngleRadian = poGaugeStartAngle + this.calculateAngleRadius(to, maxValue, minValue);
            const coordinates = this.calculateCoordinates(height, startAngleRadian, endAngleRadian);
            return { coordinates, color: range.color };
        })
            .reverse();
        this.coordinates = rangesCoordinates;
    }
    setSingleRangeCoordinates(height, value) {
        const verifiedValue = value > 100 ? 100 : value;
        const endAngleRadian = poGaugeStartAngle + this.calculateAngleRadius(verifiedValue, poGaugeTotalValueDefault);
        const coordinates = value > 0 ? this.calculateCoordinates(height, poGaugeStartAngle, endAngleRadian) : undefined;
        const color = PoDefaultColors[0][0];
        this.coordinates = [{ coordinates, color }];
    }
    setPointerCoordinates(height, value, maxValue, minValue) {
        const coordinates = this.calculatePointerInitialCoordinates(height, poGaugeStartAngle);
        const pointerDegrees = this.pointerRotation(value, maxValue, minValue);
        this.pointerCoordinates = Object.assign(Object.assign({}, coordinates), { pointerDegrees });
    }
    pointerRotation(value, maxValue, minValue) {
        const percent = this.convertValueToPercentage(value, maxValue, minValue);
        // valores referentes às angulações mínimas e máximas do ponteiro.
        const minRotation = 0;
        const maxRotation = 180;
        return (percent * (maxRotation - minRotation)) / 100 + minRotation;
    }
    calculatePointerInitialCoordinates(height, startAngleRadian) {
        const radius = height - PoGaugePointerEnd - PoGaugeThickness / 2;
        // Valor que representa a escala do ponteiro para plotagem.
        const scale = 40;
        const pointerScaledWidth = radius / scale;
        const pointerScaledBorderRadius = radius / (scale * 2);
        const sinAlpha = Math.sin(startAngleRadian);
        const cosAlpha = Math.cos(startAngleRadian);
        const targetX = radius + cosAlpha * radius;
        const targetY = radius + sinAlpha * radius;
        const startX = radius;
        const startY = radius + pointerScaledWidth;
        const endX = radius;
        const endY = radius - pointerScaledWidth;
        const coordinates = [
            'M',
            startX,
            startY,
            'L',
            targetX,
            targetY + pointerScaledBorderRadius,
            'A',
            1,
            1,
            0,
            '0,1',
            targetX,
            targetY - pointerScaledBorderRadius,
            'L',
            endX,
            endY,
            'Z'
        ].join(' ');
        return { coordinates, radius };
    }
    calculateCoordinates(height, startAngleRadian, endAngleRadian) {
        // Subtrai altura pelo excedente ponteiro em relação ao gráfico, pela metade do valor da coroa circular.
        const radius = height - PoGaugePointerEnd - PoGaugeThickness / 2;
        const innerRadius = radius - PoGaugeThickness;
        const sinAlpha = Math.sin(startAngleRadian);
        const cosAlpha = Math.cos(startAngleRadian);
        const sinBeta = Math.sin(endAngleRadian);
        const cosBeta = Math.cos(endAngleRadian);
        const startX = Math.round(radius + cosAlpha * radius);
        const startY = Math.round(radius + sinAlpha * radius);
        const endX = Math.round(radius + cosBeta * radius);
        const endY = Math.round(radius + sinBeta * radius);
        const startInnerX = Math.round(radius + cosAlpha * innerRadius);
        const startInnerY = Math.round(radius + sinAlpha * innerRadius);
        const endInnerX = Math.round(radius + cosBeta * innerRadius);
        const endInnerY = Math.round(radius + sinBeta * innerRadius);
        return [
            'M',
            startX,
            startY,
            'A',
            radius,
            radius,
            0,
            '0,1',
            endX,
            endY,
            'A',
            1,
            1,
            0,
            '0,1',
            endInnerX,
            endInnerY,
            'A',
            innerRadius,
            innerRadius,
            0,
            '0,0',
            startInnerX,
            startInnerY,
            'A',
            1,
            1,
            0,
            '0,1',
            startX,
            startY,
            'Z'
        ].join(' ');
    }
    calculateAngleRadius(value, maxValue, minValue = 0) {
        const angle = ((value - minValue) / (maxValue - minValue)) * (Math.PI * 2);
        return angle / 2;
    }
    convertValueToPercentage(value, maxValue, minValue) {
        return ((value - minValue) / (maxValue - minValue)) * 100;
    }
    setViewBox(height) {
        const width = this.calculateDiameter(height);
        this.viewBox = `0 ${-PoGaugePointerEnd} ${width} ${height}`;
    }
    calculateDiameter(height) {
        const radius = height - PoGaugePointerEnd - PoGaugeThickness / 2;
        return radius + Math.cos(0) * radius;
    }
    calculateMinAndMaxValues(ranges) {
        const minRange = this.getDomain(ranges, 'min');
        const maxRange = this.getDomain(ranges, 'max');
        return {
            minRange: this.verifyIfFloatOrInteger(minRange) ? minRange : 0,
            maxRange: this.verifyIfFloatOrInteger(maxRange) ? maxRange : 100
        };
    }
    verifyIfFloatOrInteger(number) {
        const notABoolean = typeof number !== 'boolean';
        const notInfinity = number !== Infinity;
        const isInteger = Number(number) === number && number % 1 === 0 && notInfinity;
        const isFloat = Number(number) === number && number % 1 !== 0 && notInfinity;
        return (notABoolean && isInteger) || (notABoolean && isFloat);
    }
    getDomain(ranges, type) {
        const rangeType = { min: 'from', max: 'to' };
        return Math[type](...ranges.map(range => range[rangeType[type]]));
    }
}
PoGaugeSvgComponent.decorators = [
    { type: Component, args: [{
                selector: 'po-gauge-svg',
                template: "<svg:svg\r\n  *ngIf=\"addSvgElement\"\r\n  class=\"po-gauge-svg\"\r\n  preserveAspectRatio=\"xMidYMax meet\"\r\n  width=\"100%\"\r\n  [attr.viewBox]=\"viewBox\"\r\n  [attr.height]=\"container?.height\"\r\n>\r\n  <!-- GAUGE PATHS -->\r\n  <svg:g po-gauge-path [p-base-coordinates]=\"baseCoordinates\" [p-ranges-coordinates]=\"coordinates\"></svg:g>\r\n\r\n  <!-- GAUGE POINTER -->\r\n  <svg:g *ngIf=\"hasRanges\" po-gauge-pointer [p-coordinates]=\"pointerCoordinates\"></svg:g>\r\n</svg:svg>\r\n"
            },] }
];
PoGaugeSvgComponent.propDecorators = {
    container: [{ type: Input, args: ['p-container',] }],
    ranges: [{ type: Input, args: ['p-ranges',] }],
    value: [{ type: Input, args: ['p-value',] }]
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG8tZ2F1Z2Utc3ZnLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL3VpL3NyYy9saWIvY29tcG9uZW50cy9wby1nYXVnZS9wby1nYXVnZS1zdmcvcG8tZ2F1Z2Utc3ZnLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFFLEtBQUssRUFBNEIsTUFBTSxlQUFlLENBQUM7QUFFM0UsT0FBTyxFQUFFLGlCQUFpQixFQUFFLGdCQUFnQixFQUFFLHdCQUF3QixFQUFFLE1BQU0scUNBQXFDLENBQUM7QUFFcEgsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLCtDQUErQyxDQUFDO0FBTWhGLE1BQU0sQ0FBQyxNQUFNLGlCQUFpQixHQUFHLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQztBQU0xQyxNQUFNLE9BQU8sbUJBQW1CO0lBSmhDO1FBV0Usa0JBQWEsR0FBWSxLQUFLLENBQUM7SUFrUGpDLENBQUM7SUE1T0MsSUFBSSxTQUFTO1FBQ1gsT0FBTyxJQUFJLENBQUMsTUFBTSxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUM7SUFDaEMsQ0FBQztJQUVELFdBQVcsQ0FBQyxPQUFzQjtRQUNoQyxJQUFJLENBQUMsSUFBSSxDQUFDLFNBQVMsSUFBSSxPQUFPLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsU0FBUyxJQUFJLE9BQU8sQ0FBQyxNQUFNLENBQUMsSUFBSSxJQUFJLENBQUMsU0FBUyxFQUFFO1lBQzdGLElBQUksQ0FBQyxjQUFjLENBQUMsSUFBSSxDQUFDLEtBQUssRUFBRSxJQUFJLENBQUMsTUFBTSxFQUFFLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQztTQUM5RDtJQUNILENBQUM7SUFFTyxjQUFjLENBQUMsS0FBYSxFQUFFLE1BQTRCLEVBQUUsU0FBOEI7UUFDaEcsTUFBTSxFQUFFLE1BQU0sRUFBRSxHQUFHLFNB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QUFFLEdBQUcsRUFBRSxJQUFJLEVBQUUsQ0FBQztRQUU3QyxPQUFPLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxHQUFHLE1BQU0sQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDLEVBQUUsQ0FBQyxLQUFLLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQ3BFLENBQUM7OztZQTVQRixTQUFTLFNBQUM7Z0JBQ1QsUUFBUSxFQUFFLGNBQWM7Z0JBQ3hCLDBmQUE0QzthQUM3Qzs7O3dCQUVFLEtBQUssU0FBQyxhQUFhO3FCQUVuQixLQUFLLFNBQUMsVUFBVTtvQkFFaEIsS0FBSyxTQUFDLFNBQVMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIElucHV0LCBPbkNoYW5nZXMsIFNpbXBsZUNoYW5nZXMgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuXHJcbmltcG9ydCB7IFBvR2F1Z2VQb2ludGVyRW5kLCBQb0dhdWdlVGhpY2tuZXNzLCBwb0dhdWdlVG90YWxWYWx1ZURlZmF1bHQgfSBmcm9tICcuLi9wby1nYXVnZS1kZWZhdWx0LXZhbHVlcy5jb25zdGFudCc7XHJcblxyXG5pbXBvcnQgeyBQb0RlZmF1bHRDb2xvcnMgfSBmcm9tICcuLi8uLi8uLi9zZXJ2aWNlcy9wby1jb2xvci9wby1jb2xvcnMuY29uc3RhbnQnO1xyXG5cclxuaW1wb3J0IHsgUG9HYXVnZUNvb3JkaW5hdGVzIH0gZnJvbSAnLi4vaW50ZXJmYWNlcy9wby1nYXVnZS1jb29yZGluYXRlcy5pbnRlcmZhY2UnO1xyXG5pbXBvcnQgeyBQb0dhdWdlUmFuZ2VzIH0gZnJvbSAnLi4vaW50ZXJmYWNlcy9wby1nYXVnZS1yYW5nZXMuaW50ZXJmYWNlJztcclxuaW1wb3J0IHsgUG9HYXVnZVN2Z0NvbnRhaW5lciB9IGZyb20gJy4uL2ludGVyZmFjZXMvcG8tZ2F1Z2Utc3ZnLWNvbnRhaW5lci5pbnRlcmZhY2UnO1xyXG5cclxuZXhwb3J0IGNvbnN0IHBvR2F1Z2VTdGFydEFuZ2xlID0gLU1hdGguUEk7XHJcblxyXG5AQ29tcG9uZW50KHtcclxuICBzZWxlY3RvcjogJ3BvLWdhdWdlLXN2ZycsXHJcbiAgdGVtcGxhdGVVcmw6ICcuL3BvLWdhdWdlLXN2Zy5jb21wb25lbnQuaHRtbCdcclxufSlcclxuZXhwb3J0IGNsYXNzIFBvR2F1Z2VTdmdDb21wb25lbnQgaW1wbGVtZW50cyBPbkNoYW5nZXMge1xyXG4gIEBJbnB1dCgncC1jb250YWluZXInKSBjb250YWluZXI6IFBvR2F1Z2VTdmdDb250YWluZXI7XHJcblxyXG4gIEBJbnB1dCgncC1yYW5nZXMnKSByYW5nZXM6IEFycmF5PFBvR2F1Z2VSYW5nZXM+O1xyXG5cclxuICBASW5wdXQoJ3AtdmFsdWUnKSB2YWx1ZTogbnVtYmVyO1xyXG5cclxuICBhZGRTdmdFbGVtZW50OiBib29sZWFuID0gZmFsc2U7XHJcbiAgYmFzZUNvb3JkaW5hdGVzOiBQb0dhdWdlQ29vcmRpbmF0ZXM7XHJcbiAgY29vcmRpbmF0ZXM6IEFycmF5PFBvR2F1Z2VDb29yZGluYXRlcz47XHJcbiAgcG9pbnRlckNvb3JkaW5hdGVzOiBQb0dhdWdlQ29vcmRpbmF0ZXM7XHJcbiAgdmlld0JveDogc3RyaW5nO1xyXG5cclxuICBnZXQgaGFzUmFuZ2VzKCk6IGJvb2xlYW4ge1xyXG4gICAgcmV0dXJuIHRoaXMucmFuZ2VzLmxlbmd0aCA+IDA7XHJcbiAgfVxyXG5cclxuICBuZ09uQ2hhbmdlcyhjaGFuZ2VzOiBTaW1wbGVDaGFuZ2VzKTogdm9pZCB7XHJcbiAgICBpZiAoKHRoaXMuY29udGFpbmVyICYmIGNoYW5nZXMudmFsdWUpIHx8ICh0aGlzLmNvbnRhaW5lciAmJiBjaGFuZ2VzLnJhbmdlcykgfHwgdGhpcy5jb250YWluZXIpIHtcclxuICAgICAgdGhpcy5zZXRDb29yZGluYXRlcyh0aGlzLnZhbHVlLCB0aGlzLnJhbmdlcywgdGhpcy5jb250YWluZXIpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBzZXRDb29yZGluYXRlcyh2YWx1ZTogbnVtYmVyLCByYW5nZXM6IEFycmF5PFBvR2F1Z2VSYW5nZXM+LCBjb250YWluZXI6IFBvR2F1Z2VTdmdDb250YWluZXIpOiB2b2lkIHtcclxuICAgIGNvbnN0IHsgaGVpZ2h0IH0gPSBjb250YWluZXI7XHJcblxyXG4gICAgLy8gQWRpY2lvbmEgZWxlbWVudG8gc3ZnIHNvbWVudGUgYXDDs3MgY2FsY3VsYXIgYSBhbHR1cmEgZG8gY29udGFpbmVyIHBvaXMgbyBzdmcgdGVtIGFsdHVyYSBkZWZhdWx0IGRlIDE1MHB4LlxyXG4gICAgdGhpcy5hZGRTdmdFbGVtZW50ID0gdHJ1ZTtcclxuICAgIHRoaXMuc2V0Vmlld0JveChoZWlnaHQpO1xyXG4gICAgdGhpcy5zZXRCYXNlQ29vcmRpbmF0ZXMoaGVpZ2h0KTtcclxuXHJcbiAgICBpZiAoIXJhbmdlcy5sZW5ndGgpIHtcclxuICAgICAgdGhpcy5zZXRTaW5nbGVSYW5nZUNvb3JkaW5hdGVzKGhlaWdodCwgdmFsdWUpO1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICB0aGlzLnNldFJhbmdlc0Nvb3JkaW5hdGVzKGhlaWdodCwgdmFsdWUsIHJhbmdlcyk7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIHNldEJhc2VDb29yZGluYXRlcyhoZWlnaHQ6IFBvR2F1Z2VTdmdDb250YWluZXJbJ2hlaWdodCddKTogdm9pZCB7XHJcbiAgICBjb25zdCBlbmRBbmdsZVJhZGlhbiA9IDA7XHJcbiAgICBjb25zdCBjb29yZGluYXRlcyA9IHRoaXMuY2FsY3VsYXRlQ29vcmRpbmF0ZXMoaGVpZ2h0LCBwb0dhdWdlU3RhcnRBbmdsZSwgZW5kQW5nbGVSYWRpYW4pO1xyXG5cclxuICAgIHRoaXMuYmFzZUNvb3JkaW5hdGVzID0geyBjb29yZGluYXRlcyB9O1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBzZXRSYW5nZXNDb29yZGluYXRlcyhoZWlnaHQ6IG51bWJlciwgdmFsdWU6IG51bWJlciA9IDAsIHJhbmdlczogQXJyYXk8UG9HYXVnZVJhbmdlcz4pOiB2b2lkIHtcclxuICAgIGNvbnN0IHsgbWluUmFuZ2UsIG1heFJhbmdlIH0gPSB0aGlzLmNhbGN1bGF0ZU1pbkFuZE1heFZhbHVlcyhyYW5nZXMpO1xyXG5cclxuICAgIGNvbnN0IG1pblZhbHVlID0gdmFsdWUgPCBtaW5SYW5nZSA/IHZhbHVlIDogbWluUmFuZ2U7XHJcbiAgICBjb25zdCBtYXhWYWx1ZSA9IHZhbHVlID4gbWF4UmFuZ2UgPyB2YWx1ZSA6IG1heFJhbmdlO1xyXG5cclxuICAgIHRoaXMuc2V0UG9pbnRlckNvb3JkaW5hdGVzKGhlaWdodCwgdmFsdWUsIG1heFZhbHVlLCBtaW5WYWx1ZSk7XHJcblxyXG4gICAgLy8gYC5yZXZlcnNlKClgIG5vIHTDqXJtaW5vIGRhIGl0ZXJhw6fDo28gcGFyYSB0cmF0YXIgYSBzb2JyZXBvc2ljw6NvIGNvcnJldGEgZGFzIGJvcmRhcyBhcnJlZG9uZGFkYXMgZG9zIHJhbmdlcy5cclxuICAgIGNvbnN0IHJhbmdlc0Nvb3JkaW5hdGVzID0gcmFuZ2VzXHJcbiAgICAgIC5tYXAoKHJhbmdlOiBQb0dhdWdlUmFuZ2VzKSA9PiB7XHJcbiAgICAgICAgY29uc3QgZnJvbSA9IHJhbmdlLmZyb20gPz8gMDtcclxuICAgICAgICBjb25zdCB0byA9IHJhbmdlLnRvID8/IG1heFJhbmdlO1xyXG4gICAgICAgIGNvbnN0IHN0YXJ0QW5nbGVSYWRpYW4gPSBwb0dhdWdlU3RhcnRBbmdsZSArIHRoaXMuY2FsY3VsYXRlQW5nbGVSYWRpdXMoZnJvbSwgbWF4VmFsdWUsIG1pblZhbHVlKTtcclxuICAgICAgICBjb25zdCBlbmRBbmdsZVJhZGlhbiA9IHBvR2F1Z2VTdGFydEFuZ2xlICsgdGhpcy5jYWxjdWxhdGVBbmdsZVJhZGl1cyh0bywgbWF4VmFsdWUsIG1pblZhbHVlKTtcclxuXHJcbiAgICAgICAgY29uc3QgY29vcmRpbmF0ZXMgPSB0aGlzLmNhbGN1bGF0ZUNvb3JkaW5hdGVzKGhlaWdodCwgc3RhcnRBbmdsZVJhZGlhbiwgZW5kQW5nbGVSYWRpYW4pO1xyXG5cclxuICAgICAgICByZXR1cm4geyBjb29yZGluYXRlcywgY29sb3I6IHJhbmdlLmNvbG9yIH07XHJcbiAgICAgIH0pXHJcbiAgICAgIC5yZXZlcnNlKCk7XHJcblxyXG4gICAgdGhpcy5jb29yZGluYXRlcyA9IHJhbmdlc0Nvb3JkaW5hdGVzO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBzZXRTaW5nbGVSYW5nZUNvb3JkaW5hdGVzKGhlaWdodDogUG9HYXVnZVN2Z0NvbnRhaW5lclsnaGVpZ2h0J10sIHZhbHVlOiBudW1iZXIpOiB2b2lkIHtcclxuICAgIGNvbnN0IHZlcmlmaWVkVmFsdWUgPSB2YWx1ZSA+IDEwMCA/IDEwMCA6IHZhbHVlO1xyXG5cclxuICAgIGNvbnN0IGVuZEFuZ2xlUmFkaWFuID0gcG9HYXVnZVN0YXJ0QW5nbGUgKyB0aGlzLmNhbGN1bGF0ZUFuZ2xlUmFkaXVzKHZlcmlmaWVkVmFsdWUsIHBvR2F1Z2VUb3RhbFZhbHVlRGVmYXVsdCk7XHJcblxyXG4gICAgY29uc3QgY29vcmRpbmF0ZXMgPSB2YWx1ZSA+IDAgPyB0aGlzLmNhbGN1bGF0ZUNvb3JkaW5hdGVzKGhlaWdodCwgcG9HYXVnZVN0YXJ0QW5nbGUsIGVuZEFuZ2xlUmFkaWFuKSA6IHVuZGVmaW5lZDtcclxuICAgIGNvbnN0IGNvbG9yID0gUG9EZWZhdWx0Q29sb3JzWzBdWzBdO1xyXG4gICAgdGhpcy5jb29yZGluYXRlcyA9IFt7IGNvb3JkaW5hdGVzLCBjb2xvciB9XTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgc2V0UG9pbnRlckNvb3JkaW5hdGVzKGhlaWdodDogbnVtYmVyLCB2YWx1ZTogbnVtYmVyLCBtYXhWYWx1ZTogbnVtYmVyLCBtaW5WYWx1ZTogbnVtYmVyKSB7XHJcbiAgICBjb25zdCBjb29yZGluYXRlcyA9IHRoaXMuY2FsY3VsYXRlUG9pbnRlckluaXRpYWxDb29yZGluYXRlcyhoZWlnaHQsIHBvR2F1Z2VTdGFydEFuZ2xlKTtcclxuICAgIGNvbnN0IHBvaW50ZXJEZWdyZWVzID0gdGhpcy5wb2ludGVyUm90YXRpb24odmFsdWUsIG1heFZhbHVlLCBtaW5WYWx1ZSk7XHJcblxyXG4gICAgdGhpcy5wb2ludGVyQ29vcmRpbmF0ZXMgPSB7IC4uLmNvb3JkaW5hdGVzLCBwb2ludGVyRGVncmVlcyB9O1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBwb2ludGVyUm90YXRpb24odmFsdWU6IG51bWJlciwgbWF4VmFsdWU6IG51bWJlciwgbWluVmFsdWU6IG51bWJlcikge1xyXG4gICAgY29uc3QgcGVyY2VudCA9IHRoaXMuY29udmVydFZhbHVlVG9QZXJjZW50YWdlKHZhbHVlLCBtYXhWYWx1ZSwgbWluVmFsdWUpO1xyXG4gICAgLy8gdmFsb3JlcyByZWZlcmVudGVzIMOgcyBhbmd1bGHDp8O1ZXMgbcOtbmltYXMgZSBtw6F4aW1hcyBkbyBwb250ZWlyby5cclxuICAgIGNvbnN0IG1pblJvdGF0aW9uID0gMDtcclxuICAgIGNvbnN0IG1heFJvdGF0aW9uID0gMTgwO1xyXG5cclxuICAgIHJldHVybiAocGVyY2VudCAqIChtYXhSb3RhdGlvbiAtIG1pblJvdGF0aW9uKSkgLyAxMDAgKyBtaW5Sb3RhdGlvbjtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgY2FsY3VsYXRlUG9pbnRlckluaXRpYWxDb29yZGluYXRlcyhoZWlnaHQ6IG51bWJlciwgc3RhcnRBbmdsZVJhZGlhbjogbnVtYmVyKSB7XHJcbiAgICBjb25zdCByYWRpdXMgPSBoZWlnaHQgLSBQb0dhdWdlUG9pbnRlckVuZCAtIFBvR2F1Z2VUaGlja25lc3MgLyAyO1xyXG5cclxuICAgIC8vIFZhbG9yIHF1ZSByZXByZXNlbnRhIGEgZXNjYWxhIGRvIHBvbnRlaXJvIHBhcmEgcGxvdGFnZW0uXHJcbiAgICBjb25zdCBzY2FsZSA9IDQwO1xyXG4gICAgY29uc3QgcG9pbnRlclNjYWxlZFdpZHRoID0gcmFkaXVzIC8gc2NhbGU7XHJcbiAgICBjb25zdCBwb2ludGVyU2NhbGVkQm9yZGVyUmFkaXVzID0gcmFkaXVzIC8gKHNjYWxlICogMik7XHJcblxyXG4gICAgY29uc3Qgc2luQWxwaGEgPSBNYXRoLnNpbihzdGFydEFuZ2xlUmFkaWFuKTtcclxuICAgIGNvbnN0IGNvc0FscGhhID0gTWF0aC5jb3Moc3RhcnRBbmdsZVJhZGlhbik7XHJcblxyXG4gICAgY29uc3QgdGFyZ2V0WCA9IHJhZGl1cyArIGNvc0FscGhhICogcmFkaXVzO1xyXG4gICAgY29uc3QgdGFyZ2V0WSA9IHJhZGl1cyArIHNpbkFscGhhICogcmFkaXVzO1xyXG5cclxuICAgIGNvbnN0IHN0YXJ0WCA9IHJhZGl1cztcclxuICAgIGNvbnN0IHN0YXJ0WSA9IHJhZGl1cyArIHBvaW50ZXJTY2FsZWRXaWR0aDtcclxuXHJcbiAgICBjb25zdCBlbmRYID0gcmFkaXVzO1xyXG4gICAgY29uc3QgZW5kWSA9IHJhZGl1cyAtIHBvaW50ZXJTY2FsZWRXaWR0aDtcclxuXHJcbiAgICBjb25zdCBjb29yZGluYXRlcyA9IFtcclxuICAgICAgJ00nLFxyXG4gICAgICBzdGFydFgsXHJcbiAgICAgIHN0YXJ0WSxcclxuICAgICAgJ0wnLFxyXG4gICAgICB0YXJnZXRYLFxyXG4gICAgICB0YXJnZXRZICsgcG9pbnRlclNjYWxlZEJvcmRlclJhZGl1cyxcclxuICAgICAgJ0EnLFxyXG4gICAgICAxLFxyXG4gICAgICAxLFxyXG4gICAgICAwLFxyXG4gICAgICAnMCwxJyxcclxuICAgICAgdGFyZ2V0WCxcclxuICAgICAgdGFyZ2V0WSAtIHBvaW50ZXJTY2FsZWRCb3JkZXJSYWRpdXMsXHJcbiAgICAgICdMJyxcclxuICAgICAgZW5kWCxcclxuICAgICAgZW5kWSxcclxuICAgICAgJ1onXHJcbiAgICBdLmpvaW4oJyAnKTtcclxuXHJcbiAgICByZXR1cm4geyBjb29yZGluYXRlcywgcmFkaXVzIH07XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGNhbGN1bGF0ZUNvb3JkaW5hdGVzKFxyXG4gICAgaGVpZ2h0OiBQb0dhdWdlU3ZnQ29udGFpbmVyWydoZWlnaHQnXSxcclxuICAgIHN0YXJ0QW5nbGVSYWRpYW46IG51bWJlcixcclxuICAgIGVuZEFuZ2xlUmFkaWFuOiBudW1iZXJcclxuICApOiBQb0dhdWdlQ29vcmRpbmF0ZXNbJ2Nvb3JkaW5hdGVzJ10ge1xyXG4gICAgLy8gU3VidHJhaSBhbHR1cmEgcGVsbyBleGNlZGVudGUgcG9udGVpcm8gZW0gcmVsYcOnw6NvIGFvIGdyw6FmaWNvLCBwZWxhIG1ldGFkZSBkbyB2YWxvciBkYSBjb3JvYSBjaXJjdWxhci5cclxuICAgIGNvbnN0IHJhZGl1cyA9IGhlaWdodCAtIFBvR2F1Z2VQb2ludGVyRW5kIC0gUG9HYXVnZVRoaWNrbmVzcyAvIDI7XHJcbiAgICBjb25zdCBpbm5lclJhZGl1cyA9IHJhZGl1cyAtIFBvR2F1Z2VUaGlja25lc3M7XHJcblxyXG4gICAgY29uc3Qgc2luQWxwaGEgPSBNYXRoLnNpbihzdGFydEFuZ2xlUmFkaWFuKTtcclxuICAgIGNvbnN0IGNvc0FscGhhID0gTWF0aC5jb3Moc3RhcnRBbmdsZVJhZGlhbik7XHJcblxyXG4gICAgY29uc3Qgc2luQmV0YSA9IE1hdGguc2luKGVuZEFuZ2xlUmFkaWFuKTtcclxuICAgIGNvbnN0IGNvc0JldGEgPSBNYXRoLmNvcyhlbmRBbmdsZVJhZGlhbik7XHJcblxyXG4gICAgY29uc3Qgc3RhcnRYID0gTWF0aC5yb3VuZChyYWRpdXMgKyBjb3NBbHBoYSAqIHJhZGl1cyk7XHJcbiAgICBjb25zdCBzdGFydFkgPSBNYXRoLnJvdW5kKHJhZGl1cyArIHNpbkFscGhhICogcmFkaXVzKTtcclxuXHJcbiAgICBjb25zdCBlbmRYID0gTWF0aC5yb3VuZChyYWRpdXMgKyBjb3NCZXRhICogcmFkaXVzKTtcclxuICAgIGNvbnN0IGVuZFkgPSBNYXRoLnJvdW5kKHJhZGl1cyArIHNpbkJldGEgKiByYWRpdXMpO1xyXG5cclxuICAgIGNvbnN0IHN0YXJ0SW5uZXJYID0gTWF0aC5yb3VuZChyYWRpdXMgKyBjb3NBbHBoYSAqIGlubmVyUmFkaXVzKTtcclxuICAgIGNvbnN0IHN0YXJ0SW5uZXJZID0gTWF0aC5yb3VuZChyYWRpdXMgKyBzaW5BbHBoYSAqIGlubmVyUmFkaXVzKTtcclxuXHJcbiAgICBjb25zdCBlbmRJbm5lclggPSBNYXRoLnJvdW5kKHJhZGl1cyArIGNvc0JldGEgKiBpbm5lclJhZGl1cyk7XHJcbiAgICBjb25zdCBlbmRJbm5lclkgPSBNYXRoLnJvdW5kKHJhZGl1cyArIHNpbkJldGEgKiBpbm5lclJhZGl1cyk7XHJcblxyXG4gICAgcmV0dXJuIFtcclxuICAgICAgJ00nLFxyXG4gICAgICBzdGFydFgsXHJcbiAgICAgIHN0YXJ0WSxcclxuICAgICAgJ0EnLFxyXG4gICAgICByYWRpdXMsXHJcbiAgICAgIHJhZGl1cyxcclxuICAgICAgMCxcclxuICAgICAgJzAsMScsXHJcbiAgICAgIGVuZFgsXHJcbiAgICAgIGVuZFksXHJcbiAgICAgICdBJyxcclxuICAgICAgMSxcclxuICAgICAgMSxcclxuICAgICAgMCxcclxuICAgICAgJzAsMScsXHJcbiAgICAgIGVuZElubmVyWCxcclxuICAgICAgZW5kSW5uZXJZLFxyXG4gICAgICAnQScsXHJcbiAgICAgIGlubmVyUmFkaXVzLFxyXG4gICAgICBpbm5lclJhZGl1cyxcclxuICAgICAgMCxcclxuICAgICAgJzAsMCcsXHJcbiAgICAgIHN0YXJ0SW5uZXJYLFxyXG4gICAgICBzdGFydElubmVyWSxcclxuICAgICAgJ0EnLFxyXG4gICAgICAxLFxyXG4gICAgICAxLFxyXG4gICAgICAwLFxyXG4gICAgICAnMCwxJyxcclxuICAgICAgc3RhcnRYLFxyXG4gICAgICBzdGFydFksXHJcbiAgICAgICdaJ1xyXG4gICAgXS5qb2luKCcgJyk7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGNhbGN1bGF0ZUFuZ2xlUmFkaXVzKHZhbHVlOiBudW1iZXIsIG1heFZhbHVlOiBudW1iZXIsIG1pblZhbHVlOiBudW1iZXIgPSAwKTogbnVtYmVyIHtcclxuICAgIGNvbnN0IGFuZ2xlID0gKCh2YWx1ZSAtIG1pblZhbHVlKSAvIChtYXhWYWx1ZSAtIG1pblZhbHVlKSkgKiAoTWF0aC5QSSAqIDIpO1xyXG5cclxuICAgIHJldHVybiBhbmdsZSAvIDI7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGNvbnZlcnRWYWx1ZVRvUGVyY2VudGFnZSh2YWx1ZTogbnVtYmVyLCBtYXhWYWx1ZTogbnVtYmVyLCBtaW5WYWx1ZSk6IG51bWJlciB7XHJcbiAgICByZXR1cm4gKCh2YWx1ZSAtIG1pblZhbHVlKSAvIChtYXhWYWx1ZSAtIG1pblZhbHVlKSkgKiAxMDA7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIHNldFZpZXdCb3goaGVpZ2h0OiBudW1iZXIpOiB2b2lkIHtcclxuICAgIGNvbnN0IHdpZHRoID0gdGhpcy5jYWxjdWxhdGVEaWFtZXRlcihoZWlnaHQpO1xyXG5cclxuICAgIHRoaXMudmlld0JveCA9IGAwICR7LVBvR2F1Z2VQb2ludGVyRW5kfSAke3dpZHRofSAke2hlaWdodH1gO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBjYWxjdWxhdGVEaWFtZXRlcihoZWlnaHQ6IG51bWJlcik6IG51bWJlciB7XHJcbiAgICBjb25zdCByYWRpdXMgPSBoZWlnaHQgLSBQb0dhdWdlUG9pbnRlckVuZCAtIFBvR2F1Z2VUaGlja25lc3MgLyAyO1xyXG5cclxuICAgIHJldHVybiByYWRpdXMgKyBNYXRoLmNvcygwKSAqIHJhZGl1cztcclxuICB9XHJcblxyXG4gIHByaXZhdGUgY2FsY3VsYXRlTWluQW5kTWF4VmFsdWVzKHJhbmdlczogQXJyYXk8UG9HYXVnZVJhbmdlcz4pIHtcclxuICAgIGNvbnN0IG1pblJhbmdlID0gdGhpcy5nZXREb21haW4ocmFuZ2VzLCAnbWluJyk7XHJcbiAgICBjb25zdCBtYXhSYW5nZSA9IHRoaXMuZ2V0RG9tYWluKHJhbmdlcywgJ21heCcpO1xyXG5cclxuICAgIHJldHVybiB7XHJcbiAgICAgIG1pblJhbmdlOiB0aGlzLnZlcmlmeUlmRmxvYXRPckludGVnZXIobWluUmFuZ2UpID8gbWluUmFuZ2UgOiAwLFxyXG4gICAgICBtYXhSYW5nZTogdGhpcy52ZXJpZnlJZkZsb2F0T3JJbnRlZ2VyKG1heFJhbmdlKSA/IG1heFJhbmdlIDogMTAwXHJcbiAgICB9O1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSB2ZXJpZnlJZkZsb2F0T3JJbnRlZ2VyKG51bWJlcjogbnVtYmVyKSB7XHJcbiAgICBjb25zdCBub3RBQm9vbGVhbiA9IHR5cGVvZiBudW1iZXIgIT09ICdib29sZWFuJztcclxuICAgIGNvbnN0IG5vdEluZmluaXR5ID0gbnVtYmVyICE9PSBJbmZpbml0eTtcclxuXHJcbiAgICBjb25zdCBpc0ludGVnZXIgPSBOdW1iZXIobnVtYmVyKSA9PT0gbnVtYmVyICYmIG51bWJlciAlIDEgPT09IDAgJiYgbm90SW5maW5pdHk7XHJcbiAgICBjb25zdCBpc0Zsb2F0ID0gTnVtYmVyKG51bWJlcikgPT09IG51bWJlciAmJiBudW1iZXIgJSAxICE9PSAwICYmIG5vdEluZmluaXR5O1xyXG5cclxuICAgIHJldHVybiAobm90QUJvb2xlYW4gJiYgaXNJbnRlZ2VyKSB8fCAobm90QUJvb2xlYW4gJiYgaXNGbG9hdCk7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGdldERvbWFpbihyYW5nZXM6IEFycmF5PFBvR2F1Z2VSYW5nZXM+LCB0eXBlOiBzdHJpbmcpOiBudW1iZXIge1xyXG4gICAgY29uc3QgcmFuZ2VUeXBlID0geyBtaW46ICdmcm9tJywgbWF4OiAndG8nIH07XHJcblxyXG4gICAgcmV0dXJuIE1hdGhbdHlwZV0oLi4ucmFuZ2VzLm1hcChyYW5nZSA9PiByYW5nZVtyYW5nZVR5cGVbdHlwZV1dKSk7XHJcbiAgfVxyXG59XHJcbiJdfQ==