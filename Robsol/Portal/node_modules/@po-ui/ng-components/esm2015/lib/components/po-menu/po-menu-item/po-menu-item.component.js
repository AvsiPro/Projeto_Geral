import { Component, Input, ViewChild } from '@angular/core';
import { convertToInt, convertToBoolean } from '../../../utils/util';
import { PoMenuItemsService } from '../services/po-menu-items.service';
// valor para que caibam 3 linhas de `label`
const poMenuItemSubItemSize = 98;
/**
 * @docsPrivate
 *
 * @description
 *
 * Componente que implementa cada item do po-menu.
 */
export class PoMenuItemComponent {
    constructor(menuItemsService) {
        this.menuItemsService = menuItemsService;
        this.maxHeight = 0;
        this._isSelected = false;
        this._isSubItem = false;
    }
    // Valor do badge.
    set badgeValue(badgeValue) {
        this._badgeValue = convertToInt(badgeValue);
    }
    get badgeValue() {
        return this._badgeValue;
    }
    // Indica se o item está selecionado.
    set isSelected(value) {
        this._isSelected = convertToBoolean(value);
        this.isSelectedSubItem = this.isSelected && this.isSubItem;
    }
    get isSelected() {
        return this._isSelected;
    }
    // Indica se o item é um sub item
    set isSubItem(value) {
        this._isSubItem = convertToBoolean(value);
    }
    get isSubItem() {
        return this._isSubItem;
    }
    // Lista de sub-items.
    set subItems(subitems) {
        this._subItems = subitems;
        if (this.isOpened) {
            this.calcMenuSubItemsMaxHeight();
        }
    }
    get subItems() {
        return this._subItems;
    }
    get canShowBadge() {
        return this.type !== 'subItems' && (this.badgeValue || this.badgeValue === 0) && this.badgeValue >= 0;
    }
    ngOnDestroy() {
        this.itemSubscription.unsubscribe();
    }
    ngOnInit() {
        // subscribe to menu component messages
        this.itemSubscription = this.menuItemsService.receiveFromParentMenuClicked().subscribe(menu => {
            this.processMenuItem(menu);
        });
    }
    clickMenuItem(event) {
        if (!(event.ctrlKey || event.metaKey)) {
            event.preventDefault();
            // Emmit to parent
            this.menuItemsService.sendToParentMenuClicked({
                link: this.link,
                action: this.action,
                id: this.id,
                icon: this.icon,
                label: this.label,
                level: this.level,
                subItems: this.subItems,
                isSelected: this.isSelected,
                isOpened: this.isOpened,
                shortLabel: this.shortLabel,
                type: this.type
            });
        }
    }
    accordionAnimation(menuActive, menuOpened, hasSubItemOpened, activatedByRoute) {
        if (this.id === menuOpened['id']) {
            this.maxHeight = this.subItems.length * poMenuItemSubItemSize;
        }
        if (hasSubItemOpened) {
            this.maxHeight = menuOpened['isOpened']
                ? this.maxHeight + menuOpened.subItems.length * poMenuItemSubItemSize
                : this.maxHeight - menuOpened.subItems.length * poMenuItemSubItemSize;
            if (activatedByRoute) {
                this.maxHeight = this.getMinimumHeight(0, this, menuActive);
            }
        }
    }
    activateMenu(menu) {
        this.isSelected = menu && this.id === menu.id;
    }
    calcMenuSubItemsMaxHeight() {
        setTimeout(() => {
            const subItems = Array.from(this.menuSubItems.nativeElement.querySelectorAll('.po-menu-item'));
            subItems.forEach((menuItem) => (this.maxHeight += menuItem.offsetHeight));
        });
    }
    getMinimumHeight(minimumHeight, menuItem, menuActive) {
        minimumHeight += poMenuItemSubItemSize;
        if (menuItem.subItems && this.hasSubItem(menuItem.subItems, menuActive['id'])) {
            for (let index = 0; index < menuItem.subItems.length; index++) {
                minimumHeight = this.getMinimumHeight(minimumHeight, menuItem.subItems[index], menuActive);
            }
        }
        return minimumHeight;
    }
    groupedMenu(menuActive, menuOpened, activatedByRoute = false) {
        const hasSubItemOpened = menuOpened && this.id !== menuOpened['id'] ? this.hasSubItem(this.subItems, menuOpened['id']) : false;
        this.isOpened = this.isMenuOpened(menuOpened, hasSubItemOpened);
        this.isSelected = menuActive && !this.isOpened ? this.hasSubItem(this.subItems, menuActive['id']) : false;
        if (!this.isOpened) {
            this.maxHeight = 0;
            return;
        }
        this.accordionAnimation(menuActive, menuOpened, hasSubItemOpened, activatedByRoute);
    }
    hasSubItem(subItems, id) {
        if (subItems) {
            return subItems.some(item => (item['id'] === id ? true : this.hasSubItem(item.subItems, id)));
        }
    }
    isMenuOpened(menuOpened, hasSubItemOpened) {
        if (menuOpened) {
            return this.id === menuOpened['id'] ? menuOpened['isOpened'] : hasSubItemOpened;
        }
        return false;
    }
    processMenuItem(menu) {
        if (this.type === 'internalLink') {
            this.activateMenu(menu.active);
            return;
        }
        if (this.type === 'subItems') {
            this.groupedMenu(menu.active, menu.grouped, menu.activatedByRoute);
        }
    }
}
PoMenuItemComponent.decorators = [
    { type: Component, args: [{
                selector: 'po-menu-item',
                template: "<!-- menu com link interno -->\r\n<a *ngIf=\"type === 'internalLink'\" class=\"po-menu-item-link\" [routerLink]=\"link\">\r\n  <ng-container *ngTemplateOutlet=\"menuItemTemplate\"></ng-container>\r\n</a>\r\n<!-- menu com link externo -->\r\n<a *ngIf=\"type === 'externalLink'\" class=\"po-menu-item-link\" [href]=\"link\">\r\n  <ng-container *ngTemplateOutlet=\"menuItemTemplate\"></ng-container>\r\n</a>\r\n<!-- menu sem link -->\r\n<a *ngIf=\"type === 'noLink'\" class=\"po-menu-item-link\" href=\"javascript:;\">\r\n  <ng-container *ngTemplateOutlet=\"menuItemTemplate\"></ng-container>\r\n</a>\r\n<!-- menu com sub itens -->\r\n<div *ngIf=\"type === 'subItems'\" class=\"po-menu-item-link po-clickable\">\r\n  <ng-container *ngTemplateOutlet=\"menuItemTemplate\"></ng-container>\r\n  <div #menuSubItems class=\"po-menu-sub-items\" [hidden]=\"collapsedMenu\" [style.maxHeight.px]=\"maxHeight\">\r\n    <div *ngFor=\"let subItem of subItems\">\r\n      <po-menu-item\r\n        p-is-sub-item\r\n        [p-action]=\"subItem.action\"\r\n        [p-badge-alert]=\"subItem.badgeAlert\"\r\n        [p-badge-color]=\"subItem.badge ? subItem.badge.color : undefined\"\r\n        [p-badge-value]=\"subItem.badge ? subItem.badge.value : undefined\"\r\n        [p-id]=\"subItem.id\"\r\n        [p-label]=\"subItem.label\"\r\n        [p-level]=\"subItem.level\"\r\n        [p-link]=\"subItem.link\"\r\n        [p-sub-items]=\"subItem.subItems\"\r\n        [p-type]=\"subItem.type\"\r\n      >\r\n      </po-menu-item>\r\n    </div>\r\n  </div>\r\n</div>\r\n\r\n<ng-template #menuItemTemplate>\r\n  <div\r\n    class=\"po-menu-item\"\r\n    [class.po-menu-icon-container]=\"level === 1 && icon\"\r\n    [class.po-menu-item-selected]=\"isSelected\"\r\n    [class.po-menu-item-level-two]=\"level === 2\"\r\n    [class.po-menu-item-level-three]=\"level === 3\"\r\n    [class.po-menu-item-level-four]=\"level === 4\"\r\n    [class.po-menu-item-grouper-up]=\"type === 'subItems' && isOpened\"\r\n    [class.po-menu-item-grouper-down]=\"type === 'subItems' && !isOpened\"\r\n    [class.po-menu-sub-item-selected]=\"isSelectedSubItem\"\r\n    (click)=\"clickMenuItem($event)\"\r\n  >\r\n    <po-badge\r\n      *ngIf=\"canShowBadge\"\r\n      [ngClass]=\"!collapsedMenu ? 'po-menu-badge-align' : 'po-menu-badge-align-collapsed'\"\r\n      [p-color]=\"badgeColor\"\r\n      [p-value]=\"badgeValue\"\r\n    >\r\n    </po-badge>\r\n    <po-icon *ngIf=\"level === 1 && icon\" class=\"po-menu-icon-item\" [p-icon]=\"icon\"></po-icon>\r\n    <div\r\n      *ngIf=\"badgeAlert\"\r\n      class=\"po-color-07\"\r\n      [ngClass]=\"!collapsedMenu ? 'po-menu-badge-alert' : 'po-menu-badge-alert-collapsed'\"\r\n    ></div>\r\n    <span\r\n      *ngIf=\"type === 'subItems' && !collapsedMenu\"\r\n      class=\"po-icon po-menu-group-icon\"\r\n      [class.po-icon-arrow-up]=\"isOpened\"\r\n      [class.po-icon-arrow-down]=\"!isOpened\"\r\n    >\r\n    </span>\r\n    <div [class.po-menu-icon-label]=\"level === 1 && icon\">\r\n      {{ label }}\r\n    </div>\r\n    <div *ngIf=\"collapsedMenu\" class=\"po-menu-short-label\">{{ shortLabel }}</div>\r\n  </div>\r\n</ng-template>\r\n"
            },] }
];
PoMenuItemComponent.ctorParameters = () => [
    { type: PoMenuItemsService }
];
PoMenuItemComponent.propDecorators = {
    action: [{ type: Input, args: ['p-action',] }],
    badgeAlert: [{ type: Input, args: ['p-badge-alert',] }],
    badgeColor: [{ type: Input, args: ['p-badge-color',] }],
    collapsedMenu: [{ type: Input, args: ['p-collapsed-menu',] }],
    icon: [{ type: Input, args: ['p-icon',] }],
    id: [{ type: Input, args: ['p-id',] }],
    isOpened: [{ type: Input, args: ['p-is-opened',] }],
    label: [{ type: Input, args: ['p-label',] }],
    level: [{ type: Input, args: ['p-level',] }],
    link: [{ type: Input, args: ['p-link',] }],
    shortLabel: [{ type: Input, args: ['p-short-label',] }],
    type: [{ type: Input, args: ['p-type',] }],
    menuSubItems: [{ type: ViewChild, args: ['menuSubItems',] }],
    badgeValue: [{ type: Input, args: ['p-badge-value',] }],
    isSelected: [{ type: Input, args: ['p-is-selected',] }],
    isSubItem: [{ type: Input, args: ['p-is-sub-item',] }],
    subItems: [{ type: Input, args: ['p-sub-items',] }]
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG8tbWVudS1pdGVtLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL3VpL3NyYy9saWIvY29tcG9uZW50cy9wby1tZW51L3BvLW1lbnUtaXRlbS9wby1tZW51LWl0ZW0uY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQWMsS0FBSyxFQUFrQyxTQUFTLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFJeEcsT0FBTyxFQUFFLFlBQVksRUFBRSxnQkFBZ0IsRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBR3JFLE9BQU8sRUFBRSxrQkFBa0IsRUFBRSxNQUFNLG1DQUFtQyxDQUFDO0FBRXZFLDRDQUE0QztBQUM1QyxNQUFNLHFCQUFxQixHQUFHLEVBQUUsQ0FBQztBQUVqQzs7Ozs7O0dBTUc7QUFLSCxNQUFNLE9BQU8sbUJBQW1CO0lBNEY5QixZQUFvQixnQkFBb0M7UUFBcEMscUJBQWdCLEdBQWhCLGdCQUFnQixDQUFvQjtRQXBEeEQsY0FBUyxHQUFXLENBQUMsQ0FBQztRQUlkLGdCQUFXLEdBQVksS0FBSyxDQUFDO1FBQzdCLGVBQVUsR0FBWSxLQUFLLENBQUM7SUErQ3VCLENBQUM7SUE1QzVELGtCQUFrQjtJQUNsQixJQUE0QixVQUFVLENBQUMsVUFBa0I7UUFDdkQsSUFBSSxDQUFDLFdBQVcsR0FBRyxZQUFZLENBQUMsVUFBVSxDQUFDLENBQUM7SUFDOUMsQ0FBQztJQUVELElBQUksVUFBVTtRQUNaLE9BQU8sSUFBSSxDQUFDLFdBQVcsQ0FBQztJQUMxQixDQUFDO0lBRUQscUNBQXFDO0lBQ3JDLElBQTRCLFVBQVUsQ0FBQyxLQUFjO1FBQ25ELElBQUksQ0FBQyxXQUFXLEdBQUcsZ0JBQWdCLENBQUMsS0FBSyxDQUFDLENBQUM7UUFFM0MsSUFBSSxDQUFDLGlCQUFpQixHQUFHLElBQUksQ0FBQyxVQUFVLElBQUksSUFBSSxDQUFDLFNB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QUFlO3dCQVVyQixLQUFLLFNBQUMsZUFBZTt1QkFTckIsS0FBSyxTQUFDLGFBQWEiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIEVsZW1lbnRSZWYsIElucHV0LCBPbkRlc3Ryb3ksIE9uSW5pdCwgVGVtcGxhdGVSZWYsIFZpZXdDaGlsZCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5cclxuaW1wb3J0IHsgU3Vic2NyaXB0aW9uIH0gZnJvbSAncnhqcyc7XHJcblxyXG5pbXBvcnQgeyBjb252ZXJ0VG9JbnQsIGNvbnZlcnRUb0Jvb2xlYW4gfSBmcm9tICcuLi8uLi8uLi91dGlscy91dGlsJztcclxuXHJcbmltcG9ydCB7IFBvTWVudUl0ZW0gfSBmcm9tICcuLi9wby1tZW51LWl0ZW0uaW50ZXJmYWNlJztcclxuaW1wb3J0IHsgUG9NZW51SXRlbXNTZXJ2aWNlIH0gZnJvbSAnLi4vc2VydmljZXMvcG8tbWVudS1pdGVtcy5zZXJ2aWNlJztcclxuXHJcbi8vIHZhbG9yIHBhcmEgcXVlIGNhaWJhbSAzIGxpbmhhcyBkZSBgbGFiZWxgXHJcbmNvbnN0IHBvTWVudUl0ZW1TdWJJdGVtU2l6ZSA9IDk4O1xyXG5cclxuLyoqXHJcbiAqIEBkb2NzUHJpdmF0ZVxyXG4gKlxyXG4gKiBAZGVzY3JpcHRpb25cclxuICpcclxuICogQ29tcG9uZW50ZSBxdWUgaW1wbGVtZW50YSBjYWRhIGl0ZW0gZG8gcG8tbWVudS5cclxuICovXHJcbkBDb21wb25lbnQoe1xyXG4gIHNlbGVjdG9yOiAncG8tbWVudS1pdGVtJyxcclxuICB0ZW1wbGF0ZVVybDogJy4vcG8tbWVudS1pdGVtLmNvbXBvbmVudC5odG1sJ1xyXG59KVxyXG5leHBvcnQgY2xhc3MgUG9NZW51SXRlbUNvbXBvbmVudCBpbXBsZW1lbnRzIE9uRGVzdHJveSwgT25Jbml0IHtcclxuICAvLyBBw6fDo28gcXVlIHNlcsOhIGNoYW1hZGEgYW8gY2xpY2FyIG5vIGl0ZW0uXHJcbiAgQElucHV0KCdwLWFjdGlvbicpIGFjdGlvbjogRnVuY3Rpb247XHJcblxyXG4gIC8vIEluZGljYSBzZSBjb250w6ltIGFsZ3VtIGl0ZW0gZmlsaG8gY29tIG8gYmFkZ2UuXHJcbiAgQElucHV0KCdwLWJhZGdlLWFsZXJ0JykgYmFkZ2VBbGVydDogYm9vbGVhbjtcclxuXHJcbiAgLy8gQ29yIGRvIGJhZGdlLlxyXG4gIEBJbnB1dCgncC1iYWRnZS1jb2xvcicpIGJhZGdlQ29sb3I6IHN0cmluZztcclxuXHJcbiAgLy8gSW5kaWNhIHNlIG8gbWVudSBlc3TDoSBjb2xhcHNhZG9cclxuICBASW5wdXQoJ3AtY29sbGFwc2VkLW1lbnUnKSBjb2xsYXBzZWRNZW51OiBib29sZWFuO1xyXG5cclxuICAvLyDDjWNvbmUgZGUgbWVudVxyXG4gIEBJbnB1dCgncC1pY29uJykgaWNvbjogc3RyaW5nIHwgVGVtcGxhdGVSZWY8dm9pZD47XHJcblxyXG4gIC8vIElkZW50aWZpY2Fkb3IgZG8gaXRlbS5cclxuICBASW5wdXQoJ3AtaWQnKSBpZDogc3RyaW5nO1xyXG5cclxuICAvLyBJbmRpY2Egc2UgbyBpdGVtIGVzdMOhIGFiZXJ0byAobWVudSBhZ3J1cGFkbylcclxuICBASW5wdXQoJ3AtaXMtb3BlbmVkJykgaXNPcGVuZWQ6IGJvb2xlYW47XHJcblxyXG4gIC8vIFRleHRvIHF1ZSBhcGFyZWNlcsOhIHJlcHJlc2VudGFuZG8gbyBpdGVtLlxyXG4gIEBJbnB1dCgncC1sYWJlbCcpIGxhYmVsOiBzdHJpbmc7XHJcblxyXG4gIC8vIEluZGljYSBxdWFsIGVtIG7DrXZlbCBkbyBwby1tZW51IGVuY29udHJhLXNlLlxyXG4gIEBJbnB1dCgncC1sZXZlbCcpIGxldmVsOiBudW1iZXI7XHJcblxyXG4gIC8vIExpbmsgZG8gaXRlbS5cclxuICBASW5wdXQoJ3AtbGluaycpIGxpbms/OiBzdHJpbmc7XHJcblxyXG4gIC8vIFRleHRvIHF1ZSBhcGFyZWNlcsOhIHJlcHJlc2VudGFuZG8gbyBpdGVtLlxyXG4gIEBJbnB1dCgncC1zaG9ydC1sYWJlbCcpIHNob3J0TGFiZWw6IHN0cmluZztcclxuXHJcbiAgLy8gSW5kaWNhIG8gdGlwbyBkZSBpdGVtLCBjb21vICdpbnRlcm5hbExpbmsnIG91ICdzdWJJdGVtcycuXHJcbiAgQElucHV0KCdwLXR5cGUnKSB0eXBlOiBzdHJpbmc7XHJcblxyXG4gIEBWaWV3Q2hpbGQoJ21lbnVTdWJJdGVtcycpIG1lbnVTdWJJdGVtczogRWxlbWVudFJlZjtcclxuXHJcbiAgaXNTZWxlY3RlZFN1Ykl0ZW07XHJcbiAgbWF4SGVpZ2h0OiBudW1iZXIgPSAwO1xyXG5cclxuICBwcml2YXRlIGl0ZW1TdWJzY3JpcHRpb246IFN1YnNjcmlwdGlvbjtcclxuICBwcml2YXRlIF9iYWRnZVZhbHVlOiBudW1iZXI7XHJcbiAgcHJpdmF0ZSBfaXNTZWxlY3RlZDogYm9vbGVhbiA9IGZhbHNlO1xyXG4gIHByaXZhdGUgX2lzU3ViSXRlbTogYm9vbGVhbiA9IGZhbHNlO1xyXG4gIHByaXZhdGUgX3N1Ykl0ZW1zOiBBcnJheTxQb01lbnVJdGVtPjtcclxuXHJcbiAgLy8gVmFsb3IgZG8gYmFkZ2UuXHJcbiAgQElucHV0KCdwLWJhZGdlLXZhbHVlJykgc2V0IGJhZGdlVmFsdWUoYmFkZ2VWYWx1ZTogbnVtYmVyKSB7XHJcbiAgICB0aGlzLl9iYWRnZVZhbHVlID0gY29udmVydFRvSW50KGJhZGdlVmFsdWUpO1xyXG4gIH1cclxuXHJcbiAgZ2V0IGJhZGdlVmFsdWUoKSB7XHJcbiAgICByZXR1cm4gdGhpcy5fYmFkZ2VWYWx1ZTtcclxuICB9XHJcblxyXG4gIC8vIEluZGljYSBzZSBvIGl0ZW0gZXN0w6Egc2VsZWNpb25hZG8uXHJcbiAgQElucHV0KCdwLWlzLXNlbGVjdGVkJykgc2V0IGlzU2VsZWN0ZWQodmFsdWU6IGJvb2xlYW4pIHtcclxuICAgIHRoaXMuX2lzU2VsZWN0ZWQgPSBjb252ZXJ0VG9Cb29sZWFuKHZhbHVlKTtcclxuXHJcbiAgICB0aGlzLmlzU2VsZWN0ZWRTdWJJdGVtID0gdGhpcy5pc1NlbGVjdGVkICYmIHRoaXMuaXNTdWJJdGVtO1xyXG4gIH1cclxuICBnZXQgaXNTZWxlY3RlZCgpIHtcclxuICAgIHJldHVybiB0aGlzLl9pc1NlbGVjdGVkO1xyXG4gIH1cclxuXHJcbiAgLy8gSW5kaWNhIHNlIG8gaXRlbSDDqSB1bSBzdWIgaXRlbVxyXG4gIEBJbnB1dCgncC1pcy1zdWItaXRlbScpIHNldCBpc1N1Ykl0ZW0odmFsdWU6IGJvb2xlYW4pIHtcclxuICAgIHRoaXMuX2lzU3ViSXRlbSA9IGNvbnZlcnRUb0Jvb2xlYW4odmFsdWUpO1xyXG4gIH1cclxuXHJcbiAgZ2V0IGlzU3ViSXRlbSgpIHtcclxuICAgIHJldHVybiB0aGlzLl9pc1N1Ykl0ZW07XHJcbiAgfVxyXG5cclxuICAvLyBMaXN0YSBkZSBzdWItaXRlbXMuXHJcbiAgQElucHV0KCdwLXN1Yi1pdGVtcycpIHNldCBzdWJJdGVtcyhzdWJpdGVtczogQXJyYXk8UG9NZW51SXRlbT4pIHtcclxuICAgIHRoaXMuX3N1Ykl0ZW1zID0gc3ViaXRlbXM7XHJcbiAgICBpZiAodGhpcy5pc09wZW5lZCkge1xyXG4gICAgICB0aGlzLmNhbGNNZW51U3ViSXRlbXNNYXhIZWlnaHQoKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIGdldCBzdWJJdGVtcygpIHtcclxuICAgIHJldHVybiB0aGlzLl9zdWJJdGVtcztcclxuICB9XHJcblxyXG4gIGdldCBjYW5TaG93QmFkZ2UoKSB7XHJcbiAgICByZXR1cm4gdGhpcy50eXBlICE9PSAnc3ViSXRlbXMnICYmICh0aGlzLmJhZGdlVmFsdWUgfHwgdGhpcy5iYWRnZVZhbHVlID09PSAwKSAmJiB0aGlzLmJhZGdlVmFsdWUgPj0gMDtcclxuICB9XHJcblxyXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgbWVudUl0ZW1zU2VydmljZTogUG9NZW51SXRlbXNTZXJ2aWNlKSB7fVxyXG5cclxuICBuZ09uRGVzdHJveSgpOiB2b2lkIHtcclxuICAgIHRoaXMuaXRlbVN1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpO1xyXG4gIH1cclxuXHJcbiAgbmdPbkluaXQoKTogdm9pZCB7XHJcbiAgICAvLyBzdWJzY3JpYmUgdG8gbWVudSBjb21wb25lbnQgbWVzc2FnZXNcclxuICAgIHRoaXMuaXRlbVN1YnNjcmlwdGlvbiA9IHRoaXMubWVudUl0ZW1zU2VydmljZS5yZWNlaXZlRnJvbVBhcmVudE1lbnVDbGlja2VkKCkuc3Vic2NyaWJlKG1lbnUgPT4ge1xyXG4gICAgICB0aGlzLnByb2Nlc3NNZW51SXRlbShtZW51KTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgY2xpY2tNZW51SXRlbShldmVudCk6IHZvaWQge1xyXG4gICAgaWYgKCEoZXZlbnQuY3RybEtleSB8fCBldmVudC5tZXRhS2V5KSkge1xyXG4gICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xyXG5cclxuICAgICAgLy8gRW1taXQgdG8gcGFyZW50XHJcbiAgICAgIHRoaXMubWVudUl0ZW1zU2VydmljZS5zZW5kVG9QYXJlbnRNZW51Q2xpY2tlZCh7XHJcbiAgICAgICAgbGluazogdGhpcy5saW5rLFxyXG4gICAgICAgIGFjdGlvbjogdGhpcy5hY3Rpb24sXHJcbiAgICAgICAgaWQ6IHRoaXMuaWQsXHJcbiAgICAgICAgaWNvbjogdGhpcy5pY29uLFxyXG4gICAgICAgIGxhYmVsOiB0aGlzLmxhYmVsLFxyXG4gICAgICAgIGxldmVsOiB0aGlzLmxldmVsLFxyXG4gICAgICAgIHN1Ykl0ZW1zOiB0aGlzLnN1Ykl0ZW1zLFxyXG4gICAgICAgIGlzU2VsZWN0ZWQ6IHRoaXMuaXNTZWxlY3RlZCxcclxuICAgICAgICBpc09wZW5lZDogdGhpcy5pc09wZW5lZCxcclxuICAgICAgICBzaG9ydExhYmVsOiB0aGlzLnNob3J0TGFiZWwsXHJcbiAgICAgICAgdHlwZTogdGhpcy50eXBlXHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBhY2NvcmRpb25BbmltYXRpb24oXHJcbiAgICBtZW51QWN0aXZlOiBQb01lbnVJdGVtLFxyXG4gICAgbWVudU9wZW5lZDogUG9NZW51SXRlbSxcclxuICAgIGhhc1N1Ykl0ZW1PcGVuZWQ6IGJvb2xlYW4sXHJcbiAgICBhY3RpdmF0ZWRCeVJvdXRlOiBib29sZWFuXHJcbiAgKSB7XHJcbiAgICBpZiAodGhpcy5pZCA9PT0gbWVudU9wZW5lZFsnaWQnXSkge1xyXG4gICAgICB0aGlzLm1heEhlaWdodCA9IHRoaXMuc3ViSXRlbXMubGVuZ3RoICogcG9NZW51SXRlbVN1Ykl0ZW1TaXplO1xyXG4gICAgfVxyXG5cclxuICAgIGlmIChoYXNTdWJJdGVtT3BlbmVkKSB7XHJcbiAgICAgIHRoaXMubWF4SGVpZ2h0ID0gbWVudU9wZW5lZFsnaXNPcGVuZWQnXVxyXG4gICAgICAgID8gdGhpcy5tYXhIZWlnaHQgKyBtZW51T3BlbmVkLnN1Ykl0ZW1zLmxlbmd0aCAqIHBvTWVudUl0ZW1TdWJJdGVtU2l6ZVxyXG4gICAgICAgIDogdGhpcy5tYXhIZWlnaHQgLSBtZW51T3BlbmVkLnN1Ykl0ZW1zLmxlbmd0aCAqIHBvTWVudUl0ZW1TdWJJdGVtU2l6ZTtcclxuXHJcbiAgICAgIGlmIChhY3RpdmF0ZWRCeVJvdXRlKSB7XHJcbiAgICAgICAgdGhpcy5tYXhIZWlnaHQgPSB0aGlzLmdldE1pbmltdW1IZWlnaHQoMCwgdGhpcywgbWVudUFjdGl2ZSk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcblxyXG4gIHByaXZhdGUgYWN0aXZhdGVNZW51KG1lbnU6IGFueSk6IHZvaWQge1xyXG4gICAgdGhpcy5pc1NlbGVjdGVkID0gbWVudSAmJiB0aGlzLmlkID09PSBtZW51LmlkO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBjYWxjTWVudVN1Ykl0ZW1zTWF4SGVpZ2h0KCkge1xyXG4gICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgIGNvbnN0IHN1Ykl0ZW1zID0gQXJyYXkuZnJvbSh0aGlzLm1lbnVTdWJJdGVtcy5uYXRpdmVFbGVtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5wby1tZW51LWl0ZW0nKSk7XHJcbiAgICAgIHN1Ykl0ZW1zLmZvckVhY2goKG1lbnVJdGVtOiBhbnkpID0+ICh0aGlzLm1heEhlaWdodCArPSBtZW51SXRlbS5vZmZzZXRIZWlnaHQpKTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBnZXRNaW5pbXVtSGVpZ2h0KG1pbmltdW1IZWlnaHQ6IG51bWJlciwgbWVudUl0ZW06IFBvTWVudUl0ZW0sIG1lbnVBY3RpdmU6IFBvTWVudUl0ZW0pIHtcclxuICAgIG1pbmltdW1IZWlnaHQgKz0gcG9NZW51SXRlbVN1Ykl0ZW1TaXplO1xyXG5cclxuICAgIGlmIChtZW51SXRlbS5zdWJJdGVtcyAmJiB0aGlzLmhhc1N1Ykl0ZW0obWVudUl0ZW0uc3ViSXRlbXMsIG1lbnVBY3RpdmVbJ2lkJ10pKSB7XHJcbiAgICAgIGZvciAobGV0IGluZGV4ID0gMDsgaW5kZXggPCBtZW51SXRlbS5zdWJJdGVtcy5sZW5ndGg7IGluZGV4KyspIHtcclxuICAgICAgICBtaW5pbXVtSGVpZ2h0ID0gdGhpcy5nZXRNaW5pbXVtSGVpZ2h0KG1pbmltdW1IZWlnaHQsIG1lbnVJdGVtLnN1Ykl0ZW1zW2luZGV4XSwgbWVudUFjdGl2ZSk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gbWluaW11bUhlaWdodDtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgZ3JvdXBlZE1lbnUobWVudUFjdGl2ZTogUG9NZW51SXRlbSwgbWVudU9wZW5lZDogUG9NZW51SXRlbSwgYWN0aXZhdGVkQnlSb3V0ZTogYm9vbGVhbiA9IGZhbHNlKTogdm9pZCB7XHJcbiAgICBjb25zdCBoYXNTdWJJdGVtT3BlbmVkID1cclxuICAgICAgbWVudU9wZW5lZCAmJiB0aGlzLmlkICE9PSBtZW51T3BlbmVkWydpZCddID8gdGhpcy5oYXNTdWJJdGVtKHRoaXMuc3ViSXRlbXMsIG1lbnVPcGVuZWRbJ2lkJ10pIDogZmFsc2U7XHJcblxyXG4gICAgdGhpcy5pc09wZW5lZCA9IHRoaXMuaXNNZW51T3BlbmVkKG1lbnVPcGVuZWQsIGhhc1N1Ykl0ZW1PcGVuZWQpO1xyXG5cclxuICAgIHRoaXMuaXNTZWxlY3RlZCA9IG1lbnVBY3RpdmUgJiYgIXRoaXMuaXNPcGVuZWQgPyB0aGlzLmhhc1N1Ykl0ZW0odGhpcy5zdWJJdGVtcywgbWVudUFjdGl2ZVsnaWQnXSkgOiBmYWxzZTtcclxuXHJcbiAgICBpZiAoIXRoaXMuaXNPcGVuZWQpIHtcclxuICAgICAgdGhpcy5tYXhIZWlnaHQgPSAwO1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICB0aGlzLmFjY29yZGlvbkFuaW1hdGlvbihtZW51QWN0aXZlLCBtZW51T3BlbmVkLCBoYXNTdWJJdGVtT3BlbmVkLCBhY3RpdmF0ZWRCeVJvdXRlKTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgaGFzU3ViSXRlbShzdWJJdGVtczogQXJyYXk8UG9NZW51SXRlbT4sIGlkOiBzdHJpbmcpOiBib29sZWFuIHtcclxuICAgIGlmIChzdWJJdGVtcykge1xyXG4gICAgICByZXR1cm4gc3ViSXRlbXMuc29tZShpdGVtID0+IChpdGVtWydpZCddID09PSBpZCA/IHRydWUgOiB0aGlzLmhhc1N1Ykl0ZW0oaXRlbS5zdWJJdGVtcywgaWQpKSk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGlzTWVudU9wZW5lZChtZW51T3BlbmVkOiBQb01lbnVJdGVtLCBoYXNTdWJJdGVtT3BlbmVkOiBib29sZWFuKTogYm9vbGVhbiB7XHJcbiAgICBpZiAobWVudU9wZW5lZCkge1xyXG4gICAgICByZXR1cm4gdGhpcy5pZCA9PT0gbWVudU9wZW5lZFsnaWQnXSA/IG1lbnVPcGVuZWRbJ2lzT3BlbmVkJ10gOiBoYXNTdWJJdGVtT3BlbmVkO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBmYWxzZTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgcHJvY2Vzc01lbnVJdGVtKG1lbnUpIHtcclxuICAgIGlmICh0aGlzLnR5cGUgPT09ICdpbnRlcm5hbExpbmsnKSB7XHJcbiAgICAgIHRoaXMuYWN0aXZhdGVNZW51KG1lbnUuYWN0aXZlKTtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG5cclxuICAgIGlmICh0aGlzLnR5cGUgPT09ICdzdWJJdGVtcycpIHtcclxuICAgICAgdGhpcy5ncm91cGVkTWVudShtZW51LmFjdGl2ZSwgbWVudS5ncm91cGVkLCBtZW51LmFjdGl2YXRlZEJ5Um91dGUpO1xyXG4gICAgfVxyXG4gIH1cclxufVxyXG4iXX0=