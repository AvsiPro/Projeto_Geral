import { __rest } from "tslib";
import { Component, ElementRef, forwardRef, Renderer2, ViewChild } from '@angular/core';
import { NG_VALIDATORS, NG_VALUE_ACCESSOR } from '@angular/forms';
import { formatBytes, isMobile } from '../../../utils/util';
import { PoI18nPipe } from '../../../services/po-i18n/po-i18n.pipe';
import { PoNotificationService } from '../../../services/po-notification/po-notification.service';
import { PoProgressStatus } from '../../po-progress/enums/po-progress-status.enum';
import { PoLanguageService } from '../../../services/po-language/po-language.service';
import { PoUploadBaseComponent } from './po-upload-base.component';
import { PoUploadDragDropComponent } from './po-upload-drag-drop/po-upload-drag-drop.component';
import { PoUploadService } from './po-upload.service';
import { PoUploadStatus } from './po-upload-status.enum';
/**
 * @docsExtends PoUploadBaseComponent
 *
 * @example
 *
 * <example name="po-upload-basic" title="PO Upload Basic">
 *   <file name="sample-po-upload-basic/sample-po-upload-basic.component.html"> </file>
 *   <file name="sample-po-upload-basic/sample-po-upload-basic.component.ts"> </file>
 * </example>
 *
 * <example name="po-upload-labs" title="PO Upload Labs">
 *   <file name="sample-po-upload-labs/sample-po-upload-labs.component.html"> </file>
 *   <file name="sample-po-upload-labs/sample-po-upload-labs.component.ts"> </file>
 * </example>
 *
 * <example name="po-upload-resume" title="PO Upload - Resume">
 *   <file name="sample-po-upload-resume/sample-po-upload-resume.component.html"> </file>
 *   <file name="sample-po-upload-resume/sample-po-upload-resume.component.ts"> </file>
 * </example>
 *
 * <example name="po-upload-rs" title="PO Upload - Realize & Show">
 *   <file name="sample-po-upload-rs/sample-po-upload-rs.component.html"> </file>
 *   <file name="sample-po-upload-rs/sample-po-upload-rs.component.ts"> </file>
 * </example>
 */
export class PoUploadComponent extends PoUploadBaseComponent {
    constructor(uploadService, renderer, i18nPipe, notification, languageService) {
        super(uploadService, languageService);
        this.renderer = renderer;
        this.i18nPipe = i18nPipe;
        this.notification = notification;
        this.infoByUploadStatus = {
            [PoUploadStatus.Uploaded]: {
                text: () => this.literals.sentWithSuccess,
                icon: 'po-icon-ok'
            },
            [PoUploadStatus.Error]: {
                text: () => this.literals.errorOccurred
            },
            [PoUploadStatus.Uploading]: {
                text: percent => percent + '%'
            }
        };
        this.progressStatusByFileStatus = {
            [PoUploadStatus.Uploaded]: PoProgressStatus.Success,
            [PoUploadStatus.Error]: PoProgressStatus.Error
        };
        this.calledByCleanInputValue = false;
    }
    get displayDragDrop() {
        return this.dragDrop && !isMobile();
    }
    get displaySendButton() {
        const currentFiles = this.currentFiles || [];
        return !this.hideSendButton && !this.autoUpload && currentFiles.length > 0 && this.hasFileNotUploaded;
    }
    get selectFileButtonLabel() {
        if (this.canHandleDirectory) {
            return this.literals.selectFolder;
        }
        else if (this.isMultiple) {
            return this.literals.selectFiles;
        }
        else {
            return this.literals.selectFile;
        }
    }
    get hasMoreThanFourItems() {
        return this.currentFiles && this.currentFiles.length > 4;
    }
    get hasMultipleFiles() {
        return this.currentFiles && this.currentFiles.length > 1;
    }
    get hasFileNotUploaded() {
        if (Array.isArray(this.currentFiles)) {
            return this.currentFiles.some(file => file.status !== PoUploadStatus.Uploaded);
        }
        return false;
    }
    get isDisabled() {
        const currentFiles = this.currentFiles || [];
        return !!(this.hasAnyFileUploading(currentFiles) ||
            !this.url ||
            this.disabled ||
            this.isExceededFileLimit(currentFiles.length));
    }
    get maxFiles() {
        return this.isMultiple && this.fileRestrictions && this.fileRestrictions.maxFiles;
    }
    cancel(file) {
        if (file.status === PoUploadStatus.Uploading) {
            return this.stopUpload(file);
        }
        this.removeFile(file);
    }
    ngAfterViewInit() {
        if (this.autoFocus) {
            this.focus();
        }
    }
    /** Método responsável por **limpar** o(s) arquivo(s) selecionado(s). */
    clear() {
        this.currentFiles = undefined;
        this.updateModel([]);
        this.cleanInputValue();
    }
    /**
     * Função que atribui foco ao componente.
     *
     * Para utilizá-la é necessário ter a instância do componente no DOM, podendo ser utilizado o ViewChild da seguinte forma:
     *
     * ```
     * import { PoUploadComponent } from '@po-ui/ng-components';
     *
     * ...
     *
     * @ViewChild(PoUploadComponent, { static: true }) upload: PoUploadComponent;
     *
     * focusUpload() {
     *   this.upload.focus();
     * }
     * ```
     */
    focus() {
        if (!this.disabled) {
            if (this.uploadButton) {
                this.uploadButton.focus();
                return;
            }
            if (this.displayDragDrop) {
                this.poUploadDragDropComponent.focus();
            }
        }
    }
    // Verifica se existe algum arquivo sendo enviado ao serviço.
    hasAnyFileUploading(files) {
        if (files && files.length) {
            return files.some(file => file.status === PoUploadStatus.Uploading);
        }
        return false;
    }
    // retorna se o status do arquivo é diferente de enviado
    isAllowCancelEvent(status) {
        return status !== PoUploadStatus.Uploaded;
    }
    // Função disparada ao selecionar algum arquivo.
    onFileChange(event) {
        // necessário este tratamento quando para IE, pois nele o change é disparado quando o campo é limpado também
        if (this.calledByCleanInputValue) {
            this.calledByCleanInputValue = false;
            return event.preventDefault();
        }
        const files = event.target.files;
        this.updateFiles(files);
        this.cleanInputValue();
    }
    onFileChangeDragDrop(files) {
        this.updateFiles(files);
    }
    // Remove o arquivo passado por parâmetro da lista dos arquivos correntes.
    removeFile(file) {
        const index = this.currentFiles.indexOf(file);
        this.currentFiles.splice(index, 1);
        this.updateModel([...this.currentFiles]);
    }
    /** Método responsável por **abrir** a janela para seleção de arquivo(s). */
    selectFiles() {
        var _a;
        (_a = this.onModelTouched) === null || _a === void 0 ? void 0 : _a.call(this);
        this.calledByCleanInputValue = false;
        this.inputFile.nativeElement.click();
    }
    sendFeedback() {
        if (this.sizeNotAllowed > 0) {
            const minFileSize = formatBytes(this.fileRestrictions.minFileSize);
            const maxFileSize = formatBytes(this.fileRestrictions.maxFileSize);
            const args = [this.sizeNotAllowed, minFileSize || '0', maxFileSize];
            this.setPipeArguments('invalidSize', args);
            this.sizeNotAllowed = 0;
        }
        if (this.extensionNotAllowed > 0) {
            const allowedExtensionsFormatted = this.fileRestrictions.allowedExtensions.join(', ').toUpperCase();
            const args = [this.extensionNotAllowed, allowedExtensionsFormatted];
            this.setPipeArguments('invalidFormat', args);
            this.extensionNotAllowed = 0;
        }
        if (this.quantityNotAllowed > 0) {
            const args = [this.quantityNotAllowed];
            this.setPipeArguments('invalidAmount', args);
            this.quantityNotAllowed = 0;
        }
    }
    /** Método responsável por **enviar** o(s) arquivo(s) selecionado(s). */
    sendFiles() {
        if (this.currentFiles && this.currentFiles.length) {
            this.uploadFiles(this.currentFiles);
        }
    }
    setDirectoryAttribute(canHandleDirectory) {
        if (canHandleDirectory) {
            this.renderer.setAttribute(this.inputFile.nativeElement, 'webkitdirectory', 'true');
        }
        else {
            this.renderer.removeAttribute(this.inputFile.nativeElement, 'webkitdirectory');
        }
    }
    // Caso o componente estiver no modo AutoUpload, o arquivo também será removido da lista.
    stopUpload(file) {
        this.uploadService.stopRequestByFile(file, () => {
            if (this.autoUpload) {
                this.removeFile(file);
            }
            else {
                this.stopUploadHandler(file);
            }
        });
    }
    trackByFn(index, file) {
        return file.uid;
    }
    // Envia os arquivos passados por parâmetro, exceto os que já foram enviados ao serviço.
    uploadFiles(files) {
        const filesFiltered = files.filter(file => file.status !== PoUploadStatus.Uploaded);
        this.uploadService.upload(this.url, filesFiltered, this.headers, this.onUpload, (file, percent) => {
            // UPLOADING
            this.uploadingHandler(file, percent);
        }, (file, eventResponse) => {
            // SUCCESS
            this.responseHandler(file, PoUploadStatus.Uploaded);
            this.onSuccess.emit(eventResponse);
        }, (file, eventError) => {
            // Error
            this.responseHandler(file, PoUploadStatus.Error);
            this.onError.emit(eventError);
        });
    }
    cleanInputValue() {
        this.calledByCleanInputValue = true;
        this.inputFile.nativeElement.value = '';
    }
    // função disparada na resposta do sucesso ou error
    responseHandler(file, status) {
        file.status = status;
        file.percent = 100;
    }
    // método responsável por setar os argumentos do i18nPipe de acordo com a restrição.
    setPipeArguments(literalAttributes, literalArguments) {
        const pipeArguments = this.i18nPipe.transform(this.literals[literalAttributes], literalArguments);
        this.notification.information(pipeArguments);
    }
    // Função disparada ao parar um envio de arquivo.
    stopUploadHandler(file) {
        file.status = PoUploadStatus.None;
        file.percent = 0;
    }
    updateFiles(files) {
        this.currentFiles = this.parseFiles(files);
        this.updateModel([...this.currentFiles]);
        if (this.autoUpload) {
            this.uploadFiles(this.currentFiles);
        }
    }
    // Atualiza o ngModel para os arquivos passados por parâmetro.
    updateModel(files) {
        const modelFiles = this.mapCleanUploadFiles(files);
        this.onModelChange ? this.onModelChange(modelFiles) : this.ngModelChange.emit(modelFiles);
    }
    // Função disparada enquanto o arquivo está sendo enviado ao serviço.
    uploadingHandler(file, percent) {
        file.status = PoUploadStatus.Uploading;
        file.percent = percent;
    }
    // retorna os objetos do array sem as propriedades: percent e displayName
    mapCleanUploadFiles(files) {
        const mapedByUploadFile = progressFile => {
            const { percent, displayName } = progressFile, uploadFile = __rest(progressFile, ["percent", "displayName"]);
            return uploadFile;
        };
        return files.map(mapedByUploadFile);
    }
}
PoUploadComponent.decorators = [
    { type: Component, args: [{
                selector: 'po-upload',
                template: "<po-field-container [p-label]=\"label\" [p-help]=\"help\" [p-optional]=\"!required && optional\">\r\n  <div class=\"po-upload\">\r\n    <input\r\n      #inputFile\r\n      class=\"po-upload-input\"\r\n      type=\"file\"\r\n      [accept]=\"allowedExtensions\"\r\n      [attr.name]=\"name\"\r\n      [disabled]=\"isDisabled\"\r\n      [multiple]=\"isMultiple\"\r\n      [required]=\"required\"\r\n      (change)=\"onFileChange($event)\"\r\n    />\r\n\r\n    <po-upload-drag-drop\r\n      *ngIf=\"displayDragDrop\"\r\n      [p-directory-compatible]=\"canHandleDirectory\"\r\n      [p-disabled]=\"isDisabled\"\r\n      [p-drag-drop-height]=\"dragDropHeight\"\r\n      [p-literals]=\"literals\"\r\n      (p-file-change)=\"onFileChangeDragDrop($event)\"\r\n      (p-select-files)=\"selectFiles()\"\r\n    >\r\n    </po-upload-drag-drop>\r\n\r\n    <po-button\r\n      *ngIf=\"!hideSelectButton && !displayDragDrop\"\r\n      #uploadButton\r\n      class=\"po-upload-button\"\r\n      for=\"file\"\r\n      [p-disabled]=\"isDisabled\"\r\n      [p-label]=\"selectFileButtonLabel\"\r\n      (p-click)=\"selectFiles()\"\r\n    >\r\n    </po-button>\r\n\r\n    <po-upload-file-restrictions\r\n      *ngIf=\"fileRestrictions && !hideRestrictionsInfo\"\r\n      class=\"po-upload-file-restrictions\"\r\n      [ngClass]=\"{ 'po-upload-file-restrictions-drag-drop': displayDragDrop }\"\r\n      [p-allowed-extensions]=\"fileRestrictions?.allowedExtensions\"\r\n      [p-max-files]=\"maxFiles\"\r\n      [p-max-file-size]=\"fileRestrictions?.maxFileSize\"\r\n      [p-min-file-size]=\"fileRestrictions?.minFileSize\"\r\n    >\r\n    </po-upload-file-restrictions>\r\n\r\n    <div *ngIf=\"currentFiles && currentFiles.length\" class=\"po-upload-progress-container\">\r\n      <po-container\r\n        p-no-shadow\r\n        [p-height]=\"hasMoreThanFourItems ? 280 : 'auto'\"\r\n        [p-no-border]=\"!hasMoreThanFourItems\"\r\n        [p-no-padding]=\"!hasMoreThanFourItems\"\r\n      >\r\n        <div [ngClass]=\"{ 'po-upload-progress-container-area po-pt-2 po-pl-1': hasMoreThanFourItems }\">\r\n          <po-progress\r\n            *ngFor=\"let file of currentFiles; trackBy: trackByFn\"\r\n            [p-info]=\"infoByUploadStatus[file.status]?.text(file.percent)\"\r\n            [p-info-icon]=\"infoByUploadStatus[file.status]?.icon\"\r\n            [p-status]=\"progressStatusByFileStatus[file.status]\"\r\n            [p-text]=\"file.displayName\"\r\n            [p-value]=\"file.percent\"\r\n            (p-cancel)=\"cancel(file)\"\r\n            (p-retry)=\"uploadFiles([file])\"\r\n          >\r\n          </po-progress>\r\n        </div>\r\n      </po-container>\r\n    </div>\r\n\r\n    <po-button\r\n      *ngIf=\"displaySendButton\"\r\n      class=\"po-upload-send-button\"\r\n      [class.po-mt-3]=\"hasMoreThanFourItems\"\r\n      p-type=\"primary\"\r\n      [p-disabled]=\"hasAnyFileUploading(currentFiles)\"\r\n      [p-label]=\"literals.startSending\"\r\n      (p-click)=\"uploadFiles(currentFiles)\"\r\n    >\r\n    </po-button>\r\n  </div>\r\n</po-field-container>\r\n",
                providers: [
                    PoI18nPipe,
                    PoUploadService,
                    {
                        provide: NG_VALUE_ACCESSOR,
                        useExisting: forwardRef(() => PoUploadComponent),
                        multi: true
                    },
                    {
                        provide: NG_VALIDATORS,
                        useExisting: forwardRef(() => PoUploadComponent),
                        multi: true
                    }
                ]
            },] }
];
PoUploadComponent.ctorParameters = () => [
    { type: PoUploadService },
    { type: Renderer2 },
    { type: PoI18nPipe },
    { type: PoNotificationService },
    { type: PoLanguageService }
];
PoUploadComponent.propDecorators = {
    inputFile: [{ type: ViewChild, args: ['inputFile', { read: ElementRef, static: true },] }],
    poUploadDragDropComponent: [{ type: ViewChild, args: [PoUploadDragDropComponent,] }],
    uploadButton: [{ type: ViewChild, args: ['uploadButton',] }]
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG8tdXBsb2FkLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL3VpL3NyYy9saWIvY29tcG9uZW50cy9wby1maWVsZC9wby11cGxvYWQvcG8tdXBsb2FkLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsT0FBTyxFQUFFLFNBQVMsRUFBRSxVQUFVLEVBQUUsVUFBVSxFQUFFLFNBQVMsRUFBRSxTQUFTLEVBQWlCLE1BQU0sZUFBZSxDQUFDO0FBQ3ZHLE9BQU8sRUFBRSxhQUFhLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUVsRSxPQUFPLEVBQUUsV0FBVyxFQUFFLFFBQVEsRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBRTVELE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSx3Q0FBd0MsQ0FBQztBQUNwRSxPQUFPLEVBQUUscUJBQXFCLEVBQUUsTUFBTSwyREFBMkQsQ0FBQztBQUNsRyxPQUFPLEVBQUUsZ0JBQWdCLEVBQUUsTUFBTSxpREFBaUQsQ0FBQztBQUNuRixPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSxtREFBbUQsQ0FBQztBQUV0RixPQUFPLEVBQUUscUJBQXFCLEVBQUUsTUFBTSw0QkFBNEIsQ0FBQztBQUNuRSxPQUFPLEVBQUUseUJBQXlCLEVBQUUsTUFBTSxxREFBcUQsQ0FBQztBQUVoRyxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFDdEQsT0FBTyxFQUFFLGNBQWMsRUFBRSxNQUFNLHlCQUF5QixDQUFDO0FBRXpEOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7R0F3Qkc7QUFtQkgsTUFBTSxPQUFPLGlCQUFrQixTQUFRLHFCQUFxQjtJQXlCMUQsWUFDRSxhQUE4QixFQUN2QixRQUFtQixFQUNsQixRQUFvQixFQUNwQixZQUFtQyxFQUMzQyxlQUFrQztRQUVsQyxLQUFLLENBQUMsYUFBYSxFQUFFLGVB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LFdBQVcsS0FBb0IsWUFBWSxFQUEzQixVQUFVLFVBQUssWUFBWSxFQUF0RCwwQkFBdUMsQ0FBZSxDQUFDO1lBRTdELE9BQU8sVUFBVSxDQUFDO1FBQ3BCLENBQUMsQ0FBQztRQUVGLE9BQU8sS0FBSyxDQUFDLEdBQUcsQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDO0lBQ3RDLENBQUM7OztZQTdVRixTQUFTLFNBQUM7Z0JBQ1QsUUFBUSxFQUFFLFdBQVc7Z0JBQ3JCLHFoR0FBeUM7Z0JBQ3pDLFNBQVMsRUFBRTtvQkFDVCxVQUFVO29CQUNWLGVBQWU7b0JBQ2Y7d0JBQ0UsT0FBTyxFQUFFLGlCQUFpQjt3QkFDMUIsV0FBVyxFQUFFLFVBQVUsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxpQkFBaUIsQ0FBQzt3QkFDaEQsS0FBSyxFQUFFLElBQUk7cUJBQ1o7b0JBQ0Q7d0JBQ0UsT0FBTyxFQUFFLGFBQWE7d0JBQ3RCLFdBQVcsRUFBRSxVQUFVLENBQUMsR0FBRyxFQUFFLENBQUMsaUJBQWlCLENBQUM7d0JBQ2hELEtBQUssRUFBRSxJQUFJO3FCQUNaO2lCQUNGO2FBQ0Y7OztZQTdDUSxlQUFlO1lBYm9CLFNBQVM7WUFLNUMsVUFBVTtZQUNWLHFCQUFxQjtZQUVyQixpQkFBaUI7Ozt3QkFvRHZCLFNBQVMsU0FBQyxXQUFXLEVBQUUsRUFBRSxJQUFJLEVBQUUsVUFBVSxFQUFFLE1BQU0sRUFBRSxJQUFJLEVBQUU7d0NBQ3pELFNBQVMsU0FBQyx5QkFBeUI7MkJBQ25DLFNBQVMsU0FBQyxjQUFjIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50LCBFbGVtZW50UmVmLCBmb3J3YXJkUmVmLCBSZW5kZXJlcjIsIFZpZXdDaGlsZCwgQWZ0ZXJWaWV3SW5pdCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBOR19WQUxJREFUT1JTLCBOR19WQUxVRV9BQ0NFU1NPUiB9IGZyb20gJ0Bhbmd1bGFyL2Zvcm1zJztcclxuXHJcbmltcG9ydCB7IGZvcm1hdEJ5dGVzLCBpc01vYmlsZSB9IGZyb20gJy4uLy4uLy4uL3V0aWxzL3V0aWwnO1xyXG5pbXBvcnQgeyBQb0J1dHRvbkNvbXBvbmVudCB9IGZyb20gJy4vLi4vLi4vcG8tYnV0dG9uL3BvLWJ1dHRvbi5jb21wb25lbnQnO1xyXG5pbXBvcnQgeyBQb0kxOG5QaXBlIH0gZnJvbSAnLi4vLi4vLi4vc2VydmljZXMvcG8taTE4bi9wby1pMThuLnBpcGUnO1xyXG5pbXBvcnQgeyBQb05vdGlmaWNhdGlvblNlcnZpY2UgfSBmcm9tICcuLi8uLi8uLi9zZXJ2aWNlcy9wby1ub3RpZmljYXRpb24vcG8tbm90aWZpY2F0aW9uLnNlcnZpY2UnO1xyXG5pbXBvcnQgeyBQb1Byb2dyZXNzU3RhdHVzIH0gZnJvbSAnLi4vLi4vcG8tcHJvZ3Jlc3MvZW51bXMvcG8tcHJvZ3Jlc3Mtc3RhdHVzLmVudW0nO1xyXG5pbXBvcnQgeyBQb0xhbmd1YWdlU2VydmljZSB9IGZyb20gJy4uLy4uLy4uL3NlcnZpY2VzL3BvLWxhbmd1YWdlL3BvLWxhbmd1YWdlLnNlcnZpY2UnO1xyXG5cclxuaW1wb3J0IHsgUG9VcGxvYWRCYXNlQ29tcG9uZW50IH0gZnJvbSAnLi9wby11cGxvYWQtYmFzZS5jb21wb25lbnQnO1xyXG5pbXBvcnQgeyBQb1VwbG9hZERyYWdEcm9wQ29tcG9uZW50IH0gZnJvbSAnLi9wby11cGxvYWQtZHJhZy1kcm9wL3BvLXVwbG9hZC1kcmFnLWRyb3AuY29tcG9uZW50JztcclxuaW1wb3J0IHsgUG9VcGxvYWRGaWxlIH0gZnJvbSAnLi9wby11cGxvYWQtZmlsZSc7XHJcbmltcG9ydCB7IFBvVXBsb2FkU2VydmljZSB9IGZyb20gJy4vcG8tdXBsb2FkLnNlcnZpY2UnO1xyXG5pbXBvcnQgeyBQb1VwbG9hZFN0YXR1cyB9IGZyb20gJy4vcG8tdXBsb2FkLXN0YXR1cy5lbnVtJztcclxuXHJcbi8qKlxyXG4gKiBAZG9jc0V4dGVuZHMgUG9VcGxvYWRCYXNlQ29tcG9uZW50XHJcbiAqXHJcbiAqIEBleGFtcGxlXHJcbiAqXHJcbiAqIDxleGFtcGxlIG5hbWU9XCJwby11cGxvYWQtYmFzaWNcIiB0aXRsZT1cIlBPIFVwbG9hZCBCYXNpY1wiPlxyXG4gKiAgIDxmaWxlIG5hbWU9XCJzYW1wbGUtcG8tdXBsb2FkLWJhc2ljL3NhbXBsZS1wby11cGxvYWQtYmFzaWMuY29tcG9uZW50Lmh0bWxcIj4gPC9maWxlPlxyXG4gKiAgIDxmaWxlIG5hbWU9XCJzYW1wbGUtcG8tdXBsb2FkLWJhc2ljL3NhbXBsZS1wby11cGxvYWQtYmFzaWMuY29tcG9uZW50LnRzXCI+IDwvZmlsZT5cclxuICogPC9leGFtcGxlPlxyXG4gKlxyXG4gKiA8ZXhhbXBsZSBuYW1lPVwicG8tdXBsb2FkLWxhYnNcIiB0aXRsZT1cIlBPIFVwbG9hZCBMYWJzXCI+XHJcbiAqICAgPGZpbGUgbmFtZT1cInNhbXBsZS1wby11cGxvYWQtbGFicy9zYW1wbGUtcG8tdXBsb2FkLWxhYnMuY29tcG9uZW50Lmh0bWxcIj4gPC9maWxlPlxyXG4gKiAgIDxmaWxlIG5hbWU9XCJzYW1wbGUtcG8tdXBsb2FkLWxhYnMvc2FtcGxlLXBvLXVwbG9hZC1sYWJzLmNvbXBvbmVudC50c1wiPiA8L2ZpbGU+XHJcbiAqIDwvZXhhbXBsZT5cclxuICpcclxuICogPGV4YW1wbGUgbmFtZT1cInBvLXVwbG9hZC1yZXN1bWVcIiB0aXRsZT1cIlBPIFVwbG9hZCAtIFJlc3VtZVwiPlxyXG4gKiAgIDxmaWxlIG5hbWU9XCJzYW1wbGUtcG8tdXBsb2FkLXJlc3VtZS9zYW1wbGUtcG8tdXBsb2FkLXJlc3VtZS5jb21wb25lbnQuaHRtbFwiPiA8L2ZpbGU+XHJcbiAqICAgPGZpbGUgbmFtZT1cInNhbXBsZS1wby11cGxvYWQtcmVzdW1lL3NhbXBsZS1wby11cGxvYWQtcmVzdW1lLmNvbXBvbmVudC50c1wiPiA8L2ZpbGU+XHJcbiAqIDwvZXhhbXBsZT5cclxuICpcclxuICogPGV4YW1wbGUgbmFtZT1cInBvLXVwbG9hZC1yc1wiIHRpdGxlPVwiUE8gVXBsb2FkIC0gUmVhbGl6ZSAmIFNob3dcIj5cclxuICogICA8ZmlsZSBuYW1lPVwic2FtcGxlLXBvLXVwbG9hZC1ycy9zYW1wbGUtcG8tdXBsb2FkLXJzLmNvbXBvbmVudC5odG1sXCI+IDwvZmlsZT5cclxuICogICA8ZmlsZSBuYW1lPVwic2FtcGxlLXBvLXVwbG9hZC1ycy9zYW1wbGUtcG8tdXBsb2FkLXJzLmNvbXBvbmVudC50c1wiPiA8L2ZpbGU+XHJcbiAqIDwvZXhhbXBsZT5cclxuICovXHJcbkBDb21wb25lbnQoe1xyXG4gIHNlbGVjdG9yOiAncG8tdXBsb2FkJyxcclxuICB0ZW1wbGF0ZVVybDogJy4vcG8tdXBsb2FkLmNvbXBvbmVudC5odG1sJyxcclxuICBwcm92aWRlcnM6IFtcclxuICAgIFBvSTE4blBpcGUsXHJcbiAgICBQb1VwbG9hZFNlcnZpY2UsXHJcbiAgICB7XHJcbiAgICAgIHByb3ZpZGU6IE5HX1ZBTFVFX0FDQ0VTU09SLFxyXG4gICAgICB1c2VFeGlzdGluZzogZm9yd2FyZFJlZigoKSA9PiBQb1VwbG9hZENvbXBvbmVudCksXHJcbiAgICAgIG11bHRpOiB0cnVlXHJcbiAgICB9LFxyXG4gICAge1xyXG4gICAgICBwcm92aWRlOiBOR19WQUxJREFUT1JTLFxyXG4gICAgICB1c2VFeGlzdGluZzogZm9yd2FyZFJlZigoKSA9PiBQb1VwbG9hZENvbXBvbmVudCksXHJcbiAgICAgIG11bHRpOiB0cnVlXHJcbiAgICB9XHJcbiAgXVxyXG59KVxyXG5leHBvcnQgY2xhc3MgUG9VcGxvYWRDb21wb25lbnQgZXh0ZW5kcyBQb1VwbG9hZEJhc2VDb21wb25lbnQgaW1wbGVtZW50cyBBZnRlclZpZXdJbml0IHtcclxuICBAVmlld0NoaWxkKCdpbnB1dEZpbGUnLCB7IHJlYWQ6IEVsZW1lbnRSZWYsIHN0YXRpYzogdHJ1ZSB9KSBwcml2YXRlIGlucHV0RmlsZTogRWxlbWVudFJlZjtcclxuICBAVmlld0NoaWxkKFBvVXBsb2FkRHJhZ0Ryb3BDb21wb25lbnQpIHByaXZhdGUgcG9VcGxvYWREcmFnRHJvcENvbXBvbmVudDogUG9VcGxvYWREcmFnRHJvcENvbXBvbmVudDtcclxuICBAVmlld0NoaWxkKCd1cGxvYWRCdXR0b24nKSBwcml2YXRlIHVwbG9hZEJ1dHRvbjogUG9CdXR0b25Db21wb25lbnQ7XHJcblxyXG4gIGluZm9CeVVwbG9hZFN0YXR1czogeyBba2V5OiBzdHJpbmddOiB7IHRleHQ6IChwZXJjZW50PzogbnVtYmVyKSA9PiBzdHJpbmc7IGljb24/OiBzdHJpbmcgfSB9ID0ge1xyXG4gICAgW1BvVXBsb2FkU3RhdHVzLlVwbG9hZGVkXToge1xyXG4gICAgICB0ZXh0OiAoKSA9PiB0aGlzLmxpdGVyYWxzLnNlbnRXaXRoU3VjY2VzcyxcclxuICAgICAgaWNvbjogJ3BvLWljb24tb2snXHJcbiAgICB9LFxyXG4gICAgW1BvVXBsb2FkU3RhdHVzLkVycm9yXToge1xyXG4gICAgICB0ZXh0OiAoKSA9PiB0aGlzLmxpdGVyYWxzLmVycm9yT2NjdXJyZWRcclxuICAgIH0sXHJcbiAgICBbUG9VcGxvYWRTdGF0dXMuVXBsb2FkaW5nXToge1xyXG4gICAgICB0ZXh0OiBwZXJjZW50ID0+IHBlcmNlbnQgKyAnJSdcclxuICAgIH1cclxuICB9O1xyXG5cclxuICBwcm9ncmVzc1N0YXR1c0J5RmlsZVN0YXR1cyA9IHtcclxuICAgIFtQb1VwbG9hZFN0YXR1cy5VcGxvYWRlZF06IFBvUHJvZ3Jlc3NTdGF0dXMuU3VjY2VzcyxcclxuICAgIFtQb1VwbG9hZFN0YXR1cy5FcnJvcl06IFBvUHJvZ3Jlc3NTdGF0dXMuRXJyb3JcclxuICB9O1xyXG5cclxuICBwcml2YXRlIGNhbGxlZEJ5Q2xlYW5JbnB1dFZhbHVlOiBib29sZWFuID0gZmFsc2U7XHJcblxyXG4gIGNvbnN0cnVjdG9yKFxyXG4gICAgdXBsb2FkU2VydmljZTogUG9VcGxvYWRTZXJ2aWNlLFxyXG4gICAgcHVibGljIHJlbmRlcmVyOiBSZW5kZXJlcjIsXHJcbiAgICBwcml2YXRlIGkxOG5QaXBlOiBQb0kxOG5QaXBlLFxyXG4gICAgcHJpdmF0ZSBub3RpZmljYXRpb246IFBvTm90aWZpY2F0aW9uU2VydmljZSxcclxuICAgIGxhbmd1YWdlU2VydmljZTogUG9MYW5ndWFnZVNlcnZpY2VcclxuICApIHtcclxuICAgIHN1cGVyKHVwbG9hZFNlcnZpY2UsIGxhbmd1YWdlU2VydmljZSk7XHJcbiAgfVxyXG5cclxuICBnZXQgZGlzcGxheURyYWdEcm9wKCk6IGJvb2xlYW4ge1xyXG4gICAgcmV0dXJuIHRoaXMuZHJhZ0Ryb3AgJiYgIWlzTW9iaWxlKCk7XHJcbiAgfVxyXG5cclxuICBnZXQgZGlzcGxheVNlbmRCdXR0b24oKTogYm9vbGVhbiB7XHJcbiAgICBjb25zdCBjdXJyZW50RmlsZXMgPSB0aGlzLmN1cnJlbnRGaWxlcyB8fCBbXTtcclxuICAgIHJldHVybiAhdGhpcy5oaWRlU2VuZEJ1dHRvbiAmJiAhdGhpcy5hdXRvVXBsb2FkICYmIGN1cnJlbnRGaWxlcy5sZW5ndGggPiAwICYmIHRoaXMuaGFzRmlsZU5vdFVwbG9hZGVkO1xyXG4gIH1cclxuXHJcbiAgZ2V0IHNlbGVjdEZpbGVCdXR0b25MYWJlbCgpIHtcclxuICAgIGlmICh0aGlzLmNhbkhhbmRsZURpcmVjdG9yeSkge1xyXG4gICAgICByZXR1cm4gdGhpcy5saXRlcmFscy5zZWxlY3RGb2xkZXI7XHJcbiAgICB9IGVsc2UgaWYgKHRoaXMuaXNNdWx0aXBsZSkge1xyXG4gICAgICByZXR1cm4gdGhpcy5saXRlcmFscy5zZWxlY3RGaWxlcztcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHJldHVybiB0aGlzLmxpdGVyYWxzLnNlbGVjdEZpbGU7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBnZXQgaGFzTW9yZVRoYW5Gb3VySXRlbXMoKTogYm9vbGVhbiB7XHJcbiAgICByZXR1cm4gdGhpcy5jdXJyZW50RmlsZXMgJiYgdGhpcy5jdXJyZW50RmlsZXMubGVuZ3RoID4gNDtcclxuICB9XHJcblxyXG4gIGdldCBoYXNNdWx0aXBsZUZpbGVzKCk6IGJvb2xlYW4ge1xyXG4gICAgcmV0dXJuIHRoaXMuY3VycmVudEZpbGVzICYmIHRoaXMuY3VycmVudEZpbGVzLmxlbmd0aCA+IDE7XHJcbiAgfVxyXG5cclxuICBnZXQgaGFzRmlsZU5vdFVwbG9hZGVkKCk6IGJvb2xlYW4ge1xyXG4gICAgaWYgKEFycmF5LmlzQXJyYXkodGhpcy5jdXJyZW50RmlsZXMpKSB7XHJcbiAgICAgIHJldHVybiB0aGlzLmN1cnJlbnRGaWxlcy5zb21lKGZpbGUgPT4gZmlsZS5zdGF0dXMgIT09IFBvVXBsb2FkU3RhdHVzLlVwbG9hZGVkKTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gZmFsc2U7XHJcbiAgfVxyXG5cclxuICBnZXQgaXNEaXNhYmxlZCgpOiBib29sZWFuIHtcclxuICAgIGNvbnN0IGN1cnJlbnRGaWxlcyA9IHRoaXMuY3VycmVudEZpbGVzIHx8IFtdO1xyXG5cclxuICAgIHJldHVybiAhIShcclxuICAgICAgdGhpcy5oYXNBbnlGaWxlVXBsb2FkaW5nKGN1cnJlbnRGaWxlcykgfHxcclxuICAgICAgIXRoaXMudXJsIHx8XHJcbiAgICAgIHRoaXMuZGlzYWJsZWQgfHxcclxuICAgICAgdGhpcy5pc0V4Y2VlZGVkRmlsZUxpbWl0KGN1cnJlbnRGaWxlcy5sZW5ndGgpXHJcbiAgICApO1xyXG4gIH1cclxuXHJcbiAgZ2V0IG1heEZpbGVzKCk6IG51bWJlciB7XHJcbiAgICByZXR1cm4gdGhpcy5pc011bHRpcGxlICYmIHRoaXMuZmlsZVJlc3RyaWN0aW9ucyAmJiB0aGlzLmZpbGVSZXN0cmljdGlvbnMubWF4RmlsZXM7XHJcbiAgfVxyXG5cclxuICBjYW5jZWwoZmlsZTogUG9VcGxvYWRGaWxlKSB7XHJcbiAgICBpZiAoZmlsZS5zdGF0dXMgPT09IFBvVXBsb2FkU3RhdHVzLlVwbG9hZGluZykge1xyXG4gICAgICByZXR1cm4gdGhpcy5zdG9wVXBsb2FkKGZpbGUpO1xyXG4gICAgfVxyXG5cclxuICAgIHRoaXMucmVtb3ZlRmlsZShmaWxlKTtcclxuICB9XHJcblxyXG4gIG5nQWZ0ZXJWaWV3SW5pdCgpIHtcclxuICAgIGlmICh0aGlzLmF1dG9Gb2N1cykge1xyXG4gICAgICB0aGlzLmZvY3VzKCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKiogTcOpdG9kbyByZXNwb25zw6F2ZWwgcG9yICoqbGltcGFyKiogbyhzKSBhcnF1aXZvKHMpIHNlbGVjaW9uYWRvKHMpLiAqL1xyXG4gIGNsZWFyKCkge1xyXG4gICAgdGhpcy5jdXJyZW50RmlsZXMgPSB1bmRlZmluZWQ7XHJcbiAgICB0aGlzLnVwZGF0ZU1vZGVsKFtdKTtcclxuICAgIHRoaXMuY2xlYW5JbnB1dFZhbHVlKCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBGdW7Dp8OjbyBxdWUgYXRyaWJ1aSBmb2NvIGFvIGNvbXBvbmVudGUuXHJcbiAgICpcclxuICAgKiBQYXJhIHV0aWxpesOhLWxhIMOpIG5lY2Vzc8OhcmlvIHRlciBhIGluc3TDom5jaWEgZG8gY29tcG9uZW50ZSBubyBET00sIHBvZGVuZG8gc2VyIHV0aWxpemFkbyBvIFZpZXdDaGlsZCBkYSBzZWd1aW50ZSBmb3JtYTpcclxuICAgKlxyXG4gICAqIGBgYFxyXG4gICAqIGltcG9ydCB7IFBvVXBsb2FkQ29tcG9uZW50IH0gZnJvbSAnQHBvLXVpL25nLWNvbXBvbmVudHMnO1xyXG4gICAqXHJcbiAgICogLi4uXHJcbiAgICpcclxuICAgKiBAVmlld0NoaWxkKFBvVXBsb2FkQ29tcG9uZW50LCB7IHN0YXRpYzogdHJ1ZSB9KSB1cGxvYWQ6IFBvVXBsb2FkQ29tcG9uZW50O1xyXG4gICAqXHJcbiAgICogZm9jdXNVcGxvYWQoKSB7XHJcbiAgICogICB0aGlzLnVwbG9hZC5mb2N1cygpO1xyXG4gICAqIH1cclxuICAgKiBgYGBcclxuICAgKi9cclxuICBmb2N1cygpIHtcclxuICAgIGlmICghdGhpcy5kaXNhYmxlZCkge1xyXG4gICAgICBpZiAodGhpcy51cGxvYWRCdXR0b24pIHtcclxuICAgICAgICB0aGlzLnVwbG9hZEJ1dHRvbi5mb2N1cygpO1xyXG4gICAgICAgIHJldHVybjtcclxuICAgICAgfVxyXG5cclxuICAgICAgaWYgKHRoaXMuZGlzcGxheURyYWdEcm9wKSB7XHJcbiAgICAgICAgdGhpcy5wb1VwbG9hZERyYWdEcm9wQ29tcG9uZW50LmZvY3VzKCk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8vIFZlcmlmaWNhIHNlIGV4aXN0ZSBhbGd1bSBhcnF1aXZvIHNlbmRvIGVudmlhZG8gYW8gc2VydmnDp28uXHJcbiAgaGFzQW55RmlsZVVwbG9hZGluZyhmaWxlczogQXJyYXk8UG9VcGxvYWRGaWxlPikge1xyXG4gICAgaWYgKGZpbGVzICYmIGZpbGVzLmxlbmd0aCkge1xyXG4gICAgICByZXR1cm4gZmlsZXMuc29tZShmaWxlID0+IGZpbGUuc3RhdHVzID09PSBQb1VwbG9hZFN0YXR1cy5VcGxvYWRpbmcpO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBmYWxzZTtcclxuICB9XHJcblxyXG4gIC8vIHJldG9ybmEgc2UgbyBzdGF0dXMgZG8gYXJxdWl2byDDqSBkaWZlcmVudGUgZGUgZW52aWFkb1xyXG4gIGlzQWxsb3dDYW5jZWxFdmVudChzdGF0dXM6IFBvVXBsb2FkU3RhdHVzKSB7XHJcbiAgICByZXR1cm4gc3RhdHVzICE9PSBQb1VwbG9hZFN0YXR1cy5VcGxvYWRlZDtcclxuICB9XHJcblxyXG4gIC8vIEZ1bsOnw6NvIGRpc3BhcmFkYSBhbyBzZWxlY2lvbmFyIGFsZ3VtIGFycXVpdm8uXHJcbiAgb25GaWxlQ2hhbmdlKGV2ZW50KTogdm9pZCB7XHJcbiAgICAvLyBuZWNlc3PDoXJpbyBlc3RlIHRyYXRhbWVudG8gcXVhbmRvIHBhcmEgSUUsIHBvaXMgbmVsZSBvIGNoYW5nZSDDqSBkaXNwYXJhZG8gcXVhbmRvIG8gY2FtcG8gw6kgbGltcGFkbyB0YW1iw6ltXHJcbiAgICBpZiAodGhpcy5jYWxsZWRCeUNsZWFuSW5wdXRWYWx1ZSkge1xyXG4gICAgICB0aGlzLmNhbGxlZEJ5Q2xlYW5JbnB1dFZhbHVlID0gZmFsc2U7XHJcbiAgICAgIHJldHVybiBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IGZpbGVzID0gZXZlbnQudGFyZ2V0LmZpbGVzO1xyXG4gICAgdGhpcy51cGRhdGVGaWxlcyhmaWxlcyk7XHJcblxyXG4gICAgdGhpcy5jbGVhbklucHV0VmFsdWUoKTtcclxuICB9XHJcblxyXG4gIG9uRmlsZUNoYW5nZURyYWdEcm9wKGZpbGVzKSB7XHJcbiAgICB0aGlzLnVwZGF0ZUZpbGVzKGZpbGVzKTtcclxuICB9XHJcblxyXG4gIC8vIFJlbW92ZSBvIGFycXVpdm8gcGFzc2FkbyBwb3IgcGFyw6JtZXRybyBkYSBsaXN0YSBkb3MgYXJxdWl2b3MgY29ycmVudGVzLlxyXG4gIHJlbW92ZUZpbGUoZmlsZSk6IHZvaWQge1xyXG4gICAgY29uc3QgaW5kZXggPSB0aGlzLmN1cnJlbnRGaWxlcy5pbmRleE9mKGZpbGUpO1xyXG4gICAgdGhpcy5jdXJyZW50RmlsZXMuc3BsaWNlKGluZGV4LCAxKTtcclxuXHJcbiAgICB0aGlzLnVwZGF0ZU1vZGVsKFsuLi50aGlzLmN1cnJlbnRGaWxlc10pO1xyXG4gIH1cclxuXHJcbiAgLyoqIE3DqXRvZG8gcmVzcG9uc8OhdmVsIHBvciAqKmFicmlyKiogYSBqYW5lbGEgcGFyYSBzZWxlw6fDo28gZGUgYXJxdWl2byhzKS4gKi9cclxuICBzZWxlY3RGaWxlcygpIHtcclxuICAgIHRoaXMub25Nb2RlbFRvdWNoZWQ/LigpO1xyXG4gICAgdGhpcy5jYWxsZWRCeUNsZWFuSW5wdXRWYWx1ZSA9IGZhbHNlO1xyXG4gICAgdGhpcy5pbnB1dEZpbGUubmF0aXZlRWxlbWVudC5jbGljaygpO1xyXG4gIH1cclxuXHJcbiAgc2VuZEZlZWRiYWNrKCk6IHZvaWQge1xyXG4gICAgaWYgKHRoaXMuc2l6ZU5vdEFsbG93ZWQgPiAwKSB7XHJcbiAgICAgIGNvbnN0IG1pbkZpbGVTaXplID0gZm9ybWF0Qnl0ZXModGhpcy5maWxlUmVzdHJpY3Rpb25zLm1pbkZpbGVTaXplKTtcclxuICAgICAgY29uc3QgbWF4RmlsZVNpemUgPSBmb3JtYXRCeXRlcyh0aGlzLmZpbGVSZXN0cmljdGlvbnMubWF4RmlsZVNpemUpO1xyXG4gICAgICBjb25zdCBhcmdzID0gW3RoaXMuc2l6ZU5vdEFsbG93ZWQsIG1pbkZpbGVTaXplIHx8ICcwJywgbWF4RmlsZVNpemVdO1xyXG4gICAgICB0aGlzLnNldFBpcGVBcmd1bWVudHMoJ2ludmFsaWRTaXplJywgYXJncyk7XHJcbiAgICAgIHRoaXMuc2l6ZU5vdEFsbG93ZWQgPSAwO1xyXG4gICAgfVxyXG5cclxuICAgIGlmICh0aGlzLmV4dGVuc2lvbk5vdEFsbG93ZWQgPiAwKSB7XHJcbiAgICAgIGNvbnN0IGFsbG93ZWRFeHRlbnNpb25zRm9ybWF0dGVkID0gdGhpcy5maWxlUmVzdHJpY3Rpb25zLmFsbG93ZWRFeHRlbnNpb25zLmpvaW4oJywgJykudG9VcHBlckNhc2UoKTtcclxuICAgICAgY29uc3QgYXJncyA9IFt0aGlzLmV4dGVuc2lvbk5vdEFsbG93ZWQsIGFsbG93ZWRFeHRlbnNpb25zRm9ybWF0dGVkXTtcclxuICAgICAgdGhpcy5zZXRQaXBlQXJndW1lbnRzKCdpbnZhbGlkRm9ybWF0JywgYXJncyk7XHJcbiAgICAgIHRoaXMuZXh0ZW5zaW9uTm90QWxsb3dlZCA9IDA7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKHRoaXMucXVhbnRpdHlOb3RBbGxvd2VkID4gMCkge1xyXG4gICAgICBjb25zdCBhcmdzID0gW3RoaXMucXVhbnRpdHlOb3RBbGxvd2VkXTtcclxuICAgICAgdGhpcy5zZXRQaXBlQXJndW1lbnRzKCdpbnZhbGlkQW1vdW50JywgYXJncyk7XHJcbiAgICAgIHRoaXMucXVhbnRpdHlOb3RBbGxvd2VkID0gMDtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKiBNw6l0b2RvIHJlc3BvbnPDoXZlbCBwb3IgKiplbnZpYXIqKiBvKHMpIGFycXVpdm8ocykgc2VsZWNpb25hZG8ocykuICovXHJcbiAgc2VuZEZpbGVzKCk6IHZvaWQge1xyXG4gICAgaWYgKHRoaXMuY3VycmVudEZpbGVzICYmIHRoaXMuY3VycmVudEZpbGVzLmxlbmd0aCkge1xyXG4gICAgICB0aGlzLnVwbG9hZEZpbGVzKHRoaXMuY3VycmVudEZpbGVzKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHNldERpcmVjdG9yeUF0dHJpYnV0ZShjYW5IYW5kbGVEaXJlY3Rvcnk6IGJvb2xlYW4pIHtcclxuICAgIGlmIChjYW5IYW5kbGVEaXJlY3RvcnkpIHtcclxuICAgICAgdGhpcy5yZW5kZXJlci5zZXRBdHRyaWJ1dGUodGhpcy5pbnB1dEZpbGUubmF0aXZlRWxlbWVudCwgJ3dlYmtpdGRpcmVjdG9yeScsICd0cnVlJyk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB0aGlzLnJlbmRlcmVyLnJlbW92ZUF0dHJpYnV0ZSh0aGlzLmlucHV0RmlsZS5uYXRpdmVFbGVtZW50LCAnd2Via2l0ZGlyZWN0b3J5Jyk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvLyBDYXNvIG8gY29tcG9uZW50ZSBlc3RpdmVyIG5vIG1vZG8gQXV0b1VwbG9hZCwgbyBhcnF1aXZvIHRhbWLDqW0gc2Vyw6EgcmVtb3ZpZG8gZGEgbGlzdGEuXHJcbiAgc3RvcFVwbG9hZChmaWxlOiBQb1VwbG9hZEZpbGUpIHtcclxuICAgIHRoaXMudXBsb2FkU2VydmljZS5zdG9wUmVxdWVzdEJ5RmlsZShmaWxlLCAoKSA9PiB7XHJcbiAgICAgIGlmICh0aGlzLmF1dG9VcGxvYWQpIHtcclxuICAgICAgICB0aGlzLnJlbW92ZUZpbGUoZmlsZSk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgdGhpcy5zdG9wVXBsb2FkSGFuZGxlcihmaWxlKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICB0cmFja0J5Rm4oaW5kZXgsIGZpbGU6IFBvVXBsb2FkRmlsZSkge1xyXG4gICAgcmV0dXJuIGZpbGUudWlkO1xyXG4gIH1cclxuXHJcbiAgLy8gRW52aWEgb3MgYXJxdWl2b3MgcGFzc2Fkb3MgcG9yIHBhcsOibWV0cm8sIGV4Y2V0byBvcyBxdWUgasOhIGZvcmFtIGVudmlhZG9zIGFvIHNlcnZpw6dvLlxyXG4gIHVwbG9hZEZpbGVzKGZpbGVzOiBBcnJheTxQb1VwbG9hZEZpbGU+KSB7XHJcbiAgICBjb25zdCBmaWxlc0ZpbHRlcmVkID0gZmlsZXMuZmlsdGVyKGZpbGUgPT4gZmlsZS5zdGF0dXMgIT09IFBvVXBsb2FkU3RhdHVzLlVwbG9hZGVkKTtcclxuICAgIHRoaXMudXBsb2FkU2VydmljZS51cGxvYWQoXHJcbiAgICAgIHRoaXMudXJsLFxyXG4gICAgICBmaWxlc0ZpbHRlcmVkLFxyXG4gICAgICB0aGlzLmhlYWRlcnMsXHJcbiAgICAgIHRoaXMub25VcGxvYWQsXHJcbiAgICAgIChmaWxlLCBwZXJjZW50KTogYW55ID0+IHtcclxuICAgICAgICAvLyBVUExPQURJTkdcclxuICAgICAgICB0aGlzLnVwbG9hZGluZ0hhbmRsZXIoZmlsZSwgcGVyY2VudCk7XHJcbiAgICAgIH0sXHJcbiAgICAgIChmaWxlLCBldmVudFJlc3BvbnNlKTogYW55ID0+IHtcclxuICAgICAgICAvLyBTVUNDRVNTXHJcbiAgICAgICAgdGhpcy5yZXNwb25zZUhhbmRsZXIoZmlsZSwgUG9VcGxvYWRTdGF0dXMuVXBsb2FkZWQpO1xyXG4gICAgICAgIHRoaXMub25TdWNjZXNzLmVtaXQoZXZlbnRSZXNwb25zZSk7XHJcbiAgICAgIH0sXHJcbiAgICAgIChmaWxlLCBldmVudEVycm9yKTogYW55ID0+IHtcclxuICAgICAgICAvLyBFcnJvclxyXG4gICAgICAgIHRoaXMucmVzcG9uc2VIYW5kbGVyKGZpbGUsIFBvVXBsb2FkU3RhdHVzLkVycm9yKTtcclxuICAgICAgICB0aGlzLm9uRXJyb3IuZW1pdChldmVudEVycm9yKTtcclxuICAgICAgfVxyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgY2xlYW5JbnB1dFZhbHVlKCkge1xyXG4gICAgdGhpcy5jYWxsZWRCeUNsZWFuSW5wdXRWYWx1ZSA9IHRydWU7XHJcbiAgICB0aGlzLmlucHV0RmlsZS5uYXRpdmVFbGVtZW50LnZhbHVlID0gJyc7XHJcbiAgfVxyXG5cclxuICAvLyBmdW7Dp8OjbyBkaXNwYXJhZGEgbmEgcmVzcG9zdGEgZG8gc3VjZXNzbyBvdSBlcnJvclxyXG4gIHByaXZhdGUgcmVzcG9uc2VIYW5kbGVyKGZpbGU6IFBvVXBsb2FkRmlsZSwgc3RhdHVzOiBQb1VwbG9hZFN0YXR1cykge1xyXG4gICAgZmlsZS5zdGF0dXMgPSBzdGF0dXM7XHJcbiAgICBmaWxlLnBlcmNlbnQgPSAxMDA7XHJcbiAgfVxyXG5cclxuICAvLyBtw6l0b2RvIHJlc3BvbnPDoXZlbCBwb3Igc2V0YXIgb3MgYXJndW1lbnRvcyBkbyBpMThuUGlwZSBkZSBhY29yZG8gY29tIGEgcmVzdHJpw6fDo28uXHJcbiAgcHJpdmF0ZSBzZXRQaXBlQXJndW1lbnRzKGxpdGVyYWxBdHRyaWJ1dGVzOiBzdHJpbmcsIGxpdGVyYWxBcmd1bWVudHM/KSB7XHJcbiAgICBjb25zdCBwaXBlQXJndW1lbnRzID0gdGhpcy5pMThuUGlwZS50cmFuc2Zvcm0odGhpcy5saXRlcmFsc1tsaXRlcmFsQXR0cmlidXRlc10sIGxpdGVyYWxBcmd1bWVudHMpO1xyXG4gICAgdGhpcy5ub3RpZmljYXRpb24uaW5mb3JtYXRpb24ocGlwZUFyZ3VtZW50cyk7XHJcbiAgfVxyXG5cclxuICAvLyBGdW7Dp8OjbyBkaXNwYXJhZGEgYW8gcGFyYXIgdW0gZW52aW8gZGUgYXJxdWl2by5cclxuICBwcml2YXRlIHN0b3BVcGxvYWRIYW5kbGVyKGZpbGU6IFBvVXBsb2FkRmlsZSkge1xyXG4gICAgZmlsZS5zdGF0dXMgPSBQb1VwbG9hZFN0YXR1cy5Ob25lO1xyXG4gICAgZmlsZS5wZXJjZW50ID0gMDtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgdXBkYXRlRmlsZXMoZmlsZXMpIHtcclxuICAgIHRoaXMuY3VycmVudEZpbGVzID0gdGhpcy5wYXJzZUZpbGVzKGZpbGVzKTtcclxuXHJcbiAgICB0aGlzLnVwZGF0ZU1vZGVsKFsuLi50aGlzLmN1cnJlbnRGaWxlc10pO1xyXG5cclxuICAgIGlmICh0aGlzLmF1dG9VcGxvYWQpIHtcclxuICAgICAgdGhpcy51cGxvYWRGaWxlcyh0aGlzLmN1cnJlbnRGaWxlcyk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvLyBBdHVhbGl6YSBvIG5nTW9kZWwgcGFyYSBvcyBhcnF1aXZvcyBwYXNzYWRvcyBwb3IgcGFyw6JtZXRyby5cclxuICBwcml2YXRlIHVwZGF0ZU1vZGVsKGZpbGVzOiBBcnJheTxQb1VwbG9hZEZpbGU+KSB7XHJcbiAgICBjb25zdCBtb2RlbEZpbGVzOiBBcnJheTxQb1VwbG9hZEZpbGU+ID0gdGhpcy5tYXBDbGVhblVwbG9hZEZpbGVzKGZpbGVzKTtcclxuICAgIHRoaXMub25Nb2RlbENoYW5nZSA/IHRoaXMub25Nb2RlbENoYW5nZShtb2RlbEZpbGVzKSA6IHRoaXMubmdNb2RlbENoYW5nZS5lbWl0KG1vZGVsRmlsZXMpO1xyXG4gIH1cclxuXHJcbiAgLy8gRnVuw6fDo28gZGlzcGFyYWRhIGVucXVhbnRvIG8gYXJxdWl2byBlc3TDoSBzZW5kbyBlbnZpYWRvIGFvIHNlcnZpw6dvLlxyXG4gIHByaXZhdGUgdXBsb2FkaW5nSGFuZGxlcihmaWxlOiBhbnksIHBlcmNlbnQ6IG51bWJlcikge1xyXG4gICAgZmlsZS5zdGF0dXMgPSBQb1VwbG9hZFN0YXR1cy5VcGxvYWRpbmc7XHJcbiAgICBmaWxlLnBlcmNlbnQgPSBwZXJjZW50O1xyXG4gIH1cclxuXHJcbiAgLy8gcmV0b3JuYSBvcyBvYmpldG9zIGRvIGFycmF5IHNlbSBhcyBwcm9wcmllZGFkZXM6IHBlcmNlbnQgZSBkaXNwbGF5TmFtZVxyXG4gIHByaXZhdGUgbWFwQ2xlYW5VcGxvYWRGaWxlcyhmaWxlczogQXJyYXk8UG9VcGxvYWRGaWxlPik6IEFycmF5PFBvVXBsb2FkRmlsZT4ge1xyXG4gICAgY29uc3QgbWFwZWRCeVVwbG9hZEZpbGUgPSBwcm9ncmVzc0ZpbGUgPT4ge1xyXG4gICAgICBjb25zdCB7IHBlcmNlbnQsIGRpc3BsYXlOYW1lLCAuLi51cGxvYWRGaWxlIH0gPSBwcm9ncmVzc0ZpbGU7XHJcblxyXG4gICAgICByZXR1cm4gdXBsb2FkRmlsZTtcclxuICAgIH07XHJcblxyXG4gICAgcmV0dXJuIGZpbGVzLm1hcChtYXBlZEJ5VXBsb2FkRmlsZSk7XHJcbiAgfVxyXG59XHJcbiJdfQ==