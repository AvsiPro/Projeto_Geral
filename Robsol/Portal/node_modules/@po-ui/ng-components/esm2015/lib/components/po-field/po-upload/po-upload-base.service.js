import { Injectable } from '@angular/core';
import { HttpClient, HttpEventType, HttpRequest, HttpResponse, HttpHeaders } from '@angular/common/http';
export class PoUploadBaseService {
    constructor(http) {
        this.http = http;
        this.formField = 'files';
        this.requests = [];
    }
    /**
     * Método responsável por enviar os arquivos ao servidor, conforme o parâmetro URL.
     *
     * @param url URL da requisição a ser efetuada.
     * @param files Arquivos a serem enviados.
     * @param tOnUpload Função a ser executada quando o arquivo for enviado ao servidor.
     * @param uploadCallback Função que será executada enquanto os arquivos estiverem sendo enviados.
     * @param successCallback Função a ser executada quando a requisição for efetuada com sucesso.
     * @param errorCallback Função a ser executada quando a requisição foi efetuada com sucesso.
     */
    upload(url, files, headers, tOnUpload, uploadCallback, successCallback, errorCallback) {
        const filesLength = files.length;
        const uploadEvent = {
            data: {},
            file: null
        };
        for (let i = 0; i < filesLength; i++) {
            const formData = new FormData();
            const file = files[i];
            const fileName = file.rawFile.name;
            formData.append(this.formField, file.rawFile, fileName);
            // Função upload, onde o desenvolvedor pode enviar dados para a requisição.
            if (tOnUpload) {
                uploadEvent['file'] = file;
                tOnUpload.emit(uploadEvent);
                formData.append('data', JSON.stringify(uploadEvent.data));
            }
            this.sendFile(url, file, headers, formData, uploadCallback, successCallback, errorCallback);
        }
    }
    sendFile(url, file, headers, formData, uploadCallback, successCallback, errorCallback) {
        const request = this.getRequest(url, headers, formData).subscribe(event => {
            if (event.type === HttpEventType.UploadProgress) {
                this.addRequest(file, request);
                const percentDone = Math.round((100 * event.loaded) / event.total);
                uploadCallback(file, percentDone);
            }
            else if (event instanceof HttpResponse) {
                // Sucesso, arquivos enviados.
                successCallback(file, event);
            }
        }, (err) => {
            errorCallback(file, err);
        });
    }
    getRequest(url, headers, formData) {
        const httpHeaders = new HttpHeaders(headers);
        const req = new HttpRequest('POST', url, formData, {
            reportProgress: true,
            headers: httpHeaders
        });
        return this.http.request(req);
    }
    stopRequestByFile(file, callback) {
        const requestObj = this.requests.find(req => req.file.uid === file.uid);
        if (requestObj) {
            const request = requestObj.request;
            request.unsubscribe();
            this.removeRequest(requestObj);
            callback();
        }
    }
    removeRequest(requestObj) {
        const index = this.requests.indexOf(requestObj);
        this.requests.splice(index, 1);
    }
    addRequest(file, request) {
        const hasRequest = this.requests.some(req => req.file.uid === file.uid);
        if (!hasRequest) {
            this.requests.push({ file, request });
        }
    }
}
PoUploadBaseService.decorators = [
    { type: Injectable }
];
PoUploadBaseService.ctorParameters = () => [
    { type: HttpClient }
];
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG8tdXBsb2FkLWJhc2Uuc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL3VpL3NyYy9saWIvY29tcG9uZW50cy9wby1maWVsZC9wby11cGxvYWQvcG8tdXBsb2FkLWJhc2Uuc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsVUFBVSxFQUFnQixNQUFNLGVBQWUsQ0FBQztBQUN6RCxPQUFPLEVBQ0wsVUFBVSxFQUNWLGFBQWEsRUFFYixXQUFXLEVBQ1gsWUFBWSxFQUNaLFdBQVcsRUFDWixNQUFNLHNCQUFzQixDQUFDO0FBTzlCLE1BQU0sT0FBTyxtQkFBbUI7SUFJOUIsWUFBb0IsSUFBZ0I7UUFBaEIsU0FBSSxHQUFKLElBQUksQ0FBWTtRQUhwQyxjQUFTLEdBQVcsT0FBTyxDQUFDO1FBQzVCLGFBQVEsR0FBZSxFQUFFLENBQUM7SUFFYSxDQUFDO0lBRXhDOzs7Ozs7Ozs7T0FTRztJQUNJLE1BQU0sQ0FDWCxHQUFXLEVBQ1gsS0FBMEIsRUFDMUIsT0FBbUQsRUFDbkQsU0FBNEIsRUFDNUIsY0FBNkQsRUFDN0QsZUFBeUQsRUFDekQsYUFBdUQ7UUFFdkQsTUFBTSxXQUFXLEdBQUcsS0FBSyxDQUFDLE1BQU0sQ0FBQztRQUNqQyxNQUFNLFdBQVcsR0FBUTtZQUN2QixJQUFJLEVBQUUsRUFBRTtZQUNSLElBQUksRUFBRSxJQUFJO1NBQ1gsQ0FBQztRQUVGLEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxXQUFXLEVBQUUsQ0FBQyxFQUFFLEVBQUU7WUFDcEMsTUFBTSxRQUFRLEdBQWEsSUFBSSxRQUFRLEVBQUUsQ0FBQztZQUMxQyxNQUFNLElBQUksR0FBRyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDdEIsTUFBTSxRQUFRLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUM7WUFFbkMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsU0FBUyxFQUFFLElBQUksQ0FBQyxPQUFPLEVBQUUsUUFBUSxDQUFDLENBQUM7WUFFeEQsMkVBQTJFO1lBQzNFLElBQUksU0FBUyxFQUFFO2dCQUNiLFdBQVcsQ0FBQyxNQUFNLENBQUMsR0FBRyxJQUFJLENBQUM7Z0JBQzNCLFNBQVMsQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLENBQUM7Z0JBRTVCLFFBQVEsQ0FBQyxNQUFNLENBQUMsTUFBTSxFQUFFLElBQUksQ0FBQyxTQUFTLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUM7YUFDM0Q7WUFFRCxJQUFJLENBQUMsUUFBUSxDQUFDLEdBQUcsRUFBRSxJQUFJLEVBQUUsT0FBTyxFQUFFLFFBQVEsRUFBRSxjQUFjLEVBQUUsZUFBZSxFQUFFLGFBQWEsQ0FBQyxDQUFDO1NBQzdGO0lBQ0gsQ0FBQztJQUVNLFFBQVEsQ0FDYixHQUFXLEVBQ1gsSUFBa0IsRUFDbEIsT0FBbUQsRUFDbkQsUUFBa0IsRUFDbEIsY0FBNkQsRUFDN0QsZUFBeUQsRUFDekQsYUFBdUQ7UUFFdkQsTUFBTSxPQUFPLEdBQUcsSUFBSSxDQUFDLFVBQVUsQ0FBQyxHQUFHLEVBQUUsT0FBTyxFQUFFLFFBQVEsQ0FBQyxDQUFDLFNBQVMsQ0FDL0QsS0FBSyxDQUFDLEVBQUU7WUFDTixJQUFJLEtBQUssQ0FBQyxJQUFJLEtBQUssYUFBYSxDQUFDLGNBQWMsRUFBRTtnQkFDL0MsSUFBSSxDQUFDLFVBQVUsQ0FBQyxJQUFJLEVBQUUsT0FBTyxDQUFDLENBQUM7Z0JBRS9CLE1BQU0sV0FBVyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxHQUFHLEdBQUcsS0FBSyxDQUFDLE1BQU0sQ0FBQyxHQUFHLEtBQUssQ0FBQyxLQUFLLENBQUMsQ0FBQztnQkFDbkUsY0FBYyxDQUFDLElBQUksRUFBRSxXQUFXLENBQUMsQ0FBQzthQUNuQztpQkFBTSxJQUFJLEtBQUssWUFBWSxZQUFZLEVBQUU7Z0JBQ3hDLDhCQUE4QjtnQkFDOUIsZUFBZSxDQUFDLElBQUksRUFBRSxLQUFLLENBQUMsQ0FBQzthQUM5QjtRQUNILENBQUMsRUFDRCxDQUFDLEdBQXNCLEVBQUUsRUFBRTtZQUN6QixhQUFhLENBQUMsSUFBSSxFQUFFLEdBQUcsQ0FBQyxDQUFDO1FBQzNCLENBQUMsQ0FDRixDQUFDO0lBQ0osQ0FBQztJQUVNLFVBQVUsQ0FDZixHQUFXLEVBQ1gsT0FBbUQsRUFDbkQsUUFBa0I7UUFFbEIsTUFBTSxXQUFXLEdBQUcsSUFBSSxXQUFXLENBQUMsT0FBTyxDQUFDLENBQUM7UUFFN0MsTUFBTSxHQUFHLEdBQUcsSUFBSSxXQUFXLENBQUMsTUFBTSxFQUFFLEdBQUcsRUFBRSxRQUFRLEVBQUU7WUFDakQsY0FBYyxFQUFFLElBQUk7WUFDcEIsT0FBTyxFQUFFLFdBQVc7U0FDckIsQ0FBQyxDQUFDO1FBQ0gsT0FBTyxJQUFJLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsQ0FBQztJQUNoQyxDQUFDO0lBRU0saUJBQWlCLENBQUMsSUFBUyxFQUFFLFFBQW9CO1FBQ3RELE1BQU0sVUFBVSxHQUFHLElBQUksQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxHQUFHLEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBRXhFLElBQUksVUFBVSxFQUFFO1lBQ2QsTUFBTSxPQUFPLEdBQUcsVUFBVSxDQUFDLE9BQU8sQ0FBQztZQUNuQyxPQUFPLENBQUMsV0FBVyxFQUFFLENBQUM7WUFDdEIsSUFBSSxDQUFDLGFBQWEsQ0FBQyxVQUFVLENBQUMsQ0FBQztZQUMvQixRQUFRLEVBQUUsQ0FBQztTQUNaO0lBQ0gsQ0FBQztJQUVNLGFBQWEsQ0FBQyxVQUFlO1FBQ2xDLE1BQU0sS0FBSyxHQUFHLElBQUksQ0FBQyxRQUFRLENBQUMsT0FBTyxDQUFDLFVBQVUsQ0FBQyxDQUFDO1FBQ2hELElBQUksQ0FBQyxRQUFRLENBQUMsTUFBTSxDQUFDLEtBQUssRUFBRSxDQUFDLENBQUMsQ0FBQztJQUNqQyxDQUFDO0lBRU0sVUFBVSxDQUFDLElBQWtCLEVBQUUsT0FBcUI7UUFDekQsTUFBTSxVQUFVLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLEdBQUcsS0FBSyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7UUFFeEUsSUFBSSxDQUFDLFVBQVUsRUFBRTtZQUNmLElBQUksQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLEVBQUUsSUFBSSxFQUFFLE9BQU8sRUFBRSxDQUFDLENBQUM7U0FDdkM7SUFDSCxDQUFDOzs7WUFsSEYsVUFBVTs7O1lBWlQsVUFBVSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEluamVjdGFibGUsIEV2ZW50RW1pdHRlciB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQge1xyXG4gIEh0dHBDbGllbnQsXHJcbiAgSHR0cEV2ZW50VHlwZSxcclxuICBIdHRwRXJyb3JSZXNwb25zZSxcclxuICBIdHRwUmVxdWVzdCxcclxuICBIdHRwUmVzcG9uc2UsXHJcbiAgSHR0cEhlYWRlcnNcclxufSBmcm9tICdAYW5ndWxhci9jb21tb24vaHR0cCc7XHJcblxyXG5pbXBvcnQgeyBQb1VwbG9hZEZpbGUgfSBmcm9tICcuL3BvLXVwbG9hZC1maWxlJztcclxuXHJcbmltcG9ydCB7IE9ic2VydmFibGUsIFN1YnNjcmlwdGlvbiB9IGZyb20gJ3J4anMnO1xyXG5cclxuQEluamVjdGFibGUoKVxyXG5leHBvcnQgY2xhc3MgUG9VcGxvYWRCYXNlU2VydmljZSB7XHJcbiAgZm9ybUZpZWxkOiBzdHJpbmcgPSAnZmlsZXMnO1xyXG4gIHJlcXVlc3RzOiBBcnJheTxhbnk+ID0gW107XHJcblxyXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgaHR0cDogSHR0cENsaWVudCkge31cclxuXHJcbiAgLyoqXHJcbiAgICogTcOpdG9kbyByZXNwb25zw6F2ZWwgcG9yIGVudmlhciBvcyBhcnF1aXZvcyBhbyBzZXJ2aWRvciwgY29uZm9ybWUgbyBwYXLDom1ldHJvIFVSTC5cclxuICAgKlxyXG4gICAqIEBwYXJhbSB1cmwgVVJMIGRhIHJlcXVpc2nDp8OjbyBhIHNlciBlZmV0dWFkYS5cclxuICAgKiBAcGFyYW0gZmlsZXMgQXJxdWl2b3MgYSBzZXJlbSBlbnZpYWRvcy5cclxuICAgKiBAcGFyYW0gdE9uVXBsb2FkIEZ1bsOnw6NvIGEgc2VyIGV4ZWN1dGFkYSBxdWFuZG8gbyBhcnF1aXZvIGZvciBlbnZpYWRvIGFvIHNlcnZpZG9yLlxyXG4gICAqIEBwYXJhbSB1cGxvYWRDYWxsYmFjayBGdW7Dp8OjbyBxdWUgc2Vyw6EgZXhlY3V0YWRhIGVucXVhbnRvIG9zIGFycXVpdm9zIGVzdGl2ZXJlbSBzZW5kbyBlbnZpYWRvcy5cclxuICAgKiBAcGFyYW0gc3VjY2Vzc0NhbGxiYWNrIEZ1bsOnw6NvIGEgc2VyIGV4ZWN1dGFkYSBxdWFuZG8gYSByZXF1aXNpw6fDo28gZm9yIGVmZXR1YWRhIGNvbSBzdWNlc3NvLlxyXG4gICAqIEBwYXJhbSBlcnJvckNhbGxiYWNrIEZ1bsOnw6NvIGEgc2VyIGV4ZWN1dGFkYSBxdWFuZG8gYSByZXF1aXNpw6fDo28gZm9pIGVmZXR1YWRhIGNvbSBzdWNlc3NvLlxyXG4gICAqL1xyXG4gIHB1YmxpYyB1cGxvYWQoXHJcbiAgICB1cmw6IHN0cmluZyxcclxuICAgIGZpbGVzOiBBcnJheTxQb1VwbG9hZEZpbGU+LFxyXG4gICAgaGVhZGVyczogeyBbbmFtZTogc3RyaW5nXTogc3RyaW5nIHwgQXJyYXk8c3RyaW5nPiB9LFxyXG4gICAgdE9uVXBsb2FkOiBFdmVudEVtaXR0ZXI8YW55PixcclxuICAgIHVwbG9hZENhbGxiYWNrOiAoZmlsZTogUG9VcGxvYWRGaWxlLCBwZXJjZW50OiBudW1iZXIpID0+IHZvaWQsXHJcbiAgICBzdWNjZXNzQ2FsbGJhY2s6IChmaWxlOiBQb1VwbG9hZEZpbGUsIGV2ZW50OiBhbnkpID0+IHZvaWQsXHJcbiAgICBlcnJvckNhbGxiYWNrOiAoZmlsZTogUG9VcGxvYWRGaWxlLCBldmVudDogYW55KSA9PiB2b2lkXHJcbiAgKSB7XHJcbiAgICBjb25zdCBmaWxlc0xlbmd0aCA9IGZpbGVzLmxlbmd0aDtcclxuICAgIGNvbnN0IHVwbG9hZEV2ZW50OiBhbnkgPSB7XHJcbiAgICAgIGRhdGE6IHt9LFxyXG4gICAgICBmaWxlOiBudWxsXHJcbiAgICB9O1xyXG5cclxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZmlsZXNMZW5ndGg7IGkrKykge1xyXG4gICAgICBjb25zdCBmb3JtRGF0YTogRm9ybURhdGEgPSBuZXcgRm9ybURhdGEoKTtcclxuICAgICAgY29uc3QgZmlsZSA9IGZpbGVzW2ldO1xyXG4gICAgICBjb25zdCBmaWxlTmFtZSA9IGZpbGUucmF3RmlsZS5uYW1lO1xyXG5cclxuICAgICAgZm9ybURhdGEuYXBwZW5kKHRoaXMuZm9ybUZpZWxkLCBmaWxlLnJhd0ZpbGUsIGZpbGVOYW1lKTtcclxuXHJcbiAgICAgIC8vIEZ1bsOnw6NvIHVwbG9hZCwgb25kZSBvIGRlc2Vudm9sdmVkb3IgcG9kZSBlbnZpYXIgZGFkb3MgcGFyYSBhIHJlcXVpc2nDp8Ojby5cclxuICAgICAgaWYgKHRPblVwbG9hZCkge1xyXG4gICAgICAgIHVwbG9hZEV2ZW50WydmaWxlJ10gPSBmaWxlO1xyXG4gICAgICAgIHRPblVwbG9hZC5lbWl0KHVwbG9hZEV2ZW50KTtcclxuXHJcbiAgICAgICAgZm9ybURhdGEuYXBwZW5kKCdkYXRhJywgSlNPTi5zdHJpbmdpZnkodXBsb2FkRXZlbnQuZGF0YSkpO1xyXG4gICAgICB9XHJcblxyXG4gICAgICB0aGlzLnNlbmRGaWxlKHVybCwgZmlsZSwgaGVhZGVycywgZm9ybURhdGEsIHVwbG9hZENhbGxiYWNrLCBzdWNjZXNzQ2FsbGJhY2ssIGVycm9yQ2FsbGJhY2spO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcHVibGljIHNlbmRGaWxlKFxyXG4gICAgdXJsOiBzdHJpbmcsXHJcbiAgICBmaWxlOiBQb1VwbG9hZEZpbGUsXHJcbiAgICBoZWFkZXJzOiB7IFtuYW1lOiBzdHJpbmddOiBzdHJpbmcgfCBBcnJheTxzdHJpbmc+IH0sXHJcbiAgICBmb3JtRGF0YTogRm9ybURhdGEsXHJcbiAgICB1cGxvYWRDYWxsYmFjazogKGZpbGU6IFBvVXBsb2FkRmlsZSwgcGVyY2VudDogbnVtYmVyKSA9PiB2b2lkLFxyXG4gICAgc3VjY2Vzc0NhbGxiYWNrOiAoZmlsZTogUG9VcGxvYWRGaWxlLCBldmVudDogYW55KSA9PiB2b2lkLFxyXG4gICAgZXJyb3JDYWxsYmFjazogKGZpbGU6IFBvVXBsb2FkRmlsZSwgZXZlbnQ6IGFueSkgPT4gdm9pZFxyXG4gICkge1xyXG4gICAgY29uc3QgcmVxdWVzdCA9IHRoaXMuZ2V0UmVxdWVzdCh1cmwsIGhlYWRlcnMsIGZvcm1EYXRhKS5zdWJzY3JpYmUoXHJcbiAgICAgIGV2ZW50ID0+IHtcclxuICAgICAgICBpZiAoZXZlbnQudHlwZSA9PT0gSHR0cEV2ZW50VHlwZS5VcGxvYWRQcm9ncmVzcykge1xyXG4gICAgICAgICAgdGhpcy5hZGRSZXF1ZXN0KGZpbGUsIHJlcXVlc3QpO1xyXG5cclxuICAgICAgICAgIGNvbnN0IHBlcmNlbnREb25lID0gTWF0aC5yb3VuZCgoMTAwICogZXZlbnQubG9hZGVkKSAvIGV2ZW50LnRvdGFsKTtcclxuICAgICAgICAgIHVwbG9hZENhbGxiYWNrKGZpbGUsIHBlcmNlbnREb25lKTtcclxuICAgICAgICB9IGVsc2UgaWYgKGV2ZW50IGluc3RhbmNlb2YgSHR0cFJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAvLyBTdWNlc3NvLCBhcnF1aXZvcyBlbnZpYWRvcy5cclxuICAgICAgICAgIHN1Y2Nlc3NDYWxsYmFjayhmaWxlLCBldmVudCk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9LFxyXG4gICAgICAoZXJyOiBIdHRwRXJyb3JSZXNwb25zZSkgPT4ge1xyXG4gICAgICAgIGVycm9yQ2FsbGJhY2soZmlsZSwgZXJyKTtcclxuICAgICAgfVxyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBnZXRSZXF1ZXN0KFxyXG4gICAgdXJsOiBzdHJpbmcsXHJcbiAgICBoZWFkZXJzOiB7IFtuYW1lOiBzdHJpbmddOiBzdHJpbmcgfCBBcnJheTxzdHJpbmc+IH0sXHJcbiAgICBmb3JtRGF0YTogRm9ybURhdGFcclxuICApOiBPYnNlcnZhYmxlPGFueT4ge1xyXG4gICAgY29uc3QgaHR0cEhlYWRlcnMgPSBuZXcgSHR0cEhlYWRlcnMoaGVhZGVycyk7XHJcblxyXG4gICAgY29uc3QgcmVxID0gbmV3IEh0dHBSZXF1ZXN0KCdQT1NUJywgdXJsLCBmb3JtRGF0YSwge1xyXG4gICAgICByZXBvcnRQcm9ncmVzczogdHJ1ZSxcclxuICAgICAgaGVhZGVyczogaHR0cEhlYWRlcnNcclxuICAgIH0pO1xyXG4gICAgcmV0dXJuIHRoaXMuaHR0cC5yZXF1ZXN0KHJlcSk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgc3RvcFJlcXVlc3RCeUZpbGUoZmlsZTogYW55LCBjYWxsYmFjazogKCkgPT4gdm9pZCkge1xyXG4gICAgY29uc3QgcmVxdWVzdE9iaiA9IHRoaXMucmVxdWVzdHMuZmluZChyZXEgPT4gcmVxLmZpbGUudWlkID09PSBmaWxlLnVpZCk7XHJcblxyXG4gICAgaWYgKHJlcXVlc3RPYmopIHtcclxuICAgICAgY29uc3QgcmVxdWVzdCA9IHJlcXVlc3RPYmoucmVxdWVzdDtcclxuICAgICAgcmVxdWVzdC51bnN1YnNjcmliZSgpO1xyXG4gICAgICB0aGlzLnJlbW92ZVJlcXVlc3QocmVxdWVzdE9iaik7XHJcbiAgICAgIGNhbGxiYWNrKCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgcmVtb3ZlUmVxdWVzdChyZXF1ZXN0T2JqOiBhbnkpIHtcclxuICAgIGNvbnN0IGluZGV4ID0gdGhpcy5yZXF1ZXN0cy5pbmRleE9mKHJlcXVlc3RPYmopO1xyXG4gICAgdGhpcy5yZXF1ZXN0cy5zcGxpY2UoaW5kZXgsIDEpO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGFkZFJlcXVlc3QoZmlsZTogUG9VcGxvYWRGaWxlLCByZXF1ZXN0OiBTdWJzY3JpcHRpb24pIHtcclxuICAgIGNvbnN0IGhhc1JlcXVlc3QgPSB0aGlzLnJlcXVlc3RzLnNvbWUocmVxID0+IHJlcS5maWxlLnVpZCA9PT0gZmlsZS51aWQpO1xyXG5cclxuICAgIGlmICghaGFzUmVxdWVzdCkge1xyXG4gICAgICB0aGlzLnJlcXVlc3RzLnB1c2goeyBmaWxlLCByZXF1ZXN0IH0pO1xyXG4gICAgfVxyXG4gIH1cclxufVxyXG4iXX0=