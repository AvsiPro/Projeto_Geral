import { EventEmitter, Input, Output, Directive } from '@angular/core';
import { convertToBoolean } from '../../utils/util';
import { PoLanguageService } from '../../services/po-language/po-language.service';
import { poLocaleDefault } from '../../services/po-language/po-language.constant';
export const poListViewLiteralsDefault = {
    en: {
        hideDetails: 'Hide details',
        loadMoreData: 'Load more data',
        noData: 'No data found',
        selectAll: 'Select all',
        showDetails: 'Show details'
    },
    es: {
        hideDetails: 'Ocultar detalles',
        loadMoreData: 'Cargar más resultados',
        noData: 'Datos no encontrados',
        selectAll: 'Seleccionar todos',
        showDetails: 'Mostrar detalles'
    },
    pt: {
        hideDetails: 'Ocultar detalhes',
        loadMoreData: 'Carregar mais resultados',
        noData: 'Nenhum dado encontrado',
        selectAll: 'Selecionar todos',
        showDetails: 'Exibir detalhes'
    },
    ru: {
        hideDetails: 'Скрыть детали',
        loadMoreData: 'Загрузить больше результатов',
        noData: 'Данные не найдены',
        selectAll: 'Выбрать все',
        showDetails: 'Посмотреть детали'
    }
};
/**
 * @description
 *
 * Componente de lista que recebe um array de objetos e renderiza de forma dinâmica os dados de
 * acordo com a necessidade de cada tela e deve ser utilizado em conjunto com as diretivas de *templates*
 *  **[p-list-view-content-template](/documentation/po-list-view-content-template)** e
 * **[p-list-view-detail-template](/documentation/po-list-view-detail-template)**.
 *
 * O componente disponibiliza uma área específica para exibição informações adicionais,
 * através da diretiva **[p-list-view-detail-template](/documentation/po-list-view-detail-template)**.
 */
export class PoListViewBaseComponent {
    constructor(languageService) {
        /**
         * @optional
         *
         * @description
         *
         * Recebe uma ação, que será executada quando clicar no botão "Carregar mais resultados".
         *
         * > Caso nenhuma ação for definida o mesmo não ficará visível.
         */
        this.showMore = new EventEmitter();
        /**
         * @optional
         *
         * @description
         *
         * Ação que será executada ao clicar no título.
         *
         * Ao ser disparado, o método inserido na ação irá receber como parâmetro o item da lista clicado.
         */
        this.titleAction = new EventEmitter();
        this.selectAll = false;
        this.showHeader = false;
        this.language = poLocaleDefault;
        this.language = languageService.getShortLanguage();
    }
    /**
     * @optional
     *
     * @description
     *
     * Lista de ações que serão exibidas no componente.
     */
    set actions(value) {
        this._actions = Array.isArray(value) ? value : [];
    }
    get actions() {
        return this._actions;
    }
    /**
     * @optional
     *
     * @description
     *
     * Define a altura do `po-list-view` em *pixels*.
     */
    set height(height) {
        this._height = height;
    }
    get height() {
        return this._height;
    }
    /**
     * @description
     *
     * Esconde o *checkbox* para seleção de todos os itens.
     *
     * @default `false`
     */
    set hideSelectAll(hideSelectAll) {
        this._hideSelectAll = convertToBoolean(hideSelectAll);
        this.showMainHeader();
    }
    get hideSelectAll() {
        return this._hideSelectAll;
    }
    /** Lista de itens que serão exibidos no componente. */
    set items(value) {
        this._items = Array.isArray(value) ? value : [];
    }
    get items() {
        return this._items;
    }
    /**
     * @optional
     *
     * @description
     *
     * Objeto com as literais usadas no `po-list-view`.
     *
     * Existem duas maneiras de customizar o componente, passando um objeto com todas as literais disponíveis:
     *
     * ```
     *  const customLiterals: PoListViewLiterals = {
     *    hideDetail: 'Ocultar detalhes completamente',
     *    loadMoreData: 'Mais dados',
     *    showDetail: 'Mostrar mais detalhes',
     *    selectAll: 'Selecionar todos os itens'
     *  };
     * ```
     *
     * Ou passando apenas as literais que deseja customizar:
     *
     * ```
     *  const customLiterals: PoListViewLiterals = {
     *    showDetail: 'Mostrar mais detalhes'
     *  };
     * ```
     *
     * E para carregar as literais customizadas, basta apenas passar o objeto para o componente.
     *
     * ```
     * <po-list-view
     *   [p-literals]="customLiterals">
     * </po-list-view>
     * ```
     *
     * > O objeto padrão de literais será traduzido de acordo com o idioma do
     * [`PoI18nService`](/documentation/po-i18n) ou do browser.
     */
    set literals(value) {
        if (value instanceof Object && !(value instanceof Array)) {
            this._literals = Object.assign(Object.assign(Object.assign({}, poListViewLiteralsDefault[poLocaleDefault]), poListViewLiteralsDefault[this.language]), value);
        }
        else {
            this._literals = poListViewLiteralsDefault[this.language];
        }
    }
    get literals() {
        return this._literals || poListViewLiteralsDefault[this.language];
    }
    /**
     * @optional
     *
     * @description
     *
     * Habilita um *checkbox* para cada item da lista. Todos os items possuem a propriedade dinâmica `$selected` para identificar se o
     * item está selecionado, por exemplo:
     *
     * ```
     *  item.$selected
     *
     *  // ou
     *
     *  item['$selected']
     * ```
     *
     * @default `false`
     */
    set select(select) {
        this._select = convertToBoolean(select);
        this.showMainHeader();
    }
    get select() {
        return this._select;
    }
    /**
     * @optional
     *
     * @description
     *
     * Indica que o botão `Carregar Mais Resultados` será desabilitado.
     */
    set showMoreDisabled(value) {
        this._showMoreDisabled = convertToBoolean(value);
    }
    get showMoreDisabled() {
        return this._showMoreDisabled;
    }
    onClickAction(listViewAction, item) {
        const cleanItem = this.deleteInternalAttrs(item);
        if (listViewAction.action) {
            listViewAction.action(cleanItem);
        }
    }
    onShowMore() {
        this.showMore.emit();
    }
    runTitleAction(listItem) {
        const itemWithPublicProperties = this.deleteInternalAttrs(listItem);
        this.titleAction.emit(itemWithPublicProperties);
    }
    selectAllListItems() {
        if (!this.hideSelectAll) {
            this.selectAll = !this.selectAll;
            this.items.forEach(item => {
                item.$selected = this.selectAll;
            });
        }
    }
    selectListItem(row) {
        row.$selected = !row.$selected;
        this.selectAll = this.checkIfItemsAreSelected(this.items);
    }
    deleteInternalAttrs(item) {
        const itemCopy = item ? Object.assign({}, item) : undefined;
        for (const key in itemCopy) {
            if (itemCopy.hasOwnProperty(key) && key.startsWith('$')) {
                delete itemCopy[key];
            }
        }
        return itemCopy;
    }
    checkIfItemsAreSelected(items) {
        const someCheckedOrIndeterminate = item => item.$selected || item.$selected === null;
        const everyChecked = item => item.$selected;
        if (items.every(everyChecked)) {
            return true;
        }
        if (items.some(someCheckedOrIndeterminate)) {
            return null;
        }
        return false;
    }
    showMainHeader() {
        this.showHeader = !!(this.select && !this.hideSelectAll && this.items && this.items.length);
    }
}
PoListViewBaseComponent.decorators = [
    { type: Directive }
];
PoListViewBaseComponent.ctorParameters = () => [
    { type: PoLanguageService }
];
PoListViewBaseComponent.propDecorators = {
    propertyLink: [{ type: Input, args: ['p-property-link',] }],
    propertyTitle: [{ type: Input, args: ['p-property-title',] }],
    showMore: [{ type: Output, args: ['p-show-more',] }],
    titleAction: [{ type: Output, args: ['p-title-action',] }],
    actions: [{ type: Input, args: ['p-actions',] }],
    height: [{ type: Input, args: ['p-height',] }],
    hideSelectAll: [{ type: Input, args: ['p-hide-select-all',] }],
    items: [{ type: Input, args: ['p-items',] }],
    literals: [{ type: Input, args: ['p-literals',] }],
    select: [{ type: Input, args: ['p-select',] }],
    showMoreDisabled: [{ type: Input, args: ['p-show-more-disabled',] }]
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG8tbGlzdC12aWV3LWJhc2UuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vcHJvamVjdHMvdWkvc3JjL2xpYi9jb21wb25lbnRzL3BvLWxpc3Qtdmlldy9wby1saXN0LXZpZXctYmFzZS5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLFlBQVksRUFBRSxLQUFLLEVBQUUsTUFBTSxFQUFFLFNBQVMsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUV2RSxPQUFPLEVBQUUsZ0JBQWdCLEVBQUUsTUFBTSxrQkFBa0IsQ0FBQztBQUNwRCxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSxnREFBZ0QsQ0FBQztBQUNuRixPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0saURBQWlELENBQUM7QUFJbEYsTUFBTSxDQUFDLE1BQU0seUJBQXlCLEdBQUc7SUFDdkMsRUFBRSxFQUFzQjtRQUN0QixXQUFXLEVBQUUsY0FBYztRQUMzQixZQUFZLEVBQUUsZ0JBQWdCO1FBQzlCLE1BQU0sRUFBRSxlQUFlO1FBQ3ZCLFNBQVMsRUFBRSxZQUFZO1FBQ3ZCLFdBQVcsRUFBRSxjQUFjO0tBQzVCO0lBQ0QsRUFBRSxFQUFzQjtRQUN0QixXQUFXLEVBQUUsa0JBQWtCO1FBQy9CLFlBQVksRUFBRSx1QkFBdUI7UUFDckMsTUFBTSxFQUFFLHNCQUFzQjtRQUM5QixTQUFTLEVBQUUsbUJBQW1CO1FBQzlCLFdBQVcsRUFBRSxrQkFBa0I7S0FDaEM7SUFDRCxFQUFFLEVBQXNCO1FBQ3RCLFdBQVcsRUFBRSxrQkFBa0I7UUFDL0IsWUFBWSxFQUFFLDBCQUEwQjtRQUN4QyxNQUFNLEVBQUUsd0JBQXdCO1FBQ2hDLFNBQVMsRUFBRSxrQkFBa0I7UUFDN0IsV0FBVyxFQUFFLGlCQUFpQjtLQUMvQjtJQUNELEVBQUUsRUFBc0I7UUFDdEIsV0FBVyxFQUFFLGVBQWU7UUFDNUIsWUFBWSxFQUFFLDhCQUE4QjtR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a0JBQWtCO3VCQVd4QixNQUFNLFNBQUMsYUFBYTswQkFXcEIsTUFBTSxTQUFDLGdCQUFnQjtzQkFzQnZCLEtBQUssU0FBQyxXQUFXO3FCQWVqQixLQUFLLFNBQUMsVUFBVTs0QkFlaEIsS0FBSyxTQUFDLG1CQUFtQjtvQkFVekIsS0FBSyxTQUFDLFNBQVM7dUJBNkNmLEtBQUssU0FBQyxZQUFZO3FCQWtDbEIsS0FBSyxTQUFDLFVBQVU7K0JBZ0JoQixLQUFLLFNBQUMsc0JBQXNCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgRXZlbnRFbWl0dGVyLCBJbnB1dCwgT3V0cHV0LCBEaXJlY3RpdmUgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuXHJcbmltcG9ydCB7IGNvbnZlcnRUb0Jvb2xlYW4gfSBmcm9tICcuLi8uLi91dGlscy91dGlsJztcclxuaW1wb3J0IHsgUG9MYW5ndWFnZVNlcnZpY2UgfSBmcm9tICcuLi8uLi9zZXJ2aWNlcy9wby1sYW5ndWFnZS9wby1sYW5ndWFnZS5zZXJ2aWNlJztcclxuaW1wb3J0IHsgcG9Mb2NhbGVEZWZhdWx0IH0gZnJvbSAnLi4vLi4vc2VydmljZXMvcG8tbGFuZ3VhZ2UvcG8tbGFuZ3VhZ2UuY29uc3RhbnQnO1xyXG5pbXBvcnQgeyBQb0xpc3RWaWV3QWN0aW9uIH0gZnJvbSAnLi9pbnRlcmZhY2VzL3BvLWxpc3Qtdmlldy1hY3Rpb24uaW50ZXJmYWNlJztcclxuaW1wb3J0IHsgUG9MaXN0Vmlld0xpdGVyYWxzIH0gZnJvbSAnLi9pbnRlcmZhY2VzL3BvLWxpc3Qtdmlldy1saXRlcmFscy5pbnRlcmZhY2UnO1xyXG5cclxuZXhwb3J0IGNvbnN0IHBvTGlzdFZpZXdMaXRlcmFsc0RlZmF1bHQgPSB7XHJcbiAgZW46IDxQb0xpc3RWaWV3TGl0ZXJhbHM+e1xyXG4gICAgaGlkZURldGFpbHM6ICdIaWRlIGRldGFpbHMnLFxyXG4gICAgbG9hZE1vcmVEYXRhOiAnTG9hZCBtb3JlIGRhdGEnLFxyXG4gICAgbm9EYXRhOiAnTm8gZGF0YSBmb3VuZCcsXHJcbiAgICBzZWxlY3RBbGw6ICdTZWxlY3QgYWxsJyxcclxuICAgIHNob3dEZXRhaWxzOiAnU2hvdyBkZXRhaWxzJ1xyXG4gIH0sXHJcbiAgZXM6IDxQb0xpc3RWaWV3TGl0ZXJhbHM+e1xyXG4gICAgaGlkZURldGFpbHM6ICdPY3VsdGFyIGRldGFsbGVzJyxcclxuICAgIGxvYWRNb3JlRGF0YTogJ0NhcmdhciBtw6FzIHJlc3VsdGFkb3MnLFxyXG4gICAgbm9EYXRhOiAnRGF0b3Mgbm8gZW5jb250cmFkb3MnLFxyXG4gICAgc2VsZWN0QWxsOiAnU2VsZWNjaW9uYXIgdG9kb3MnLFxyXG4gICAgc2hvd0RldGFpbHM6ICdNb3N0cmFyIGRldGFsbGVzJ1xyXG4gIH0sXHJcbiAgcHQ6IDxQb0xpc3RWaWV3TGl0ZXJhbHM+e1xyXG4gICAgaGlkZURldGFpbHM6ICdPY3VsdGFyIGRldGFsaGVzJyxcclxuICAgIGxvYWRNb3JlRGF0YTogJ0NhcnJlZ2FyIG1haXMgcmVzdWx0YWRvcycsXHJcbiAgICBub0RhdGE6ICdOZW5odW0gZGFkbyBlbmNvbnRyYWRvJyxcclxuICAgIHNlbGVjdEFsbDogJ1NlbGVjaW9uYXIgdG9kb3MnLFxyXG4gICAgc2hvd0RldGFpbHM6ICdFeGliaXIgZGV0YWxoZXMnXHJcbiAgfSxcclxuICBydTogPFBvTGlzdFZpZXdMaXRlcmFscz57XHJcbiAgICBoaWRlRGV0YWlsczogJ9Ch0LrRgNGL0YLRjCDQtNC10YLQsNC70LgnLFxyXG4gICAgbG9hZE1vcmVEYXRhOiAn0JfQsNCz0YDRg9C30LjRgtGMINCx0L7Qu9GM0YjQtSDRgNC10LfRg9C70YzRgtCw0YLQvtCyJyxcclxuICAgIG5vRGF0YTogJ9CU0LDQvdC90YvQtSDQvdC1INC90LDQudC00LXQvdGLJyxcclxuICAgIHNlbGVjdEFsbDogJ9CS0YvQsdGA0LDRgtGMINCy0YHQtScsXHJcbiAgICBzaG93RGV0YWlsczogJ9Cf0L7RgdC80L7RgtGA0LXRgtGMINC00LXRgtCw0LvQuCdcclxuICB9XHJcbn07XHJcblxyXG4vKipcclxuICogQGRlc2NyaXB0aW9uXHJcbiAqXHJcbiAqIENvbXBvbmVudGUgZGUgbGlzdGEgcXVlIHJlY2ViZSB1bSBhcnJheSBkZSBvYmpldG9zIGUgcmVuZGVyaXphIGRlIGZvcm1hIGRpbsOibWljYSBvcyBkYWRvcyBkZVxyXG4gKiBhY29yZG8gY29tIGEgbmVjZXNzaWRhZGUgZGUgY2FkYSB0ZWxhIGUgZGV2ZSBzZXIgdXRpbGl6YWRvIGVtIGNvbmp1bnRvIGNvbSBhcyBkaXJldGl2YXMgZGUgKnRlbXBsYXRlcypcclxuICogICoqW3AtbGlzdC12aWV3LWNvbnRlbnQtdGVtcGxhdGVdKC9kb2N1bWVudGF0aW9uL3BvLWxpc3Qtdmlldy1jb250ZW50LXRlbXBsYXRlKSoqIGVcclxuICogKipbcC1saXN0LXZpZXctZGV0YWlsLXRlbXBsYXRlXSgvZG9jdW1lbnRhdGlvbi9wby1saXN0LXZpZXctZGV0YWlsLXRlbXBsYXRlKSoqLlxyXG4gKlxyXG4gKiBPIGNvbXBvbmVudGUgZGlzcG9uaWJpbGl6YSB1bWEgw6FyZWEgZXNwZWPDrWZpY2EgcGFyYSBleGliacOnw6NvIGluZm9ybWHDp8O1ZXMgYWRpY2lvbmFpcyxcclxuICogYXRyYXbDqXMgZGEgZGlyZXRpdmEgKipbcC1saXN0LXZpZXctZGV0YWlsLXRlbXBsYXRlXSgvZG9jdW1lbnRhdGlvbi9wby1saXN0LXZpZXctZGV0YWlsLXRlbXBsYXRlKSoqLlxyXG4gKi9cclxuQERpcmVjdGl2ZSgpXHJcbmV4cG9ydCBjbGFzcyBQb0xpc3RWaWV3QmFzZUNvbXBvbmVudCB7XHJcbiAgLyoqIFJlY2ViZSB1bWEgcHJvcHJpZWRhZGUgcXVlIHNlcsOhIHV0aWxpemFkYSBwYXJhIHJlY3VwZXJhciBvIHZhbG9yIGRvIG9iamV0byBxdWUgc2Vyw6EgdXNhZG8gY29tbyBsaW5rIHBhcmEgbyB0w610dWxvLiAqL1xyXG4gIEBJbnB1dCgncC1wcm9wZXJ0eS1saW5rJykgcHJvcGVydHlMaW5rPzogc3RyaW5nO1xyXG5cclxuICAvKiogUmVjZWJlIHVtYSBwcm9wcmllZGFkZSBxdWUgc2Vyw6EgdXRpbGl6YWRhIHBhcmEgcmVjdXBlcmFyIG8gdmFsb3IgZG8gb2JqZXRvIHF1ZSBzZXLDoSBleGliaWRvIGNvbW8gbyB0w610dWxvIGRlIGNhZGEgaXRlbS4gKi9cclxuICBASW5wdXQoJ3AtcHJvcGVydHktdGl0bGUnKSBwcm9wZXJ0eVRpdGxlPzogc3RyaW5nO1xyXG5cclxuICAvKipcclxuICAgKiBAb3B0aW9uYWxcclxuICAgKlxyXG4gICAqIEBkZXNjcmlwdGlvblxyXG4gICAqXHJcbiAgICogUmVjZWJlIHVtYSBhw6fDo28sIHF1ZSBzZXLDoSBleGVjdXRhZGEgcXVhbmRvIGNsaWNhciBubyBib3TDo28gXCJDYXJyZWdhciBtYWlzIHJlc3VsdGFkb3NcIi5cclxuICAgKlxyXG4gICAqID4gQ2FzbyBuZW5odW1hIGHDp8OjbyBmb3IgZGVmaW5pZGEgbyBtZXNtbyBuw6NvIGZpY2Fyw6Egdmlzw612ZWwuXHJcbiAgICovXHJcbiAgQE91dHB1dCgncC1zaG93LW1vcmUnKSBzaG93TW9yZTogRXZlbnRFbWl0dGVyPGFueT4gPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcclxuXHJcbiAgLyoqXHJcbiAgICogQG9wdGlvbmFsXHJcbiAgICpcclxuICAgKiBAZGVzY3JpcHRpb25cclxuICAgKlxyXG4gICAqIEHDp8OjbyBxdWUgc2Vyw6EgZXhlY3V0YWRhIGFvIGNsaWNhciBubyB0w610dWxvLlxyXG4gICAqXHJcbiAgICogQW8gc2VyIGRpc3BhcmFkbywgbyBtw6l0b2RvIGluc2VyaWRvIG5hIGHDp8OjbyBpcsOhIHJlY2ViZXIgY29tbyBwYXLDom1ldHJvIG8gaXRlbSBkYSBsaXN0YSBjbGljYWRvLlxyXG4gICAqL1xyXG4gIEBPdXRwdXQoJ3AtdGl0bGUtYWN0aW9uJykgdGl0bGVBY3Rpb246IEV2ZW50RW1pdHRlcjxhbnk+ID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XHJcblxyXG4gIHBvcHVwVGFyZ2V0OiBhbnk7XHJcbiAgc2VsZWN0QWxsOiBib29sZWFuID0gZmFsc2U7XHJcbiAgc2hvd0hlYWRlcjogYm9vbGVhbiA9IGZhbHNlO1xyXG5cclxuICBwcml2YXRlIF9hY3Rpb25zOiBBcnJheTxQb0xpc3RWaWV3QWN0aW9uPjtcclxuICBwcml2YXRlIF9oZWlnaHQ6IG51bWJlcjtcclxuICBwcml2YXRlIF9oaWRlU2VsZWN0QWxsOiBib29sZWFuO1xyXG4gIHByaXZhdGUgX2l0ZW1zOiBBcnJheTxhbnk+O1xyXG4gIHByaXZhdGUgX2xpdGVyYWxzOiBQb0xpc3RWaWV3TGl0ZXJhbHM7XHJcbiAgcHJpdmF0ZSBfc2VsZWN0OiBib29sZWFuO1xyXG4gIHByaXZhdGUgX3Nob3dNb3JlRGlzYWJsZWQ6IGJvb2xlYW47XHJcbiAgcHJpdmF0ZSBsYW5ndWFnZTogc3RyaW5nID0gcG9Mb2NhbGVEZWZhdWx0O1xyXG5cclxuICAvKipcclxuICAgKiBAb3B0aW9uYWxcclxuICAgKlxyXG4gICAqIEBkZXNjcmlwdGlvblxyXG4gICAqXHJcbiAgICogTGlzdGEgZGUgYcOnw7VlcyBxdWUgc2Vyw6NvIGV4aWJpZGFzIG5vIGNvbXBvbmVudGUuXHJcbiAgICovXHJcbiAgQElucHV0KCdwLWFjdGlvbnMnKSBzZXQgYWN0aW9ucyh2YWx1ZTogQXJyYXk8UG9MaXN0Vmlld0FjdGlvbj4pIHtcclxuICAgIHRoaXMuX2FjdGlvbnMgPSBBcnJheS5pc0FycmF5KHZhbHVlKSA/IHZhbHVlIDogW107XHJcbiAgfVxyXG5cclxuICBnZXQgYWN0aW9ucygpIHtcclxuICAgIHJldHVybiB0aGlzLl9hY3Rpb25zO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQG9wdGlvbmFsXHJcbiAgICpcclxuICAgKiBAZGVzY3JpcHRpb25cclxuICAgKlxyXG4gICAqIERlZmluZSBhIGFsdHVyYSBkbyBgcG8tbGlzdC12aWV3YCBlbSAqcGl4ZWxzKi5cclxuICAgKi9cclxuICBASW5wdXQoJ3AtaGVpZ2h0Jykgc2V0IGhlaWdodChoZWlnaHQ6IG51bWJlcikge1xyXG4gICAgdGhpcy5faGVpZ2h0ID0gaGVpZ2h0O1xyXG4gIH1cclxuXHJcbiAgZ2V0IGhlaWdodCgpIHtcclxuICAgIHJldHVybiB0aGlzLl9oZWlnaHQ7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBAZGVzY3JpcHRpb25cclxuICAgKlxyXG4gICAqIEVzY29uZGUgbyAqY2hlY2tib3gqIHBhcmEgc2VsZcOnw6NvIGRlIHRvZG9zIG9zIGl0ZW5zLlxyXG4gICAqXHJcbiAgICogQGRlZmF1bHQgYGZhbHNlYFxyXG4gICAqL1xyXG4gIEBJbnB1dCgncC1oaWRlLXNlbGVjdC1hbGwnKSBzZXQgaGlkZVNlbGVjdEFsbChoaWRlU2VsZWN0QWxsOiBib29sZWFuKSB7XHJcbiAgICB0aGlzLl9oaWRlU2VsZWN0QWxsID0gY29udmVydFRvQm9vbGVhbihoaWRlU2VsZWN0QWxsKTtcclxuICAgIHRoaXMuc2hvd01haW5IZWFkZXIoKTtcclxuICB9XHJcblxyXG4gIGdldCBoaWRlU2VsZWN0QWxsKCkge1xyXG4gICAgcmV0dXJuIHRoaXMuX2hpZGVTZWxlY3RBbGw7XHJcbiAgfVxyXG5cclxuICAvKiogTGlzdGEgZGUgaXRlbnMgcXVlIHNlcsOjbyBleGliaWRvcyBubyBjb21wb25lbnRlLiAqL1xyXG4gIEBJbnB1dCgncC1pdGVtcycpIHNldCBpdGVtcyh2YWx1ZTogQXJyYXk8YW55Pikge1xyXG4gICAgdGhpcy5faXRlbXMgPSBBcnJheS5pc0FycmF5KHZhbHVlKSA/IHZhbHVlIDogW107XHJcbiAgfVxyXG5cclxuICBnZXQgaXRlbXMoKSB7XHJcbiAgICByZXR1cm4gdGhpcy5faXRlbXM7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBAb3B0aW9uYWxcclxuICAgKlxyXG4gICAqIEBkZXNjcmlwdGlvblxyXG4gICAqXHJcbiAgICogT2JqZXRvIGNvbSBhcyBsaXRlcmFpcyB1c2FkYXMgbm8gYHBvLWxpc3Qtdmlld2AuXHJcbiAgICpcclxuICAgKiBFeGlzdGVtIGR1YXMgbWFuZWlyYXMgZGUgY3VzdG9taXphciBvIGNvbXBvbmVudGUsIHBhc3NhbmRvIHVtIG9iamV0byBjb20gdG9kYXMgYXMgbGl0ZXJhaXMgZGlzcG9uw612ZWlzOlxyXG4gICAqXHJcbiAgICogYGBgXHJcbiAgICogIGNvbnN0IGN1c3RvbUxpdGVyYWxzOiBQb0xpc3RWaWV3TGl0ZXJhbHMgPSB7XHJcbiAgICogICAgaGlkZURldGFpbDogJ09jdWx0YXIgZGV0YWxoZXMgY29tcGxldGFtZW50ZScsXHJcbiAgICogICAgbG9hZE1vcmVEYXRhOiAnTWFpcyBkYWRvcycsXHJcbiAgICogICAgc2hvd0RldGFpbDogJ01vc3RyYXIgbWFpcyBkZXRhbGhlcycsXHJcbiAgICogICAgc2VsZWN0QWxsOiAnU2VsZWNpb25hciB0b2RvcyBvcyBpdGVucydcclxuICAgKiAgfTtcclxuICAgKiBgYGBcclxuICAgKlxyXG4gICAqIE91IHBhc3NhbmRvIGFwZW5hcyBhcyBsaXRlcmFpcyBxdWUgZGVzZWphIGN1c3RvbWl6YXI6XHJcbiAgICpcclxuICAgKiBgYGBcclxuICAgKiAgY29uc3QgY3VzdG9tTGl0ZXJhbHM6IFBvTGlzdFZpZXdMaXRlcmFscyA9IHtcclxuICAgKiAgICBzaG93RGV0YWlsOiAnTW9zdHJhciBtYWlzIGRldGFsaGVzJ1xyXG4gICAqICB9O1xyXG4gICAqIGBgYFxyXG4gICAqXHJcbiAgICogRSBwYXJhIGNhcnJlZ2FyIGFzIGxpdGVyYWlzIGN1c3RvbWl6YWRhcywgYmFzdGEgYXBlbmFzIHBhc3NhciBvIG9iamV0byBwYXJhIG8gY29tcG9uZW50ZS5cclxuICAgKlxyXG4gICAqIGBgYFxyXG4gICAqIDxwby1saXN0LXZpZXdcclxuICAgKiAgIFtwLWxpdGVyYWxzXT1cImN1c3RvbUxpdGVyYWxzXCI+XHJcbiAgICogPC9wby1saXN0LXZpZXc+XHJcbiAgICogYGBgXHJcbiAgICpcclxuICAgKiA+IE8gb2JqZXRvIHBhZHLDo28gZGUgbGl0ZXJhaXMgc2Vyw6EgdHJhZHV6aWRvIGRlIGFjb3JkbyBjb20gbyBpZGlvbWEgZG9cclxuICAgKiBbYFBvSTE4blNlcnZpY2VgXSgvZG9jdW1lbnRhdGlvbi9wby1pMThuKSBvdSBkbyBicm93c2VyLlxyXG4gICAqL1xyXG4gIEBJbnB1dCgncC1saXRlcmFscycpIHNldCBsaXRlcmFscyh2YWx1ZTogUG9MaXN0Vmlld0xpdGVyYWxzKSB7XHJcbiAgICBpZiAodmFsdWUgaW5zdGFuY2VvZiBPYmplY3QgJiYgISh2YWx1ZSBpbnN0YW5jZW9mIEFycmF5KSkge1xyXG4gICAgICB0aGlzLl9saXRlcmFscyA9IHtcclxuICAgICAgICAuLi5wb0xpc3RWaWV3TGl0ZXJhbHNEZWZhdWx0W3BvTG9jYWxlRGVmYXVsdF0sXHJcbiAgICAgICAgLi4ucG9MaXN0Vmlld0xpdGVyYWxzRGVmYXVsdFt0aGlzLmxhbmd1YWdlXSxcclxuICAgICAgICAuLi52YWx1ZVxyXG4gICAgICB9O1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdGhpcy5fbGl0ZXJhbHMgPSBwb0xpc3RWaWV3TGl0ZXJhbHNEZWZhdWx0W3RoaXMubGFuZ3VhZ2VdO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgZ2V0IGxpdGVyYWxzKCkge1xyXG4gICAgcmV0dXJuIHRoaXMuX2xpdGVyYWxzIHx8IHBvTGlzdFZpZXdMaXRlcmFsc0RlZmF1bHRbdGhpcy5sYW5ndWFnZV07XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBAb3B0aW9uYWxcclxuICAgKlxyXG4gICAqIEBkZXNjcmlwdGlvblxyXG4gICAqXHJcbiAgICogSGFiaWxpdGEgdW0gKmNoZWNrYm94KiBwYXJhIGNhZGEgaXRlbSBkYSBsaXN0YS4gVG9kb3Mgb3MgaXRlbXMgcG9zc3VlbSBhIHByb3ByaWVkYWRlIGRpbsOibWljYSBgJHNlbGVjdGVkYCBwYXJhIGlkZW50aWZpY2FyIHNlIG9cclxuICAgKiBpdGVtIGVzdMOhIHNlbGVjaW9uYWRvLCBwb3IgZXhlbXBsbzpcclxuICAgKlxyXG4gICAqIGBgYFxyXG4gICAqICBpdGVtLiRzZWxlY3RlZFxyXG4gICAqXHJcbiAgICogIC8vIG91XHJcbiAgICpcclxuICAgKiAgaXRlbVsnJHNlbGVjdGVkJ11cclxuICAgKiBgYGBcclxuICAgKlxyXG4gICAqIEBkZWZhdWx0IGBmYWxzZWBcclxuICAgKi9cclxuICBASW5wdXQoJ3Atc2VsZWN0Jykgc2V0IHNlbGVjdChzZWxlY3Q6IGJvb2xlYW4pIHtcclxuICAgIHRoaXMuX3NlbGVjdCA9IGNvbnZlcnRUb0Jvb2xlYW4oc2VsZWN0KTtcclxuICAgIHRoaXMuc2hvd01haW5IZWFkZXIoKTtcclxuICB9XHJcblxyXG4gIGdldCBzZWxlY3QoKSB7XHJcbiAgICByZXR1cm4gdGhpcy5fc2VsZWN0O1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQG9wdGlvbmFsXHJcbiAgICpcclxuICAgKiBAZGVzY3JpcHRpb25cclxuICAgKlxyXG4gICAqIEluZGljYSBxdWUgbyBib3TDo28gYENhcnJlZ2FyIE1haXMgUmVzdWx0YWRvc2Agc2Vyw6EgZGVzYWJpbGl0YWRvLlxyXG4gICAqL1xyXG4gIEBJbnB1dCgncC1zaG93LW1vcmUtZGlzYWJsZWQnKSBzZXQgc2hvd01vcmVEaXNhYmxlZCh2YWx1ZTogYm9vbGVhbikge1xyXG4gICAgdGhpcy5fc2hvd01vcmVEaXNhYmxlZCA9IGNvbnZlcnRUb0Jvb2xlYW4odmFsdWUpO1xyXG4gIH1cclxuXHJcbiAgZ2V0IHNob3dNb3JlRGlzYWJsZWQoKTogYm9vbGVhbiB7XHJcbiAgICByZXR1cm4gdGhpcy5fc2hvd01vcmVEaXNhYmxlZDtcclxuICB9XHJcblxyXG4gIGNvbnN0cnVjdG9yKGxhbmd1YWdlU2VydmljZTogUG9MYW5ndWFnZVNlcnZpY2UpIHtcclxuICAgIHRoaXMubGFuZ3VhZ2UgPSBsYW5ndWFnZVNlcnZpY2UuZ2V0U2hvcnRMYW5ndWFnZSgpO1xyXG4gIH1cclxuXHJcbiAgb25DbGlja0FjdGlvbihsaXN0Vmlld0FjdGlvbjogUG9MaXN0Vmlld0FjdGlvbiwgaXRlbSkge1xyXG4gICAgY29uc3QgY2xlYW5JdGVtID0gdGhpcy5kZWxldGVJbnRlcm5hbEF0dHJzKGl0ZW0pO1xyXG4gICAgaWYgKGxpc3RWaWV3QWN0aW9uLmFjdGlvbikge1xyXG4gICAgICBsaXN0Vmlld0FjdGlvbi5hY3Rpb24oY2xlYW5JdGVtKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIG9uU2hvd01vcmUoKTogdm9pZCB7XHJcbiAgICB0aGlzLnNob3dNb3JlLmVtaXQoKTtcclxuICB9XHJcblxyXG4gIHJ1blRpdGxlQWN0aW9uKGxpc3RJdGVtOiBhbnkpIHtcclxuICAgIGNvbnN0IGl0ZW1XaXRoUHVibGljUHJvcGVydGllcyA9IHRoaXMuZGVsZXRlSW50ZXJuYWxBdHRycyhsaXN0SXRlbSk7XHJcbiAgICB0aGlzLnRpdGxlQWN0aW9uLmVtaXQoaXRlbVdpdGhQdWJsaWNQcm9wZXJ0aWVzKTtcclxuICB9XHJcblxyXG4gIHNlbGVjdEFsbExpc3RJdGVtcygpIHtcclxuICAgIGlmICghdGhpcy5oaWRlU2VsZWN0QWxsKSB7XHJcbiAgICAgIHRoaXMuc2VsZWN0QWxsID0gIXRoaXMuc2VsZWN0QWxsO1xyXG5cclxuICAgICAgdGhpcy5pdGVtcy5mb3JFYWNoKGl0ZW0gPT4ge1xyXG4gICAgICAgIGl0ZW0uJHNlbGVjdGVkID0gdGhpcy5zZWxlY3RBbGw7XHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgc2VsZWN0TGlzdEl0ZW0ocm93OiBhbnkpIHtcclxuICAgIHJvdy4kc2VsZWN0ZWQgPSAhcm93LiRzZWxlY3RlZDtcclxuXHJcbiAgICB0aGlzLnNlbGVjdEFsbCA9IHRoaXMuY2hlY2tJZkl0ZW1zQXJlU2VsZWN0ZWQodGhpcy5pdGVtcyk7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGRlbGV0ZUludGVybmFsQXR0cnMoaXRlbSkge1xyXG4gICAgY29uc3QgaXRlbUNvcHkgPSBpdGVtID8geyAuLi5pdGVtIH0gOiB1bmRlZmluZWQ7XHJcblxyXG4gICAgZm9yIChjb25zdCBrZXkgaW4gaXRlbUNvcHkpIHtcclxuICAgICAgaWYgKGl0ZW1Db3B5Lmhhc093blByb3BlcnR5KGtleSkgJiYga2V5LnN0YXJ0c1dpdGgoJyQnKSkge1xyXG4gICAgICAgIGRlbGV0ZSBpdGVtQ29weVtrZXldO1xyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIGl0ZW1Db3B5O1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBjaGVja0lmSXRlbXNBcmVTZWxlY3RlZChpdGVtczogQXJyYXk8YW55Pik6IGJvb2xlYW4ge1xyXG4gICAgY29uc3Qgc29tZUNoZWNrZWRPckluZGV0ZXJtaW5hdGUgPSBpdGVtID0+IGl0ZW0uJHNlbGVjdGVkIHx8IGl0ZW0uJHNlbGVjdGVkID09PSBudWxsO1xyXG4gICAgY29uc3QgZXZlcnlDaGVja2VkID0gaXRlbSA9PiBpdGVtLiRzZWxlY3RlZDtcclxuXHJcbiAgICBpZiAoaXRlbXMuZXZlcnkoZXZlcnlDaGVja2VkKSkge1xyXG4gICAgICByZXR1cm4gdHJ1ZTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAoaXRlbXMuc29tZShzb21lQ2hlY2tlZE9ySW5kZXRlcm1pbmF0ZSkpIHtcclxuICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIGZhbHNlO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBzaG93TWFpbkhlYWRlcigpIHtcclxuICAgIHRoaXMuc2hvd0hlYWRlciA9ICEhKHRoaXMuc2VsZWN0ICYmICF0aGlzLmhpZGVTZWxlY3RBbGwgJiYgdGhpcy5pdGVtcyAmJiB0aGlzLml0ZW1zLmxlbmd0aCk7XHJcbiAgfVxyXG59XHJcbiJdfQ==