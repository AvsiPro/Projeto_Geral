import { __decorate } from "tslib";
import { EventEmitter, Input, Output, ViewChild, Directive } from '@angular/core';
import { InputBoolean, PoLanguageService, PoModalComponent, poLocaleDefault } from '@po-ui/ng-components';
export const poAdvancedFiltersLiteralsDefault = {
    en: {
        title: 'Advanced search',
        cancelLabel: 'Cancel',
        confirmLabel: 'Apply filters'
    },
    es: {
        title: 'Búsqueda avanzada',
        cancelLabel: 'Cancelar',
        confirmLabel: 'Aplicar filtros'
    },
    pt: {
        title: 'Busca avançada',
        cancelLabel: 'Cancelar',
        confirmLabel: 'Aplicar filtros'
    },
    ru: {
        title: 'Расширенный поиск',
        cancelLabel: 'отменить',
        confirmLabel: 'Применить фильтры'
    }
};
/**
 * @docsPrivate
 *
 * @description
 *
 * Filtro de busca avançada criado a partir de um formulário dinâmico.
 * Componente de uso interno.
 */
export class PoAdvancedFilterBaseComponent {
    constructor(languageService) {
        /**
         * Mantém na modal de busca avançada os valores preenchidos do último filtro realizado pelo usuário.
         */
        this.keepFilters = false;
        /** Função que será disparada e receberá os valores do formulário ao ser clicado no botão buscar. */
        this.searchEvent = new EventEmitter();
        this.filter = {};
        this.language = poLocaleDefault;
        this.primaryAction = {
            action: () => {
                const models = this.getValuesFromForm();
                this.searchEvent.emit(models);
                this.poModal.close();
            },
            label: this.literals.confirmLabel
        };
        this.secondaryAction = {
            action: () => {
                this.poModal.close();
            },
            label: this.literals.cancelLabel
        };
        this.optionsServiceChosenOptions = [];
        this._filters = [];
        this.language = languageService.getShortLanguage();
    }
    /**
     * Coleção de objetos que implementam a interface PoPageDynamicSearchFilters, para definição dos campos que serão criados
     * dinamicamente.
     */
    set filters(filters) {
        this._filters = Array.isArray(filters) ? [...filters] : [];
    }
    get filters() {
        return this._filters;
    }
    /** Objeto com as literais usadas no `po-advanced-filter`. */
    set literals(value) {
        if (value instanceof Object && !(value instanceof Array)) {
            this._literals = Object.assign(Object.assign(Object.assign({}, poAdvancedFiltersLiteralsDefault[poLocaleDefault]), poAdvancedFiltersLiteralsDefault[this.language]), value);
        }
        else {
            this._literals = poAdvancedFiltersLiteralsDefault[this.language];
        }
        this.primaryAction.label = this.literals.confirmLabel;
        this.secondaryAction.label = this.literals.cancelLabel;
    }
    get literals() {
        return this._literals || poAdvancedFiltersLiteralsDefault[this.language];
    }
    // Retorna os models dos campos preenchidos
    getValuesFromForm() {
        let optionServiceOptions;
        Object.keys(this.filter).forEach(property => {
            if (this.filter[property] === undefined || this.filter[property] === '') {
                delete this.filter[property];
            }
        });
        if (this.optionsServiceChosenOptions.length) {
            optionServiceOptions = this.optionsServiceChosenOptions.filter((optionItem) => Object.values(this.filter).includes(optionItem.value));
        }
        return { filter: this.filter, optionsService: optionServiceOptions };
    }
}
PoAdvancedFilterBaseComponent.decorators = [
    { type: Directive }
];
PoAdvancedFilterBaseComponent.ctorParameters = () => [
    { type: PoLanguageService }
];
PoAdvancedFilterBaseComponent.propDecorators = {
    poModal: [{ type: ViewChild, args: [PoModalComponent, { static: true },] }],
    keepFilters: [{ type: Input, args: ['p-keep-filters',] }],
    searchEvent: [{ type: Output, args: ['p-search-event',] }],
    filters: [{ type: Input, args: ['p-filters',] }],
    literals: [{ type: Input, args: ['p-literals',] }]
};
__decorate([
    InputBoolean()
], PoAdvancedFilterBaseComponent.prototype, "keepFilters", void 0);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG8tYWR2YW5jZWQtZmlsdGVyLWJhc2UuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vLi4vcHJvamVjdHMvdGVtcGxhdGVzL3NyYy9saWIvY29tcG9uZW50cy9wby1wYWdlLWR5bmFtaWMtc2VhcmNoL3BvLWFkdmFuY2VkLWZpbHRlci9wby1hZHZhbmNlZC1maWx0ZXItYmFzZS5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU8sRUFBRSxZQUFZLEVBQUUsS0FBSyxFQUFFLE1BQU0sRUFBRSxTQUFTLEVBQUUsU0FBUyxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBRWxGLE9BQU8sRUFDTCxZQUFZLEVBRVosaUJBQWlCLEVBRWpCLGdCQUFnQixFQUNoQixlQUFlLEVBRWhCLE1BQU0sc0JBQXNCLENBQUM7QUFLOUIsTUFBTSxDQUFDLE1BQU0sZ0NBQWdDLEdBQUc7SUFDOUMsRUFBRSxFQUE0QjtRQUM1QixLQUFLLEVBQUUsaUJBQWlCO1FBQ3hCLFdBQVcsRUFBRSxRQUFRO1FBQ3JCLFlBQVksRUFBRSxlQUFlO0tBQzlCO0lBQ0QsRUFBRSxFQUE0QjtRQUM1QixLQUFLLEVBQUUsbUJBQW1CO1FBQzFCLFdBQVcsRUFBRSxVQUFVO1FBQ3ZCLFlBQVksRUFBRSxpQkFBaUI7S0FDaEM7SUFDRCxFQUFFLEVBQTRCO1FBQzVCLEtBQUssRUFBRSxnQkFBZ0I7UUFDdkIsV0FBVyxFQUFFLFVBQVU7UUFDdkIsWUFBWSxFQUFFLGlCQUFpQjtLQUNoQztJQUNELEVBQUUsRUFBNEI7UUFDNUIsS0FBSyxFQUFFLG1CQUFtQjtRQUMxQixXQUFXLEVBQUUsVUFBVTtRQUN2QixZQUFZLEVBQUUsbUJBQW1CO0tBQ2xDO0NBQ0YsQ0FBQztBQUVGOzs7Ozs7O0dBT0c7QUFFSCxNQUFNLE9BQU8sNkJBQTZCO0lBc0V4QyxZQUFZLGVBQWtDO1FBbkU5Qzs7V0FFRztRQUdILGdCQUFXLEdBQVksS0FBSyxD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LENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDLFFBQVEsQ0FBQyxVQUFVLENBQUMsS0FBSyxDQUFDLENBQ3RELENBQUM7U0FDSDtRQUVELE9BQU8sRUFBRSxNQUFNLEVBQUUsSUFBSSxDQUFDLE1BQU0sRUFBRSxjQUFjLEVBQUUsb0JBQW9CLEVBQUUsQ0FBQztJQUN2RSxDQUFDOzs7WUE1RkYsU0FBUzs7O1lBekNSLGlCQUFpQjs7O3NCQTJDaEIsU0FBUyxTQUFDLGdCQUFnQixFQUFFLEVBQUUsTUFBTSxFQUFFLElBQUksRUFBRTswQkFNNUMsS0FBSyxTQUFDLGdCQUFnQjswQkFJdEIsTUFBTSxTQUFDLGdCQUFnQjtzQkErQnZCLEtBQUssU0FBQyxXQUFXO3VCQVNqQixLQUFLLFNBQUMsWUFBWTs7QUEzQ25CO0lBRkMsWUFBWSxFQUFFO2tFQUVjIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgRXZlbnRFbWl0dGVyLCBJbnB1dCwgT3V0cHV0LCBWaWV3Q2hpbGQsIERpcmVjdGl2ZSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5cclxuaW1wb3J0IHtcclxuICBJbnB1dEJvb2xlYW4sXHJcbiAgUG9EeW5hbWljRm9ybUZpZWxkLFxyXG4gIFBvTGFuZ3VhZ2VTZXJ2aWNlLFxyXG4gIFBvTW9kYWxBY3Rpb24sXHJcbiAgUG9Nb2RhbENvbXBvbmVudCxcclxuICBwb0xvY2FsZURlZmF1bHQsXHJcbiAgUG9Db21ib09wdGlvblxyXG59IGZyb20gJ0Bwby11aS9uZy1jb21wb25lbnRzJztcclxuXHJcbmltcG9ydCB7IFBvQWR2YW5jZWRGaWx0ZXJMaXRlcmFscyB9IGZyb20gJy4vcG8tYWR2YW5jZWQtZmlsdGVyLWxpdGVyYWxzLmludGVyZmFjZSc7XHJcbmltcG9ydCB7IFBvUGFnZUR5bmFtaWNTZWFyY2hGaWx0ZXJzIH0gZnJvbSAnLi4vcG8tcGFnZS1keW5hbWljLXNlYXJjaC1maWx0ZXJzLmludGVyZmFjZSc7XHJcblxyXG5leHBvcnQgY29uc3QgcG9BZHZhbmNlZEZpbHRlcnNMaXRlcmFsc0RlZmF1bHQgPSB7XHJcbiAgZW46IDxQb0FkdmFuY2VkRmlsdGVyTGl0ZXJhbHM+e1xyXG4gICAgdGl0bGU6ICdBZHZhbmNlZCBzZWFyY2gnLFxyXG4gICAgY2FuY2VsTGFiZWw6ICdDYW5jZWwnLFxyXG4gICAgY29uZmlybUxhYmVsOiAnQXBwbHkgZmlsdGVycydcclxuICB9LFxyXG4gIGVzOiA8UG9BZHZhbmNlZEZpbHRlckxpdGVyYWxzPntcclxuICAgIHRpdGxlOiAnQsO6c3F1ZWRhIGF2YW56YWRhJyxcclxuICAgIGNhbmNlbExhYmVsOiAnQ2FuY2VsYXInLFxyXG4gICAgY29uZmlybUxhYmVsOiAnQXBsaWNhciBmaWx0cm9zJ1xyXG4gIH0sXHJcbiAgcHQ6IDxQb0FkdmFuY2VkRmlsdGVyTGl0ZXJhbHM+e1xyXG4gICAgdGl0bGU6ICdCdXNjYSBhdmFuw6dhZGEnLFxyXG4gICAgY2FuY2VsTGFiZWw6ICdDYW5jZWxhcicsXHJcbiAgICBjb25maXJtTGFiZWw6ICdBcGxpY2FyIGZpbHRyb3MnXHJcbiAgfSxcclxuICBydTogPFBvQWR2YW5jZWRGaWx0ZXJMaXRlcmFscz57XHJcbiAgICB0aXRsZTogJ9Cg0LDRgdGI0LjRgNC10L3QvdGL0Lkg0L/QvtC40YHQuicsXHJcbiAgICBjYW5jZWxMYWJlbDogJ9C+0YLQvNC10L3QuNGC0YwnLFxyXG4gICAgY29uZmlybUxhYmVsOiAn0J/RgNC40LzQtdC90LjRgtGMINGE0LjQu9GM0YLRgNGLJ1xyXG4gIH1cclxufTtcclxuXHJcbi8qKlxyXG4gKiBAZG9jc1ByaXZhdGVcclxuICpcclxuICogQGRlc2NyaXB0aW9uXHJcbiAqXHJcbiAqIEZpbHRybyBkZSBidXNjYSBhdmFuw6dhZGEgY3JpYWRvIGEgcGFydGlyIGRlIHVtIGZvcm11bMOhcmlvIGRpbsOibWljby5cclxuICogQ29tcG9uZW50ZSBkZSB1c28gaW50ZXJuby5cclxuICovXHJcbkBEaXJlY3RpdmUoKVxyXG5leHBvcnQgY2xhc3MgUG9BZHZhbmNlZEZpbHRlckJhc2VDb21wb25lbnQge1xyXG4gIEBWaWV3Q2hpbGQoUG9Nb2RhbENvbXBvbmVudCwgeyBzdGF0aWM6IHRydWUgfSkgcG9Nb2RhbDogUG9Nb2RhbENvbXBvbmVudDtcclxuXHJcbiAgLyoqXHJcbiAgICogTWFudMOpbSBuYSBtb2RhbCBkZSBidXNjYSBhdmFuw6dhZGEgb3MgdmFsb3JlcyBwcmVlbmNoaWRvcyBkbyDDumx0aW1vIGZpbHRybyByZWFsaXphZG8gcGVsbyB1c3XDoXJpby5cclxuICAgKi9cclxuICBASW5wdXRCb29sZWFuKClcclxuICBASW5wdXQoJ3Ata2VlcC1maWx0ZXJzJylcclxuICBrZWVwRmlsdGVyczogYm9vbGVhbiA9IGZhbHNlO1xyXG5cclxuICAvKiogRnVuw6fDo28gcXVlIHNlcsOhIGRpc3BhcmFkYSBlIHJlY2ViZXLDoSBvcyB2YWxvcmVzIGRvIGZvcm11bMOhcmlvIGFvIHNlciBjbGljYWRvIG5vIGJvdMOjbyBidXNjYXIuICovXHJcbiAgQE91dHB1dCgncC1zZWFyY2gtZXZlbnQnKSBzZWFyY2hFdmVudCA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xyXG5cclxuICBmaWx0ZXIgPSB7fTtcclxuICBsYW5ndWFnZTogc3RyaW5nID0gcG9Mb2NhbGVEZWZhdWx0O1xyXG5cclxuICBwcmltYXJ5QWN0aW9uOiBQb01vZGFsQWN0aW9uID0ge1xyXG4gICAgYWN0aW9uOiAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IG1vZGVscyA9IHRoaXMuZ2V0VmFsdWVzRnJvbUZvcm0oKTtcclxuXHJcbiAgICAgIHRoaXMuc2VhcmNoRXZlbnQuZW1pdChtb2RlbHMpO1xyXG4gICAgICB0aGlzLnBvTW9kYWwuY2xvc2UoKTtcclxuICAgIH0sXHJcbiAgICBsYWJlbDogdGhpcy5saXRlcmFscy5jb25maXJtTGFiZWxcclxuICB9O1xyXG5cclxuICBzZWNvbmRhcnlBY3Rpb246IFBvTW9kYWxBY3Rpb24gPSB7XHJcbiAgICBhY3Rpb246ICgpID0+IHtcclxuICAgICAgdGhpcy5wb01vZGFsLmNsb3NlKCk7XHJcbiAgICB9LFxyXG4gICAgbGFiZWw6IHRoaXMubGl0ZXJhbHMuY2FuY2VsTGFiZWxcclxuICB9O1xyXG5cclxuICBwcm90ZWN0ZWQgb3B0aW9uc1NlcnZpY2VDaG9zZW5PcHRpb25zOiBBcnJheTxQb0NvbWJvT3B0aW9uPiA9IFtdO1xyXG5cclxuICBwcml2YXRlIF9maWx0ZXJzOiBBcnJheTxQb0R5bmFtaWNGb3JtRmllbGQ+ID0gW107XHJcbiAgcHJpdmF0ZSBfbGl0ZXJhbHM6IFBvQWR2YW5jZWRGaWx0ZXJMaXRlcmFscztcclxuXHJcbiAgLyoqXHJcbiAgICogQ29sZcOnw6NvIGRlIG9iamV0b3MgcXVlIGltcGxlbWVudGFtIGEgaW50ZXJmYWNlIFBvUGFnZUR5bmFtaWNTZWFyY2hGaWx0ZXJzLCBwYXJhIGRlZmluacOnw6NvIGRvcyBjYW1wb3MgcXVlIHNlcsOjbyBjcmlhZG9zXHJcbiAgICogZGluYW1pY2FtZW50ZS5cclxuICAgKi9cclxuICBASW5wdXQoJ3AtZmlsdGVycycpIHNldCBmaWx0ZXJzKGZpbHRlcnM6IEFycmF5PFBvUGFnZUR5bmFtaWNTZWFyY2hGaWx0ZXJzPikge1xyXG4gICAgdGhpcy5fZmlsdGVycyA9IEFycmF5LmlzQXJyYXkoZmlsdGVycykgPyBbLi4uZmlsdGVyc10gOiBbXTtcclxuICB9XHJcblxyXG4gIGdldCBmaWx0ZXJzKCk6IEFycmF5PFBvUGFnZUR5bmFtaWNTZWFyY2hGaWx0ZXJzPiB7XHJcbiAgICByZXR1cm4gdGhpcy5fZmlsdGVycztcclxuICB9XHJcblxyXG4gIC8qKiBPYmpldG8gY29tIGFzIGxpdGVyYWlzIHVzYWRhcyBubyBgcG8tYWR2YW5jZWQtZmlsdGVyYC4gKi9cclxuICBASW5wdXQoJ3AtbGl0ZXJhbHMnKSBzZXQgbGl0ZXJhbHModmFsdWU6IFBvQWR2YW5jZWRGaWx0ZXJMaXRlcmFscykge1xyXG4gICAgaWYgKHZhbHVlIGluc3RhbmNlb2YgT2JqZWN0ICYmICEodmFsdWUgaW5zdGFuY2VvZiBBcnJheSkpIHtcclxuICAgICAgdGhpcy5fbGl0ZXJhbHMgPSB7XHJcbiAgICAgICAgLi4ucG9BZHZhbmNlZEZpbHRlcnNMaXRlcmFsc0RlZmF1bHRbcG9Mb2NhbGVEZWZhdWx0XSxcclxuICAgICAgICAuLi5wb0FkdmFuY2VkRmlsdGVyc0xpdGVyYWxzRGVmYXVsdFt0aGlzLmxhbmd1YWdlXSxcclxuICAgICAgICAuLi52YWx1ZVxyXG4gICAgICB9O1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdGhpcy5fbGl0ZXJhbHMgPSBwb0FkdmFuY2VkRmlsdGVyc0xpdGVyYWxzRGVmYXVsdFt0aGlzLmxhbmd1YWdlXTtcclxuICAgIH1cclxuXHJcbiAgICB0aGlzLnByaW1hcnlBY3Rpb24ubGFiZWwgPSB0aGlzLmxpdGVyYWxzLmNvbmZpcm1MYWJlbDtcclxuICAgIHRoaXMuc2Vjb25kYXJ5QWN0aW9uLmxhYmVsID0gdGhpcy5saXRlcmFscy5jYW5jZWxMYWJlbDtcclxuICB9XHJcblxyXG4gIGdldCBsaXRlcmFscygpIHtcclxuICAgIHJldHVybiB0aGlzLl9saXRlcmFscyB8fCBwb0FkdmFuY2VkRmlsdGVyc0xpdGVyYWxzRGVmYXVsdFt0aGlzLmxhbmd1YWdlXTtcclxuICB9XHJcblxyXG4gIGNvbnN0cnVjdG9yKGxhbmd1YWdlU2VydmljZTogUG9MYW5ndWFnZVNlcnZpY2UpIHtcclxuICAgIHRoaXMubGFuZ3VhZ2UgPSBsYW5ndWFnZVNlcnZpY2UuZ2V0U2hvcnRMYW5ndWFnZSgpO1xyXG4gIH1cclxuXHJcbiAgLy8gUmV0b3JuYSBvcyBtb2RlbHMgZG9zIGNhbXBvcyBwcmVlbmNoaWRvc1xyXG4gIHByaXZhdGUgZ2V0VmFsdWVzRnJvbUZvcm0oKSB7XHJcbiAgICBsZXQgb3B0aW9uU2VydmljZU9wdGlvbnM6IEFycmF5PFBvQ29tYm9PcHRpb24+O1xyXG5cclxuICAgIE9iamVjdC5rZXlzKHRoaXMuZmlsdGVyKS5mb3JFYWNoKHByb3BlcnR5ID0+IHtcclxuICAgICAgaWYgKHRoaXMuZmlsdGVyW3Byb3BlcnR5XSA9PT0gdW5kZWZpbmVkIHx8IHRoaXMuZmlsdGVyW3Byb3BlcnR5XSA9PT0gJycpIHtcclxuICAgICAgICBkZWxldGUgdGhpcy5maWx0ZXJbcHJvcGVydHldO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuXHJcbiAgICBpZiAodGhpcy5vcHRpb25zU2VydmljZUNob3Nlbk9wdGlvbnMubGVuZ3RoKSB7XHJcbiAgICAgIG9wdGlvblNlcnZpY2VPcHRpb25zID0gdGhpcy5vcHRpb25zU2VydmljZUNob3Nlbk9wdGlvbnMuZmlsdGVyKChvcHRpb25JdGVtOiBQb0NvbWJvT3B0aW9uKSA9PlxyXG4gICAgICAgIE9iamVjdC52YWx1ZXModGhpcy5maWx0ZXIpLmluY2x1ZGVzKG9wdGlvbkl0ZW0udmFsdWUpXHJcbiAgICAgICk7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHsgZmlsdGVyOiB0aGlzLmZpbHRlciwgb3B0aW9uc1NlcnZpY2U6IG9wdGlvblNlcnZpY2VPcHRpb25zIH07XHJcbiAgfVxyXG59XHJcbiJdfQ==