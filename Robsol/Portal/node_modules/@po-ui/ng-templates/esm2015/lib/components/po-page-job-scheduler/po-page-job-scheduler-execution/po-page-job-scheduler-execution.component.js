import { Component, EventEmitter, Input, Output, ViewChild } from '@angular/core';
import { isTypeof } from '../../../utils/util';
import { PoPageJobSchedulerLookupService } from '../po-page-job-scheduler-lookup.service';
import { PoPageJobSchedulerService } from '../po-page-job-scheduler.service';
export class PoPageJobSchedulerExecutionComponent {
    constructor(poPageJobSchedulerService, poPageJobSchedulerLookup) {
        this.poPageJobSchedulerService = poPageJobSchedulerService;
        this.poPageJobSchedulerLookup = poPageJobSchedulerLookup;
        this.isEdit = false;
        this.literals = {};
        this.noParameters = true;
        this.changeProcess = new EventEmitter();
        this.dayPattern = '^(3[0-1]|[0-2][0-9]|[1-9]|0[1-9])$';
        this.existProcessAPI = true;
        this.minDateFirstExecution = new Date();
        this.periodicityOptions = [];
        this.timePattern = '^(2[0-3]|[01][0-9]):?([0-5][0-9])$';
        this.weekDays = [];
        this.frequencyOptions = [];
        this.containsFrequency = false;
        this.frequency = 'hour';
        this._value = {};
    }
    set value(value) {
        this._value = value && isTypeof(value, 'object') ? value : {};
        this.containsFrequency = this._value.frequency && this._value.frequency.value ? true : false;
    }
    get value() {
        return this._value;
    }
    get startDateFirstExecution() {
        return this.isEdit ? undefined : this.minDateFirstExecution;
    }
    get hourLabel() {
        return this.containsFrequency ? this.literals.startTime : this.literals.time;
    }
    get dayLabel() {
        return this.containsFrequency ? this.literals.startDay : this.literals.day;
    }
    ngAfterViewInit() {
        setTimeout(() => {
            this.subscribeProcessIdValueChanges();
            if (this.value.periodicity) {
                this.frequencyOptions = this.frequencyOptions.map(frequencyOption => (Object.assign(Object.assign({}, frequencyOption), { disabled: frequencyOption.value === 'day' && this.value.periodicity !== 'monthly' })));
            }
        });
    }
    ngOnInit() {
        this.periodicityTemplates = {
            daily: this.dailyTemplate,
            monthly: this.monthlyTemplate,
            weekly: this.weeklyTempalte
        };
        if (this.noParameters) {
            this.checkExistsProcessesAPI();
        }
        this.periodicityOptions = this.getPeriodicityOptions();
        this.weekDays = this.getWeekDays();
        this.frequencyOptions = this.getFrequencyOptions();
    }
    onChangeContainsFrequency(containsFrequency) {
        if (containsFrequency) {
            this.value.frequency = { type: 'hour', value: null };
        }
        else {
            this.value.frequency = {};
        }
        this.value.rangeLimitHour = null;
        this.value.rangeLimitDay = null;
        this.value.dayOfMonth = null;
    }
    onChangePeriodicityOptions(periodicity) {
        this.frequencyOptions = this.frequencyOptions.map(frequencyOption => (Object.assign(Object.assign({}, frequencyOption), { disabled: frequencyOption.value === 'day' && periodicity !== 'monthly' })));
        this.value.frequency.type = null;
    }
    onChangeFrequencyOptions() {
        this.value.rangeLimitHour = null;
    }
    checkExistsProcessesAPI() {
        this.poPageJobSchedulerService.getHeadProcesses().subscribe(undefined, error => {
            this.existProcessAPI = false;
        });
    }
    getPeriodicityOptions() {
        return [
            { label: this.literals.single, value: 'single' },
            { label: this.literals.daily, value: 'daily' },
            { label: this.literals.weekly, value: 'weekly' },
            { label: this.literals.monthly, value: 'monthly' }
        ];
    }
    getFrequencyOptions() {
        return [
            { label: this.literals.day, value: 'day' },
            { label: this.literals.hour, value: 'hour' },
            { label: this.literals.minute, value: 'minute' }
        ];
    }
    getWeekDays() {
        return [
            { label: this.literals.sunday, value: 'Sunday' },
            { label: this.literals.monday, value: 'Monday' },
            { label: this.literals.tuesday, value: 'Tuesday' },
            { label: this.literals.wednesday, value: 'Wednesday' },
            { label: this.literals.thursday, value: 'Thursday' },
            { label: this.literals.friday, value: 'Friday' },
            { label: this.literals.saturday, value: 'Saturday' }
        ];
    }
    subscribeProcessIdValueChanges() {
        var _a;
        (_a = this.form.controls['processID']) === null || _a === void 0 ? void 0 : _a.valueChanges.subscribe(processId => {
            this.changeProcess.emit({ processId, existAPI: this.existProcessAPI });
        });
    }
}
PoPageJobSchedulerExecutionComponent.decorators = [
    { type: Component, args: [{
                selector: 'po-page-job-scheduler-execution',
                template: "<form #formExecution=\"ngForm\">\r\n  <div class=\"po-row\">\r\n    <ng-container *ngIf=\"existProcessAPI; then lookupProcessesID; else inputProcessesID\"></ng-container>\r\n  </div>\r\n\r\n  <div class=\"po-row\">\r\n    <po-divider class=\"po-md-12\" [p-label]=\"literals.firstExecution\"></po-divider>\r\n\r\n    <po-datepicker\r\n      class=\"po-md-4\"\r\n      name=\"firstExecution\"\r\n      [(ngModel)]=\"value.firstExecution\"\r\n      p-placeholder=\"dd/mm/aaaa\"\r\n      p-required\r\n      [p-disabled]=\"isEdit\"\r\n      [p-label]=\"literals.day\"\r\n      [p-min-date]=\"startDateFirstExecution\"\r\n    >\r\n    </po-datepicker>\r\n\r\n    <po-input\r\n      class=\"po-md-2\"\r\n      name=\"firstExecutionHour\"\r\n      [(ngModel)]=\"value.firstExecutionHour\"\r\n      p-mask=\"99:99\"\r\n      p-mask-format-model\r\n      p-placeholder=\"HH:mm\"\r\n      p-required\r\n      [p-disabled]=\"isEdit\"\r\n      [p-label]=\"literals.time\"\r\n      [p-pattern]=\"timePattern\"\r\n    >\r\n    </po-input>\r\n  </div>\r\n\r\n  <hr />\r\n\r\n  <div class=\"po-row\">\r\n    <po-radio-group\r\n      class=\"po-sm-12\"\r\n      name=\"periodicity\"\r\n      [(ngModel)]=\"value.periodicity\"\r\n      p-columns=\"4\"\r\n      p-required\r\n      [p-label]=\"literals.periodicity\"\r\n      [p-options]=\"periodicityOptions\"\r\n      (p-change)=\"onChangePeriodicityOptions($event)\"\r\n    >\r\n    </po-radio-group>\r\n\r\n    <ng-container *ngIf=\"value.periodicity !== 'single'\">\r\n      <div class=\"po-row\">\r\n        <po-switch\r\n          class=\"po-md-12\"\r\n          name=\"containsFrequency\"\r\n          [(ngModel)]=\"containsFrequency\"\r\n          [p-label]=\"literals.frequency\"\r\n          [p-label-off]=\"literals.no\"\r\n          [p-label-on]=\"literals.yes\"\r\n          (p-change)=\"onChangeContainsFrequency($event)\"\r\n        >\r\n        </po-switch>\r\n        <ng-container *ngIf=\"containsFrequency\">\r\n          <po-radio-group\r\n            class=\"po-md-10\"\r\n            name=\"frequencyType\"\r\n            p-required\r\n            [(ngModel)]=\"value.frequency.type\"\r\n            [p-columns]=\"3\"\r\n            [p-options]=\"frequencyOptions\"\r\n            (p-change)=\"onChangeFrequencyOptions()\"\r\n          >\r\n          </po-radio-group>\r\n\r\n          <po-number class=\"po-md-2\" name=\"frequencyValue\" p-required [(ngModel)]=\"value.frequency.value\"> </po-number>\r\n        </ng-container>\r\n      </div>\r\n\r\n      <div class=\"po-row\">\r\n        <po-divider class=\"po-md-12\" [p-label]=\"literals.periodicityData\"> </po-divider>\r\n\r\n        <ng-container *ngTemplateOutlet=\"periodicityTemplates[value.periodicity]\"> </ng-container>\r\n      </div>\r\n\r\n      <div class=\"po-row\">\r\n        <po-switch\r\n          class=\"po-md-3\"\r\n          name=\"recurrent\"\r\n          [(ngModel)]=\"value.recurrent\"\r\n          [p-label]=\"literals.recurrent\"\r\n          [p-label-off]=\"literals.no\"\r\n          [p-label-on]=\"literals.yes\"\r\n        >\r\n        </po-switch>\r\n      </div>\r\n    </ng-container>\r\n  </div>\r\n\r\n  <ng-template #lookupProcessesID>\r\n    <po-lookup\r\n      *ngIf=\"noParameters\"\r\n      class=\"po-md-12\"\r\n      name=\"processID\"\r\n      [(ngModel)]=\"value.processID\"\r\n      p-field-label=\"description\"\r\n      p-field-value=\"processID\"\r\n      p-required\r\n      [p-disabled]=\"isEdit\"\r\n      [p-filter-service]=\"poPageJobSchedulerLookup\"\r\n      [p-label]=\"literals.process\"\r\n      [p-placeholder]=\"literals.enterProcess\"\r\n    >\r\n    </po-lookup>\r\n  </ng-template>\r\n\r\n  <ng-template #inputProcessesID>\r\n    <po-input\r\n      class=\"po-md-12\"\r\n      name=\"processID\"\r\n      [(ngModel)]=\"value.processID\"\r\n      p-required\r\n      [p-disabled]=\"isEdit\"\r\n      [p-label]=\"literals.process\"\r\n      [p-placeholder]=\"literals.enterProcess\"\r\n    >\r\n    </po-input>\r\n  </ng-template>\r\n\r\n  <ng-template #dailyTemplate>\r\n    <ng-container *ngTemplateOutlet=\"inputHourTemplate\"> </ng-container>\r\n  </ng-template>\r\n\r\n  <ng-template #weeklyTemplate>\r\n    <div class=\"po-row\">\r\n      <ng-container *ngTemplateOutlet=\"inputHourTemplate\"> </ng-container>\r\n    </div>\r\n\r\n    <po-checkbox-group\r\n      class=\"po-md-12\"\r\n      name=\"daysOfWeek\"\r\n      [(ngModel)]=\"value.daysOfWeek\"\r\n      p-columns=\"4\"\r\n      p-required\r\n      [p-label]=\"literals.weekDays\"\r\n      [p-options]=\"weekDays\"\r\n    >\r\n    </po-checkbox-group>\r\n  </ng-template>\r\n\r\n  <ng-template #monthlyTemplate>\r\n    <po-number\r\n      class=\"po-md-3\"\r\n      name=\"dayOfMonth\"\r\n      [(ngModel)]=\"value.dayOfMonth\"\r\n      p-required\r\n      [p-error-pattern]=\"'Dia inv\u00E1lido'\"\r\n      [p-label]=\"dayLabel\"\r\n      [p-max]=\"31\"\r\n      [p-pattern]=\"dayPattern\"\r\n    >\r\n    </po-number>\r\n\r\n    <po-number\r\n      *ngIf=\"containsFrequency\"\r\n      class=\"po-md-3\"\r\n      name=\"rangeLimitDay\"\r\n      [(ngModel)]=\"value.rangeLimitDay\"\r\n      p-required\r\n      [p-error-pattern]=\"'Dia inv\u00E1lido'\"\r\n      [p-label]=\"literals.endDay\"\r\n      [p-max]=\"31\"\r\n      [p-pattern]=\"dayPattern\"\r\n    >\r\n    </po-number>\r\n\r\n    <ng-container *ngTemplateOutlet=\"inputHourTemplate\"> </ng-container>\r\n  </ng-template>\r\n\r\n  <ng-template #inputHourTemplate>\r\n    <po-input\r\n      class=\"po-md-2\"\r\n      name=\"hour\"\r\n      [(ngModel)]=\"value.hour\"\r\n      p-mask=\"99:99\"\r\n      p-mask-format-model\r\n      p-placeholder=\"HH:mm\"\r\n      p-required\r\n      [p-label]=\"hourLabel\"\r\n      [p-pattern]=\"timePattern\"\r\n    >\r\n    </po-input>\r\n\r\n    <po-input\r\n      *ngIf=\"containsFrequency && value.frequency.type !== 'day'\"\r\n      class=\"po-md-2\"\r\n      name=\"rangeLimitHour\"\r\n      [(ngModel)]=\"value.rangeLimitHour\"\r\n      p-mask=\"99:99\"\r\n      p-mask-format-model\r\n      p-placeholder=\"HH:mm\"\r\n      p-required\r\n      [p-label]=\"literals.endTime\"\r\n      [p-pattern]=\"timePattern\"\r\n    >\r\n    </po-input>\r\n  </ng-template>\r\n</form>\r\n"
            },] }
];
PoPageJobSchedulerExecutionComponent.ctorParameters = () => [
    { type: PoPageJobSchedulerService },
    { type: PoPageJobSchedulerLookupService }
];
PoPageJobSchedulerExecutionComponent.propDecorators = {
    form: [{ type: ViewChild, args: ['formExecution', { static: true },] }],
    dailyTemplate: [{ type: ViewChild, args: ['dailyTemplate', { static: true },] }],
    monthlyTemplate: [{ type: ViewChild, args: ['monthlyTemplate', { static: true },] }],
    weeklyTempalte: [{ type: ViewChild, args: ['weeklyTemplate', { static: true },] }],
    isEdit: [{ type: Input, args: ['p-is-edit',] }],
    literals: [{ type: Input, args: ['p-literals',] }],
    noParameters: [{ type: Input, args: ['p-no-parameters',] }],
    changeProcess: [{ type: Output, args: ['p-change-process',] }],
    value: [{ type: Input, args: ['p-value',] }]
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG8tcGFnZS1qb2Itc2NoZWR1bGVyLWV4ZWN1dGlvbi5jb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy90ZW1wbGF0ZXMvc3JjL2xpYi9jb21wb25lbnRzL3BvLXBhZ2Utam9iLXNjaGVkdWxlci9wby1wYWdlLWpvYi1zY2hlZHVsZXItZXhlY3V0aW9uL3BvLXBhZ2Utam9iLXNjaGVkdWxlci1leGVjdXRpb24uY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBaUIsU0FBUyxFQUFFLFlBQVksRUFBRSxLQUFLLEVBQVUsTUFBTSxFQUFlLFNBQVMsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUt0SCxPQUFPLEVBQUUsUUFBUSxFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFFL0MsT0FBTyxFQUFFLCtCQUErQixFQUFFLE1BQU0seUNBQXlDLENBQUM7QUFDMUYsT0FBTyxFQUFFLHlCQUF5QixFQUFFLE1BQU0sa0NBQWtDLENBQUM7QUFNN0UsTUFBTSxPQUFPLG9DQUFvQztJQXdDL0MsWUFDVSx5QkFBb0QsRUFDckQsd0JBQXlEO1FBRHhELDhCQUF5QixHQUF6Qix5QkFBeUIsQ0FBMkI7UUFDckQsNkJBQXdCLEdBQXhCLHdCQUF3QixDQUFpQztRQWxDOUMsV0FBTSxHQUFZLEtBQUssQ0FBQztRQUV2QixhQUFRLEdBQVEsRUFBRSxDQUFDO1FBRWQsaUJBQVksR0FBWSxJQUFJLENBQUM7UUFFM0Isa0JBQWEsR0FBc0IsSUFBSSxZQUFZLEVBQU8sQ0FBQztRQUV2RixlQUFVLEdBQUcsb0NBQW9DLENBQUM7UUFDbEQsb0JBQWUsR0FBRyxJQUFJLENBQUM7UUFDdkIsMEJBQXFCLEdBQUcsSUFBSSxJQUFJLEVBQUUsQ0FBQztRQUNuQyx1QkFBa0IsR0FBOEIsRUFBRSxDQUFDO1FBRW5ELGdCQUFXLEdBQUcsb0NBQW9DLENBQUM7UUFDbkQsYUFBUSxHQUFpQyxFQUFF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QVMsQ0FBQyxTQUFTLENBQUMsRUFBRTtZQUNsRSxJQUFJLENBQUMsYUFBYSxDQUFDLElBQUksQ0FBQyxFQUFFLFNBQVMsRUFBRSxRQUFRLEVBQUUsSUFBSSxDQUFDLGVBQWUsRUFBRSxDQUFDLENBQUM7UUFDekUsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDOzs7WUExSkYsU0FBUyxTQUFDO2dCQUNULFFBQVEsRUFBRSxpQ0FBaUM7Z0JBQzNDLG9sTUFBNkQ7YUFDOUQ7OztZQUxRLHlCQUF5QjtZQUR6QiwrQkFBK0I7OzttQkFRckMsU0FBUyxTQUFDLGVBQWUsRUFBRSxFQUFFLE1BQU0sRUFBRSxJQUFJLEVBQUU7NEJBRzNDLFNBQVMsU0FBQyxlQUFlLEVBQUUsRUFBRSxNQUFNLEVBQUUsSUFBSSxFQUFFOzhCQUMzQyxTQUFTLFNBQUMsaUJBQWlCLEVBQUUsRUFBRSxNQUFNLEVBQUUsSUFBSSxFQUFFOzZCQUM3QyxTQUFTLFNBQUMsZ0JBQWdCLEVBQUUsRUFBRSxNQUFNLEVBQUUsSUFBSSxFQUFFO3FCQUU1QyxLQUFLLFNBQUMsV0FBVzt1QkFFakIsS0FBSyxTQUFDLFlBQVk7MkJBRWxCLEtBQUssU0FBQyxpQkFBaUI7NEJBRXZCLE1BQU0sU0FBQyxrQkFBa0I7b0JBZ0J6QixLQUFLLFNBQUMsU0FBUyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEFmdGVyVmlld0luaXQsIENvbXBvbmVudCwgRXZlbnRFbWl0dGVyLCBJbnB1dCwgT25Jbml0LCBPdXRwdXQsIFRlbXBsYXRlUmVmLCBWaWV3Q2hpbGQgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgTmdGb3JtIH0gZnJvbSAnQGFuZ3VsYXIvZm9ybXMnO1xyXG5cclxuaW1wb3J0IHsgUG9DaGVja2JveEdyb3VwT3B0aW9uLCBQb1JhZGlvR3JvdXBPcHRpb24gfSBmcm9tICdAcG8tdWkvbmctY29tcG9uZW50cyc7XHJcblxyXG5pbXBvcnQgeyBpc1R5cGVvZiB9IGZyb20gJy4uLy4uLy4uL3V0aWxzL3V0aWwnO1xyXG5cclxuaW1wb3J0IHsgUG9QYWdlSm9iU2NoZWR1bGVyTG9va3VwU2VydmljZSB9IGZyb20gJy4uL3BvLXBhZ2Utam9iLXNjaGVkdWxlci1sb29rdXAuc2VydmljZSc7XHJcbmltcG9ydCB7IFBvUGFnZUpvYlNjaGVkdWxlclNlcnZpY2UgfSBmcm9tICcuLi9wby1wYWdlLWpvYi1zY2hlZHVsZXIuc2VydmljZSc7XHJcblxyXG5AQ29tcG9uZW50KHtcclxuICBzZWxlY3RvcjogJ3BvLXBhZ2Utam9iLXNjaGVkdWxlci1leGVjdXRpb24nLFxyXG4gIHRlbXBsYXRlVXJsOiAncG8tcGFnZS1qb2Itc2NoZWR1bGVyLWV4ZWN1dGlvbi5jb21wb25lbnQuaHRtbCdcclxufSlcclxuZXhwb3J0IGNsYXNzIFBvUGFnZUpvYlNjaGVkdWxlckV4ZWN1dGlvbkNvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCwgQWZ0ZXJWaWV3SW5pdCB7XHJcbiAgQFZpZXdDaGlsZCgnZm9ybUV4ZWN1dGlvbicsIHsgc3RhdGljOiB0cnVlIH0pIGZvcm06IE5nRm9ybTtcclxuXHJcbiAgLy8gdGVtcGxhdGVzXHJcbiAgQFZpZXdDaGlsZCgnZGFpbHlUZW1wbGF0ZScsIHsgc3RhdGljOiB0cnVlIH0pIGRhaWx5VGVtcGxhdGU7XHJcbiAgQFZpZXdDaGlsZCgnbW9udGhseVRlbXBsYXRlJywgeyBzdGF0aWM6IHRydWUgfSkgbW9udGhseVRlbXBsYXRlO1xyXG4gIEBWaWV3Q2hpbGQoJ3dlZWtseVRlbXBsYXRlJywgeyBzdGF0aWM6IHRydWUgfSkgd2Vla2x5VGVtcGFsdGU7XHJcblxyXG4gIEBJbnB1dCgncC1pcy1lZGl0JykgaXNFZGl0OiBib29sZWFuID0gZmFsc2U7XHJcblxyXG4gIEBJbnB1dCgncC1saXRlcmFscycpIGxpdGVyYWxzID0gPGFueT57fTtcclxuXHJcbiAgQElucHV0KCdwLW5vLXBhcmFtZXRlcnMnKSBub1BhcmFtZXRlcnM6IEJvb2xlYW4gPSB0cnVlO1xyXG5cclxuICBAT3V0cHV0KCdwLWNoYW5nZS1wcm9jZXNzJykgY2hhbmdlUHJvY2VzczogRXZlbnRFbWl0dGVyPGFueT4gPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcclxuXHJcbiAgZGF5UGF0dGVybiA9ICdeKDNbMC0xXXxbMC0yXVswLTldfFsxLTldfDBbMS05XSkkJztcclxuICBleGlzdFByb2Nlc3NBUEkgPSB0cnVlO1xyXG4gIG1pbkRhdGVGaXJzdEV4ZWN1dGlvbiA9IG5ldyBEYXRlKCk7XHJcbiAgcGVyaW9kaWNpdHlPcHRpb25zOiBBcnJheTxQb1JhZGlvR3JvdXBPcHRpb24+ID0gW107XHJcbiAgcGVyaW9kaWNpdHlUZW1wbGF0ZXM6IHsgZGFpbHk6IFRlbXBsYXRlUmVmPGFueT47IHdlZWtseTogVGVtcGxhdGVSZWY8YW55PjsgbW9udGhseTogVGVtcGxhdGVSZWY8YW55PiB9O1xyXG4gIHRpbWVQYXR0ZXJuID0gJ14oMlswLTNdfFswMV1bMC05XSk6PyhbMC01XVswLTldKSQnO1xyXG4gIHdlZWtEYXlzOiBBcnJheTxQb0NoZWNrYm94R3JvdXBPcHRpb24+ID0gW107XHJcbiAgZnJlcXVlbmN5T3B0aW9uczogQXJyYXk8UG9SYWRpb0dyb3VwT3B0aW9uPiA9IFtdO1xyXG4gIGNvbnRhaW5zRnJlcXVlbmN5ID0gZmFsc2U7XHJcbiAgZnJlcXVlbmN5OiBzdHJpbmcgPSAnaG91cic7XHJcbiAgcmFuZ2VMaW1pdEhvdXI6IHN0cmluZztcclxuXHJcbiAgcHJpdmF0ZSBfdmFsdWU6IGFueSA9IHt9O1xyXG5cclxuICBASW5wdXQoJ3AtdmFsdWUnKSBzZXQgdmFsdWUodmFsdWU6IGFueSkge1xyXG4gICAgdGhpcy5fdmFsdWUgPSB2YWx1ZSAmJiBpc1R5cGVvZih2YWx1ZSwgJ29iamVjdCcpID8gdmFsdWUgOiB7fTtcclxuXHJcbiAgICB0aGlzLmNvbnRhaW5zRnJlcXVlbmN5ID0gdGhpcy5fdmFsdWUuZnJlcXVlbmN5ICYmIHRoaXMuX3ZhbHVlLmZyZXF1ZW5jeS52YWx1ZSA/IHRydWUgOiBmYWxzZTtcclxuICB9XHJcblxyXG4gIGdldCB2YWx1ZSgpIHtcclxuICAgIHJldHVybiB0aGlzLl92YWx1ZTtcclxuICB9XHJcblxyXG4gIGNvbnN0cnVjdG9yKFxyXG4gICAgcHJpdmF0ZSBwb1BhZ2VKb2JTY2hlZHVsZXJTZXJ2aWNlOiBQb1BhZ2VKb2JTY2hlZHVsZXJTZXJ2aWNlLFxyXG4gICAgcHVibGljIHBvUGFnZUpvYlNjaGVkdWxlckxvb2t1cDogUG9QYWdlSm9iU2NoZWR1bGVyTG9va3VwU2VydmljZVxyXG4gICkge31cclxuXHJcbiAgZ2V0IHN0YXJ0RGF0ZUZpcnN0RXhlY3V0aW9uKCkge1xyXG4gICAgcmV0dXJuIHRoaXMuaXNFZGl0ID8gdW5kZWZpbmVkIDogdGhpcy5taW5EYXRlRmlyc3RFeGVjdXRpb247XHJcbiAgfVxyXG5cclxuICBnZXQgaG91ckxhYmVsKCkge1xyXG4gICAgcmV0dXJuIHRoaXMuY29udGFpbnNGcmVxdWVuY3kgPyB0aGlzLmxpdGVyYWxzLnN0YXJ0VGltZSA6IHRoaXMubGl0ZXJhbHMudGltZTtcclxuICB9XHJcblxyXG4gIGdldCBkYXlMYWJlbCgpIHtcclxuICAgIHJldHVybiB0aGlzLmNvbnRhaW5zRnJlcXVlbmN5ID8gdGhpcy5saXRlcmFscy5zdGFydERheSA6IHRoaXMubGl0ZXJhbHMuZGF5O1xyXG4gIH1cclxuXHJcbiAgbmdBZnRlclZpZXdJbml0KCkge1xyXG4gICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgIHRoaXMuc3Vic2NyaWJlUHJvY2Vzc0lkVmFsdWVDaGFuZ2VzKCk7XHJcblxyXG4gICAgICBpZiAodGhpcy52YWx1ZS5wZXJpb2RpY2l0eSkge1xyXG4gICAgICAgIHRoaXMuZnJlcXVlbmN5T3B0aW9ucyA9IHRoaXMuZnJlcXVlbmN5T3B0aW9ucy5tYXAoZnJlcXVlbmN5T3B0aW9uID0+ICh7XHJcbiAgICAgICAgICAuLi5mcmVxdWVuY3lPcHRpb24sXHJcbiAgICAgICAgICBkaXNhYmxlZDogZnJlcXVlbmN5T3B0aW9uLnZhbHVlID09PSAnZGF5JyAmJiB0aGlzLnZhbHVlLnBlcmlvZGljaXR5ICE9PSAnbW9udGhseSdcclxuICAgICAgICB9KSk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgbmdPbkluaXQoKSB7XHJcbiAgICB0aGlzLnBlcmlvZGljaXR5VGVtcGxhdGVzID0ge1xyXG4gICAgICBkYWlseTogdGhpcy5kYWlseVRlbXBsYXRlLFxyXG4gICAgICBtb250aGx5OiB0aGlzLm1vbnRobHlUZW1wbGF0ZSxcclxuICAgICAgd2Vla2x5OiB0aGlzLndlZWtseVRlbXBhbHRlXHJcbiAgICB9O1xyXG5cclxuICAgIGlmICh0aGlzLm5vUGFyYW1ldGVycykge1xyXG4gICAgICB0aGlzLmNoZWNrRXhpc3RzUHJvY2Vzc2VzQVBJKCk7XHJcbiAgICB9XHJcblxyXG4gICAgdGhpcy5wZXJpb2RpY2l0eU9wdGlvbnMgPSB0aGlzLmdldFBlcmlvZGljaXR5T3B0aW9ucygpO1xyXG4gICAgdGhpcy53ZWVrRGF5cyA9IHRoaXMuZ2V0V2Vla0RheXMoKTtcclxuICAgIHRoaXMuZnJlcXVlbmN5T3B0aW9ucyA9IHRoaXMuZ2V0RnJlcXVlbmN5T3B0aW9ucygpO1xyXG4gIH1cclxuXHJcbiAgb25DaGFuZ2VDb250YWluc0ZyZXF1ZW5jeShjb250YWluc0ZyZXF1ZW5jeSkge1xyXG4gICAgaWYgKGNvbnRhaW5zRnJlcXVlbmN5KSB7XHJcbiAgICAgIHRoaXMudmFsdWUuZnJlcXVlbmN5ID0geyB0eXBlOiAnaG91cicsIHZhbHVlOiBudWxsIH07XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB0aGlzLnZhbHVlLmZyZXF1ZW5jeSA9IHt9O1xyXG4gICAgfVxyXG5cclxuICAgIHRoaXMudmFsdWUucmFuZ2VMaW1pdEhvdXIgPSBudWxsO1xyXG4gICAgdGhpcy52YWx1ZS5yYW5nZUxpbWl0RGF5ID0gbnVsbDtcclxuICAgIHRoaXMudmFsdWUuZGF5T2ZNb250aCA9IG51bGw7XHJcbiAgfVxyXG5cclxuICBvbkNoYW5nZVBlcmlvZGljaXR5T3B0aW9ucyhwZXJpb2RpY2l0eSkge1xyXG4gICAgdGhpcy5mcmVxdWVuY3lPcHRpb25zID0gdGhpcy5mcmVxdWVuY3lPcHRpb25zLm1hcChmcmVxdWVuY3lPcHRpb24gPT4gKHtcclxuICAgICAgLi4uZnJlcXVlbmN5T3B0aW9uLFxyXG4gICAgICBkaXNhYmxlZDogZnJlcXVlbmN5T3B0aW9uLnZhbHVlID09PSAnZGF5JyAmJiBwZXJpb2RpY2l0eSAhPT0gJ21vbnRobHknXHJcbiAgICB9KSk7XHJcblxyXG4gICAgdGhpcy52YWx1ZS5mcmVxdWVuY3kudHlwZSA9IG51bGw7XHJcbiAgfVxyXG5cclxuICBvbkNoYW5nZUZyZXF1ZW5jeU9wdGlvbnMoKSB7XHJcbiAgICB0aGlzLnZhbHVlLnJhbmdlTGltaXRIb3VyID0gbnVsbDtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgY2hlY2tFeGlzdHNQcm9jZXNzZXNBUEkoKSB7XHJcbiAgICB0aGlzLnBvUGFnZUpvYlNjaGVkdWxlclNlcnZpY2UuZ2V0SGVhZFByb2Nlc3NlcygpLnN1YnNjcmliZSh1bmRlZmluZWQsIGVycm9yID0+IHtcclxuICAgICAgdGhpcy5leGlzdFByb2Nlc3NBUEkgPSBmYWxzZTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBnZXRQZXJpb2RpY2l0eU9wdGlvbnMoKSB7XHJcbiAgICByZXR1cm4gW1xyXG4gICAgICB7IGxhYmVsOiB0aGlzLmxpdGVyYWxzLnNpbmdsZSwgdmFsdWU6ICdzaW5nbGUnIH0sXHJcbiAgICAgIHsgbGFiZWw6IHRoaXMubGl0ZXJhbHMuZGFpbHksIHZhbHVlOiAnZGFpbHknIH0sXHJcbiAgICAgIHsgbGFiZWw6IHRoaXMubGl0ZXJhbHMud2Vla2x5LCB2YWx1ZTogJ3dlZWtseScgfSxcclxuICAgICAgeyBsYWJlbDogdGhpcy5saXRlcmFscy5tb250aGx5LCB2YWx1ZTogJ21vbnRobHknIH1cclxuICAgIF07XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGdldEZyZXF1ZW5jeU9wdGlvbnMoKSB7XHJcbiAgICByZXR1cm4gW1xyXG4gICAgICB7IGxhYmVsOiB0aGlzLmxpdGVyYWxzLmRheSwgdmFsdWU6ICdkYXknIH0sXHJcbiAgICAgIHsgbGFiZWw6IHRoaXMubGl0ZXJhbHMuaG91ciwgdmFsdWU6ICdob3VyJyB9LFxyXG4gICAgICB7IGxhYmVsOiB0aGlzLmxpdGVyYWxzLm1pbnV0ZSwgdmFsdWU6ICdtaW51dGUnIH1cclxuICAgIF07XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGdldFdlZWtEYXlzKCkge1xyXG4gICAgcmV0dXJuIFtcclxuICAgICAgeyBsYWJlbDogdGhpcy5saXRlcmFscy5zdW5kYXksIHZhbHVlOiAnU3VuZGF5JyB9LFxyXG4gICAgICB7IGxhYmVsOiB0aGlzLmxpdGVyYWxzLm1vbmRheSwgdmFsdWU6ICdNb25kYXknIH0sXHJcbiAgICAgIHsgbGFiZWw6IHRoaXMubGl0ZXJhbHMudHVlc2RheSwgdmFsdWU6ICdUdWVzZGF5JyB9LFxyXG4gICAgICB7IGxhYmVsOiB0aGlzLmxpdGVyYWxzLndlZG5lc2RheSwgdmFsdWU6ICdXZWRuZXNkYXknIH0sXHJcbiAgICAgIHsgbGFiZWw6IHRoaXMubGl0ZXJhbHMudGh1cnNkYXksIHZhbHVlOiAnVGh1cnNkYXknIH0sXHJcbiAgICAgIHsgbGFiZWw6IHRoaXMubGl0ZXJhbHMuZnJpZGF5LCB2YWx1ZTogJ0ZyaWRheScgfSxcclxuICAgICAgeyBsYWJlbDogdGhpcy5saXRlcmFscy5zYXR1cmRheSwgdmFsdWU6ICdTYXR1cmRheScgfVxyXG4gICAgXTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgc3Vic2NyaWJlUHJvY2Vzc0lkVmFsdWVDaGFuZ2VzKCkge1xyXG4gICAgdGhpcy5mb3JtLmNvbnRyb2xzWydwcm9jZXNzSUQnXT8udmFsdWVDaGFuZ2VzLnN1YnNjcmliZShwcm9jZXNzSWQgPT4ge1xyXG4gICAgICB0aGlzLmNoYW5nZVByb2Nlc3MuZW1pdCh7IHByb2Nlc3NJZCwgZXhpc3RBUEk6IHRoaXMuZXhpc3RQcm9jZXNzQVBJIH0pO1xyXG4gICAgfSk7XHJcbiAgfVxyXG59XHJcbiJdfQ==